System.register(["./index-68ccac70.js","./animation-component-a7d670b3.js","./find-222dc7da.js","./node-event-40319828.js","./director-56fe9b8d.js","./pipeline-state-manager-8f16c5a7.js","./buffer-barrier-d1733967.js","./instantiate-42c48975.js","./move-8e10dd33.js","./index-811842a0.js","./create-mesh-1be8f092.js","./deprecated-51f2c4c2.js","./touch-685512cb.js","./mesh-renderer-c40c4f87.js","./mesh-97b1b18c.js","./deprecated-0752a51c.js","./model-renderer-8b84c274.js","./renderer-7bc9d919.js","./util-06cac5ac.js","./capsule-212e055a.js","./skeleton-99c82a69.js","./camera-component-9188fe5a.js","./deprecated-37e42d8f.js"],(function(t){"use strict";var e,n,i,r,o,a,s,u,l,c,h,f,p,d,v,_,y,g,m,E,T,A,b,C,S,w,P,O,N,I,x,R,k,L,M,D,B,F,U,V,G,W,z,j,H,Q,Y,q,Z,X,J,K,$,tt,et,nt,it,rt,ot,at,st,ut,lt,ct,ht,ft,pt,dt,vt,_t,yt,gt,mt,Et,Tt,At,bt,Ct,St,wt,Pt,Ot,Nt,It,xt,Rt,kt,Lt,Mt,Dt,Bt,Ft,Ut,Vt,Gt,Wt;return{setters:[function(t){e=t.bD,n=t.bA,i=t.bE,r=t.bx,o=t.aC,a=t.bg,s=t.f,u=t.w,l=t.cj,c=t.aQ,h=t.d,f=t.b$,p=t.i,d=t.cu,v=t.cv,_=t.bu,y=t.o,g=t.Q,m=t.c3,E=t.ay,T=t.cw,A=t.cx,b=t.c7,C=t.c6,S=t.e,w=t.bQ,P=t.bt,O=t.cy,N=t.J,I=t.cz,x=t.t,R=t.F,k=t.L,L=t.bF,M=t.V,D=t.I,B=t.ab,F=t.c2,U=t.br,V=t.K,G=t.ci,W=t.P,z=t.c9,j=t.C,H=t.bf,Q=t.b0,Y=t.l,q=t.bN},function(e){Z=e.C,X=e.A,J=e.c,K=e.a,$=e.T,tt=e.i,et=e.e,nt=e.U,it=e.b,rt=e.t,ot=e.n,at=e.d,st=e.f,ut=e.W,lt=e.g,ct=e.R,ht=e.V,ft=e.Q,pt=e.h,dt=e.S,vt=e.O,_t=e.j,yt=e.k,gt=e.H,mt=e.l,Et=e.m,Tt=e.o,At=e.p,bt=e.q,Ct=e.r,t({AnimCurve:e.v,Animation:e.s,AnimationClip:e.f,AnimationComponent:e.s,AnimationState:e.A,EventInfo:e.E,RatioSampler:e.u,computeRatioByType:e.x,sampleAnimationCurve:e.w})},function(t){St=t.a6,wt=t.s,Pt=t.q,Ot=t.o,Nt=t.ac,It=t.ax,xt=t.N},function(t){Rt=t.A,kt=t.C},function(t){Lt=t.a3,Mt=t.a2},function(t){Dt=t.d},function(t){Bt=t.T},function(t){Ft=t.i},function(t){Ut=t.s},function(){},function(){},function(e){Vt=e.g,Gt=e.d,Wt=e.c,t({getPathFromRoot:e.e,getWorldTransformUntilRoot:e.f})},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){var zt,jt,Ht,Qt,Yt;e(Z+"EmbeddedPlayer")((zt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).begin=jt&&jt(),e.end=Ht&&Ht(),e.reconciledSpeed=Qt&&Qt(),e.playable=Yt&&Yt(),e}return n(e,t),e}(o),jt=i(zt.prototype,"begin",[a],(function(){return 0})),Ht=i(zt.prototype,"end",[a],(function(){return 0})),Qt=i(zt.prototype,"reconciledSpeed",[a],(function(){return!1})),Yt=i(zt.prototype,"playable",[a],(function(){return null})),zt));var qt,Zt,Xt,Jt=function(){},Kt=function(){function t(t){this._randomAccess=t}return t.prototype.setTime=function(){},r(t,[{key:"randomAccess",get:function(){return this._randomAccess}}]),t}();e(Z+"EmbeddedAnimationClipPlayable")((qt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).path=Zt&&Zt(),e.clip=Xt&&Xt(),e}return n(e,t),e.prototype.instantiate=function(t){var e=this.clip,n=this.path;if(!e)return null;var i=t.getChildByPath(n);if(!i)return s(3938,n,t.getPathInHierarchy(),e.name),null;var r=new X(e);return r.initialize(i),new ee(r)},e}(Jt),Zt=i(qt.prototype,"path",[a],(function(){return""})),Xt=i(qt.prototype,"clip",[a],(function(){return null})),qt));var $t,te,ee=function(t){function e(e){var n;return(n=t.call(this,!0)||this)._animationState=void 0,n._animationState=e,n}n(e,t);var i=e.prototype;return i.destroy=function(){this._animationState.destroy()},i.play=function(){this._animationState.play()},i.pause=function(){this._animationState.pause()},i.stop=function(){this._animationState.stop()},i.setSpeed=function(t){this._animationState.speed=t},i.setTime=function(t){this._animationState.time=t},e}(Kt);e(Z+"EmbeddedParticleSystemPlayable")(($t=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).path=te&&te(),e}return n(e,t),e.prototype.instantiate=function(t){var e=t.getChildByPath(this.path);if(!e)return u("Hierarchy path "+this.path+" does not exists."),null;var n=l("cc.ParticleSystem");if(!n)return u("Particle system is required for embedded particle system player."),null;var i=e.getComponent(n);return i?new re(i):(u(this.path+" does not includes a particle system component."),null)},e}(Jt),te=i($t.prototype,"path",[a],(function(){return""})),$t));var ne,ie,re=function(t){function e(e){var n;return(n=t.call(this,!1)||this)._particleSystem=void 0,n._particleSystem=e,n}n(e,t);var i=e.prototype;return i.destroy=function(){},i.play=function(){this._particleSystem.play()},i.pause=function(){this._particleSystem.stopEmitting()},i.stop=function(){this._particleSystem.stopEmitting()},i.setSpeed=function(t){this._particleSystem.simulationSpeed=t},e}(Kt),oe=a;e(Z+"RealArrayTrack")((ne=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._channels=ie&&ie(),e}n(e,t);var i=e.prototype;return i.channels=function(){return this._channels},i[J]=function(){return new Ee(this._channels.map((function(t){return t.curve})))},r(e,[{key:"elementCount",get:function(){return this._channels.length},set:function(t){var e=this._channels.length;if(t<e)this._channels.splice(t);else if(t>e){var n;(n=this._channels).push.apply(n,Array.from({length:t-e},(function(){return new K(new c)})))}}}]),e}($),ie=i(ne.prototype,"_channels",[oe],(function(){return[]})),ne));var ae,se,ue,le,ce,he,fe,pe,de,ve,_e,ye,ge,me,Ee=function(){function t(t){this._curves=t,this._result=new Array(t.length).fill(0)}return t.prototype.evaluate=function(t){for(var e=this._result,n=e.length,i=0;i<n;++i)e[i]=this._curves[i].evaluate(t);return this._result},r(t,[{key:"requiresDefault",get:function(){return!1}}]),t}(),Te=e("cc.animation.UniformProxyFactory")((se=function(){function t(t,e){this.passIndex=ue&&ue(),this.uniformName=le&&le(),d(this,"channelIndex",ce,this),this.passIndex=e||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){if(t instanceof St){var e=this.passIndex,n=this.uniformName,i=this.channelIndex;if(e<0||e>=t.passes.length)h(3941,t.name,e);else{var r=t.passes[e],o=r.getHandle(n);if(o){if(wt.getTypeFromHandle(o)<Bt.SAMPLER1D){var a=void 0===i?o:r.getHandle(n,i,Bt.FLOAT);return a?function(t,e){for(var n,i=p(t.shaderInfo.blocks);!(n=i()).done;)for(var r,o=n.value,a=p(o.members);!(r=a()).done;){var s=r.value;if(s.name===e)return s.count>1}return!1}(r,n)?{set:function(t){r.setUniformArray(a,t)}}:{set:function(t){r.setUniform(a,t)}}:void h(3943,t.name,e,n,i)}var s=wt.getBindingFromHandle(o),l=r.properties[n],c=l&&l.value?""+l.value+Pt(l.type):Ot(l.type),f=Nt.get(c);return f||(u("Illegal texture default value: "+c+"."),f=Nt.get("default-texture")),{set:function(t){t||(t=f);var e=t.getGFXTexture();e&&e.width&&e.height&&(r.bindTexture(s,e),t instanceof It&&r.bindSampler(s,Dt.gfxDevice.getSampler(t.getSamplerInfo())))}}}h(3942,t.name,e,n)}}else h(3940,t)},t}(),ue=i(se.prototype,"passIndex",[a],(function(){return 0})),le=i(se.prototype,"uniformName",[a],(function(){return""})),ce=f(se.prototype,"channelIndex",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),ae=se))||ae,Ae=e("cc.animation.MorphWeightValueProxy")((fe=function(){function t(){this.subMeshIndex=pe&&pe(),this.shapeIndex=de&&de()}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeight(n,e.subMeshIndex,e.shapeIndex)}}},t}(),pe=i(fe.prototype,"subMeshIndex",[a],(function(){return 0})),de=i(fe.prototype,"shapeIndex",[a],(function(){return 0})),he=fe))||he,be=e("cc.animation.MorphWeightsValueProxy")((_e=function(){function t(){this.subMeshIndex=ye&&ye()}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeights(n,e.subMeshIndex)}}},t}(),ye=i(_e.prototype,"subMeshIndex",[a],(function(){return 0})),ve=_e))||ve,Ce=e("cc.animation.MorphWeightsAllValueProxy")(ge=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(e){for(var n,i,r=null!==(n=null===(i=t.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0,o=0;o<r;++o)t.setWeights(e,o)}}},t}())||ge,Se=Symbol("[[Owner]]");function we(t,e){_(t[Se]===e)}!function(t){t[t.FLOAT=0]="FLOAT",t[t.BOOLEAN=1]="BOOLEAN",t[t.TRIGGER=2]="TRIGGER",t[t.INTEGER=3]="INTEGER",t[t.VEC3_experimental=4]="VEC3_experimental",t[t.QUAT_experimental=5]="QUAT_experimental"}(me||(me={}));var Pe,Oe,Ne,Ie,xe,Re,ke,Le,Me=Symbol("CreateInstance"),De=function(){function t(t){this._refs=[],this.type=t}return t.prototype.bind=function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._refs.push({fn:t,thisArg:e,args:i}),this.getValue()},r(t,[{key:"value",get:function(){return this.getValue()},set:function(t){this.setValue(t);for(var e,n=p(this._refs);!(e=n()).done;){var i=e.value,r=i.fn,o=i.thisArg,a=i.args;r.call.apply(r,[o,t].concat(a))}}}]),t}(),Be=e("cc.animation.PlainVariable")((Oe=function(){function t(t){if(this._type=Ne&&Ne(),this._value=Ie&&Ie(),void 0!==t)switch(this._type=t,t){default:break;case me.FLOAT:case me.INTEGER:this._value=0;break;case me.BOOLEAN:this._value=!1}}return t.prototype[Me]=function(){return new Fe(this._type,this._value)},r(t,[{key:"type",get:function(){return this._type}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}(),Ne=i(Oe.prototype,"_type",[a],(function(){return me.FLOAT})),Ie=i(Oe.prototype,"_value",[a],(function(){return 0})),Pe=Oe))||Pe,Fe=function(t){function e(e,n){var i;return(i=t.call(this,e)||this)._value=void 0,i._value=n,i}n(e,t);var i=e.prototype;return i.getValue=function(){return this._value},i.setValue=function(t){this._value=t},e}(De);!function(t){t[t.AFTER_CONSUMED=0]="AFTER_CONSUMED",t[t.NEXT_FRAME_OR_AFTER_CONSUMED=1]="NEXT_FRAME_OR_AFTER_CONSUMED"}(Le||(Le={})),_(0==(0|Le.AFTER_CONSUMED<<1));var Ue,Ve,Ge,We,ze,je,He,Qe,Ye,qe,Ze,Xe,Je=e("cc.animation.TriggerVariable")((Re=function(){function t(){this._flags=ke&&ke()}return t.prototype[Me]=function(){return new Ke(this.value,this.resetMode)},r(t,[{key:"type",get:function(){return me.TRIGGER}},{key:"value",get:function(){return!!((1&this._flags)>>0)},set:function(t){t?this._flags|=1:this._flags&=-2}},{key:"resetMode",get:function(){return(6&this._flags)>>1},set:function(t){this._flags&=-7,this._flags|=t<<1}}]),t}(),ke=i(Re.prototype,"_flags",[a],(function(){return 0})),xe=Re))||xe,Ke=function(t){function e(e,n){var i;return(i=t.call(this,me.TRIGGER)||this).resetMode=Le.AFTER_CONSUMED,i._value=void 0,i.resetMode=n,i._value=e,i}n(e,t);var i=e.prototype;return i.getValue=function(){return this._value},i.setValue=function(t){this._value=t},e}(De),$e=e("cc.animation.Vec3Variable")((Ve=function(){function t(){this._value=Ge&&Ge()}return t.prototype[Me]=function(){return new tn(this.value)},r(t,[{key:"type",get:function(){return me.VEC3_experimental}},{key:"value",get:function(){return this._value},set:function(t){y.copy(this._value,t)}}]),t}(),Ge=i(Ve.prototype,"_value",[a],(function(){return new y})),Ue=Ve))||Ue,tn=function(t){function e(e){var n;return(n=t.call(this,me.VEC3_experimental)||this)._value=new y,y.copy(n._value,e),n}n(e,t);var i=e.prototype;return i.getValue=function(){return this._value},i.setValue=function(t){y.copy(this._value,t)},e}(De),en=e("cc.animation.QuatVariable")((ze=function(){function t(){this._value=je&&je()}return t.prototype[Me]=function(){return new nn(this._value)},r(t,[{key:"type",get:function(){return me.QUAT_experimental}},{key:"value",get:function(){return this._value},set:function(t){g.copy(this._value,t)}}]),t}(),je=i(ze.prototype,"_value",[a],(function(){return new g})),We=ze))||We,nn=function(t){function e(e){var n;return(n=t.call(this,me.QUAT_experimental)||this)._value=new g,g.copy(n._value,e),n}n(e,t);var i=e.prototype;return i.getValue=function(){return this._value},i.setValue=function(t){g.copy(this._value,t)},e}(De),rn=function(t){function e(e){var n;return(n=t.call(this,e+" transition is invalid")||this).name="TransitionRejectError",n}return n(e,t),e}(m(Error)),on=function(t){function e(e){return t.call(this,"Graph variable "+e+" is not defined")||this}return n(e,t),e}(m(Error)),an=function(t){function e(e,n,i){return t.call(this,"Expect graph variable "+e+" to have type '"+n+"' instead of received '"+(null!=i?i:typeof i)+"'")||this}return n(e,t),e}(m(Error));function sn(t){var e=t[E];if("object"==typeof e&&e){var n,i=e;return null===(n=i.clone)||void 0===n?void 0:n.call(i,t)}}var un,ln,cn,hn,fn,pn,dn,vn,_n,yn,gn,mn,En=Symbol("[[Outgoing transitions]]"),Tn=Symbol("[[Incoming transitions]]"),An=e,bn=a,Cn=An("cc.animation.State")((Qe=function(t){function e(){var e;return(e=t.call(this)||this).name=Ye&&Ye(),e[En]=[],e[Tn]=[],e}return n(e,t),e.prototype.copyTo=function(t){t.name=this.name,t[E]=sn(this)},e}(o),Ye=i(Qe.prototype,"name",[bn],(function(){return""})),He=Qe))||He,Sn=An(Z+"InteractiveState")((Ze=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._components=Xe&&Xe(),e}n(e,t);var i=e.prototype;return i.addComponent=function(t){var e=new t;return this._components.push(e),e},i.removeComponent=function(t){T(this._components,t)},i.instantiateComponents=function(){return this._components.map((function(t){return Ft(t)}))},i.copyTo=function(e){t.prototype.copyTo.call(this,e),e._components=this.instantiateComponents()},r(e,[{key:"components",get:function(){return this._components}}]),e}(Cn),Xe=i(Ze.prototype,"_components",[bn],(function(){return[]})),qe=Ze))||qe,wn=e(Z+"AnimationGraphEventBinding")((ln=function(){function t(){this.methodName=cn&&cn()}var e=t.prototype;return e.emit=function(t){this.methodName&&tt(t,this.methodName,[])},e.copyTo=function(t){return t.methodName=this.methodName,this},r(t,[{key:"isBound",get:function(){return!!this.methodName}}]),t}(),cn=i(ln.prototype,"methodName",[a],(function(){return""})),un=ln))||un,Pn=e("cc.animation.Motion")((fn=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).motion=pn&&pn(),e.speed=dn&&dn(),e.speedMultiplier=vn&&vn(),e.speedMultiplierEnabled=_n&&_n(),e.transitionInEventBinding=yn&&yn(),e.transitionOutEventBinding=gn&&gn(),e}n(e,t);var i=e.prototype;return i.__callOnAfterDeserializeRecursive=function(){var t;null===(t=this.motion)||void 0===t||t.__callOnAfterDeserializeRecursive()},i.copyTo=function(e){var n,i;return t.prototype.copyTo.call(this,e),e.motion=null!==(n=null===(i=this.motion)||void 0===i?void 0:i.clone())&&void 0!==n?n:null,e.speed=this.speed,e.speedMultiplier=this.speedMultiplier,e.speedMultiplierEnabled=this.speedMultiplierEnabled,this.transitionInEventBinding.copyTo(e.transitionInEventBinding),this.transitionOutEventBinding.copyTo(e.transitionOutEventBinding),this},e}(Sn),pn=i(fn.prototype,"motion",[a],(function(){return null})),dn=i(fn.prototype,"speed",[a],(function(){return 1})),vn=i(fn.prototype,"speedMultiplier",[a],(function(){return""})),_n=i(fn.prototype,"speedMultiplierEnabled",[a],(function(){return!1})),yn=i(fn.prototype,"transitionInEventBinding",[a],(function(){return new wn})),gn=i(fn.prototype,"transitionOutEventBinding",[a],(function(){return new wn})),hn=fn))||hn,On=Symbol("[[OnAfterDeserialized]]"),Nn=e(Z+"AnimationGraphLike")(mn=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e}(Rt))||mn;function In(t,e,n){var i=Object.prototype.propertyIsEnumerable;if(!i.call(t,e))return t;if(n in t)return t;var r={};return"symbol"==typeof e?(Object.entries(t).forEach((function(t){var e=t[0],n=t[1];r[e]=n})),Object.getOwnPropertySymbols(t).forEach((function(o){i.call(t,o)&&(r[o===e?n:o]=t[o])}))):(Object.entries(t).forEach((function(t){var i=t[0],o=t[1];r[i===e?n:i]=o})),Object.getOwnPropertySymbols(t).forEach((function(e){i.call(t,e)&&(r[e]=t[e])}))),r}var xn,Rn,kn,Ln,Mn,Dn,Bn,Fn,Un=function(){var t=!1;try{t=[]instanceof function(){function t(){}return t[Symbol.hasInstance]=function(t){return Array.isArray(t)},t}()}catch(e){t=!1}return t?function(t){function e(){throw new Error("This function can not be called as a constructor.")}return Object.defineProperty(e,Symbol.hasInstance,{value:function(e){return e instanceof t}}),e}:function(t){return t}}(),Vn=e(Z+"PoseGraphNodeShell")((Rn=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._bindings=kn&&kn(),e}n(e,t);var i=e.prototype;return i.getBindings=function(){return this._bindings},i.addBinding=function(t,e,n){this._emplaceBinding(new zn(t,e,n))},i.deleteBinding=function(t){var e=this._findBindingIndex(t);e>=0&&this._bindings.splice(e,1)},i.moveArrayElementBindingForward=function(t,e,n){for(var i=this._bindings,r=[],o=0;o<i.length;++o){var a=i[o],s=a.inputPath,u=s[0],l=s[1];u===t&&(void 0===l?-1:l)>=e&&(r.push(a),i.splice(o,1))}for(var c=0,h=r;c<h.length;c++){var f=h[c],p=f.inputPath,d=p[0],v=p[1],_=void 0===v?-1:v;this.addBinding([d,_+(n?-1:1)],f.producer,f.outputIndex)}},i.deleteBindingTo=function(t){for(var e=this._bindings,n=0;n<e.length;++n)e[n].producer===t&&e.splice(n,1)},i.findBinding=function(t){var e=this._findBindingIndex(t);return e>=0?this._bindings[e]:void 0},i._findBindingIndex=function(t){return this._bindings.findIndex((function(e){return Gn(e.inputPath,t)}))},i._emplaceBinding=function(t){var e=this._bindings.findIndex((function(e){return Gn(e.inputPath,t.inputPath)}));e>=0?this._bindings[e]=t:this._bindings.push(t)},e}(o),kn=i(Rn.prototype,"_bindings",[a],(function(){return[]})),xn=Rn))||xn;function Gn(t,e){var n=t[0],i=t[1],r=e[0],o=e[1];return n===r&&i===o}var Wn,zn=e(Z+"PoseGraphNodeInputBinding")((Mn=function(){function t(t,e,n){this._inputPath=Dn&&Dn(),this._producer=Bn&&Bn(),this._outputIndex=Fn&&Fn(),this._inputPath=t,this._producer=e,void 0!==n&&(this._outputIndex=n)}return r(t,[{key:"inputPath",get:function(){return this._inputPath}},{key:"producer",get:function(){return this._producer}},{key:"outputIndex",get:function(){return this._outputIndex}}]),t}(),Dn=i(Mn.prototype,"_inputPath",[a],null),Bn=i(Mn.prototype,"_producer",[a],null),Fn=i(Mn.prototype,"_outputIndex",[a],(function(){return 0})),Ln=Mn))||Ln,jn=function(t){function e(e){return t.call(this,"Can not add the specified "+e.toString()+" since it has already been added into another graph.")||this}return n(e,t),e}(m(Error)),Hn=function(t){function e(e){return t.call(this,"Can not perform specified operation on "+e.toString()+" since it has not been added in to graph.")||this}return n(e,t),e}(m(Error));!function(t){t[t.FLOAT=0]="FLOAT",t[t.INTEGER=1]="INTEGER",t[t.BOOLEAN=2]="BOOLEAN",t[t.VEC3=3]="VEC3",t[t.QUAT=4]="QUAT",t[t.POSE=5]="POSE"}(Wn||(Wn={}));var Qn=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e}(o),Yn=["arraySyncGroup"];function qn(t,e,n,i){var r=t.getShell(e);if(!r)throw new Hn(e);var o=n[0],a=n[1],s=void 0===a?-1:a,u=e[o];Array.isArray(u)&&(u.splice(s,0,i),r.moveArrayElementBindingForward(o,s+1,!1))}function Zn(t,e,n){var i=t.getShell(e);if(!i)throw new Hn(e);var r=n[0],o=n[1],a=void 0===o?-1:o,s=e[r];Array.isArray(s)&&(a<0||a>=s.length||(i.deleteBinding(n),s.splice(a,1),i.moveArrayElementBindingForward(r,a+1,!0)))}function Xn(t){switch(t){default:case Wn.FLOAT:case Wn.INTEGER:return 0;case Wn.BOOLEAN:return!1;case Wn.POSE:return null;case Wn.VEC3:return new y;case Wn.QUAT:return new g}}var Jn=new(function(){function t(){this._classInputMap=new WeakMap}var e=t.prototype;return e.setPropertyNodeInputRecord=function(t,e,n){var i=this._classInputMap.get(t);i||(i={properties:{}},this._classInputMap.set(t,i)),n.arraySyncGroup;var r=A(n,Yn),o=n.arraySyncGroup;if(o){var a,s;i.arraySyncGroups||(i.arraySyncGroups={});var u=null!==(s=(a=i.arraySyncGroups)[o])&&void 0!==s?s:a[o]={members:[]};u.members.includes(e)||u.members.push(e),r.arraySyncGroup=u}i.properties[e]=Object.freeze(r)},e.getInputKeys=function(t){var e=this,n=[];return function i(r){if(r){i(b(r));var o=e._classInputMap.get(r);if(o)for(var a=function(){var e=u[s][0];if(n.findIndex((function(t){var n=t[0];return e===n}))>=0)return"continue";var i=t[e];if(Array.isArray(i))for(var r=0;r<i.length;++r)n.push([e,r]);else n.push([e])},s=0,u=Object.entries(o.properties);s<u.length;s++)a()}}(t.constructor),n},e.isPoseInput=function(t,e){var n=e[0],i=this._getPropertyNodeInputRecord(t.constructor,n);return!!i&&i.type===Wn.POSE},e.getInputMetadata=function(t,e){var n=e[0],i=e[1],r=void 0===i?-1:i,o=this._getPropertyNodeInputRecord(t.constructor,n);if(o){var a=t[n];if(Array.isArray(a)){if(r<0||r>=a.length)return;var s,u,l=null!==(s=null===(u=o.getArrayElementDisplayName)||void 0===u?void 0:u.call(t,r))&&void 0!==s?s:o.displayName;return{type:o.type,displayName:l,deletable:!(o.arraySyncGroup&&o.arraySyncGroupFollower),insertPoint:!0}}return{type:o.type,displayName:o.displayName}}},e.hasInput=function(t,e){var n=e[0],i=e[1],r=void 0===i?-1:i;if(!this._getPropertyNodeInputRecord(t.constructor,n))return!1;var o=t[n];return!Array.isArray(o)||!(r<0||r>=o.length)},e.getInputInsertInfos=function(t){for(var e={},n=t.constructor;n;n=b(n)){var i=this._classInputMap.get(n);if(i)for(var r in i.properties){var o=i.properties[r],a=t[r];if(Array.isArray(a)){if(o.arraySyncGroup&&o.arraySyncGroupFollower)continue;e[r]={displayName:r}}}}return e},e.deleteInput=function(t,e,n){var i=n[0],r=n[1],o=void 0===r?-1:r,a=this._getPropertyNodeInputRecord(e.constructor,i);if(a){var s=e[i];if(Array.isArray(s)&&!(o<0||o>=s.length)){var u=a.arraySyncGroup;u?this._deleteInputInArraySyncGroup(t,e,u,s.length,o):Zn(t,e,n)}}},e.insertInput=function(t,e,n){var i=n,r=this._getPropertyNodeInputRecord(e.constructor,i);if(r){var o=e[i];if(Array.isArray(o)){var a=o.length,s=r.arraySyncGroup;s?this._insertInputInArraySyncGroup(t,e,s,o.length,a):qn(t,e,[i,a],Xn(r.type))}}},e._getPropertyNodeInputRecord=function(t,e){if(t){var n=this._classInputMap.get(t);if(n){var i=n.properties[e];if(i)return i}return this._getPropertyNodeInputRecord(b(t),e)}},e._insertInputInArraySyncGroup=function(t,e,n,i,r){for(var o=0;o<n.members.length;++o){var a=n.members[o],s=this._getPropertyNodeInputRecord(e.constructor,a),u=e[a];Array.isArray(u)&&u.length===i&&qn(t,e,[a,r],Xn(s.type))}},e._deleteInputInArraySyncGroup=function(t,e,n,i,r){for(var o=0;o<n.members.length;++o){var a=n.members[o];this._getPropertyNodeInputRecord(e.constructor,a);var s=e[a];Array.isArray(s)&&s.length===i&&Zn(t,e,[a,r])}},t}()),Kn=new WeakMap;function $n(t){return function(e){if(C(e,Qn)||(S("This kind of decorator should only be applied to pose graph node classes."),0)){var n=function(t){var e=Kn.get(t);if(e)return e;var n={};return Kn.set(t,n),n}(e);t(n)}}}var ti,ei,ni,ii,ri,oi,ai,si,ui,li=function(t){return $n((function(e){e.category=t}))},ci=function(t){return $n((function(e){e.factory=t}))},hi=function(t){return void 0===t&&(t=!0),$n((function(e){e.hide=t}))},fi=function(t){return $n((function(e){var n;Object.assign(null!==(n=e.appearance)&&void 0!==n?n:e.appearance={},t)}))},pi=e(Z+"PoseGraphOutputNode")(ti=fi({themeColor:"#CD3A58",inline:!0})((ei=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).pose=ni&&ni(),e}return n(e,t),e}(Qn),ni=i(ei.prototype,"pose",[a],(function(){return null})),ti=ei))||ti)||ti;Jn.setPropertyNodeInputRecord(pi,"pose",{type:Wn.POSE});var di,vi,_i,yi,gi,mi,Ei,Ti,Ai,bi,Ci,Si,wi,Pi,Oi,Ni,Ii,xi,Ri,ki,Li,Mi,Di,Bi,Fi,Ui,Vi,Gi,Wi,zi,ji,Hi,Qi,Yi,qi,Zi,Xi,Ji,Ki,$i,tr,er,nr,ir,rr,or,ar,sr,ur,lr,cr,hr,fr,pr,dr=e(Z+"PoseGraph")((ri=function(t){function e(){var e;return(e=t.call(this)||this)._outputNode=oi&&oi(),e._nodes=ai&&ai(),e._shells=si&&si(),e._shellMap=ui&&ui(),e.addNode(e._outputNode),e}n(e,t);var i=e.prototype;return i.__callOnAfterDeserializeRecursive=function(){_(this._nodes.length===this._shells.length);for(var t=0;t<this._nodes.length;++t){var e,n=this._nodes[t],i=this._shells[t];this._shellMap.set(n,i),null===(e=n.__callOnAfterDeserializeRecursive)||void 0===e||e.call(n)}},i.nodes=function(){return this._nodes.values()},i.addNode=function(t){if(this._shellMap.has(t))throw new jn(t);var e=new Vn;return this._shells.push(e),this._nodes.push(t),this._shellMap.set(t,e),t},i.removeNode=function(t){if(t!==this._outputNode){var e=this._nodes.indexOf(t);if(!(e<0)){_(this._shellMap.has(t));for(var n,i=p(this._shells);!(n=i()).done;)n.value.deleteBindingTo(t);w(this._shells,e),w(this._nodes,e),this._shellMap.delete(t)}}else S("Can not remove the output node.")},i.getShell=function(t){return this._shellMap.get(t)},r(e,[{key:"outputNode",get:function(){return this._outputNode}}]),e}(o),oi=i(ri.prototype,"_outputNode",[a],(function(){return new pi})),ai=i(ri.prototype,"_nodes",[a],(function(){return[]})),si=i(ri.prototype,"_shells",[a],(function(){return[]})),ui=i(ri.prototype,"_shellMap",[a],(function(){return new Map})),ii=ri))||ii,vr=e(Z+"Transition")((vi=function(t){function e(e,n,i){var r;return(r=t.call(this)||this).from=_i&&_i(),r.to=yi&&yi(),r.conditions=gi&&gi(),r[Se]=void 0,r.from=e,r.to=n,i&&(r.conditions=i),r}return n(e,t),e.prototype.copyTo=function(t){t.conditions=this.conditions.map((function(t){return t.clone()}))},e}(o),_i=i(vi.prototype,"from",[a],null),yi=i(vi.prototype,"to",[a],null),gi=i(vi.prototype,"conditions",[a],(function(){return[]})),di=vi))||di,_r=e(Z+"DurationalTransition")((Ei=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).destinationStart=Ti&&Ti(),e.relativeDestinationStart=Ai&&Ai(),e.startEventBinding=bi&&bi(),e.endEventBinding=Ci&&Ci(),e[Se]=void 0,e}return n(e,t),e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.destinationStart=this.destinationStart,e.relativeDestinationStart=this.relativeDestinationStart,this.startEventBinding.copyTo(e.startEventBinding),this.endEventBinding.copyTo(e.endEventBinding)},e}(vr),Ti=i(Ei.prototype,"destinationStart",[a],(function(){return 0})),Ai=i(Ei.prototype,"relativeDestinationStart",[a],(function(){return!1})),bi=i(Ei.prototype,"startEventBinding",[a],(function(){return new wn})),Ci=i(Ei.prototype,"endEventBinding",[a],(function(){return new wn})),mi=Ei))||mi,yr=e(Z+"AnimationTransition")((wi=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).duration=Pi&&Pi(),e.relativeDuration=Oi&&Oi(),e.exitConditionEnabled=Ni&&Ni(),e._exitCondition=Ii&&Ii(),e}return n(e,t),e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.duration=this.duration,e.relativeDuration=this.relativeDuration,e.exitConditionEnabled=this.exitConditionEnabled,e.exitCondition=this.exitCondition},r(e,[{key:"exitCondition",get:function(){return this._exitCondition},set:function(t){this._exitCondition=t}}]),e}(_r),Pi=i(wi.prototype,"duration",[a],(function(){return.3})),Oi=i(wi.prototype,"relativeDuration",[a],(function(){return!1})),Ni=i(wi.prototype,"exitConditionEnabled",[a],(function(){return!0})),Ii=i(wi.prototype,"_exitCondition",[a],(function(){return 1})),Si=wi))||Si;function gr(t){return t instanceof yr}var mr,Er=e(Z+"EmptyState")(xi=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e}(Cn))||xi,Tr=e(Z+"EmptyStateTransition")((ki=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).duration=Li&&Li(),e}return n(e,t),e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.duration=this.duration},e}(_r),Li=i(ki.prototype,"duration",[a],(function(){return.3})),Ri=ki))||Ri,Ar=e(Z+"ProceduralPoseState")((Di=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).graph=Bi&&Bi(),e.transitionInEventBinding=Fi&&Fi(),e.transitionOutEventBinding=Ui&&Ui(),e}n(e,t);var i=e.prototype;return i.__callOnAfterDeserializeRecursive=function(){this.graph.__callOnAfterDeserializeRecursive()},i.copyTo=function(e){return t.prototype.copyTo.call(this,e),this.transitionInEventBinding.copyTo(e.transitionInEventBinding),this.transitionOutEventBinding.copyTo(e.transitionOutEventBinding),this},e}(Cn),Bi=i(Di.prototype,"graph",[a],(function(){return new dr})),Fi=i(Di.prototype,"transitionInEventBinding",[a],(function(){return new wn})),Ui=i(Di.prototype,"transitionOutEventBinding",[a],(function(){return new wn})),Mi=Di))||Mi,br=Un(Ar),Cr=e(Z+"ProceduralPoseTransition")((Gi=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).duration=Wi&&Wi(),e}return n(e,t),e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.duration=this.duration},e}(_r),Wi=i(Gi.prototype,"duration",[a],(function(){return.3})),Vi=Gi))||Vi,Sr=Un(Cr),wr=e("cc.animation.StateMachine")((ji=function(t){n(i,t);var e=i.prototype;function i(e){var n;return(n=t.call(this)||this)._states=Hi&&Hi(),n._transitions=Qi&&Qi(),n._entryState=Yi&&Yi(),n._exitState=qi&&qi(),n._anyState=Zi&&Zi(),n._allowEmptyStates=!0,n._allowEmptyStates=null!=e&&e,n._entryState=n._addState(new Cn),n._entryState.name="Entry",n._exitState=n._addState(new Cn),n._exitState.name="Exit",n._anyState=n._addState(new Cn),n._anyState.name="Any",n}return e.__callOnAfterDeserializeRecursive=function(){this[On]();for(var t=this._states.length,e=0;e<t;++e){var n=this._states[e];n instanceof Pr?n.stateMachine.__callOnAfterDeserializeRecursive():(n instanceof Ar||n instanceof Pn)&&n.__callOnAfterDeserializeRecursive()}},e[On]=function(){this._states.forEach((function(){})),this._transitions.forEach((function(t){t.from[En].push(t),t.to[Tn].push(t)}))},e.states=function(){return this._states},e.transitions=function(){return this._transitions},e.getTransitionsBetween=function(t,e){return we(t,this),we(e,this),t[En].filter((function(t){return t.to===e}))},e.getOutgoings=function(t){return we(t,this),t[En]},e.getIncomings=function(t){return we(t,this),t[Tn]},e.addMotion=function(){return this._addState(new Pn)},e.addSubStateMachine=function(){return this._addState(new Pr(this._allowEmptyStates))},e.addEmpty=function(){if(!this._allowEmptyStates)throw new Error("Empty states are now allowed in this state machine.");return this._addState(new Er)},e.addProceduralPoseState=function(){return this._addState(new Ar)},e.remove=function(t){we(t,this),t!==this.entryState&&t!==this.exitState&&t!==this.anyState&&(this.eraseTransitionsIncludes(t),T(this._states,t))},e.connect=function(t,e,n){if(we(t,this),we(e,this),e===this.entryState)throw new rn("to-entry");if(e===this.anyState)throw new rn("to-any");if(t===this.exitState)throw new rn("from-exit");var i=t instanceof Pn||t===this._anyState?new yr(t,e,n):t instanceof Er?new Tr(t,e,n):t instanceof Ar?new Cr(t,e,n):new vr(t,e,n);return this._transitions.push(i),t[En].push(i),e[Tn].push(i),i},e.disconnect=function(t,e){we(t,this),we(e,this);for(var n=t[En],i=e[Tn],r=this._transitions,o=n.filter((function(t){return t.to===e})),a=o.length,s=function(){var t=o[u];T(n,t),_(T(r,t)),P(O(i,(function(e){return e===t})))},u=0;u<a;++u)s()},e.removeTransition=function(t){_(T(this._transitions,t)),P(O(t.from[En],(function(e){return e===t}))),P(O(t.to[Tn],(function(e){return e===t})))},e.eraseOutgoings=function(t){var e=this;we(t,this);for(var n=t[En],i=function(){var t=n[r],i=t.to;_(T(e._transitions,t)),P(O(i[Tn],(function(e){return e===t})))},r=0;r<n.length;++r)i();n.length=0},e.eraseIncomings=function(t){var e=this;we(t,this);for(var n=t[Tn],i=function(){var t=n[r],i=t.from;_(T(e._transitions,t)),P(O(i[En],(function(e){return e===t})))},r=0;r<n.length;++r)i();n.length=0},e.eraseTransitionsIncludes=function(t){this.eraseIncomings(t),this.eraseOutgoings(t)},e.adjustTransitionPriority=function(t,e){var n=t.from;if(0!==e){var i=n[En],r=i.indexOf(t),o=N(r+e,0,i.length-1),a=this._transitions,s=a.indexOf(t);if(o>r)for(var u=r+1;u<=o;++u){var l=i[u],c=a.indexOf(l);a[s]=l,s=c}else if(r>o)for(var h=r-1;h>=o;--h){var f=i[h],p=a.indexOf(f);a[s]=f,s=p}a[s]=t,Ut(i,r,o)}},e.copyTo=function(t){for(var e,n=t._states.filter((function(e){switch(e){case t._entryState:case t._exitState:case t._anyState:return!0;default:return!1}})),i=p(n);!(e=i()).done;){var r=e.value;t.remove(r)}for(var o,a=new Map,s=p(this._states);!(o=s()).done;){var u=o.value;switch(u){case this._entryState:a.set(u,t._entryState);break;case this._exitState:a.set(u,t._exitState);break;case this._anyState:a.set(u,t._anyState);break;default:if(u instanceof Pn||u instanceof Pr||u instanceof Er||u instanceof Ar){if(u instanceof Er&&!t._allowEmptyStates)continue;var l=Ft(u);t._addState(l),a.set(u,l)}}}for(var c,h=p(this._transitions);!(c=h()).done;){var f=c.value;if(t._allowEmptyStates||!(f.from instanceof Er||f.to instanceof Er)){var d=a.get(f.from),v=a.get(f.to),_=t.connect(d,v);_.conditions=f.conditions.map((function(t){return t.clone()})),f.copyTo(_)}}},e.clone=function(){var t=new i(this._allowEmptyStates);return this.copyTo(t),t},e._addState=function(t){return this._states.push(t),t},r(i,[{key:"allowEmptyStates",get:function(){return this._allowEmptyStates}},{key:"entryState",get:function(){return this._entryState}},{key:"exitState",get:function(){return this._exitState}},{key:"anyState",get:function(){return this._anyState}}]),i}(o),Hi=i(ji.prototype,"_states",[a],(function(){return[]})),Qi=i(ji.prototype,"_transitions",[a],(function(){return[]})),Yi=i(ji.prototype,"_entryState",[a],null),qi=i(ji.prototype,"_exitState",[a],null),Zi=i(ji.prototype,"_anyState",[a],null),zi=ji))||zi,Pr=e("cc.animation.SubStateMachine")((Ji=function(t){function e(e){var n;return(n=t.call(this)||this)._stateMachine=Ki&&Ki(),n._stateMachine=new wr(e),n}return n(e,t),e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),this._stateMachine.copyTo(e._stateMachine)},r(e,[{key:"stateMachine",get:function(){return this._stateMachine}}]),e}(Sn),Ki=i(Ji.prototype,"_stateMachine",[a],null),Xi=Ji))||Xi,Or=e(Z+"PoseGraphStash")((tr=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).graph=er&&er(),e}return n(e,t),e}(o),er=i(tr.prototype,"graph",[a],(function(){return new dr})),$i=tr))||$i,Nr=e("cc.animation.Layer")((ir=function(){var t=e.prototype;function e(){this[Se]=void 0,this._stateMachine=rr&&rr(),this.name=or&&or(),this.weight=ar&&ar(),this.mask=sr&&sr(),this.additive=ur&&ur(),this._stashes=lr&&lr(),this._stateMachine=new wr(!0)}return t.__callOnAfterDeserializeRecursive=function(){for(var t in this.stateMachine._allowEmptyStates=!0,this.stateMachine.__callOnAfterDeserializeRecursive(),this._stashes)this._stashes[t].graph.__callOnAfterDeserializeRecursive()},t.stashes=function(){return Object.entries(this._stashes)},t.getStash=function(t){return this._stashes[t]},t.addStash=function(t){return this._stashes[t]=new Or},t.removeStash=function(t){delete this._stashes[t]},t.renameStash=function(t,e){this._stashes=In(this._stashes,t,e)},r(e,[{key:"stateMachine",get:function(){return this._stateMachine}}]),e}(),rr=i(ir.prototype,"_stateMachine",[a],null),or=i(ir.prototype,"name",[a],(function(){return""})),ar=i(ir.prototype,"weight",[a],(function(){return 1})),sr=i(ir.prototype,"mask",[a],(function(){return null})),ur=i(ir.prototype,"additive",[a],(function(){return!1})),lr=i(ir.prototype,"_stashes",[a],(function(){return{}})),nr=ir))||nr;!function(t){t[t.override=0]="override",t[t.additive=1]="additive"}(mr||(mr={}));var Ir,xr=e("cc.animation.AnimationGraph")((hr=function(t){function e(){var e;return(e=t.call(this)||this)._layers=fr&&fr(),e._variables=pr&&pr(),e}n(e,t);var i=e.prototype;return i.onLoaded=function(){for(var t=this._layers,e=t.length,n=0;n<e;++n)t[n].__callOnAfterDeserializeRecursive()},i.addLayer=function(){var t=new Nr;return this._layers.push(t),t},i.removeLayer=function(t){w(this._layers,t)},i.moveLayer=function(t,e){Ut(this._layers,t,e)},i.addVariable=function(t,e,n){var i=function(t,e){var n;switch(t){case me.FLOAT:case me.INTEGER:case me.BOOLEAN:n=new Be(t);break;case me.TRIGGER:n=new Je;break;case me.VEC3_experimental:n=new $e;break;case me.QUAT_experimental:n=new en;break;default:throw new Error("Unknown variable type "+t)}return void 0!==e&&(n.value=e),n}(e,n);return this._variables[t]=i,i},i.removeVariable=function(t){delete this._variables[t]},i.getVariable=function(t){return this._variables[t]},i.renameVariable=function(t,e){this._variables=In(this._variables,t,e)},r(e,[{key:"layers",get:function(){return this._layers}},{key:"variables",get:function(){return Object.entries(this._variables)}}]),e}(Nn),fr=i(hr.prototype,"_layers",[a],(function(){return[]})),pr=i(hr.prototype,"_variables",[a],(function(){return{}})),cr=hr))||cr,Rr=Symbol("[[createEval]]"),kr=e(Z+"MotionBase")(Ir=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e.prototype.__callOnAfterDeserializeRecursive=function(){},e}(o))||Ir;var Lr=new y,Mr=new y,Dr=new g;new g;var Br,Fr,Ur,Vr=function(){function t(){this._position=new y,this._rotation=new g,this._scale=y.clone(y.ONE)}return t.clone=function(e){var n=new t;return t.copy(n,e),n},t.setIdentity=function(t){return y.copy(t._position,y.ZERO),g.copy(t._rotation,g.IDENTITY),y.copy(t._scale,y.ONE),t},t.copy=function(t,e){return y.copy(t._position,e._position),g.copy(t._rotation,e._rotation),y.copy(t._scale,e._scale),t},t.equals=function(t,e,n){return y.equals(t._position,e._position,n)&&g.equals(t._rotation,e._rotation,n)&&y.equals(t._scale,e._scale,n)},t.strictEquals=function(t,e){return y.strictEquals(t._position,e._position)&&g.strictEquals(t._rotation,e._rotation)&&y.strictEquals(t._scale,e._scale)},t.lerp=function(e,n,i,r){return 0===r?t.copy(e,n):1===r?t.copy(e,i):(y.lerp(e._position,n._position,i._position,r),g.slerp(e._rotation,n._rotation,i._rotation,r),y.lerp(e._scale,n._scale,i._scale,r),e)},t.multiply=function(t,e,n){var i=g.multiply(Dr,e._rotation,n._rotation),r=y.multiply(Lr,n._scale,e._scale),o=y.multiply(Mr,n._position,e._scale);return y.transformQuat(o,o,e._rotation),y.add(o,o,e._position),y.copy(t._position,o),g.copy(t._rotation,i),y.copy(t._scale,r),t},t.invert=function(t,e){var n=t._rotation,i=t._scale,r=t._position;return g.invert(n,e._rotation),Gr(i,e._scale,R),y.negate(r,e._position),y.multiply(r,r,i),y.transformQuat(r,r,n),t},t.fromMatrix=function(t,e){return x.toSRT(e,t._rotation,t._position,t._scale),t},t.toMatrix=function(t,e){return x.fromSRT(t,e._rotation,e._position,e._scale)},r(t,[{key:"position",get:function(){return this._position},set:function(t){y.copy(this._position,t)}},{key:"rotation",get:function(){return this._rotation},set:function(t){g.copy(this._rotation,t)}},{key:"scale",get:function(){return this._scale},set:function(t){y.copy(this._scale,t)}}]),t}();function Gr(t,e,n){var i=e.x,r=e.y,o=e.z;return y.set(t,Math.abs(i)<=n?0:1/i,Math.abs(r)<=n?0:1/r,Math.abs(o)<=n?0:1/o)}Vr.IDENTITY=Object.freeze(new Vr),Vr.ZERO=Object.freeze((Br=new Vr,y.copy(Br._position,y.ZERO),g.set(Br._rotation,0,0,0,0),y.copy(Br._scale,y.ZERO),Br)),Vr.calculateRelative=(Fr=new g,Ur=new y,function(t,e,n){var i=g.invert(Fr,n._rotation),r=Gr(Ur,n._scale,R),o=y.subtract(Mr,e._position,n._position);return y.transformQuat(o,o,i),y.multiply(o,o,r),y.copy(t._position,o),g.multiply(t._rotation,i,e._rotation),y.multiply(t._scale,e._scale,r),t});var Wr,zr,jr,Hr=(Wr=new g,function(t,e,n,i){y.scaleAndAdd(t.position,e.position,n.position,i);var r=g.slerp(Wr,g.IDENTITY,n.rotation,i);return g.multiply(t.rotation,r,e.rotation),y.scaleAndAdd(t.scale,e.scale,n.scale,i),t}),Qr=(zr=new g,function(t,e,n){var i=g.invert(zr,e);return g.multiply(t,n,i)}),Yr=Object.freeze(function(){var t=new Vr;return t.position=y.ZERO,t.rotation=g.IDENTITY,t.scale=y.ZERO,t}()),qr=function(){function t(t,e){this.transforms=void 0,this.auxiliaryCurves=void 0,this._poseTransformSpace=jr.LOCAL,this.transforms=t,this.auxiliaryCurves=e}return t._create=function(e,n){return new t(e,n)},t}();!function(t){t[t.LOCAL=0]="LOCAL",t[t.COMPONENT=1]="COMPONENT"}(jr||(jr={}));var Zr=function(){function t(t){this._involvedTransforms=new Uint16Array(t)}return r(t,[{key:"involvedTransforms",get:function(){return this._involvedTransforms}}]),t}();function Xr(t,e,n,i){void 0===i&&(i=void 0),function(t,e,n,i){void 0===i&&(i=void 0);var r=t.length;if(_(r===t.length),0!==n)if(1!==n)if(i)for(var o=0;o<i.involvedTransforms.length;++o){var a=i.involvedTransforms[o];$r(t,e,n,a)}else for(var s=0;s<r;++s)$r(t,e,n,s);else i?function(t,e,n){var i=t.length;_(i===t.length);for(var r=0;r<n.involvedTransforms.length;++r){var o=n.involvedTransforms[r];t.copyRange(o,e,o,1)}}(t,e,i):t.set(e)}(t.transforms,e.transforms,n,i),function(t,e,n){var i=e.length;_(i===t.length);for(var r=0;r<i;++r)t[r]=k(t[r],e[r],n)}(t.auxiliaryCurves,e.auxiliaryCurves,n)}var Jr,Kr,$r=(Jr=new Vr,Kr=new Vr,function(t,e,n,i){var r=t.getTransform(i,Kr),o=e.getTransform(i,Jr);Vr.lerp(r,r,o,n),t.setTransform(i,r)});var to=function(){var t=new Vr,e=new Vr;return function(n,i,r){var o=i.getTransform(r,t),a=n.getTransform(r,e);!function(t,e,n){y.subtract(t.position,e.position,n.position),Qr(t.rotation,n.rotation,e.rotation),y.subtract(t.scale,e.scale,n.scale)}(a,a,o),n.setTransform(r,a)}}();function eo(t,e,n,i){void 0===i&&(i=void 0),function(t,e,n,i){void 0===i&&(i=void 0);var r=t.length;if(_(r===e.length),i)for(var o=0;o<i.involvedTransforms.length;++o){var a=i.involvedTransforms[o];no(t,e,n,a)}else for(var s=0;s<r;++s)no(t,e,n,s)}(t.transforms,e.transforms,n,i),function(t,e,n){var i=t.length;_(i===e.length);for(var r=0;r<t.length;++r)t[r]+=e[r]*n}(t.auxiliaryCurves,e.auxiliaryCurves,n)}var no=function(){var t=new Vr,e=new Vr;return function(n,i,r,o){var a=i.getTransform(o,t),s=n.getTransform(o,e);Hr(s,s,a,r),n.setTransform(o,s)}}(),io=new y,ro=new g,oo=function(){function t(t){this._transformHandle=t}return t.prototype.destroy=function(){this._transformHandle.destroy()},t}(),ao=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.setValue=function(t,e){e.transforms.setPosition(this._transformHandle.index,t)},i.getValue=function(t){return t.transforms.getPosition(this._transformHandle.index,io)},e}(oo),so=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.setValue=function(t,e){e.transforms.setRotation(this._transformHandle.index,t)},i.getValue=function(t){return t.transforms.getRotation(this._transformHandle.index,ro)},e}(oo),uo=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.setValue=function(t,n){var i=g.fromEuler(e._EULER_TO_QUAT_CACHE,t.x,t.y,t.z);n.transforms.setRotation(this._transformHandle.index,i)},i.getValue=function(t){var e=t.transforms.getRotation(this._transformHandle.index,ro);return g.toEuler(io,e)},e}(oo);uo._EULER_TO_QUAT_CACHE=new g;var lo=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.setValue=function(t,e){e.transforms.setScale(this._transformHandle.index,t)},i.getValue=function(t){return t.transforms.getScale(this._transformHandle.index,io)},e}(oo),co=function(){function t(t){this._handle=t}var e=t.prototype;return e.destroy=function(){this._handle.destroy()},e.setValue=function(t,e){e.auxiliaryCurves[this._handle.index]=t},e.getValue=function(t){return t.auxiliaryCurves[this._handle.index]},t}(),ho=function(){function t(t,e){this._binding=void 0,this._trackSampler=void 0,this._binding=t,this._trackSampler=e}var e=t.prototype;return e.destroy=function(){this._binding.destroy()},e.evaluate=function(t,e){var n=this._trackSampler,i=this._binding,r=n.requiresDefault?i.getValue(e):void 0,o=n.evaluate(t,r);i.setValue(o,e)},t}();function fo(t,e,n){var i=function(t,e){var n=e.origin,i=t.path,r=t.proxy,o=i.length,a=o-1;if(0!==o&&(i.isPropertyAt(a)||i.isElementAt(a))&&!r){var s=i.isPropertyAt(a)?i.parsePropertyAt(a):i.parseElementAt(a),u=i[ot](n,0,o-1);if(null===u)return null;if(u instanceof xt&&at(s)){var l=function(){for(var t=[],e=u;e&&e!==n;e=e.parent)t.unshift(e.name);return e===n?t.join("/"):void 0}();if("string"==typeof l){var c=e.bindTransform(l);if(!c)return;return function(t,e){switch(e){case"position":return new ao(t);case"rotation":return new so(t);case"eulerAngles":return new uo(t);case"scale":return new lo(t)}}(c,s)}}}S("Animation graph currently only supports (bone) transform animations.")}(e[rt],n);return null!=i?i:void 0}var po,vo,_o,yo,go,mo,Eo,To,Ao,bo,Co,So,wo,Po,Oo,No,Io,xo,Ro,ko,Lo,Mo,Do,Bo,Fo,Uo,Vo,Go=function(){function t(t,e){this._binding=t,this._curve=e}return t.prototype.evaluate=function(t,e){var n=this._curve,i=this._binding,r=e,o=n.evaluate(t);i.setValue(o,r)},t}(),Wo=function(){function t(t,e){this._trackEvaluations=[],this._exoticAnimationEvaluation=void 0,this._auxiliaryCurveEvaluations=[],t._trySyncLegacyData();for(var n,i,r=[],o=[],a=t.tracks,s=t[et],u=p(a);!(i=u()).done;){var l=i.value;if(!(l instanceof nt||Array.from(l.channels()).every((function(t){return 0===t.curve.keyFramesCount})))){var c=fo(0,l,e);if(c){var h=l[J](),f=new ho(c,h);r.push(f)}}}s&&(n=s.createEvaluatorForAnimationGraph(e));for(var d=t.getAuxiliaryCurveNames_experimental(),v=d.length,_=0;_<v;++_){var y=d[_],g=t.getAuxiliaryCurve_experimental(y),m=e.bindAuxiliaryCurve(y),E=new co(m);o.push(new Go(E,g))}this._trackEvaluations=r,this._exoticAnimationEvaluation=n,this._auxiliaryCurveEvaluations=o}var e=t.prototype;return e.destroy=function(){var t;null===(t=this._exoticAnimationEvaluation)||void 0===t||t.destroy();for(var e=this._trackEvaluations,n=e.length,i=0;i<n;++i)e[i].destroy()},e.evaluate=function(t,e){for(var n=this._trackEvaluations,i=this._exoticAnimationEvaluation,r=this._auxiliaryCurveEvaluations,o=e.pushDefaultedPose(),a=n.length,s=0;s<a;++s)n[s].evaluate(t,o);i&&i.evaluate(t,o);for(var u=r.length,l=0;l<u;++l)r[l].evaluate(t,o);return o},t}(),zo=function(){function t(t,e){this._clipEval=void 0,this._refClipEval=void 0,this._clipEval=new Wo(t,e);var n=t[it].refClip;n&&n!==t&&(this._refClipEval=new Wo(n,e))}var e=t.prototype;return e.destroy=function(){var t;this._clipEval.destroy(),null===(t=this._refClipEval)||void 0===t||t.destroy()},e.evaluate=function(t,e){var n,i,r,o=this._clipEval.evaluate(t,e);return n=this._refClipEval?this._refClipEval.evaluate(0,e):this._clipEval.evaluate(0,e),r=n,function(t,e){var n=t.length;_(n===e.length);for(var i=0;i<n;++i)to(t,e,i)}((i=o).transforms,r.transforms),function(t,e){var n=t.length;_(n===e.length);for(var i=0;i<t.length;++i)t[i]-=e[i]}(i.auxiliaryCurves,r.auxiliaryCurves),e.popPose(),o},t}(),jo=L,Ho=(po=e("cc.animation.ClipMotion"),vo=jo(st),po((yo=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).clip=go&&go(),e}n(e,t);var i=e.prototype;return i[Rr]=function(t,e,n){return this.clip?new Yo(t,this.clip,e,n):null},i.clone=function(){var t=new e;return t.clip=this.clip,t[E]=sn(this),t},e}(kr),go=i(yo.prototype,"clip",[vo,a],(function(){return null})),_o=yo))||_o),Qo=Symbol("EvaluatePort"),Yo=function(){function t(t,e,n,i){var r;this._clipEmbeddedPlayerEval=null,this._frameEventEval=null,this._wrapInfo=new ut,this._duration=0,this._ignoreEmbeddedPlayers=void 0,this._originalClip=e,this._ignoreEmbeddedPlayers=i;var o=null!==(r=null==n?void 0:n.get(e))&&void 0!==r?r:e;this._setClip(o,t)}var e=t.prototype;return e.createPort=function(){return new qo(this)},e.getClipStatuses=function(t){var e=this,n=!1;return{next:function(){return n?{done:!0,value:void 0}:(n=!0,{done:!1,value:{__DEBUG_ID__:e.__DEBUG__ID__,clip:e._clip,weight:t}})}}},e[Qo]=function(t,e){var n,i,r=this._duration,o=this._clip.duration,a=this._clipEval,s=r*t,u=this._clip.wrapMode,l=function(t,e,n,i,r,o){if(0===e)return o.time=0,o.ratio=0,o.direction=1,o.stopped=!!Number.isFinite(i),o.iterations=0,o;var a=!1,s=t>0?t/e:-t/e;if(s>=i){s=i,a=!0;var u=i-(0|i);0===u&&(u=1),t=u*e*(t>0?1:-1)}if(t>e){var l=t%e;t=0===l?e:l}else t<0&&0!=(t%=e)&&(t+=e);var c=!1,h=n&I.ShouldWrap;h&&(c=function(t,e){var n=!1;return(t&I.PingPong)===I.PingPong&&(e-(0|e)==0&&e>0&&(e-=1),1&e&&(n=!n)),(t&I.Reverse)===I.Reverse&&(n=!n),n}(n,s));var f=c?-1:1;return r&&(f*=-1),h&&c&&(t=e-t),o.time=t,o.ratio=o.time/e,o.direction=f,o.stopped=a,o.iterations=s,o}(s,r,u,(u&I.Loop)===I.Loop?1/0:1,!1,this._wrapInfo),c=l.ratio*o,h=a.evaluate(c,e);return null===(n=this._frameEventEval)||void 0===n||n.sample(l.ratio,l.direction,l.iterations),null===(i=this._clipEmbeddedPlayerEval)||void 0===i||i.evaluate(c,Math.trunc(l.iterations)),h},e.overrideClips=function(t,e){var n=this._originalClip,i=t.get(n);i&&this._setClip(i,e)},e.reenter=function(){var t;null===(t=this._frameEventEval)||void 0===t||t.reset()},e._setClip=function(t,e){var n;null===(n=this._clipEval)||void 0===n||n.destroy(),this._frameEventEval=null,this._clipEmbeddedPlayerEval&&(this._clipEmbeddedPlayerEval.destroy(),this._clipEmbeddedPlayerEval=null),this._clip=t,this._duration=0===t.speed?0:t.duration/t.speed,this._clipEval=function(t,e){return t.isAdditive_experimental?new zo(t,e):new Wo(t,e)}(t,e),this._frameEventEval=t.createEventEvaluator(e.origin),!this._ignoreEmbeddedPlayers&&t.containsAnyEmbeddedPlayer()&&(this._clipEmbeddedPlayerEval=t.createEmbeddedPlayerEvaluator(e.origin))},r(t,[{key:"duration",get:function(){return this._duration}}]),t}(),qo=function(){function t(t){this._eval=void 0,this._eval=t}var e=t.prototype;return e.evaluate=function(t,e){return this._eval[Qo](t,e)},e.reenter=function(){this._eval.reenter()},t}(),Zo=e,Xo=a,Jo=Zo(Z+"AnimationBlendItem")((Eo=function(){function t(){this.motion=To&&To()}var e=t.prototype;return e.clone=function(){var e=new t;return this._copyTo(e),e},e._copyTo=function(t){var e,n;return t.motion=null!==(e=null===(n=this.motion)||void 0===n?void 0:n.clone())&&void 0!==e?e:null,t},t}(),To=i(Eo.prototype,"motion",[Xo],(function(){return null})),mo=Eo))||mo,Ko=Zo(Z+"AnimationBlend")((bo=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name=Co&&Co(),e}return n(e,t),e.prototype.copyTo=function(t){t.name=this.name,t[E]=sn(this)},e}(kr),Co=i(bo.prototype,"name",[Xo],(function(){return""})),Ao=bo))||Ao,$o=function(){function t(t,e,n,i,r,o){this._childEvaluators=r.map((function(i){var r,o;return null!==(r=null===(o=i.motion)||void 0===o?void 0:o[Rr](t,e,n))&&void 0!==r?r:null})),this._weights=new Array(this._childEvaluators.length).fill(0),this._inputs=[].concat(o)}var e=t.prototype;return e.createPort=function(){return new ta(this,this._childEvaluators.map((function(t){var e;return null!==(e=null==t?void 0:t.createPort())&&void 0!==e?e:null})))},e.getChildWeight=function(t){return this._weights[t]},e.getChildMotionEval=function(t){return this._childEvaluators[t]},e.getClipStatuses=function(t){var e,n=this._childEvaluators,i=this._weights,r=n.length,o=0;return{next:function(){for(;;){if(e){var a=e.next();if(!a.done)return a}if(o>=r)return{done:!0,value:void 0};var s=n[o];e=null==s?void 0:s.getClipStatuses(t*i[o]),++o}}}},e.__evaluatePort=function(t,e,n){for(var i=this._childEvaluators.length,r=0,o=null,a=0;a<i;++a){var s,u=this._weights[a];if(u){var l=null===(s=t.childPorts[a])||void 0===s?void 0:s.evaluate(e,n);l&&(r+=u,o?(r&&Xr(o,l,u/r),n.popPose()):o=l)}}return o||n.pushDefaultedPose()},e.overrideClips=function(t,e){for(var n=0;n<this._childEvaluators.length;++n){var i;null===(i=this._childEvaluators[n])||void 0===i||i.overrideClips(t,e)}},e.setInput=function(t,e){this._inputs[e]=t,this.doEval()},e.doEval=function(){this.eval(this._weights,this._inputs)},e.eval=function(){},r(t,[{key:"childCount",get:function(){return this._weights.length}},{key:"duration",get:function(){for(var t=0,e=0;e<this._childEvaluators.length;++e){var n,i;t+=(null!==(n=null===(i=this._childEvaluators[e])||void 0===i?void 0:i.duration)&&void 0!==n?n:0)*this._weights[e]}return t}}]),t}(),ta=function(){function t(t,e){this.childPorts=[],this._host=void 0,this._host=t,this.childPorts=e}var e=t.prototype;return e.evaluate=function(t,e){return this._host.__evaluatePort(this,t,e)},e.reenter=function(){for(var t=this.childPorts,e=t.length,n=0;n<e;++n){var i;null===(i=t[n])||void 0===i||i.reenter()}},t}(),ea=e,na=a,ia=ea(Z+"BindableNumber")((wo=function(){function t(t){void 0===t&&(t=0),this.variable=Po&&Po(),this.value=Oo&&Oo(),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),Po=i(wo.prototype,"variable",[na],(function(){return""})),Oo=i(wo.prototype,"value",[na],(function(){return 0})),So=wo))||So,ra=ea(Z+"BindableBoolean")((Io=function(){function t(t){void 0===t&&(t=!1),this.variable=xo&&xo(),this.value=Ro&&Ro(),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),xo=i(Io.prototype,"variable",[na],(function(){return""})),Ro=i(Io.prototype,"value",[na],(function(){return!1})),No=Io))||No;function oa(t,e,n,i,r){var o=e.variable,a=e.value;if(!o)return a;var s=t.getVar(o);if(!aa(s,o))return a;if(s.type!==n)throw new an(o,"number");for(var u=arguments.length,l=new Array(u>5?u-5:0),c=5;c<u;c++)l[c-5]=arguments[c];var h=s.bind.apply(s,[i,r].concat(l));return h}function aa(t,e){if(t)return!0;throw new on(e)}var sa,ua,la=e,ca=a,ha=la(Z+"AnimationBlend1DItem")((Lo=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).threshold=Mo&&Mo(),e}n(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return this._copyTo(t),t},i._copyTo=function(e){return t.prototype._copyTo.call(this,e),e.threshold=this.threshold,e},e}(Jo),Mo=i(Lo.prototype,"threshold",[ca],(function(){return 0})),ko=Lo))||ko,fa=la("cc.animation.AnimationBlend1D")(((Vo=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._items=Fo&&Fo(),e.param=Uo&&Uo(),e}n(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return this.copyTo(t),t._items=this._items.map((function(t){return t.clone()})),t.param=this.param.clone(),t},i[Rr]=function(t,e,n){var i=new pa(t,e,n,this,this._items,this._items.map((function(t){return t.threshold})),0),r=oa(t,this.param,me.FLOAT,i.setInput,i,0);return i.setInput(r,0),i},r(e,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t).sort((function(t,e){return t.threshold-e.threshold}))}}]),e}(Ko)).Item=ha,Fo=i((Bo=Vo).prototype,"_items",[ca],(function(){return[]})),Uo=i(Bo.prototype,"param",[ca],(function(){return new ia})),Do=Bo))||Do,pa=function(t){function e(e,n,i,r,o,a,s){var u;return(u=t.call(this,e,n,i,r,o,[s])||this)._thresholds=a,u.doEval(),u}return n(e,t),e.prototype.eval=function(t,e){var n=e[0];!function(t,e,n){if(t.fill(0),0===e.length);else if(n<=e[0])t[0]=1;else if(n>=e[e.length-1])t[t.length-1]=1;else{for(var i=0,r=1;r<e.length;++r)if(e[r]>n){i=r;break}var o=e[i-1],a=e[i],s=a-o;t[i-1]=(a-n)/s,t[i]=(n-o)/s}}(t,this._thresholds,n)},e}($o),da=(sa=new M,ua={wA:0,wB:0},function(t,e,n){if(_(t.length===e.length),0!==e.length)if(1!==e.length)if(M.strictEquals(n,M.ZERO)){var i=e.findIndex((function(t){return M.strictEquals(t,M.ZERO)}));i>=0?t[i]=1:t.fill(1/e.length)}else{for(var r=-1,o=-1,a=-1,s=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY,l=n.x,c=n.y,h=0;h<e.length;++h){var f=e[h];if(M.equals(f,M.ZERO))a=h;else{var p=M.normalize(sa,f),d=M.dot(p,n);p.x*c-p.y*l>0?d>=u&&(u=d,r=h):d>=s&&(s=d,o=h)}}var v=0;if(r<0||o<0)v=1;else{var y=(S=e[r],w=e[o],P=n,O=ua,(N=M.cross(S,w))?(O.wA=M.cross(P,w)/N,O.wB=M.cross(P,S)/-N):(O.wA=0,O.wB=0),O),g=y.wA,m=y.wB,E=0,T=0,A=g+m;A>1?(E=g/A,T=m/A):A<0?(E=0,T=0,v=1):(E=g,T=m,v=1-A),t[r]=E,t[o]=T}if(v>0)if(a>=0)t[a]=v;else for(var b=v/t.length,C=0;C<t.length;++C)t[C]+=b}else t[0]=1;var S,w,P,O,N});var va,_a,ya,ga,ma,Ea,Ta,Aa,ba,Ca,Sa=function(t,e,n,i,r){M.subtract(i,n,t),M.subtract(r,e,t)},wa=function(){function t(e){for(var n=t._ANGLE_MULTIPLIER,i=e.length,r=this._exampleMagnitudes=new Array(i).fill(0),o=this._exampleDirections=e.map((function(t,e){var n=M.copy(new M,t),i=M.len(n);return r[e]=i,D(i,0,1e-5)||M.multiplyScalar(n,n,1/i),n})),a=this._precomputedVIJs=new Float32Array(3*i*i),s=0;s<i;++s)for(var u=r[s],l=o[s],c=0;c<i;++c)if(s!==c){var h=r[c],f=o[c],p=(u+h)/2,d=3*(i*s+c);a[d+0]=(h-u)/p,a[d+1]=Pa(l,f)*n,a[d+2]=p}this._cacheVIXAngles=new Float32Array(i)}return t.prototype.interpolate=function(e,n){var i=this._exampleDirections,r=this._exampleMagnitudes,o=this._precomputedVIJs,a=this._cacheVIXAngles,s=t._CACHE_INPUT_DIRECTION,u=t._CACHE_VIJ,l=t._CACHE_VIX,c=t._ANGLE_MULTIPLIER,h=i.length;if(_(e.length===h),0!==h)if(1!==h){var f=n,p=M.len(f),d=a;if(M.equals(f,M.ZERO))for(var v=0;v<h;++v)d[v]=0;else for(var y=M.multiplyScalar(s,f,1/p),g=0;g<h;++g){var m=i[g];M.equals(m,M.ZERO)?d[g]=0:d[g]=Pa(m,y)*c}for(var E=0,T=0;T<h;++T){for(var A=r[T],b=i[T],C=Number.POSITIVE_INFINITY,S=0;S<h;++S)if(T!==S){var w=i[S],P=3*(h*T+S),O=o[P+0],N=o[P+1],I=o[P+2],x=N,R=d[T];M.equals(b,M.ZERO)?x=d[S]:M.equals(w,M.ZERO)?x=d[T]:M.equals(f,M.ZERO)&&(R=x);var k=M.set(u,O,x),L=M.set(l,(p-A)/I,R),D=1-M.dot(L,k)/M.lengthSqr(k);if(D<=0){C=0;break}C=Math.min(C,D)}e[T]=C,E+=C}if(E>0)for(var B=0;B<h;++B)e[B]/=E;else for(var F=1/h,U=0;U<h;++U)e[U]=F}else e[0]=1},t}();function Pa(t,e){var n=M.angle(t,e);return t.x*e.y-t.y*e.x<0?-n:n}wa._CACHE_INPUT_DIRECTION=new M,wa._CACHE_VIJ=new M,wa._CACHE_VIX=new M,wa._ANGLE_MULTIPLIER=1;var Oa,Na=e,Ia=a;!function(t){t[t.SIMPLE_DIRECTIONAL=0]="SIMPLE_DIRECTIONAL",t[t.FREEFORM_CARTESIAN=1]="FREEFORM_CARTESIAN",t[t.FREEFORM_DIRECTIONAL=2]="FREEFORM_DIRECTIONAL"}(Oa||(Oa={})),B(Oa);var xa,Ra,ka,La,Ma,Da,Ba=Na(Z+"AnimationBlend2DItem")((_a=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).threshold=ya&&ya(),e}n(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return this._copyTo(t),t},i._copyTo=function(e){return t.prototype._copyTo.call(this,e),M.copy(e.threshold,this.threshold),e},e}(Jo),ya=i(_a.prototype,"threshold",[Ia],(function(){return new M})),va=_a))||va,Fa=Na("cc.animation.AnimationBlend2D")(((Ca=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._items=Ea&&Ea(),e.paramX=Ta&&Ta(),e.paramY=Aa&&Aa(),e._algorithm=ba&&ba(),e._polarSpaceGBI=void 0,e}n(e,t);var i=e.prototype;return i.__callOnAfterDeserializeRecursive=function(){this._tryReconstructPolarSpaceInterpolator()},i.clone=function(){var t=new e;return this.copyTo(t),t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t.paramX=this.paramX.clone(),t.paramY=this.paramY.clone(),t.algorithm=this._algorithm,t},i[Rr]=function(t,e,n){var i,r=this.algorithm;switch(r){case Oa.FREEFORM_DIRECTIONAL:_(this._polarSpaceGBI),i=new Va(t,e,n,this,this._items,this._polarSpaceGBI,[0,0]);break;default:case Oa.SIMPLE_DIRECTIONAL:case Oa.FREEFORM_CARTESIAN:i=new Ua(t,e,n,this,this._items,this._items.map((function(t){return t.threshold})),r,[0,0])}var o=oa(t,this.paramX,me.FLOAT,i.setInput,i,0),a=oa(t,this.paramY,me.FLOAT,i.setInput,i,1);return i.setInput(o,0),i.setInput(a,1),i},i._tryReconstructPolarSpaceInterpolator=function(){this._algorithm===Oa.FREEFORM_DIRECTIONAL?this._polarSpaceGBI=new wa(this._items.map((function(t){return t.threshold}))):this._polarSpaceGBI=void 0},r(e,[{key:"algorithm",get:function(){return this._algorithm},set:function(t){t!==this._algorithm&&(this._algorithm=t,this._tryReconstructPolarSpaceInterpolator())}},{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t),this._tryReconstructPolarSpaceInterpolator()}}]),e}(Ko)).Algorithm=Oa,Ca.Item=Ba,Ea=i((ma=Ca).prototype,"_items",[Ia],(function(){return[]})),Ta=i(ma.prototype,"paramX",[Ia],(function(){return new ia})),Aa=i(ma.prototype,"paramY",[Ia],(function(){return new ia})),ba=i(ma.prototype,"_algorithm",[Ia],(function(){return Oa.SIMPLE_DIRECTIONAL})),ga=ma))||ga,Ua=function(t){function e(e,n,i,r,o,a,s,u){var l;return(l=t.call(this,e,n,i,r,o,u)||this)._thresholds=void 0,l._algorithm=void 0,l._value=new M,l._thresholds=a,l._algorithm=s,l.doEval(),l}return n(e,t),e.prototype.eval=function(t,e){var n=e[0],i=e[1];switch(M.set(this._value,n,i),t.fill(0),this._algorithm){case Oa.SIMPLE_DIRECTIONAL:da(t,this._thresholds,this._value);break;case Oa.FREEFORM_CARTESIAN:!function(t,e,n){!function(t,e,n,i){t.fill(0);for(var r=new M(0,0),o=new M(0,0),a=0,s=e.length,u=0;u<s;++u){for(var l=Number.MAX_VALUE,c=!1,h=0;h<s;++h)if(u!==h){i(e[u],e[h],n,r,o);var f=1-M.dot(r,o)/M.lengthSqr(o);if(f<0){c=!0;break}l=Math.min(l,f)}c||(t[u]=l,a+=l)}a>0&&t.forEach((function(e,n){return t[n]=e/a}))}(t,e,n,Sa)}(t,this._thresholds,this._value)}},e}($o),Va=function(t){function e(e,n,i,r,o,a,s){var u;return(u=t.call(this,e,n,i,r,o,s)||this)._interpolator=void 0,u._value=new M,u._interpolator=a,u.doEval(),u}return n(e,t),e.prototype.eval=function(t,e){var n=e[0],i=e[1];M.set(this._value,n,i),t.fill(0),this._interpolator.interpolate(t,this._value)},e}($o),Ga=e,Wa=a,za=Ga(Z+"AnimationBlendDirectItem")((Ra=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).weight=ka&&ka(),e}n(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return this._copyTo(t),t},i._copyTo=function(e){return t.prototype._copyTo.call(this,e),e.weight=this.weight,e},e}(Jo),ka=i(Ra.prototype,"weight",[Wa],(function(){return new ia(0)})),xa=Ra))||xa;Ga("cc.animation.AnimationBlendDirect")(((Da=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._items=Ma&&Ma(),e}n(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return this.copyTo(t),t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t},i[Rr]=function(t,e,n){for(var i=new vs(t,e,n,this,this._items,new Array(this._items.length).fill(0)),r=0;r<this._items.length;++r){var o=oa(t,this._items[r].weight,me.FLOAT,i.setInput,i,r);i.setInput(o,r)}return i},r(e,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t)}}]),e}(Ko)).Item=za,Ma=i((La=Da).prototype,"_items",[Wa],(function(){return[]})),La));var ja,Ha,Qa,Ya,qa,Za,Xa,Ja,Ka,$a,ts,es,ns,is,rs,os,as,ss,us,ls,cs,hs,fs,ps,ds,vs=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).doEval(),e}return n(e,t),e.prototype.eval=function(t,e){for(var n=t.length,i=0;i<n;++i)t[i]=e[i]},e}($o),_s=e("cc.JointMask")((Ha=function(){this.path=Qa&&Qa(),this.enabled=Ya&&Ya()},Qa=i(Ha.prototype,"path",[a],(function(){return""})),Ya=i(Ha.prototype,"enabled",[a],(function(){return!0})),ja=Ha))||ja,ys=(qa=e(Z+"AnimationMask"),Za=L(_s),qa((Ja=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._jointMasks=Ka&&Ka(),e}n(e,t);var i=e.prototype;return i.addJoint=function(t,e){this.removeJoint(t);var n=new _s;n.path=t,n.enabled=e,this._jointMasks.push(n)},i.removeJoint=function(t){O(this._jointMasks,(function(e){return e.path===t}))},i.clear=function(){this._jointMasks.length=0},i.filterDisabledNodes=function(t){for(var e=this._jointMasks,n=e.length,i=new Set,r=0;r<n;++r){var o=e[r],a=o.path;if(!o.enabled){var s=t.getChildByPath(a);s&&i.add(s)}}return i},i.isExcluded=function(t){var e,n;return!(null===(e=null===(n=this._jointMasks.find((function(e){return e.path===t})))||void 0===n?void 0:n.enabled)||void 0===e||e)},r(e,[{key:"joints",get:function(){return this._jointMasks},set:function(t){this.clear();for(var e,n=p(t);!(e=n()).done;){var i=e.value;this.addJoint(i.path,i.enabled)}}}]),e}(Rt),Ka=i(Ja.prototype,"_jointMasks",[a],(function(){return[]})),f(Ja.prototype,"joints",[Za],Object.getOwnPropertyDescriptor(Ja.prototype,"joints"),Ja.prototype),Xa=Ja))||Xa),gs=e(Z+"ClipOverrideEntry")((es=function(){this.original=ns&&ns(),this.substitution=is&&is()},ns=i(es.prototype,"original",[a],(function(){return null})),is=i(es.prototype,"substitution",[a],(function(){return null})),ts=es))||ts,ms=(rs=e(Z+"AnimationGraphVariant"),os=L(xr),rs((ss=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._graph=us&&us(),e._clipOverrides=ls&&ls(),e}return n(e,t),r(e,[{key:"original",get:function(){return this._graph},set:function(t){this._graph=t}},{key:"clipOverrides",get:function(){return this._clipOverrides}}]),e}(Nn),f(ss.prototype,"original",[os],Object.getOwnPropertyDescriptor(ss.prototype,"original"),ss.prototype),us=i(ss.prototype,"_graph",[a],(function(){return null})),ls=i(ss.prototype,"_clipOverrides",[a],(function(){return new Es})),as=ss))||as),Es=e(Z+"ClipOverrideMap")(($a=Symbol.iterator,hs=function(){function t(){this._entries=fs&&fs()}var e=t.prototype;return e[$a]=function(){return this._entries[Symbol.iterator]()},e.has=function(t){return!!this._entries.find((function(e){return e.original===t}))},e.get=function(t){var e=this._entries.find((function(e){return e.original===t}));return null==e?void 0:e.substitution},e.set=function(t,e){var n=this._entries.find((function(e){return e.original===t}));if(n)n.substitution=e;else{var i=new gs;i.original=t,i.substitution=e,this._entries.push(i)}},e.delete=function(t){O(this._entries,(function(e){return e.original===t}))},e.clear=function(){this._entries.length=0},r(t,[{key:"size",get:function(){return this._entries.length}}]),t}(),fs=i(hs.prototype,"_entries",[a],(function(){return[]})),cs=hs))||cs,Ts="i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes/",As=Ts+"/i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_blend/";!function(t){t[t.NO=0]="NO",t[t.LOCAL=1]="LOCAL",t[t.COMPONENT=2]="COMPONENT"}(ds||(ds={})),B(ds);var bs,Cs,Ss,ws,Ps,Os,Ns,Is,xs=e(Z+"PoseNode")(ps=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._dependencyEvaluation=void 0,e}n(e,t);var i=e.prototype;return i.update=function(t){var e;null===(e=this._dependencyEvaluation)||void 0===e||e.evaluate(),this.doUpdate(t)},i.evaluate=function(t,e){var n=this.doEvaluate(t),i=n._poseTransformSpace;switch(e){default:case ds.NO:break;case ds.LOCAL:i===jr.COMPONENT&&t._poseTransformsSpaceComponentToLocal(n),_(n._poseTransformSpace===jr.LOCAL);break;case ds.COMPONENT:i===jr.LOCAL&&t._poseTransformsSpaceLocalToComponent(n),_(n._poseTransformSpace===jr.COMPONENT)}return n},e.evaluateDefaultPose=function(t,e){switch(e){default:case ds.NO:case ds.LOCAL:return t.pushDefaultedPose();case ds.COMPONENT:return t.pushDefaultedPoseInComponentSpace()}},i._setDependencyEvaluation=function(t){this._dependencyEvaluation=t},i._forceEvaluateEvaluation=function(){var t;null===(t=this._dependencyEvaluation)||void 0===t||t.evaluate()},e}(Qn))||ps,Rs={listEntries:function(t){return[].concat(t.animationGraph.layers[t.layerIndex].stashes()).map((function(t){var e=t[0];return{arg:e,menu:e}}))},create:function(t){var e=new ks;return e.stashName=t,e}},ks=e(Z+"PoseNodeUseStashedPose")(bs=li(Ts)(bs=ci(Rs)(bs=fi({inline:!0})((Cs=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).stashName=Ss&&Ss(),e._runtimeStash=void 0,e}n(e,t);var i=e.prototype;return i.bind=function(t){var e=this.stashName;if(e){var n=t.stashView.bindStash(e);this._runtimeStash=n}},i.settle=function(){},i.reenter=function(){var t;null===(t=this._runtimeStash)||void 0===t||t.reenter()},i.doUpdate=function(t){var e;null===(e=this._runtimeStash)||void 0===e||e.requestUpdate(t)},i.doEvaluate=function(t){var e,n;return null!==(e=null===(n=this._runtimeStash)||void 0===n?void 0:n.evaluate(t))&&void 0!==e?e:t.pushDefaultedPose()},e}(xs),Ss=i(Cs.prototype,"stashName",[a],(function(){return""})),bs=Cs))||bs)||bs)||bs)||bs,Ls=e,Ms=a;!function(t){t[t.TRUTHY=0]="TRUTHY",t[t.FALSY=1]="FALSY"}(Is||(Is={})),Ls(Z+"UnaryCondition")(((Ns=function(){function t(){this.operator=Ps&&Ps(),this.operand=Os&&Os()}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.operand=this.operand.clone(),e},e[Rr]=function(t){var e=this.operator,n=this.operand,i=new Bs(e,!1),r=oa(t,n,me.BOOLEAN,i.setOperand,i);return i.reset(r),i},t}()).Operator=Is,Ps=i((ws=Ns).prototype,"operator",[Ms],(function(){return Is.TRUTHY})),Os=i(ws.prototype,"operand",[Ms],(function(){return new ra})),ws));var Ds,Bs=function(){function t(t,e){this._operator=t,this._operand=e,this._eval()}var e=t.prototype;return e.reset=function(t){this.setOperand(t)},e.setOperand=function(t){this._operand=t,this._eval()},e.eval=function(){return this._result},e._eval=function(){var t=this._operand;switch(this._operator){default:case Is.TRUTHY:this._result=!!t;break;case Is.FALSY:this._result=!t}},t}();!function(t){t[t.FLOAT=0]="FLOAT",t[t.INTEGER=3]="INTEGER"}(Ds||(Ds={}));var Fs,Us=function(){},Vs=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){}};!function(t){t[t.MOTION=1]="MOTION",t[t.POSE=2]="POSE",t[t.EMPTY=4]="EMPTY",t[t.WEIGHTED=7]="WEIGHTED"}(Fs||(Fs={}));var Gs,Ws,zs,js,Hs,Qs,Ys,qs=a,Zs=e(Z+"TCVariableBinding")(Gs=Vs(Ds.FLOAT,Ds.INTEGER)((Ws=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).type=zs&&zs(),e.variableName=js&&js(),e}n(e,t);var i=e.prototype;return i.getValueType=function(){return this.type},i.bind=function(t){var e=t.getVar(this.variableName);if(e)return new Xs(e)},e}(Us),zs=i(Ws.prototype,"type",[qs,F],(function(){return Ds.FLOAT})),js=i(Ws.prototype,"variableName",[qs],(function(){return""})),Gs=Ws))||Gs)||Gs,Xs=function(){function t(t){this._varInstance=t}return t.prototype.evaluate=function(){return this._varInstance.value},t}(),Js=a;e(Z+"TCAuxiliaryCurveBinding")(Hs=Vs(Ds.FLOAT)((Qs=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).curveName=Ys&&Ys(),e}n(e,t);var i=e.prototype;return i.getValueType=function(){return Ds.FLOAT},i.bind=function(t){var e=t.getEvaluationTimeAuxiliaryCurveView();return new eu(e,this.curveName)},e}(Us),Ys=i(Qs.prototype,"curveName",[Js],(function(){return""})),Hs=Qs))||Hs);var Ks,$s,tu,eu=function(){function t(t,e){this._view=t,this._curveName=e}return t.prototype.evaluate=function(){return this._view.get(this._curveName)},t}();Ks=e(Z+"TCStateWeightBinding"),$s=Vs(Ds.FLOAT),Fs.WEIGHTED,Ks(tu=$s(tu=void(tu=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.getValueType=function(){return Ds.FLOAT},i.bind=function(){return new ou},e}(Us))||tu)||tu);var nu,iu,ru,ou=function(){function t(){}return t.prototype.evaluate=function(t){return t.sourceStateWeight},t}();nu=e(Z+"TCStateMotionTimeBinding"),iu=Vs(Ds.FLOAT),Fs.POSE,nu(ru=iu(ru=void(ru=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.getValueType=function(){return Ds.FLOAT},i.bind=function(){return new pu},e}(Us))||ru)||ru);var au,su,uu,lu,cu,hu,fu,pu=function(){function t(){}return t.prototype.evaluate=function(t){return t.sourceStateMotionTimeNormalized},t}(),du=e,vu=a;!function(t){t[t.EQUAL_TO=0]="EQUAL_TO",t[t.NOT_EQUAL_TO=1]="NOT_EQUAL_TO",t[t.LESS_THAN=2]="LESS_THAN",t[t.LESS_THAN_OR_EQUAL_TO=3]="LESS_THAN_OR_EQUAL_TO",t[t.GREATER_THAN=4]="GREATER_THAN",t[t.GREATER_THAN_OR_EQUAL_TO=5]="GREATER_THAN_OR_EQUAL_TO"}(fu||(fu={})),du(Z+"BinaryCondition")(((hu=function(){function t(){this.operator=su&&su(),this.lhs=uu&&uu(),this.lhsBinding=lu&&lu(),this.rhs=cu&&cu()}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.lhs=this.lhs,e.lhsBinding=Ft(this.lhsBinding),e.rhs=this.rhs,e},e[Rr]=function(t){var e,n=null===(e=this.lhsBinding)||void 0===e?void 0:e.bind(t);return new Eu(this.operator,this.lhs,this.rhs,n)},t}()).Operator=fu,su=i((au=hu).prototype,"operator",[vu],(function(){return fu.EQUAL_TO})),uu=i(au.prototype,"lhs",[vu],(function(){return 0})),lu=i(au.prototype,"lhsBinding",[vu],(function(){return new Zs})),cu=i(au.prototype,"rhs",[vu],(function(){return 0})),au));var _u,yu,gu,mu,Eu=function(){function t(t,e,n,i){this._operator=t,this._lhsBindingEvaluation=i,this._lhsValue=e,this._rhsValue=n}return t.prototype.eval=function(t){var e,n,i=null!==(e=null===(n=this._lhsBindingEvaluation)||void 0===n?void 0:n.evaluate(t))&&void 0!==e?e:this._lhsValue,r=this._rhsValue;switch(this._operator){default:case fu.EQUAL_TO:return i===r;case fu.NOT_EQUAL_TO:return i!==r;case fu.LESS_THAN:return i<r;case fu.LESS_THAN_OR_EQUAL_TO:return i<=r;case fu.GREATER_THAN:return i>r;case fu.GREATER_THAN_OR_EQUAL_TO:return i>=r}},t}(),Tu=a,Au=e(Z+"TriggerCondition")((yu=function(){function t(){this.trigger=gu&&gu()}var e=t.prototype;return e.clone=function(){var e=new t;return e.trigger=this.trigger,e},e[Rr]=function(t){var e=new bu(!1),n=t.getVar(this.trigger);return aa(n,this.trigger)&&(function(t,e){if(t!==me.TRIGGER)throw new an(e,"trigger")}(n.type,this.trigger),e.setTrigger(n.bind(e.setTrigger,e))),e},t}(),gu=i(yu.prototype,"trigger",[Tu],(function(){return""})),_u=yu))||_u,bu=function(){function t(t){this._triggered=!1,this._triggered=t}var e=t.prototype;return e.setTrigger=function(t){this._triggered=t},e.eval=function(){return this._triggered},t}(),Cu=e(Z+"StateMachineComponent")(mu=function(){function t(){}var e=t.prototype;return e.onMotionStateEnter=function(){},e.onMotionStateExit=function(){},e.onMotionStateUpdate=function(){},e.onStateMachineEnter=function(){},e.onStateMachineExit=function(){},t}())||mu,Su=10,wu=Float64Array.BYTES_PER_ELEMENT*Su,Pu=function(){function t(t,e,n){this._data=void 0,this._data=void 0===t?new Float64Array:"number"==typeof t?new Float64Array(Su*t):new Float64Array(t,e,"number"==typeof n?Su*n:void 0)}var e=t.prototype;return e.getTransform=function(t,e){var n=this._data,i=e.position,r=e.rotation,o=e.scale,a=Su*t;return y.fromArray(i,n,a),g.fromArray(r,n,a+3),y.fromArray(o,n,a+7),e},e.getPosition=function(t,e){var n=this._data,i=Su*t;return y.fromArray(e,n,i),e},e.getRotation=function(t,e){var n=this._data,i=Su*t;return g.fromArray(e,n,i+3),e},e.getScale=function(t,e){var n=this._data,i=Su*t;return y.fromArray(e,n,i+7),e},e.setTransform=function(t,e){var n=this._data,i=e.position,r=e.rotation,o=e.scale,a=Su*t;y.toArray(n,i,a),g.toArray(n,r,a+3),y.toArray(n,o,a+7)},e.setPosition=function(t,e){var n=this._data,i=Su*t;y.toArray(n,e,i)},e.setRotation=function(t,e){var n=this._data,i=Su*t;g.toArray(n,e,i+3)},e.setScale=function(t,e){var n=this._data,i=Su*t;y.toArray(n,e,i+7)},e.copyWithin=function(t,e,n){this._data.copyWithin(t*Su,e*Su,"number"==typeof n?n*Su:void 0)},e.fill=function(t,e,n){var i,r,o=this.length;if(null!==(i=e)&&void 0!==i||(e=0),null!==(r=n)&&void 0!==r||(n=o),!(e>=o)){this.setTransform(e,t);for(var a=e+1;a<n;++a)this.copyWithin(a,e,e+1)}},e.fillZero=function(t,e){this._data.fill(0,"number"==typeof t?t*Su:void 0,"number"==typeof e?e*Su:void 0)},e.set=function(t,e){this._data.set(t._data,"number"==typeof e?e*Su:void 0)},e.slice=function(e,n){var i=this._data.slice("number"==typeof e?e*Su:void 0,"number"==typeof n?n*Su:void 0);return new t(i.buffer,i.byteOffset,i.length/Su)},e.copyRange=function(t,e,n,i){for(var r=Su*i,o=this._data,a=Su*t,s=e._data,u=Su*n,l=0;l<r;++l)o[a+l]=s[u+l]},r(t,[{key:"buffer",get:function(){return this._data.buffer}},{key:"byteLength",get:function(){return this._data.byteLength}},{key:"byteOffset",get:function(){return this._data.byteOffset}},{key:"length",get:function(){return this._data.length/Su}}],[{key:"BYTES_PER_ELEMENT",get:function(){return wu}}]),t}(),Ou=Symbol(""),Nu=Symbol(""),Iu=function(t){this.buffer=void 0,this.useCount=0,this.buffer=new ArrayBuffer(t)},xu=function(){function t(t,e){this._locking=!1,this._pages=[],this._allocatorCount=0,this._manager=t,this._pageSize=e}var e=t.prototype;return e.debugLock=function(){_(!this._locking),this._locking=!0},e.debugUnlock=function(){_(this._locking),this._locking=!1},e.getPageMemory=function(t){return _(t>=0&&t<this._pages.length),this._pages[t].buffer},e.pushPage=function(t){var e=t[Ou];_(e<=this._pages.length),e===this._pages.length&&this._pushNewPage(),_(e<this._pages.length);var n=this._pages[e];return++n.useCount,++t[Ou],n},e.popPage=function(t){var e=t[Ou]-1,n=this._pages[e];_(n.useCount>0),--n.useCount,--t[Ou],0===n.useCount&&(_(e===this._pages.length-1),this._pages.pop())},e.createAllocator=function(t){var e=new ku(this,t);return++this._allocatorCount,e},e.destroyAllocator=function(t){for(var e=t[Ou],n=0;n<e;++n){var i=this._pages[n];_(i.useCount>0),--i.useCount}_(this._allocatorCount>0),--this._allocatorCount,0===this._allocatorCount&&this._manager[Nu](this)},e._pushNewPage=function(){var t=new Iu(this._pageSize);this._pages.push(t)},r(t,[{key:"pageSize",get:function(){return this._pageSize}},{key:"debugLocking",get:function(){return this._locking}},{key:"allocatorCount",get:function(){return this._allocatorCount}}]),t}(),Ru=function(t,e){this.buffer=t,this.byteOffset=e},ku=function(){function t(t,e){this[Ou]=0,this._slicesPerPage=0,this._slices=[],this._resource=t,this._sliceSize=e;var n=Math.floor(this._resource.pageSize/e);this._slicesPerPage=n}var e=t.prototype;return e.destroy=function(){_(0===this._slices.length),_(!this._resource.debugLocking),this._resource.destroyAllocator(this)},e.debugLock=function(){this._resource.debugLock()},e.debugUnlock=function(){this._resource.debugUnlock()},e.push=function(){var t=this._sliceSize,e=this._slices,n=this._slicesPerPage,i=e.length,r=0,o=0;0===t?(0===this[Ou]&&this._resource.pushPage(this),_(1===this[Ou])):(i===n*this[Ou]&&(this._resource.pushPage(this),_(i<n*this[Ou])),o=(i-(r=i%n))/n,_(this[Ou]*n>=i));var a=this._resource.getPageMemory(o),s=new Ru(a,t*r);return this._slices.push(s),s},e.pop=function(){var t=this._slices,e=this._slicesPerPage,n=t.length-1;0===this._sliceSize?(_(1===this[Ou]),0===n&&this._resource.popPage(this)):0==n%e&&this._resource.popPage(this),this._slices.pop()},r(t,[{key:"isEmpty",get:function(){return 0===this._slices.length}}]),t}(),Lu=function(){function t(t){this._stacks=new Map,this._thresholds=t,_(t.every((function(t,e,n){return 0===e||t>n[e-1]})))}var e=t.prototype;return e.createAllocator=function(t){var e=t,n=this._selectStackPageSize(e),i=this._stacks.get(n);return i||(i=new xu(this,n),this._stacks.set(n,i)),i.createAllocator(e)},e[Nu]=function(t){for(var e,n=p(this._stacks);!(e=n()).done;){var i=e.value,r=i[0];if(i[1]===t){this._stacks.delete(r);break}}},e._selectStackPageSize=function(t){var e=U(this._thresholds,t),n=t;return e>=0?n=this._thresholds[e]:(e=~e)===this._thresholds.length||(_(e>=0&&e<this._thresholds.length),n=this._thresholds[e]),n},r(t,[{key:"isEmpty",get:function(){return 0===this._stacks.size}}]),t}(),Mu=function(){function t(t,e){this._poses=[],this._allocatedCount=0,this._memoryAllocator=void 0,this._transformCount=t,this._auxiliaryCurveCount=e;var n=Du(t,e,1);this._memoryAllocator=Fu.createAllocator(n)}var e=t.prototype;return e.destroy=function(){_(0===this._allocatedCount);for(var t=0;t<this._poses.length;++t)this._memoryAllocator.pop();return this._poses.length=0,this._memoryAllocator.destroy()},e.push=function(){0===this._allocatedCount&&this._memoryAllocator.debugLock(),this._allocatedCount===this._poses.length&&(this._allocateNewPose(),_(this._allocatedCount<this._poses.length));var t=this._poses[this._allocatedCount];return++this._allocatedCount,t},e.pop=function(){_(this._allocatedCount>0),--this._allocatedCount,0===this._allocatedCount&&this._memoryAllocator.debugUnlock()},e._allocateNewPose=function(){var t=this._memoryAllocator.push(),e=Pu.BYTES_PER_ELEMENT*this._transformCount,n=t.byteOffset,i=new Pu(t.buffer,n,this._transformCount),r=new Float64Array(t.buffer,n+e,this._auxiliaryCurveCount),o=qr._create(i,r);this._poses.push(o)},r(t,[{key:"allocatedCount",get:function(){return this._allocatedCount}},{key:"top",get:function(){return _(this._allocatedCount>0),this._poses[this._allocatedCount-1]}}]),t}();function Du(t,e,n){return(Pu.BYTES_PER_ELEMENT*t+Float64Array.BYTES_PER_ELEMENT*e)*n}var Bu,Fu=new Lu([Du(128,10,4)]);!function(t){t[t.WORLD=0]="WORLD",t[t.COMPONENT=1]="COMPONENT",t[t.PARENT=2]="PARENT",t[t.LOCAL=3]="LOCAL"}(Bu||(Bu={})),B(Bu);var Uu,Vu,Gu,Wu,zu,ju,Hu,Qu,Yu=Symbol("PoseHeapAllocator"),qu=function(){function t(t,e){this._transformCount=0,this._metaValueCount=0,this._pages=[],this._allocatedCount=0,this._foremostPossibleFreePage=0,this._transformCount=t,this._metaValueCount=e}var e=t.prototype;return e.allocatePose=function(){++this._allocatedCount;for(var t=this._pages,e=t.length,n=this._foremostPossibleFreePage;n<e;++n){var i=t[n],r=i.tryAllocate();if(r)return r[Yu].pageIndex=n,0===i.freeCount&&++this._foremostPossibleFreePage,r}var o=this._allocatePoseInNewPage();return this._foremostPossibleFreePage=o[Yu].pageIndex,o},e.destroyPose=function(t){var e=this._pages;e.length;var n=t[Yu].pageIndex,i=e[n];i.deallocate(t),--this._allocatedCount,n<this._foremostPossibleFreePage&&(_(i.freeCount>0),this._foremostPossibleFreePage=n)},e._allocatePoseInNewPage=function(){var t=new Ku(this._transformCount,this._metaValueCount,4),e=this._pages.length;this._pages.push(t);var n=t.tryAllocate();return n[Yu].pageIndex=e,n},r(t,[{key:"allocatedCount",get:function(){return this._allocatedCount}}]),t}(),Zu=function(){function t(){this._id=-1}return r(t,[{key:"pageIndex",get:function(){return this._id>>Ju},set:function(t){this._id&=Xu,this._id|=t<<Ju}},{key:"poseIndex",get:function(){return this._id&Xu},set:function(t){this._id&=~Xu,this._id|=t}}]),t}(),Xu=7,Ju=3,Ku=function(){function t(t,e,n){this._buffer=void 0,this._idleFlags=15,this._poses=void 0,this._freeCount=0,this._transformCount=t,this._metaValueCount=e,this._capacity=n;var i=(Pu.BYTES_PER_ELEMENT*t+Float64Array.BYTES_PER_ELEMENT*e)*n;this._buffer=new ArrayBuffer(i),this._poses=new Array(n).fill(null),this._freeCount=n}var e=t.prototype;return e.tryAllocate=function(){var t,e,n=this._poses,i=this._idleFlags,r=this._capacity,o=0===(e=i)?1/0:Math.log2(e&-e);if(o>=r)return null;_(o>=0&&o<n.length);var a=null!==(t=n[o])&&void 0!==t?t:n[o]=this._createPose(o);return a[Yu].poseIndex=o,this._idleFlags&=~(1<<o),_(this._freeCount>0),--this._freeCount,a},e.deallocate=function(t){var e=this._poses,n=t[Yu].poseIndex;_(n>=0&&n<e.length),_(e[n]===t),this._idleFlags|=1<<n,_(this._freeCount<this._capacity),++this._freeCount},e._createPose=function(t){var e=Pu.BYTES_PER_ELEMENT*this._transformCount,n=(e+Float64Array.BYTES_PER_ELEMENT*this._metaValueCount)*t,i=new Pu(this._buffer,n,this._transformCount),r=new Float64Array(this._buffer,n+e,this._metaValueCount),o=qr._create(i,r);return o[Yu]=new Zu,o},r(t,[{key:"capacity",get:function(){return this._capacity}},{key:"freeCount",get:function(){return this._freeCount}}]),t}();function $u(t,e){if(t.name===e)return t;for(var n=t.children.length,i=0;i<n;++i){var r=$u(t.children[i],e);if(r)return r}return null}var tl,el=function(){function t(t,e,n,i){var r=this;this._origin=void 0,this._layoutMaintainer=void 0,this._varRegistry=void 0,this._additiveFlagStack=[],this._triggerResetter=function(t){return r._resetTrigger(t)},this._isLayerWideContextPropertiesSet=!1,this._stashView=void 0,this._motionSyncManager=void 0,this._clipOverrides=void 0,this._controller=i,this._origin=t,this._layoutMaintainer=e,this._varRegistry=n,this._additiveFlagStack=[!1]}var e=t.prototype;return e.bindTransform=function(t){var e=this._origin.getChildByPath(t);return e?this._layoutMaintainer.getOrCreateTransformBinding(e):null},e.bindTransformByName=function(t){var e=$u(this._origin,t);return e?this._layoutMaintainer.getOrCreateTransformBinding(e):null},e.getBoneChildren=function(t){var e=$u(this._origin,t);return e?e.children.map((function(t){return t.name})):[]},e.getParentBoneNameByName=function(t){var e,n=$u(this._origin,t);return n?n===this._origin?"":null===(e=n.parent)||void 0===e?void 0:e.name:null},e.bindAuxiliaryCurve=function(t){return this._layoutMaintainer.getOrCreateAuxiliaryCurveBinding(t)},e.getEvaluationTimeAuxiliaryCurveView=function(){return this._layoutMaintainer.auxiliaryCurveRegistry},e.getVar=function(t){return this._varRegistry[t]},e._pushAdditiveFlag=function(t){this._additiveFlagStack.push(t)},e._popAdditiveFlag=function(){_(this._additiveFlagStack.length>1),this._additiveFlagStack.pop()},e._integrityCheck=function(){return 1===this._additiveFlagStack.length},e._setLayerWideContextProperties=function(t,e){_(!this._isLayerWideContextPropertiesSet),this._isLayerWideContextPropertiesSet=!0,this._stashView=t,this._motionSyncManager=e},e._unsetLayerWideContextProperties=function(){_(this._isLayerWideContextPropertiesSet),this._isLayerWideContextPropertiesSet=!1,this._stashView=void 0,this._motionSyncManager=void 0},e._setClipOverrides=function(t){this._clipOverrides=t},e._resetTrigger=function(t){var e=this._varRegistry[t];e&&(e.value=!1)},r(t,[{key:"origin",get:function(){return this._origin}},{key:"controller",get:function(){return this._controller}},{key:"triggerResetter",get:function(){return this._triggerResetter}},{key:"clipOverrides",get:function(){return this._clipOverrides}},{key:"additive",get:function(){var t=this._additiveFlagStack;return t[t.length-1]}},{key:"stashView",get:function(){return _(this._stashView),this._stashView}},{key:"motionSyncManager",get:function(){return _(this._motionSyncManager),this._motionSyncManager}}]),t}(),nl=new Vr,il=function(){function t(){this._namedCurves=new Map}var e=t.prototype;return e.names=function(){return this._namedCurves.keys()},e.has=function(t){return this._namedCurves.has(t)},e.get=function(t){var e;return null!==(e=this._namedCurves.get(t))&&void 0!==e?e:0},e.set=function(t,e){this._namedCurves.set(t,e)},t}();!function(t){t[t.TRANSFORM_COUNT=1]="TRANSFORM_COUNT",t[t.TRANSFORM_ORDER=2]="TRANSFORM_ORDER",t[t.AUXILIARY_CURVE_COUNT=4]="AUXILIARY_CURVE_COUNT"}(tl||(tl={}));var rl=(Uu=function(){},Vu=function(){},Gu=function(){},Wu=function(){},zu=function(){},ju=function(){},Hu=function(){},Qu=function(){function t(t,e){this._origin=void 0,this._auxiliaryCurveRegistry=void 0,this._auxiliaryCurveRecords=[],this._transformRecords=[],this._parentTable=[],this._bindStarted=!1,this._transformCountBeforeBind=-1,this._auxiliaryCurveCountBeforeBind=-1,this._origin=t,this._auxiliaryCurveRegistry=e}var e=t.prototype;return e.getOrCreateTransformBinding=function(t){for(var e=this._origin,n=!1,i=t;i;i=i.parent)if(i===e){n=!0;break}if(!n)return null;var r=this._getOrCreateTransformBinding(t);if(t!==e)for(var o=t.parent;o!==e;o=o.parent)this._getOrCreateTransformBinding(o);return r},e._getOrCreateTransformBinding=function(t){var e=this._transformRecords,n=e.findIndex((function(e){return e.node===t}));if(n>=0){var i=e[n];return++i.refCount,i.handle}for(var r=0,o=function(t){var n=e.findIndex((function(e){return e.node===t}));if(n>=0)return r=n+1,"break"},a=t.parent;a&&"break"!==o(a);a=a.parent);for(var s=r;s<e.length;++s)++e[s].handle.index;var u=new ol(new _l(this,r),t);return e.splice(r,0,u),u.handle},e.getOrCreateAuxiliaryCurveBinding=function(t){var e=this._auxiliaryCurveRecords,n=e.findIndex((function(e){return e.name===t}));if(n>=0){var i=e[n];return++i.refCount,i.handle}var r=e.length,o=new al(new yl(this,r),t);return e.push(o),o.handle},e.createEvaluationContext=function(){return _(!this._bindStarted),new vl(this.transformCount,this.auxiliaryCurveCount,this._parentTable.slice(),this._origin)},e.resetPoseStashAllocator=function(t){_(!this._bindStarted),t._reset(this.transformCount,this.auxiliaryCurveCount)},e.createTransformFilter=function(t){for(var e,n=this._origin,i=[],r=p(this._transformRecords);!(e=r()).done;){var o=e.value,a=o.node,s=o.handle,u=l(n,a);if(void 0===u)S(a.getPathInHierarchy()+" is not a child of "+n.getPathInHierarchy());else if(t.isExcluded(u))continue;i.push(s.index)}return i.sort(),new Zr(i);function l(t,e){for(var n=[],i=e;i;i=i.parent){if(i===t)return n.join("/");n.unshift(i.name)}}},e.fetchDefaultTransforms=function(t){var e=this._transformRecords.length;_(t.length===e);for(var n=0;n<e;++n){var i=this._transformRecords[n].defaultTransform;t.setTransform(n,i)}},e.apply=function(t){var e=t.transforms,n=t.auxiliaryCurves,i=this._transformRecords.length;_(e.length===i);for(var r=0;r<i;++r){var o=e.getTransform(r,nl);this._transformRecords[r].node.setRTS(o.rotation,o.position,o.scale)}for(var a=this._auxiliaryCurveRecords.length,s=0;s<a;++s){var u=this._auxiliaryCurveRecords[s].name,l=n[s];this._auxiliaryCurveRegistry.set(u,l)}},e._destroyTransformHandle=function(t){_(t>=0&&t<this._transformRecords.length);var e=this._transformRecords[t];_(e.refCount>0),--e.refCount},e._destroyAuxiliaryCurveHandle=function(t){_(t>=0&&t<this._auxiliaryCurveRecords.length);var e=this._auxiliaryCurveRecords[t];_(e.refCount>0),--e.refCount},e.startBind=function(){this._bindStarted=!0,this._transformCountBeforeBind=this._transformRecords.length,this._auxiliaryCurveCountBeforeBind=this._auxiliaryCurveRecords.length},e.endBind=function(){var t=this._transformRecords,e=this._auxiliaryCurveRecords,n=0;if(sl(t),t.length!==this._transformCountBeforeBind){n|=tl.TRANSFORM_COUNT;for(var i=t.length,r=0;r<i;++r)t[r].order=r}else{for(var o=t.length,a=!1,s=0;s<o;++s){var u=t[s];u.order!==s&&(a=!0,u.order=s)}a&&(n|=tl.TRANSFORM_ORDER)}sl(e),e.length!==this._auxiliaryCurveCountBeforeBind&&(n|=tl.AUXILIARY_CURVE_COUNT);var l=this._parentTable,c=this._origin;l.length=t.length;for(var h=function(){var e=t[f].node;if(e===c)return l[f]=-1,"continue";var n=e.parent;if(n===c){var i=t.findIndex((function(t){return t.node===n}));l[f]=i>=0?i:-1}else{var r=t.findIndex((function(t){return t.node===n}));l[f]=r}},f=0;f<t.length;++f)h();return this._bindStarted=!1,n},r(t,[{key:"transformCount",get:function(){return this._transformRecords.length}},{key:"auxiliaryCurveCount",get:function(){return this._auxiliaryCurveRecords.length}},{key:"auxiliaryCurveRegistry",get:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){return this._auxiliaryCurveRegistry}))}]),t}(),f(Qu.prototype,"getOrCreateTransformBinding",[Uu],Object.getOwnPropertyDescriptor(Qu.prototype,"getOrCreateTransformBinding"),Qu.prototype),f(Qu.prototype,"_getOrCreateTransformBinding",[Vu],Object.getOwnPropertyDescriptor(Qu.prototype,"_getOrCreateTransformBinding"),Qu.prototype),f(Qu.prototype,"getOrCreateAuxiliaryCurveBinding",[Gu],Object.getOwnPropertyDescriptor(Qu.prototype,"getOrCreateAuxiliaryCurveBinding"),Qu.prototype),f(Qu.prototype,"_destroyTransformHandle",[Wu],Object.getOwnPropertyDescriptor(Qu.prototype,"_destroyTransformHandle"),Qu.prototype),f(Qu.prototype,"_destroyAuxiliaryCurveHandle",[zu],Object.getOwnPropertyDescriptor(Qu.prototype,"_destroyAuxiliaryCurveHandle"),Qu.prototype),f(Qu.prototype,"startBind",[ju],Object.getOwnPropertyDescriptor(Qu.prototype,"startBind"),Qu.prototype),f(Qu.prototype,"endBind",[Hu],Object.getOwnPropertyDescriptor(Qu.prototype,"endBind"),Qu.prototype),Qu),ol=function(t,e){this.order=-1,this.refCount=1,this.handle=void 0,this.node=void 0,this.defaultTransform=void 0,this.handle=t,this.node=e;var n=new Vr;n.position=e.position,n.rotation=e.rotation,n.scale=e.scale,this.defaultTransform=n},al=function(t,e){this.refCount=1,this.handle=void 0,this.name=void 0,this.handle=t,this.name=e};function sl(t){var e=function(t,e){for(var n=t.length,i=0;i<n&&e(t[i]);++i);if(i===n)return n;for(var r=i,o=i+1;o<n;++o){var a=t[o];if(e(a)){var s=a;t[o]=t[r],t[r]=s,++r}}return r}(t,(function(t){return _(t.refCount>=0),t.refCount>0}));if(_(e<=t.length),e!==t.length){for(var n=0;n<e;++n)t[n].handle.index=n;t.splice(e,t.length-e)}}var ul,ll,cl,hl=Symbol("[[DefaultTransforms]]"),fl=function(){function t(t){this._layoutMaintainer=t}return t.prototype.createTransformFilter=function(t){return this._layoutMaintainer.createTransformFilter(t)},r(t,[{key:"transformCount",get:function(){return this._layoutMaintainer.transformCount}}]),t}(),pl=new Vr,dl=new Vr,vl=function(){function t(t,e,n,i){this[hl]=void 0,this._poseAllocator=void 0,this._parentTable=void 0,this._componentNode=void 0,this._cacheComponentToWorldTransform=new Vr,this._poseAllocator=new Mu(t,e),this._parentTable=n,this._componentNode=i,this[hl]=new Pu(t)}var e=t.prototype;return e.destroy=function(){this._poseAllocator.destroy()},e.pushDefaultedPose=function(){var t=this._poseAllocator.push();return t.transforms.set(this[hl]),t._poseTransformSpace=jr.LOCAL,t.auxiliaryCurves.fill(0),t},e.pushDefaultedPoseInComponentSpace=function(){var t=this.pushDefaultedPose();return this._poseTransformsSpaceLocalToComponent(t),t},e.pushZeroDeltaPose=function(){var t=this._poseAllocator.push();return t.transforms.fill(Yr),t._poseTransformSpace=jr.LOCAL,t.auxiliaryCurves.fill(0),t},e.pushDuplicatedPose=function(t){var e=this._poseAllocator.push();return e.transforms.set(t.transforms),e._poseTransformSpace=t._poseTransformSpace,e.auxiliaryCurves.set(t.auxiliaryCurves),e},e.popPose=function(){this._poseAllocator.pop()},e._isStackTopPose_debugging=function(t){return t===this._poseAllocator.top},e._poseTransformsSpaceLocalToComponent=function(t){for(var e=t.transforms,n=e.length,i=0;i<n;++i){var r=this._parentTable[i];if(!(r<0)){var o=e.getTransform(i,pl),a=e.getTransform(r,dl);Vr.multiply(o,a,o),e.setTransform(i,o)}}t._poseTransformSpace=jr.COMPONENT},e._poseTransformsSpaceComponentToLocal=function(t){for(var e=t.transforms,n=e.length-1;n>=0;--n){var i=this._parentTable[n];if(!(i<0)){var r=e.getTransform(n,pl),o=e.getTransform(i,dl);Vr.calculateRelative(r,r,o),e.setTransform(n,r)}}t._poseTransformSpace=jr.LOCAL},e._convertPoseSpaceTransformToTargetSpace=function(t,e,n,i){var r=n._poseTransformSpace;switch(e){default:break;case Bu.WORLD:r===jr.COMPONENT?Vr.multiply(t,this._getComponentToWorldTransform(),t):(_(r===jr.LOCAL),Vr.multiply(t,this._getLocalToWorldTransform(dl,n,i),t));break;case Bu.COMPONENT:r===jr.COMPONENT||(_(r===jr.LOCAL),Vr.multiply(t,this._getLocalToComponentTransform(dl,n,i),t));break;case Bu.PARENT:if(r===jr.COMPONENT){var o=this._parentTable[i];if(o>=0){var a=n.transforms.getTransform(o,dl),s=Vr.invert(a,a);Vr.multiply(t,s,t)}}else _(r===jr.LOCAL);break;case Bu.LOCAL:_(r===jr.COMPONENT||r===jr.LOCAL);var u=n.transforms.getTransform(i,dl),l=Vr.invert(u,u);Vr.multiply(t,l,t)}return t},e._convertTransformToPoseTransformSpace=function(t,e,n,i){var r=n._poseTransformSpace;switch(e){default:break;case Bu.WORLD:if(r===jr.COMPONENT){var o=Vr.invert(dl,this._getComponentToWorldTransform());Vr.multiply(t,o,t)}else{_(r===jr.LOCAL);var a=this._getLocalToWorldTransform(dl,n,i),s=Vr.invert(a,a);Vr.multiply(t,s,t)}break;case Bu.COMPONENT:if(r===jr.COMPONENT);else{_(r===jr.LOCAL);var u=this._getLocalToComponentTransform(dl,n,i),l=Vr.invert(u,u);Vr.multiply(t,l,t)}break;case Bu.PARENT:if(r===jr.COMPONENT){var c=this._parentTable[i];if(c>=0){var h=n.transforms.getTransform(c,dl);Vr.multiply(t,h,t)}}break;case Bu.LOCAL:_(r===jr.COMPONENT||r===jr.LOCAL);var f=n.transforms.getTransform(i,dl);Vr.multiply(t,f,t)}return t},e._getComponentToWorldTransform=function(){var t=this._cacheComponentToWorldTransform,e=this._componentNode;return t.position=e.worldPosition,t.rotation=e.worldRotation,t.scale=e.worldScale,t},e._getLocalToComponentTransform=function(t,e,n){var i=this._parentTable;Vr.setIdentity(t);for(var r=i[n];r>=0;r=i[r]){var o=e.transforms.getTransform(r,pl);Vr.multiply(t,o,t)}return t},e._getLocalToWorldTransform=function(t,e,n){return this._getLocalToComponentTransform(t,e,n),Vr.multiply(t,this._getComponentToWorldTransform(),t),t},r(t,[{key:"allocatedPoseCount",get:function(){return this._poseAllocator.allocatedCount}},{key:"parentTable",get:function(){return this._parentTable}},{key:"_stackSize_debugging",get:function(){return this._poseAllocator.allocatedCount}}]),t}(),_l=function(){function t(t,e){this.index=-1,this._host=void 0,this._host=t,this.index=e}return t.prototype.destroy=function(){this._host._destroyTransformHandle(this.index)},t}(),yl=function(){function t(t,e){this.index=-1,this._host=void 0,this._host=t,this.index=e}return t.prototype.destroy=function(){this._host._destroyAuxiliaryCurveHandle(this.index)},t}(),gl=function(){function t(){this._context={deltaTime:0,indicativeWeight:0}}var e=t.prototype;return e.generate=function(t,e){return this._context.deltaTime=t,this._context.indicativeWeight=e,this._context},e.forkSubWeight=function(t,e){this._context.deltaTime=t.deltaTime,this._context.indicativeWeight=t.indicativeWeight*e},t}(),ml=function(){function t(){this._allocator=null}var e=t.prototype;return e._reset=function(t,e){this._allocator=new qu(t,e)},e.allocatePose=function(){return _(this._allocator),this._allocator.allocatePose()},e.destroyPose=function(t){return _(this._allocator),this._allocator.destroyPose(t)},r(t,[{key:"allocatedPoseCount",get:function(){return _(this._allocator),this._allocator.allocatedCount}}]),t}(),El=function(t){function e(e){var n;return(n=t.call(this)||this)._outputTypes=[],n._outputTypes=e,n}n(e,t);var i=e.prototype;return i.getOutputType=function(t){return this._outputTypes[t]},i.link=function(){},r(e,[{key:"outputCount",get:function(){return this._outputTypes.length}}]),e}(Qn),Tl=function(t){function e(e){return t.call(this,[e])||this}return n(e,t),e.prototype.selfEvaluate=function(t){t[0]=this.selfEvaluateDefaultOutput()},e}(El);function Al(t){return function(e,n){if("string"==typeof n){var i=e.constructor;t.type!==Wn.POSE||C(i,xs)?C(i,xs)||C(i,El)?Jn.setPropertyNodeInputRecord(i,n,t):S("@input can be only applied to fields of subclasses of PoseNode or PureValueNode."):S("@input specifying pose input can be only applied to fields of subclasses of PoseNode.")}else S("@input can be only applied to string-named fields.")}}var bl,Cl,Sl,wl,Pl,Ol,Nl,Il,xl,Rl,kl,Ll,Ml=e(Z+"MotionSyncInfo")((ll=function(){this.group=cl&&cl()},cl=i(ll.prototype,"group",[a],(function(){return""})),ul=ll))||ul;function Dl(t){return{listEntries:function(){return[{arg:{type:"clip-motion"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_clip_motion"},{arg:{type:"animation-blend-1d"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_animation_blend_1d"},{arg:{type:"animation-blend-2d"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_animation_blend_2d"}]},create:function(e){var n=null;switch(e.type){case"clip-motion":n=new Ho;break;case"animation-blend-1d":n=new fa;break;case"animation-blend-2d":n=new Fa}return t(n)}}}var Bl=1e-5,Fl=(bl=e(Z+"PoseNodePlayMotion"),Cl=li(Ts),Sl=ci(Dl((function(t){var e=new Fl;return e.motion=t,e}))),wl=fi({themeColor:"#227F9B"}),Pl=Al({type:Wn.FLOAT}),Ol=Al({type:Wn.FLOAT}),bl(Nl=Cl(Nl=Sl(Nl=wl((Il=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).motion=xl&&xl(),e.syncInfo=Rl&&Rl(),d(e,"startTime",kl,G(e)),d(e,"speedMultiplier",Ll,G(e)),e._workspace=null,e._runtimeSyncRecord=void 0,e}n(e,t);var i=e.prototype;return i.bind=function(t){var e,n=this.motion;if(n){var i=n[Rr](t,null!==(e=t.clipOverrides)&&void 0!==e?e:null,!1);i&&(this._workspace=new Ul(i,i.createPort()),this.syncInfo.group&&(this._runtimeSyncRecord=t.motionSyncManager.register(this.syncInfo)))}},i.settle=function(){},i.reenter=function(){if(this._workspace){var t=this._runtimeSyncRecord,e=this._workspace.motionEval.duration;this._forceEvaluateEvaluation();var n=e<Bl?0:V(this.startTime/e);t?t.notifyRenter(n):this._workspace.normalizedTime=n,this._workspace.lastIndicativeWeight=0}},i.doUpdate=function(t){if(this._workspace){var e=t.deltaTime,n=this._runtimeSyncRecord,i=this._workspace.motionEval.duration,r=0;i>Bl&&(r=e*this.speedMultiplier/i),n?n.notifyUpdate(r,t.indicativeWeight):this._workspace.normalizedTime+=r,this._workspace.lastIndicativeWeight=t.indicativeWeight}},i.doEvaluate=function(t){if(this._workspace){var e=this._runtimeSyncRecord?this._runtimeSyncRecord.getSyncedEnterTime():this._workspace.normalizedTime;return this._workspace.motionEvalPort.evaluate(e,t)}return t.pushDefaultedPose()},r(e,[{key:"lastIndicativeWeight",get:function(){var t,e;return null!==(t=null===(e=this._workspace)||void 0===e?void 0:e.lastIndicativeWeight)&&void 0!==t?t:0}},{key:"elapsedMotionTime",get:function(){var t,e;return null!==(t=null===(e=this._workspace)||void 0===e?void 0:e.normalizedTime)&&void 0!==t?t:0}}]),e}(xs),xl=i(Il.prototype,"motion",[a],(function(){return new Ho})),Rl=i(Il.prototype,"syncInfo",[a],(function(){return new Ml})),kl=f(Il.prototype,"startTime",[a,Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ll=f(Il.prototype,"speedMultiplier",[a,Ol],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Nl=Il))||Nl)||Nl)||Nl)||Nl),Ul=function(t,e){this.normalizedTime=0,this.lastIndicativeWeight=0,this.motionEval=t,this.motionEvalPort=e};function Vl(t){return t instanceof xs||t instanceof El}var Gl=function(){function t(t,e){this._rootPoseNode=t,this._countingPlayMotionNodes=e}var e=t.prototype;return e.bind=function(t){var e;null===(e=this._rootPoseNode)||void 0===e||e.bind(t)},e.settle=function(t){var e;null===(e=this._rootPoseNode)||void 0===e||e.settle(t)},e.reenter=function(){var t;null===(t=this._rootPoseNode)||void 0===t||t.reenter()},e.update=function(t){var e;null===(e=this._rootPoseNode)||void 0===e||e.update(t)},e.evaluate=function(t){var e,n;return null!==(e=null===(n=this._rootPoseNode)||void 0===n?void 0:n.evaluate(t,ds.LOCAL))&&void 0!==e?e:null},e.countMotionTime=function(){var t=this._countingPlayMotionNodes;if(!t)return 0;for(var e=0,n=Number.NEGATIVE_INFINITY,i=0;i<t.length;++i){var r=t[i],o=r.elapsedMotionTime,a=r.lastIndicativeWeight;a>n&&(n=a,e=o)}return e},t}();function Wl(t,e,n){void 0===n&&(n=!1);var i=t.outputNode,r=t.getShell(i).getBindings();if(_(r.length<2),0===r.length)return new Gl(void 0,n?[]:void 0);var o=r[0];_(0===o.outputIndex),_(o.producer instanceof xs);var a=new Map,s=zl(t,o.producer,a,e);return new Gl(s,n?Array.from(a.values()).filter((function(t){return t instanceof Fl})):void 0)}function zl(t,e,n,i){var r=t.getShell(e),o=n.get(e);if(o)return o;var a=Ft(e);"__callOnAfterDeserializeRecursive"in a&&a.__callOnAfterDeserializeRecursive(),a instanceof El&&a.link(i);for(var s,l=a,c=[],h=p(r.getBindings());!(s=h()).done;){var f=s.value,d=f.producer,v=f.outputIndex,_=f.inputPath;if(Vl(d)){var y=zl(t,d,n,i);if(y instanceof xs)Ql(l,_,y,v);else{var g=Xl(l,_,y,v);g&&c.push(g)}}else u("There's a input bound to a node with unrecognized type.")}var m,E=new jl(c);return l instanceof xs?(l._setDependencyEvaluation(E),m=l):m=new Hl(l,E),n.set(e,m),m}var jl=function(){function t(t){this._bindingEvaluations=void 0,this._bindingEvaluations=t}return t.prototype.evaluate=function(){for(var t,e=this._bindingEvaluations,n=p(e);!(t=n()).done;)t.value.evaluate()},t}(),Hl=function(){function t(t,e){this._outputs=void 0,this._node=t,this._dependency=e,this._outputs=new Array(t.outputCount)}var e=t.prototype;return e.getDefaultOutput=function(){return this.getOutput(0)},e.getOutput=function(t){return this._outputs[t]},e.evaluate=function(){var t=this._node;this._dependency.evaluate(),t.selfEvaluate(this._outputs)},r(t,[{key:"node",get:function(){return this._node}},{key:"outputCount",get:function(){return this._outputs.length}}]),t}();function Ql(t,e,n,i){var r=e[0],o=e[1],a=void 0===o?-1:o;if(r in t)if(0===i){var s=t[r];if(a<0)return null!==s?void u("Invalid binding: consumer node's input "+r+" should be leaved as evaluation before evaluation."):void(t[r]=n);Array.isArray(s)?a>=s.length?u("Invalid binding: consumer node's input "+r+" have length "+s.length+" but the binding specified "+a):null===s[a]?s[a]=n:u("Invalid binding: consumer node's input "+r+"["+a+"] should be leaved as null before evaluation"):u("Invalid binding: consumer node's input "+r+" should be an array.")}else u("Node "+n.toString()+" does not have specified output "+i+".");else u("Invalid binding: consumer node has no property "+r)}var Yl,ql=function(){function t(t,e,n,i){this._consumerNode=t,this._consumerPropertyKey=e,this._producerRecord=n,this._producerOutputIndex=i}return t.prototype.evaluate=function(){this._producerRecord.evaluate(),this._consumerNode[this._consumerPropertyKey]=this._producerRecord.getOutput(this._producerOutputIndex)},t}(),Zl=function(){function t(t,e,n,i,r){this._consumerNode=t,this._consumerPropertyKey=e,this._consumerElementIndex=n,this._producerRecord=i,this._producerOutputIndex=r}return t.prototype.evaluate=function(){this._producerRecord.evaluate(),this._consumerNode[this._consumerPropertyKey][this._consumerElementIndex]=this._producerRecord.getOutput(this._producerOutputIndex)},t}();function Xl(t,e,n,i){var r=e[0],o=e[1],a=void 0===o?-1:o;if(r in t){var s=t[r];if(a<0)return new ql(t,r,n,i);if(Array.isArray(s)){if(!(a>=s.length))return new Zl(t,r,a,n,i);u("Invalid binding: consumer node's input "+r+" have length "+s.length+" but the binding specified "+a)}else u("Invalid binding: consumer node's input "+r+" should be an array.")}else u("Invalid binding: consumer node has no property "+r)}var Jl=function(){function t(t,e,n,i){this.passthroughWeight=1,this._motionStates=[],this._proceduralPoseStates=[],this._topLevelEntry=void 0,this._topLevelExit=void 0,this._currentNode=void 0,this._pendingTransitionPath=[],this._activatedTransitions=[],this._activatedTransitionPool=Pc.createPool(4),this._updateContextGenerator=new gl,this._conditionEvaluationContext=new wc,this._additive=!1,this._additive=n.additive,this.name=e,this._controller=n.controller;var r=this._addStateMachine(t,null,n,i,e),o=r.entry,a=r.exit;this._topLevelEntry=o,this._topLevelExit=a,this._currentNode=o,o.increaseActiveReference(),this._resetTrigger=n.triggerResetter}var e=t.prototype;return e.settle=function(t){for(var e=this._proceduralPoseStates,n=e.length,i=0;i<n;++i)e[i].settle(t)},e.reenter=function(){for(var t,e=p(this._activatedTransitions);!(t=e()).done;){var n=t.value;n.destination.decreaseActiveReference(),this._activatedTransitionPool.free(n)}this._activatedTransitions.length=0,this._topLevelEntry.increaseActiveReference(),this._currentNode.decreaseActiveReference(),this._currentNode=this._topLevelEntry},e.update=function(t){_(!this.exited),this._loopMatchTransitions(),this._resetStateTickFlagsAndWeights(),this._updateActivatedTransitions(t.deltaTime),this._commitStateUpdates(t)},e.evaluate=function(t){return this._sample(t)||this._pushNullishPose(t)},e.getCurrentStateStatus=function(){var t=this._currentNode;return t.kind===$l.animation||t.kind===$l.procedural?t.getStatus():null},e.getCurrentClipStatuses=function(){var t=this._currentNode;return t.kind===$l.animation?t.getClipStatuses(t.absoluteWeight):ec},e.getCurrentTransition=function(t){var e=this._activatedTransitions;if(0===e.length)return!1;var n=e[e.length-1],i=1===e.length?this._currentNode:e[e.length-2].destination,r=n.getAbsoluteDuration(i);return t.duration=r,t.time=n.normalizedElapsedTime*r,!0},e.getNextStateStatus=function(){var t=this._activatedTransitions;if(0===t.length)return null;var e=t[t.length-1].destination;switch(e.kind){default:break;case $l.procedural:case $l.animation:return e.getStatus()}return null},e.getNextClipStatuses=function(){var t,e=this._activatedTransitions;if(0===e.length)return ec;var n=e[e.length-1],i=n.destination;switch(i.kind){default:return ec;case $l.animation:return null!==(t=i.getClipStatuses(n.destination.absoluteWeight))&&void 0!==t?t:ec}},e.overrideClips=function(t,e){for(var n=this._motionStates,i=n.length,r=0;r<i;++r)n[r].overrideClips(t,e)},e._addStateMachine=function(t,e,n,i,r){for(var o,a,s,u=this,l=Array.from(t.states()),c=l.map((function(e){if(e instanceof Pn){var r=new ac(e,n,i);return u._motionStates.push(r),r}if(e===t.entryState)return o=new bc(e,$l.entry,e.name);if(e===t.exitState)return s=new bc(e,$l.exit,e.name);if(e===t.anyState)return a=new bc(e,$l.any,e.name);if(e instanceof Er)return new Cc(e);if(e instanceof br){var l=new Sc(e,n);return u._proceduralPoseStates.push(l),l}return null})),h={components:null,parent:e,entry:o,exit:s,any:a},f=0;f<l.length;++f){var d=c[f];d&&(d.stateMachine=h)}for(var v=l.map((function(t){if(t instanceof Pr){var e=u._addStateMachine(t.stateMachine,h,n,i,r+"/"+t.name);return e.components=new oc(t),e}return null})),_=0;_<l.length;++_){var y=l[_],g=t.getOutgoings(y),m=void 0;if(y instanceof Pr){var E=v[_];m=E.exit}else{var T=c[_];m=T}for(var A,b=function(){var t,e=A.value,i=e.to,r=l.findIndex((function(t){return t===e.to}));if(i instanceof Pr)t=v[r].entry;else{var o=c[r];t=o instanceof ac?o.entry:o}var a={conditions:e.conditions.map((function(t){return t[Rr](n)})),to:t,triggers:void 0,duration:0,normalizedDuration:!1,destinationStart:0,relativeDestinationStart:!1,exitCondition:0,exitConditionEnabled:!1,activated:!1,startEventBinding:void 0,endEventBinding:void 0};(gr(e)||e instanceof Tr||e instanceof Sr)&&(a.duration=e.duration,a.destinationStart=e.destinationStart,a.relativeDestinationStart=e.relativeDestinationStart,e.startEventBinding.isBound&&(a.startEventBinding=e.startEventBinding),e.endEventBinding.isBound&&(a.endEventBinding=e.endEventBinding),gr(e)&&(a.normalizedDuration=e.relativeDuration,a.exitConditionEnabled=e.exitConditionEnabled,a.exitCondition=e.exitCondition)),a.conditions.forEach((function(t,n){var i,r=e.conditions[n];r instanceof Au&&r.trigger&&(null!==(i=a.triggers)&&void 0!==i?i:a.triggers=[]).push(r.trigger)})),m.addTransition(a)},C=p(g);!(A=C()).done;)b()}return h},e._loopMatchTransitions=function(){var t=this._pendingTransitionPath,e=this._activatedTransitions;_(0===t.length);for(var n=0===e.length?this._currentNode:e[e.length-1].destination,i=0;;++i){if(i>=16){h(14e3,16,"");break}var r=this._matchNextTransition(n);if(!r)break;var o=r.to,a=n;if(n=o,Kl(o)){if(o===a)break;this._activateTransition(t,r),t.length=0}else t.push(r)}t.length=0},e._resetStateTickFlagsAndWeights=function(){var t=this._currentNode,e=this._activatedTransitions;t.resetTickFlagsAndWeight();for(var n=0;n<e.length;++n)e[n].destination.resetTickFlagsAndWeight()},e._commitStateUpdates=function(t){var e=this._currentNode,n=this._activatedTransitions;this._updateContextGenerator,this._commitStateUpdate(e,t);for(var i=0;i<n.length;++i){var r=n[i].destination;this._commitStateUpdate(r,t)}},e._commitStateUpdate=function(t,e){var n=this._updateContextGenerator;if(!t.testTickFlag(nc.UPDATED))if(t.setTickFlag(nc.UPDATED),t.kind===$l.animation)t.update(e.deltaTime,this._controller);else if(t.kind===$l.procedural){var i=n.generate(e.deltaTime,e.indicativeWeight*t.absoluteWeight);t.update(i)}},e._sample=function(t){var e,n=this._currentNode,i=this._activatedTransitions,r=1,o=null,a=0;if(n.kind===$l.animation)o=null!==(e=n.evaluate(t))&&void 0!==e?e:this._pushNullishPose(t);else if(n.kind===$l.procedural){var s;o=null!==(s=n.evaluate(t))&&void 0!==s?s:this._pushNullishPose(t)}else r-=n.absoluteWeight,o=null;o&&(a=n.absoluteWeight),n.setTickFlag(nc.EVALUATED);for(var u=0;u<i.length;++u){var l=i[u].destination;if(!l.testTickFlag(nc.EVALUATED)){l.setTickFlag(nc.EVALUATED);var c,h=l.absoluteWeight,f=void 0;l.kind===$l.empty?(r-=h,f=null):f=null!==(c=l.evaluate(t))&&void 0!==c?c:this._pushNullishPose(t),f&&(o&&(a+=h)?(Xr(o,f,h/a),t.popPose()):o=f)}}return this.passthroughWeight=r,o},e._pushNullishPose=function(t){return this._additive?t.pushZeroDeltaPose():t.pushDefaultedPose()},e._matchNextTransition=function(t){var e=this._matchTransition(t,t);if(e)return e;if(t.kind===$l.animation||t.kind===$l.procedural){var n=this._matchAnyScoped(t);if(n)return n}return null},e._matchAnyScoped=function(t){for(var e=t.stateMachine;null!==e;e=e.parent){var n=this._matchTransition(e.any,t);if(n)return n}return null},e._matchTransition=function(t,e){_(t===e||t.kind===$l.any),this._conditionEvaluationContext.set(e);for(var n=t.outgoingTransitions,i=n.length,r=0;r<i;++r){var o=n[r];if(!o.activated){var a=o.conditions,s=a.length;if(0===s){if(t.kind===$l.entry||t.kind===$l.exit)return o;if(!o.exitConditionEnabled)continue}if(e.kind===$l.animation&&o.exitConditionEnabled){var u=e.duration*o.exitCondition;if(e.time<u)break}for(var l=!0,c=0;c<s;++c)if(!a[c].eval(this._conditionEvaluationContext)){l=!1;break}if(l)return o}}return null},e._activateTransition=function(t,e){var n=e.to;_(Kl(n));var i=this._activatedTransitionPool.alloc();i.reset(t,e),this._activatedTransitions.push(i);for(var r=i.path.length,o=0;o<r;++o){var a=i.path[o];this._resetTriggersOnTransition(a)}for(var s=0;s<i.path.length;++s){var u=i.path[s];this._callEnterMethods(u.to)}_(this._activatedTransitions.length>0);var l=1===this._activatedTransitions.length?this._currentNode:this._activatedTransitions[this._activatedTransitions.length-2].destination;l instanceof rc&&l.transitionOutEventBinding&&this._emit(l.transitionOutEventBinding),e.startEventBinding&&this._emit(e.startEventBinding),n instanceof rc&&n.transitionInEventBinding&&this._emit(n.transitionInEventBinding)},e._updateActivatedTransitions=function(t){for(var e=this._activatedTransitions,n=e.length-1,i=1,r=n;n>=0;--n){var o=e[n],a=0===n?this._currentNode:e[n-1].destination;if(o.update(t,a),o.done){this._dropActivatedTransitions(r);break}var s=o.normalizedElapsedTime*i;o.destination.increaseAbsoluteWeight(s),i*=1-o.normalizedElapsedTime,r=n-1}this._currentNode.increaseAbsoluteWeight(i)},e._dropActivatedTransitions=function(t){var e=this._activatedTransitions,n=this._activatedTransitionPool;_(t>=0&&t<e.length);var i=t+1,r=e[t],o=r.destination;_(0!==r.path.length);var a=r.path[r.path.length-1];a.endEventBinding&&this._emit(a.endEventBinding),this._callExitMethods(this._currentNode);for(var s=0;s<=t;++s){var u=e[s];s!==t&&u.destination.decreaseActiveReference();for(var l=s===t?u.path.length-1:u.path.length,c=0;c<l;++c){var h=u.path[c];this._callExitMethods(h.to)}n.free(u)}if(t===e.length-1)e.length=0;else{for(var f=t+1;f<e.length;++f)e[f-i]=e[f];e.length-=i}this._currentNode.decreaseActiveReference(),this._currentNode=o},e._resetTriggersOnTransition=function(t){var e=t.triggers;if(e)for(var n=e.length,i=0;i<n;++i){var r=e[i];this._resetTrigger(r)}},e._resetTrigger=function(t){(0,this._triggerReset)(t)},e._callEnterMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case $l.animation:t.components.callMotionStateEnterMethods(n,t.getStatus());break;case $l.entry:null===(e=t.stateMachine.components)||void 0===e||e.callStateMachineEnterMethods(n)}},e._callExitMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case $l.animation:t.components.callMotionStateExitMethods(n,t.getStatus());break;case $l.exit:null===(e=t.stateMachine.components)||void 0===e||e.callStateMachineExitMethods(n)}},e._emit=function(t){t.emit(this._controller.node)},r(t,[{key:"exited",get:function(){return this._currentNode===this._topLevelExit}}]),t}();function Kl(t){return t.kind===$l.animation||t.kind===$l.empty||t.kind===$l.procedural}var $l,tc=Object.freeze({next:function(){return{done:!0,value:void 0}}}),ec=Object.freeze(((Yl={})[Symbol.iterator]=function(){return tc},Yl));!function(t){t[t.entry=0]="entry",t[t.exit=1]="exit",t[t.any=2]="any",t[t.animation=3]="animation",t[t.empty=4]="empty",t[t.procedural=5]="procedural"}($l||($l={}));var nc,ic=function(){function t(t){this.name=void 0,this.outgoingTransitions=[],this._activeReferenceCount=0,this._tickFlags=0,this._absoluteWeight=0,this.name=t.name}var e=t.prototype;return e.setPrefix_debug=function(t){this.__DEBUG_ID__=""+t+this.name},e.addTransition=function(t){this.outgoingTransitions.push(t)},e.increaseActiveReference=function(){0===this._activeReferenceCount&&(this._absoluteWeight=0,this._tickFlags=0),++this._activeReferenceCount},e.decreaseActiveReference=function(){--this._activeReferenceCount},e.resetTickFlagsAndWeight=function(){this._checkActivated(),this._absoluteWeight=0,this._tickFlags=0},e.increaseAbsoluteWeight=function(t){this._absoluteWeight+=t},e.testTickFlag=function(t){return!!(this._tickFlags&t)},e.setTickFlag=function(t){_(!this.testTickFlag(t),"Can not set "+nc[t]+" since it has been set!"),this._tickFlags|=t},e._checkActivated=function(){_(this._activeReferenceCount>0)},r(t,[{key:"absoluteWeight",get:function(){return this._absoluteWeight}},{key:"activeReferenceCount",get:function(){return this._activeReferenceCount}}]),t}(),rc=function(t){function e(e){var n;return(n=t.call(this,e)||this).transitionInEventBinding=void 0,n.transitionOutEventBinding=void 0,e.transitionInEventBinding.isBound&&(n.transitionInEventBinding=e.transitionInEventBinding),e.transitionOutEventBinding.isBound&&(n.transitionOutEventBinding=e.transitionOutEventBinding),n}return n(e,t),e}(ic);!function(t){t[t.UPDATED=1]="UPDATED",t[t.EVALUATED=2]="EVALUATED"}(nc||(nc={}));var oc=function(){function t(t){this._components=t.instantiateComponents()}var e=t.prototype;return e.callMotionStateEnterMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateEnter",t,e)},e.callMotionStateUpdateMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateUpdate",t,e)},e.callMotionStateExitMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateExit",t,e)},e.callStateMachineEnterMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineEnter",t)},e.callStateMachineExitMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineExit",t)},e._callMotionStateCallbackIfNonDefault=function(t,e,n){for(var i=this._components,r=i.length,o=0;o<r;++o){var a=i[o];a[t]!==Cu.prototype[t]&&a[t](e,n)}},e._callStateMachineCallbackIfNonDefault=function(t,e){for(var n=this._components,i=n.length,r=0;r<i;++r){var o=n[r];o[t]!==Cu.prototype[t]&&o[t](e)}},t}(),ac=function(){function t(t,e,n){var i,r;this._source=null,this._baseSpeed=1,this._speed=1,this._publicState=void 0,this._privateState=void 0;var o=t.name;if(this._baseSpeed=t.speed,this._setSpeedMultiplier(1),t.speedMultiplierEnabled&&t.speedMultiplier){var a=t.speedMultiplier,s=e.getVar(a);if(aa(s,a)){!function(t,e,n){if(t!==e)throw new an(n,"number")}(s.type,me.FLOAT,a),s.bind(this._setSpeedMultiplier,this);var u=s.value;this._setSpeedMultiplier(u)}}var l=null!==(i=null===(r=t.motion)||void 0===r?void 0:r[Rr](e,n,!1))&&void 0!==i?i:null;l&&Object.defineProperty(l,"__DEBUG_ID__",{value:o}),this._source=l,this._publicState=new sc(this,t,null==l?void 0:l.createPort()),this._privateState=new sc(this,t,null==l?void 0:l.createPort()),this.components=new oc(t)}var e=t.prototype;return e.setPrefix_debug=function(t){this._publicState.setPrefix_debug(t),this._privateState.setPrefix_debug(t)},e.addTransition=function(t){t.to===this._publicState?this._publicState.addTransition(z({},t,{to:this._privateState})):this._publicState.addTransition(t),this._privateState.addTransition(t)},e.getClipStatuses=function(t){var e,n=this._source;return n?((e={})[Symbol.iterator]=function(){return n.getClipStatuses(t)},e):ec},e.overrideClips=function(t,e){var n;null===(n=this._source)||void 0===n||n.overrideClips(t,e)},e._setSpeedMultiplier=function(t){this._speed=this._baseSpeed*t},r(t,[{key:"duration",get:function(){var t,e;return null!==(t=null===(e=this._source)||void 0===e?void 0:e.duration)&&void 0!==t?t:0}},{key:"speed",get:function(){return this._speed}},{key:"entry",get:function(){return this._publicState}},{key:"stateMachine",get:function(){return this._stateMachine},set:function(t){this._stateMachine=t,this._publicState.stateMachine=t,this._privateState.stateMachine=t}}]),t}(),sc=function(t){function e(e,n,i){var r;return(r=t.call(this,n)||this).kind=$l.animation,r._container=void 0,r._progress=0,r._port=void 0,r._statusCache={progress:0},r._container=e,r._port=i,r}n(e,t);var i=e.prototype;return i.reenter=function(t){var e;this._progress=t,null===(e=this._port)||void 0===e||e.reenter()},i.getStatus=function(){var t=this._statusCache;return t.progress=uc(this._progress),t},i.getClipStatuses=function(t){return this._container.getClipStatuses(t)},i.update=function(t,e){this._progress=function(t,e,n){return 0===e?0:t+n/e}(this._progress,this.duration,t*this._container.speed),this._container.components.callMotionStateUpdateMethods(e,this.getStatus())},i.evaluate=function(t){var e,n;return null!==(e=null===(n=this._port)||void 0===n?void 0:n.evaluate(this._progress,t))&&void 0!==e?e:null},r(e,[{key:"duration",get:function(){return this._container.duration}},{key:"components",get:function(){return this._container.components}},{key:"normalizedTime",get:function(){return this._progress}},{key:"time",get:function(){return this._progress*this._container.duration}}]),e}(rc);function uc(t){var e=t-Math.trunc(t);return e>=0?e:1+e}var lc,cc,hc,fc,pc,dc,vc,_c,yc,gc,mc,Ec,Tc,Ac,bc=function(t){function e(e,n){var i;return(i=t.call(this,e)||this).kind=void 0,i.kind=n,i}return n(e,t),e}(ic),Cc=function(t){function e(e){var n;return(n=t.call(this,e)||this).kind=$l.empty,n}return n(e,t),e}(ic),Sc=function(t){function e(e,n){var i;(i=t.call(this,e)||this).kind=$l.procedural,i.elapsedTime=0,i.statusCache={progress:0},i._instantiatedPoseGraph=void 0,i._statusCache={progress:0},i._elapsedTime=0;var r=Wl(e.graph,n,!0);return r.bind(n),i._instantiatedPoseGraph=r,i._statusCache.progress=0,i}n(e,t);var i=e.prototype;return i.settle=function(t){this._instantiatedPoseGraph.settle(t)},i.reenter=function(){this._statusCache.progress=0,this._instantiatedPoseGraph.reenter()},i.update=function(t){this._elapsedTime+=t.deltaTime,this._instantiatedPoseGraph.update(t)},i.evaluate=function(t){var e;return null!==(e=this._instantiatedPoseGraph.evaluate(t))&&void 0!==e?e:null},i.getStatus=function(){return this._statusCache.progress=uc(this._elapsedTime),this._statusCache},i.countMotionTime=function(){return this._instantiatedPoseGraph.countMotionTime()},e}(rc),wc=function(){function t(){this.sourceStateWeight=0,this._sourceState=void 0}var e=t.prototype;return e.set=function(t){this._sourceState=t,Kl(t)?(_(t.activeReferenceCount),this.sourceStateWeight=t.absoluteWeight):this.sourceStateWeight=0},e.unset=function(){this._sourceState=void 0,this.sourceStateWeight=0},r(t,[{key:"sourceStateMotionTimeNormalized",get:function(){var t=this._sourceState;switch(_(t&&(t.kind===$l.animation||t.kind===$l.procedural)&&t.activeReferenceCount),t.kind){case $l.animation:return t.normalizedTime;case $l.procedural:return t.countMotionTime();default:return 0}}}]),t}(),Pc=function(){function t(){this.normalizedElapsedTime=0,this.path=[],this._durationMultiplier=1}var e=t.prototype;return e.getAbsoluteDuration=function(t){return this._getAbsoluteDurationUnscaled(t)*this._durationMultiplier},e.update=function(t,e){if(Kl(e)){var n=this.getAbsoluteDuration(e),i=0;if(n<=0)i=0,this.normalizedElapsedTime=1;else{var r=this.normalizedElapsedTime*n,o=n-r;i=Math.min(o,t);var a=V((r+i)/n);this.normalizedElapsedTime=a}}else this.normalizedElapsedTime=1},t.createPool=function(e){return new W((function(){return new t}),e,void 0)},e.reset=function(t,e){var n=e.to;_(Kl(n)),this.normalizedElapsedTime=0,this.destination=n,this.path=[].concat(t,[e]);var i=n.activeReferenceCount;if(n.increaseActiveReference(),0===i)if(n.kind===$l.animation){var r=this.path[0],o=r.destinationStart,a=r.relativeDestinationStart?o:0===n.duration?0:o/n.duration;n.reenter(a)}else n.kind===$l.procedural&&n.reenter();_(n.activeReferenceCount>0),this._durationMultiplier=1-n.absoluteWeight},e._getAbsoluteDurationUnscaled=function(t){_(0!==this.path.length);var e=this.path[0],n=e.duration;return e.normalizedDuration?(t.kind===$l.animation?t.duration:1)*n:n},r(t,[{key:"done",get:function(){return D(this.normalizedElapsedTime,1,1e-6)}}]),t}();e(Z+"PoseNodeStateMachine")(lc=li(Ts)(lc=fi({themeColor:"#CCCCCC",inline:!0})((cc=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name=hc&&hc(),e.stateMachine=fc&&fc(),e._stateMachineEval=void 0,e}n(e,t);var i=e.prototype;return i.__callOnAfterDeserializeRecursive=function(){this.stateMachine._allowEmptyStates=!1,this.stateMachine.__callOnAfterDeserializeRecursive()},i.bind=function(t){_(!this._stateMachineEval),this._stateMachineEval=new Jl(this.stateMachine,"",t,null)},i.settle=function(t){var e;null===(e=this._stateMachineEval)||void 0===e||e.settle(t)},i.reenter=function(){var t;null===(t=this._stateMachineEval)||void 0===t||t.reenter()},i.doUpdate=function(t){var e=this._stateMachineEval;e.update(t),_(e.passthroughWeight>.99999)},i.doEvaluate=function(t){var e=this._stateMachineEval,n=e.evaluate(t);return _(e.passthroughWeight>.99999),n},e}(xs),hc=i(cc.prototype,"name",[a],(function(){return""})),fc=i(cc.prototype,"stateMachine",[a],(function(){return new wr(!1)})),lc=cc))||lc)||lc);var Oc,Nc,Ic,xc,Rc,kc,Lc,Mc,Dc,Bc,Fc,Uc,Vc,Gc,Wc,zc,jc,Hc,Qc,Yc,qc,Zc,Xc,Jc,Kc,$c,th,eh,nh,ih,rh=(pc=e(Z+"PoseNodeSampleMotion"),dc=li(Ts),vc=ci(Dl((function(t){var e=new rh;return e.motion=t,e}))),_c=fi({themeColor:"#D97721"}),yc=Al({type:Wn.FLOAT}),pc(gc=dc(gc=vc(gc=_c((mc=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).motion=Ec&&Ec(),d(e,"time",Tc,G(e)),e.useNormalizedTime=Ac&&Ac(),e._workspace=null,e}n(e,t);var i=e.prototype;return i.bind=function(t){var e,n=this.motion;if(n){var i=n[Rr](t,null!==(e=t.clipOverrides)&&void 0!==e?e:null,!0);if(i){var r=new oh(i,i.createPort());this._workspace=r}}},i.settle=function(){},i.reenter=function(){},i.doUpdate=function(){},i.doEvaluate=function(t){var e=this._workspace;if(!e)return t.pushDefaultedPose();var n=this.time,i=this.useNormalizedTime?n:n/e.motionEval.duration;return e.motionEvalPort.evaluate(V(i),t)},e}(xs),Ec=i(mc.prototype,"motion",[a],(function(){return new Ho})),Tc=f(mc.prototype,"time",[a,yc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ac=i(mc.prototype,"useNormalizedTime",[a],(function(){return!1})),gc=mc))||gc)||gc)||gc)||gc),oh=function(t,e){this.motionEval=t,this.motionEvalPort=e};function ah(t){return t<1e-5}Oc=e(Z+"PoseNodeAdditivelyBlend"),Nc=li(As),Ic=fi({themeColor:"#72A869"}),xc=Al({type:Wn.POSE}),Rc=Al({type:Wn.POSE}),kc=Al({type:Wn.FLOAT}),Oc(Lc=Nc(Lc=Ic((Mc=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,d(e,"basePose",Dc,G(e)),d(e,"additivePose",Bc,G(e)),d(e,"ratio",Fc,G(e)),e}n(e,t);var i=e.prototype;return i.bind=function(t){var e,n;null===(e=this.basePose)||void 0===e||e.bind(t),t._pushAdditiveFlag(!0),null===(n=this.additivePose)||void 0===n||n.bind(t),t._popAdditiveFlag()},i.settle=function(t){var e,n;null===(e=this.basePose)||void 0===e||e.settle(t),null===(n=this.additivePose)||void 0===n||n.settle(t)},i.reenter=function(){var t,e;null===(t=this.basePose)||void 0===t||t.reenter(),null===(e=this.additivePose)||void 0===e||e.reenter()},i.doUpdate=function(t){var e,n;null===(e=this.basePose)||void 0===e||e.update(t),null===(n=this.additivePose)||void 0===n||n.update(t)},i.doEvaluate=function(t){var e,n,i=null!==(e=null===(n=this.basePose)||void 0===n?void 0:n.evaluate(t,ds.LOCAL))&&void 0!==e?e:t.pushDefaultedPose();return this.additivePose?(eo(i,this.additivePose.evaluate(t,ds.LOCAL),this.ratio),t.popPose(),i):i},e}(xs),Dc=f(Mc.prototype,"basePose",[a,xc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bc=f(Mc.prototype,"additivePose",[a,Rc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fc=f(Mc.prototype,"ratio",[a,kc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Lc=Mc))||Lc)||Lc),Uc=e(Z+"PoseNodeBlendInProportion"),Vc=li(As),Gc=fi({themeColor:"#72A869"}),Wc=Al({type:Wn.POSE,arraySyncGroup:"blend-item"}),zc=Al({type:Wn.FLOAT,arraySyncGroup:"blend-item",arraySyncGroupFollower:!0}),Uc(jc=Vc(jc=Gc((Hc=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,d(e,"poses",Qc,G(e)),d(e,"proportions",Yc,G(e)),e._updateContextGenerator=new gl,e}n(e,t);var i=e.prototype;return i.bind=function(t){for(var e,n=p(this.poses);!(e=n()).done;){var i=e.value;null==i||i.bind(t)}},i.settle=function(t){for(var e,n=p(this.poses);!(e=n()).done;){var i=e.value;null==i||i.settle(t)}},i.reenter=function(){for(var t,e=p(this.poses);!(t=e()).done;){var n=t.value;null==n||n.reenter()}},i.doUpdate=function(t){for(var e=this._updateContextGenerator,n=this.poses.length,i=0;i<n;++i){var r,o=this.proportions[i];if(!ah(o)){var a=e.generate(t.deltaTime,t.indicativeWeight*o);null===(r=this.poses[i])||void 0===r||r.update(a)}}},i.doEvaluate=function(t){for(var e=this.poses.length,n=0,i=null,r=0;r<e;++r){var o,a=this.proportions[r];if(!ah(a)){var s=null===(o=this.poses[r])||void 0===o?void 0:o.evaluate(t,ds.LOCAL);s&&(n+=a,i?(n&&Xr(i,s,a/n),t.popPose()):i=s)}}return i||t.pushDefaultedPose()},e}(xs),Qc=f(Hc.prototype,"poses",[a,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yc=f(Hc.prototype,"proportions",[a,zc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jc=Hc))||jc)||jc);var sh,uh,lh,ch,hh,fh,ph,dh,vh=(qc=e(Z+"PoseNodeBlendTwoPoseBase"),Zc=hi(!0),Xc=Al({type:Wn.POSE}),Jc=Al({type:Wn.POSE}),Kc=Al({type:Wn.FLOAT}),qc($c=Zc((th=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,d(e,"pose0",eh,G(e)),d(e,"pose1",nh,G(e)),d(e,"ratio",ih,G(e)),e._updateContextGenerator=new gl,e}n(e,t);var i=e.prototype;return i.bind=function(t){var e,n;null===(e=this.pose0)||void 0===e||e.bind(t),null===(n=this.pose1)||void 0===n||n.bind(t)},i.settle=function(t){var e,n;null===(e=this.pose0)||void 0===e||e.settle(t),null===(n=this.pose1)||void 0===n||n.settle(t)},i.reenter=function(){var t,e;null===(t=this.pose0)||void 0===t||t.reenter(),null===(e=this.pose1)||void 0===e||e.reenter()},i.doUpdate=function(t){var e=this.pose0,n=this.pose1,i=this._updateContextGenerator,r=this.ratio,o=i.generate(t.deltaTime,t.indicativeWeight*(1-r));null==e||e.update(o);var a=i.generate(t.deltaTime,t.indicativeWeight*r);null==n||n.update(a)},i.doEvaluate=function(t){var n,i,r,o,a=ds.LOCAL;if(!this.pose0||!this.pose1)return e.evaluateDefaultPose(t,a);var s=null!==(n=null===(i=this.pose0)||void 0===i?void 0:i.evaluate(t,a))&&void 0!==n?n:e.evaluateDefaultPose(t,a),u=null!==(r=null===(o=this.pose1)||void 0===o?void 0:o.evaluate(t,a))&&void 0!==r?r:e.evaluateDefaultPose(t,a);return this.doBlend(s,u,this.ratio),t.popPose(),s},e}(xs),eh=f(th.prototype,"pose0",[a,Xc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nh=f(th.prototype,"pose1",[a,Jc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ih=f(th.prototype,"ratio",[a,Kc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$c=th))||$c)||$c);e(Z+"PoseNodeBlendTwoPose")(sh=li(As)(sh=fi({themeColor:"#72A869"})(sh=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e.prototype.doBlend=function(t,e,n){return Xr(t,e,n)},e}(vh))||sh)||sh),uh=e(Z+"PoseNodeFilteringBlend"),lh=li(As),ch=fi({themeColor:"#72A869"}),hh=L(ys),uh(fh=lh(fh=ch((ph=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).mask=dh&&dh(),e._transformFilter=void 0,e}n(e,t);var i=e.prototype;return i.settle=function(e){if(t.prototype.settle.call(this,e),this.mask){var n=e.createTransformFilter(this.mask);this._transformFilter=n}},i.doBlend=function(t,e,n){Xr(t,e,n,this._transformFilter)},e}(vh),dh=i(ph.prototype,"mask",[a,hh],(function(){return null})),fh=ph))||fh)||fh);var _h,yh,gh,mh,Eh,Th,Ah,bh,Ch,Sh,wh,Ph,Oh,Nh,Ih,xh,Rh,kh,Lh,Mh,Dh,Bh,Fh,Uh,Vh,Gh,Wh,zh,jh,Hh,Qh,Yh,qh=Ts+"/i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_choose/",Zh=1e-5,Xh=e(Z+"PoseNodeChoosePoseBase")(_h=hi()((yh=function(t){function e(e){var n;return void 0===e&&(e=0),(n=t.call(this)||this)._poses=gh&&gh(),n._fadeInDurations=mh&&mh(),n._updateContextGenerator=new gl,n._evaluationRecord=void 0,n._poses.length=e,n._poses.fill(null),n._fadeInDurations.length=e,n._fadeInDurations.fill(0),n}n(e,t);var i=e.prototype;return i.bind=function(t){for(var e,n=p(this._poses);!(e=n()).done;){var i=e.value;null==i||i.bind(t)}var r=new Jh(this._poses.length,this.getChosenIndex());this._evaluationRecord=r},i.settle=function(t){for(var e,n=p(this._poses);!(e=n()).done;){var i=e.value;null==i||i.settle(t)}},i.reenter=function(){for(var t,e=p(this._poses);!(t=e()).done;){var n=t.value;null==n||n.reenter()}},i.doUpdate=function(t){var e=this._poses,n=this._evaluationRecord;if(n.update(t.deltaTime,this.getChosenIndex(),this._fadeInDurations),!n.allWeightsAreZero()){var i=e.length,r=n.items;_(r.length===i);for(var o=0;o<i;++o){var a=r[o].weight;if(!ah(a)){var s=e[o],u=this._updateContextGenerator.generate(t.deltaTime,t.indicativeWeight*a);null==s||s.update(u)}}}},i.doEvaluate=function(t){var n=this._poses,i=this._evaluationRecord,r=ds.LOCAL,o=n.length,a=i.items;_(a.length===n.length);var s=null;if(!i.allWeightsAreZero())for(var u=0,l=0;l<o;++l){var c,h=i.items[l].weight;if(!ah(h)){var f=null===(c=n[l])||void 0===c?void 0:c.evaluate(t,ds.LOCAL);f&&(u+=h,s?(u&&Xr(s,f,h/u),t.popPose()):s=f)}}return s||e.evaluateDefaultPose(t,r)},i.getChosenIndex=function(){return 0},e}(xs),gh=i(yh.prototype,"_poses",[a],(function(){return[]})),mh=i(yh.prototype,"_fadeInDurations",[a],(function(){return[]})),_h=yh))||_h)||_h,Jh=function(){function t(t,e){this._items=void 0,this._chosenPoseIndex=-1,this._elapsedTransitionTime=0,this._blendingDuration=0;var n=Array.from({length:t},(function(){return new Kh}));e>=0&&e<t&&(n[e].selfSourceWeight=1,n[e].selfTargetWeight=1,n[e].weight=1),this._items=n}var e=t.prototype;return e.allWeightsAreZero=function(){return this._chosenPoseIndex<0},e.update=function(t,e,n){if(this._checkAlternation(e,n),!(this._chosenPoseIndex<0)){var i=this._elapsedTransitionTime,r=this._blendingDuration,o=this._items;if(!(i>=r)){var a=o.length,s=0,u=0;t>r-i?(this._elapsedTransitionTime=r,u=1):(this._elapsedTransitionTime+=t,u=this._elapsedTransitionTime/r);for(var l=0;l<a;++l){var c=o[l],h=k(c.selfSourceWeight,c.selfTargetWeight,u);s+=h,c.weight=h}if(!ah(s))for(var f=0;f<a;++f)o[f].weight/=s}}},e._checkAlternation=function(t,e){var n=this._items,i=this._chosenPoseIndex,r=n.length;if(r&&t!==i&&!(t<0||t>=r)){var o=Math.max(e[t],0);if(o<Zh)for(var a=0;a<r;++a){var s=n[a];a===t?(s.selfSourceWeight=1,s.selfTargetWeight=1,s.weight=1):(s.selfSourceWeight=0,s.selfTargetWeight=0,s.weight=0)}else for(var u=this._blendingDuration<Zh?1:this._elapsedTransitionTime/this._blendingDuration,l=0;l<r;++l){var c=n[l];c.selfSourceWeight=k(c.selfSourceWeight,c.selfTargetWeight,u),c.selfTargetWeight=l===t?1:0}this._chosenPoseIndex=t,this._elapsedTransitionTime=0,this._blendingDuration=o}},r(t,[{key:"items",get:function(){return this._items}}]),t}(),Kh=function(){this.selfSourceWeight=0,this.selfTargetWeight=0,this.weight=0};Eh=e(Z+"PoseNodeChoosePoseByBoolean"),Th=li(qh),Ah=fi({themeColor:"#D07979"}),bh=Al({type:Wn.POSE}),Ch=Al({type:Wn.POSE}),Sh=Al({type:Wn.FLOAT}),wh=Al({type:Wn.FLOAT}),Ph=Al({type:Wn.BOOLEAN}),Eh(Oh=Th(Oh=Ah((Nh=function(t){function e(){var e;return e=t.call(this,2)||this,d(e,"choice",Ih,G(e)),e}return n(e,t),e.prototype.getChosenIndex=function(){return this.choice?0:1},r(e,[{key:"truePose",get:function(){return this._poses[0]},set:function(t){this._poses[0]=t}},{key:"falsePose",get:function(){return this._poses[1]},set:function(t){this._poses[1]=t}},{key:"trueFadeInDuration",get:function(){return this._fadeInDurations[0]},set:function(t){this._fadeInDurations[0]=t}},{key:"falseFadeInDuration",get:function(){return this._fadeInDurations[1]},set:function(t){this._fadeInDurations[1]=t}}]),e}(Xh),f(Nh.prototype,"truePose",[bh],Object.getOwnPropertyDescriptor(Nh.prototype,"truePose"),Nh.prototype),f(Nh.prototype,"falsePose",[Ch],Object.getOwnPropertyDescriptor(Nh.prototype,"falsePose"),Nh.prototype),f(Nh.prototype,"trueFadeInDuration",[Sh],Object.getOwnPropertyDescriptor(Nh.prototype,"trueFadeInDuration"),Nh.prototype),f(Nh.prototype,"falseFadeInDuration",[wh],Object.getOwnPropertyDescriptor(Nh.prototype,"falseFadeInDuration"),Nh.prototype),Ih=f(Nh.prototype,"choice",[a,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Oh=Nh))||Oh)||Oh),xh=e(Z+"PoseNodeChoosePoseByIndex"),Rh=li(qh),kh=fi({themeColor:"#D07979"}),Lh=Al({type:Wn.POSE,arraySyncGroup:"choose-item"}),Mh=Al({type:Wn.FLOAT,arraySyncGroup:"choose-item",arraySyncGroupFollower:!0}),Dh=Al({type:Wn.INTEGER}),xh(Bh=Rh(Bh=kh((Fh=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,d(e,"choice",Uh,G(e)),e}return n(e,t),e.prototype.getChosenIndex=function(){return this.choice},r(e,[{key:"poses",get:function(){return this._poses},set:function(t){this._poses=t}},{key:"fadeInDurations",get:function(){return this._fadeInDurations},set:function(t){this._fadeInDurations=t}}]),e}(Xh),f(Fh.prototype,"poses",[Lh],Object.getOwnPropertyDescriptor(Fh.prototype,"poses"),Fh.prototype),f(Fh.prototype,"fadeInDurations",[Mh],Object.getOwnPropertyDescriptor(Fh.prototype,"fadeInDurations"),Fh.prototype),Uh=f(Fh.prototype,"choice",[a,Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bh=Fh))||Bh)||Bh),function(t){t[t.VALUE=0]="VALUE",t[t.AUXILIARY_CURVE=1]="AUXILIARY_CURVE"}(Yh||(Yh={})),B(Yh);var $h,tf,ef,nf,rf,of,af,sf,uf,lf,cf,hf,ff,pf,df,vf,_f,yf,gf,mf,Ef,Tf,Af,bf,Cf,Sf=(Vh=e(Z+"IntensitySpecification"),Gh=L(Yh),Vh((zh=function(){function t(){this.type=jh&&jh(),this.value=Hh&&Hh(),this.auxiliaryCurveName=Qh&&Qh(),this._handle=void 0}var e=t.prototype;return e.bind=function(t){if(this.type===Yh.AUXILIARY_CURVE&&this.auxiliaryCurveName){var e=t.bindAuxiliaryCurve(this.auxiliaryCurveName);this._handle=e}},e.evaluate=function(t){return this.type===Yh.AUXILIARY_CURVE&&this._handle?t.auxiliaryCurves[this._handle.index]:this.value},t}(),jh=i(zh.prototype,"type",[Gh,a],(function(){return Yh.VALUE})),Hh=i(zh.prototype,"value",[a],(function(){return 1})),Qh=i(zh.prototype,"auxiliaryCurveName",[a],(function(){return""})),Wh=zh))||Wh),wf=function(){this.transformIndex=-1,this.transform=new Vr},Pf=function(){function t(){this._pool=new W((function(){return new wf}),3),this._array=new j(3),this._debugLastTransformIndex=-1}var e=t.prototype;return e.push=function(t,e){var n=this._pool.alloc();n.transformIndex=t,Vr.copy(n.transform,e),this._array.push(n)},e.clear=function(){for(var t=this._array.length,e=0;e<t;++e){var n=this._array.get(e);this._pool.free(n)}this._array.clear()},r(t,[{key:"length",get:function(){return this._array.length}},{key:"array",get:function(){return this._array.array}}]),t}(),Of=function(){function t(t){this._transformFlags=[],this._transformFlags=new Array(t)}var e=t.prototype;return e.clear=function(){this._transformFlags.fill(!1)},e.test=function(t){return this._transformFlags[t]},e.set=function(t){this._transformFlags[t]=!0},e.unset=function(t){this._transformFlags[t]=!1},t}(),Nf=new Vr,If=new Vr,xf=($h=e(Z+"PoseNodeModifyPoseBase"),tf=hi(),ef=Al({type:Wn.POSE}),$h(nf=tf((rf=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,d(e,"pose",of,G(e)),e._modificationQueue=new Pf,e._spaceFlagTable=new Of(0),e}n(e,t);var i=e.prototype;return i.settle=function(t){var e;null===(e=this.pose)||void 0===e||e.settle(t),this._spaceFlagTable=new Of(t.transformCount)},i.reenter=function(){var t;null===(t=this.pose)||void 0===t||t.reenter()},i.bind=function(t){var e;null===(e=this.pose)||void 0===e||e.bind(t)},i.doUpdate=function(t){var e;null===(e=this.pose)||void 0===e||e.update(t)},i.doEvaluate=function(t){var e,n,i=this.getPoseTransformSpaceRequirement(),r=null!==(e=null===(n=this.pose)||void 0===n?void 0:n.evaluate(t,i))&&void 0!==e?e:xs.evaluateDefaultPose(t,i),o=this._modificationQueue;return _(0===o.length),this.modifyPose(t,r,o),function(t,e,n,i){var r=n.length;if(0!==r)if(e._poseTransformSpace!==jr.LOCAL){_(e._poseTransformSpace===jr.COMPONENT),i.clear();for(var o=n.array[0].transformIndex,a=o,s=0;s<r;++s){var u=n.array[s].transformIndex;i.set(u),a=u}for(var l=o;l<e.transforms.length;++l){var c=t.parentTable[l];c<0||i.test(c)&&(i.set(l),a=l)}for(var h=a;h>=o;--h)if(i.test(h)){var f=t.parentTable[h];if(f>=0){var p=e.transforms.getTransform(h,Nf),d=e.transforms.getTransform(f,If);Vr.calculateRelative(p,p,d),e.transforms.setTransform(h,p)}}for(var v=0;v<r;++v){var y=n.array[v],g=y.transformIndex,m=y.transform;e.transforms.setTransform(g,m),i.unset(g)}for(var E=o;E<=a;++E)if(i.test(E)){var T=t.parentTable[E],A=e.transforms.getTransform(E,Nf),b=e.transforms.getTransform(T,If);Vr.multiply(A,b,A),e.transforms.setTransform(E,A)}}else for(var C=0;C<r;++C){var S=n.array[C],w=S.transformIndex,P=S.transform;e.transforms.setTransform(w,P)}}(t,r,o,this._spaceFlagTable),o.clear(),r},e}(xs),of=f(rf.prototype,"pose",[a,ef],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nf=rf))||nf)||nf);!function(t){t[t.LEAVE_UNCHANGED=0]="LEAVE_UNCHANGED",t[t.REPLACE=1]="REPLACE",t[t.ADD=2]="ADD"}(Cf||(Cf={})),B(Cf);var Rf=1e-5,kf=new Vr;af=e(Z+"PoseNodeApplyTransform"),sf=li(Ts),uf=fi({themeColor:"#72A869"}),lf=L(Cf),cf=Al({type:Wn.VEC3}),hf=L(Cf),ff=Al({type:Wn.QUAT}),pf=L(Bu),df=Al({type:Wn.FLOAT}),af(vf=sf(vf=uf((_f=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).node=yf&&yf(),e.positionOperation=gf&&gf(),d(e,"position",mf,G(e)),e.rotationOperation=Ef&&Ef(),d(e,"rotation",Tf,G(e)),e.intensity=Af&&Af(),e.transformSpace=bf&&bf(),e._transformHandle=null,e}n(e,t);var i=e.prototype;return i.bind=function(e){var n=this.node;if(t.prototype.bind.call(this,e),n){var i=e.bindTransformByName(n);i?(this._transformHandle=i,this.intensity.bind(e)):S("Failed to bind transform "+n)}},i.getPoseTransformSpaceRequirement=function(){return ds.NO},i.modifyPose=function(t,e,n){var i=this._transformHandle;if(!i)return e;var r=this.intensity.evaluate(e);if(r<Rf)return e;var o=D(r,1,Rf),a=i.index,s=e.transforms.getTransform(a,kf),u=this.rotationOperation;if(u!==Cf.LEAVE_UNCHANGED){var l=this.rotation,c=this.transformSpace;switch(t._convertPoseSpaceTransformToTargetSpace(s,c,e,a),u){default:case Cf.REPLACE:Xf(s,l,r,o);break;case Cf.ADD:Jf(s,l,r,o)}t._convertTransformToPoseTransformSpace(s,c,e,a)}var h=this.positionOperation;if(h!==Cf.LEAVE_UNCHANGED){var f=this.position,p=this.transformSpace;switch(t._convertPoseSpaceTransformToTargetSpace(s,p,e,a),h){default:case Cf.REPLACE:Yf(s,f,r,o);break;case Cf.ADD:qf(s,f,r,o)}t._convertTransformToPoseTransformSpace(s,p,e,a)}return n.push(a,s),e},r(e,[{key:"intensityValue",get:function(){return this.intensity.value},set:function(t){this.intensity.value=t}}]),e}(xf),yf=i(_f.prototype,"node",[a],(function(){return""})),gf=i(_f.prototype,"positionOperation",[a,lf],(function(){return Cf.LEAVE_UNCHANGED})),mf=f(_f.prototype,"position",[a,cf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y}}),Ef=i(_f.prototype,"rotationOperation",[a,hf],(function(){return Cf.LEAVE_UNCHANGED})),Tf=f(_f.prototype,"rotation",[a,ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new g}}),Af=i(_f.prototype,"intensity",[a],(function(){return new Sf})),bf=i(_f.prototype,"transformSpace",[a,pf],(function(){return Bu.WORLD})),f(_f.prototype,"intensityValue",[df],Object.getOwnPropertyDescriptor(_f.prototype,"intensityValue"),_f.prototype),vf=_f))||vf)||vf);var Lf,Mf,Df,Bf,Ff,Uf,Vf,Gf,Wf,zf,jf,Hf,Qf=(Lf=new y,Mf=new y,{replace:function(t,e,n,i){if(i)t.position=e;else{var r=y.copy(Lf,t.position);y.lerp(r,r,e,n),t.position=r}},add:function(t,e,n,i){var r=Mf;i?y.copy(r,e):y.slerp(r,y.ZERO,e,n),y.add(r,t.position,r),t.position=r}}),Yf=Qf.replace,qf=Qf.add,Zf=function(){var t=new g,e=new g;return{replace:function(e,n,i,r){if(r)e.rotation=n;else{var o=g.copy(t,e.rotation);g.slerp(o,o,n,i),e.rotation=o}},add:function(n,i,r,o){var a=g.copy(t,n.rotation),s=e;o?g.copy(s,i):g.slerp(s,g.IDENTITY,i,r),g.multiply(s,s,a),n.rotation=s}}}(),Xf=Zf.replace,Jf=Zf.add,Kf=new Vr;!function(t){t[t.LOCAL=0]="LOCAL",t[t.COMPONENT=1]="COMPONENT"}(Hf||(Hf={})),B(Hf),Df=e(Z+"PoseNodeCopyTransform"),Bf=li(Ts),Ff=fi({themeColor:"#72A869"}),Uf=L(Hf),Df(Vf=Bf(Vf=Ff((Gf=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).sourceNodeName=Wf&&Wf(),e.targetNodeName=zf&&zf(),e.space=jf&&jf(),e._workspace=void 0,e}n(e,t);var i=e.prototype;return i.bind=function(e){t.prototype.bind.call(this,e);var n=e.bindTransformByName(this.sourceNodeName),i=e.bindTransformByName(this.targetNodeName);if(!n||!i)return null==n||n.destroy(),void(null==i||i.destroy());this._workspace=new lp(n,i)},i.modifyPose=function(t,e){var n=this._workspace;if(n){var i=n.hSource.index,r=n.hTarget.index,o=e.transforms.getTransform(i,Kf);e.transforms.setTransform(r,o)}},i.getPoseTransformSpaceRequirement=function(){return this.space===Hf.COMPONENT?ds.COMPONENT:ds.LOCAL},e}(xf),Wf=i(Gf.prototype,"sourceNodeName",[a],(function(){return""})),zf=i(Gf.prototype,"targetNodeName",[a],(function(){return""})),jf=i(Gf.prototype,"space",[a,Uf],(function(){return Hf.COMPONENT})),Vf=Gf))||Vf)||Vf);var $f,tp,ep,np,ip,rp,op,ap,sp,up,lp=function(t,e){this.hSource=t,this.hTarget=e};!function(t){t[t.LEAVE_UNCHANGED=0]="LEAVE_UNCHANGED",t[t.REPLACE=1]="REPLACE",t[t.ADD=2]="ADD"}(up||(up={})),B(up),$f=e(Z+"PoseNodeSetAuxiliaryCurve"),tp=li(Ts),ep=Al({type:Wn.FLOAT}),np=L(up),$f(ip=tp((rp=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).curveName=op&&op(),d(e,"curveValue",ap,G(e)),e.flag=sp&&sp(),e._handle=void 0,e}n(e,t);var i=e.prototype;return i.bind=function(e){t.prototype.bind.call(this,e),this.curveName&&(this._handle=e.bindAuxiliaryCurve(this.curveName))},i.getPoseTransformSpaceRequirement=function(){return ds.NO},i.modifyPose=function(t,e){var n=this._handle;if(n)switch(this.flag){case up.REPLACE:e.auxiliaryCurves[n.index]=this.curveValue;break;case up.ADD:e.auxiliaryCurves[n.index]+=this.curveValue;break;case up.LEAVE_UNCHANGED:}},e}(xf),op=i(rp.prototype,"curveName",[a],(function(){return""})),ap=f(rp.prototype,"curveValue",[a,ep],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sp=i(rp.prototype,"flag",[a,np],(function(){return up.REPLACE})),ip=rp))||ip);var cp,hp,fp,pp,dp,vp,_p,yp,gp,mp,Ep,Tp,Ap,bp,Cp,Sp,wp,Pp,Op,Np,Ip,xp,Rp,kp=function(){var t,e,n=new g,i=new y,r=new y,o=new y,a=(t=new y,e=new y,function(n,i,r,o,a){return g.rotationTo(n,y.subtract(t,r,i).normalize(),y.subtract(e,a,o).normalize())});return function(t,e,s,u,l){var c=y.copy(i,null!=l?l:e.position),h=t.position,f=e.position,p=s.position;s.rotation;var d=r,v=o;Lp(h,f,p,u,c,d,v);var _=a(n,h,f,h,d);g.multiply(_,_,t.rotation),t.rotation=_;var m=a(n,f,p,d,v);g.multiply(m,m,e.rotation),e.rotation=m,e.position=d,s.position=v}}(),Lp=(cp=new y,hp=new y,fp=new y,function(t,e,n,i,r,o,a){var s=y.distance(t,e),u=y.distance(e,n),l=y.distance(t,i),c=y.subtract(cp,i,t);c.normalize();var h=s+u;if(l>=h)return y.scaleAndAdd(o,t,c,s),void y.scaleAndAdd(a,t,c,h);y.copy(a,i);var f=N((s*s+l*l-u*u)/(2*s*l),-1,1),p=y.subtract(hp,r,t),d=y.projectOnPlane(fp,p,c);d.normalize();var v=s*f,_=s*s-v*v,g=Math.sqrt(_);y.scaleAndAdd(o,t,c,v),y.scaleAndAdd(o,o,d,g)}),Mp=new Vr,Dp=new Vr,Bp=new Vr,Fp=new y,Up=new y,Vp=new Vr;!function(t){t[t.NONE=0]="NONE",t[t.VALUE=1]="VALUE",t[t.BONE=2]="BONE"}(Rp||(Rp={})),B(Rp);var Gp=(pp=e(Z+"PoseNodeTwoBoneIKSolver.TargetSpecification"),dp=L(Rp),vp=L(Bu),pp((yp=function(){function t(t){this.type=gp&&gp(),this.targetPosition=mp&&mp(),this.targetPositionSpace=Ep&&Ep(),this.targetBone=Tp&&Tp(),this._sourceBoneHandle=void 0,this._targetBoneHandle=void 0,void 0!==t&&(this.type=t)}var e=t.prototype;return e.bind=function(t,e){var n;this._sourceBoneHandle=e,this.type===Rp.BONE&&this.targetBone&&(this._targetBoneHandle=null!==(n=t.bindTransformByName(this.targetBone))&&void 0!==n?n:void 0)},e.evaluate=function(t,e,n){if(_(this._sourceBoneHandle),this._targetBoneHandle)e.transforms.getPosition(this._targetBoneHandle.index,t);else if(this.type===Rp.NONE)e.transforms.getPosition(this._sourceBoneHandle.index,t);else{var i=Vr.setIdentity(Vp);i.position=this.targetPosition,n._convertTransformToPoseTransformSpace(i,this.targetPositionSpace,e,this._sourceBoneHandle.index),y.copy(t,i.position)}return t},t}(),gp=i(yp.prototype,"type",[a,dp],(function(){return Rp.VALUE})),mp=i(yp.prototype,"targetPosition",[a],(function(){return new y})),Ep=i(yp.prototype,"targetPositionSpace",[a,vp],(function(){return Bu.WORLD})),Tp=i(yp.prototype,"targetBone",[a],(function(){return""})),_p=yp))||_p);Ap=e(Z+"PoseNodeTwoBoneIKSolver"),bp=li("i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes//i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_ik/"),Cp=Al({type:Wn.VEC3}),Sp=Al({type:Wn.VEC3}),Ap(wp=bp((Pp=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).debug=Op&&Op(),e.endEffectorBoneName=Np&&Np(),e.endEffectorTarget=Ip&&Ip(),e.poleTarget=xp&&xp(),e._workspace=void 0,e}n(e,t);var i=e.prototype;return i.bind=function(e){if(t.prototype.bind.call(this,e),this.endEffectorBoneName){var n=e.getParentBoneNameByName(this.endEffectorBoneName),i=n?e.getParentBoneNameByName(n):"";if(n&&i){var r=e.bindTransformByName(this.endEffectorBoneName),o=e.bindTransformByName(n),a=e.bindTransformByName(i);r&&o&&a?(this.endEffectorTarget.bind(e,r),this.poleTarget.bind(e,o),this._workspace=new Jp(r,o,a)):(null==r||r.destroy(),null==o||o.destroy(),null==a||a.destroy())}}},i.getPoseTransformSpaceRequirement=function(){return ds.COMPONENT},i.modifyPose=function(t,e,n){var i=this._workspace;if(i){var r=i.hRoot.index,o=i.hMiddle.index,a=i.hEndEffector.index,s=e.transforms.getTransform(r,Mp),u=e.transforms.getTransform(o,Dp),l=e.transforms.getTransform(a,Bp),c=this.endEffectorTarget.evaluate(Fp,e,t),h=this.poleTarget.evaluate(Up,e,t);kp(s,u,l,c,h,this.debug?this:void 0),n.push(r,s),n.push(o,u),n.push(a,l)}},r(e,[{key:"endEffectorTargetPosition",get:function(){return this.endEffectorTarget.targetPosition},set:function(t){y.copy(this.endEffectorTarget.targetPosition,t)}},{key:"poleTargetPosition",get:function(){return this.poleTarget.targetPosition},set:function(t){y.copy(this.poleTarget.targetPosition,t)}}]),e}(xf),Op=i(Pp.prototype,"debug",[a],(function(){return!1})),Np=i(Pp.prototype,"endEffectorBoneName",[a],(function(){return""})),Ip=i(Pp.prototype,"endEffectorTarget",[a],(function(){return new Gp(Rp.VALUE)})),f(Pp.prototype,"endEffectorTargetPosition",[Cp],Object.getOwnPropertyDescriptor(Pp.prototype,"endEffectorTargetPosition"),Pp.prototype),xp=i(Pp.prototype,"poleTarget",[a],(function(){return new Gp(Rp.NONE)})),f(Pp.prototype,"poleTargetPosition",[Sp],Object.getOwnPropertyDescriptor(Pp.prototype,"poleTargetPosition"),Pp.prototype),wp=Pp))||wp);var Wp,zp,jp,Hp,Qp,Yp,qp,Zp,Xp,Jp=function(t,e,n){this.hEndEffector=t,this.hMiddle=e,this.hRoot=n},Kp={listEntries:function(t){for(var e,n=[],i=p(t.animationGraph.variables);!(e=i()).done;){var r=e.value,o=r[0],a=r[1].type;if(a!==me.TRIGGER){var s=void 0;switch(a){default:break;case me.FLOAT:s=Wn.FLOAT;break;case me.INTEGER:s=Wn.INTEGER;break;case me.BOOLEAN:s=Wn.BOOLEAN;break;case me.VEC3_experimental:s=Wn.VEC3;break;case me.QUAT_experimental:s=Wn.QUAT}void 0!==s&&n.push({arg:{name:o,type:s},menu:o})}}return n},create:function(t){var e;switch(t.type){default:throw new Error("Bad create node arg: "+Wn[t.type]);case Wn.FLOAT:e=new td;break;case Wn.INTEGER:e=new ed;break;case Wn.BOOLEAN:e=new nd;break;case Wn.VEC3:e=new id;break;case Wn.QUAT:e=new rd}return e.variableName=t.name,e}},$p=e(Z+"PVNodeGetVariableBase")(Wp=ci(Kp)((zp=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).variableName=jp&&jp(),e._varInstance=void 0,e}return n(e,t),e.prototype.link=function(t){this._varInstance=t.getVar(this.variableName)},e}(Tl),jp=i(zp.prototype,"variableName",[a],(function(){return""})),Wp=zp))||Wp)||Wp,td=e(Z+"PVNodeGetVariableFloat")(Hp=hi()(Hp=fi({inline:!0,themeColor:"#8471CF"})(Hp=function(t){function e(){return t.call(this,Wn.FLOAT)||this}return n(e,t),e.prototype.selfEvaluateDefaultOutput=function(){var t;return null===(t=this._varInstance)||void 0===t?void 0:t.value},e}($p))||Hp)||Hp)||Hp,ed=e(Z+"PVNodeGetVariableInteger")(Qp=hi()(Qp=fi({inline:!0,themeColor:"#2A90DC"})(Qp=function(t){function e(){return t.call(this,Wn.INTEGER)||this}return n(e,t),e.prototype.selfEvaluateDefaultOutput=function(){var t;return null===(t=this._varInstance)||void 0===t?void 0:t.value},e}($p))||Qp)||Qp)||Qp,nd=e(Z+"PVNodeGetVariableBoolean")(Yp=hi()(Yp=fi({inline:!0,themeColor:"#D07979"})(Yp=function(t){function e(){return t.call(this,Wn.BOOLEAN)||this}return n(e,t),e.prototype.selfEvaluateDefaultOutput=function(){var t;return null===(t=this._varInstance)||void 0===t?void 0:t.value},e}($p))||Yp)||Yp)||Yp,id=e(Z+"PVNodeGetVariableVec3")(qp=hi()(qp=fi({inline:!0,themeColor:"#D97721"})(qp=function(t){function e(){return t.call(this,Wn.VEC3)||this}return n(e,t),e.prototype.selfEvaluateDefaultOutput=function(){var t;return null===(t=this._varInstance)||void 0===t?void 0:t.value},e}($p))||qp)||qp)||qp,rd=e(Z+"PVNodeGetVariableQuat")(Zp=hi()(Zp=fi({inline:!0,themeColor:"#B169C4"})(Zp=function(t){function e(){return t.call(this,Wn.QUAT)||this}return n(e,t),e.prototype.selfEvaluateDefaultOutput=function(){var t;return null===(t=this._varInstance)||void 0===t?void 0:t.value},e}($p))||Zp)||Zp)||Zp,od=function(){function t(){this._groups=[]}var e=t.prototype;return e.register=function(t){var e=t.group,n=this._groups.find((function(t){return t.name===e}));return n||(n=new ad(e),this._groups.push(n)),n.addMember()},e.sync=function(){for(var t,e=p(this._groups);!(t=e()).done;)t.value.sync()},t}(),ad=function(){function t(t){this._lastLeader=void 0,this._records=[],this.name=t}var e=t.prototype;return e.addMember=function(){var t=new sd;return this._records.push(t),t},e.sync=function(){var t=this._records,e=t.length,n=this._lastLeader;if(this._lastLeader=void 0,!t.every((function(t){return!t.active}))){t.sort((function(t,e){var n=t.active?t.weight:-1;return(e.active?e.weight:-1)-n}));var i=0,r=t[0].weight;if(t[i]!==n)for(var o=0;o<e;++o){var a=t[o];if(!a.active||!D(a.weight,r,1e-6))break;if(a===n){i=o;break}}_(t[i].active),this._lastLeader=t[i];for(var s=t[i].normalizedTime,u=0;u<e;++u){var l=t[u];if(!l.active)break;l.normalizedTime=s,l.reset()}}},t}(),sd=function(){function t(){this.normalizedTime=0,this.weight=0,this.active=!1}var e=t.prototype;return e.notifyRenter=function(t){this.reset(),this.normalizedTime=t},e.notifyUpdate=function(t,e){this.normalizedTime+=t,this.active?this.weight+=e:(this.active=!0,this.weight=e)},e.reset=function(){this.active=!1,this.weight=0},e.getSyncedEnterTime=function(){return this.normalizedTime},t}();!function(t){t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.UNSETTLED=1]="UNSETTLED",t[t.SETTLED=2]="SETTLED",t[t.UP_TO_DATE=3]="UP_TO_DATE",t[t.OUTDATED=4]="OUTDATED",t[t.UPDATING=5]="UPDATING",t[t.UPDATED=6]="UPDATED",t[t.EVALUATING=7]="EVALUATING",t[t.EVALUATED=8]="EVALUATED"}(Xp||(Xp={}));var ud,ld,cd,hd,fd,pd,dd=function(){function t(t){this._state=Xp.UNINITIALIZED,this._instantiatedPoseGraph=void 0,this._maxRequestedUpdateTime=0,this._evaluationCache=null,this._updateContextGenerator=new gl,this._allocator=t}var e=t.prototype;return e.set=function(t,e){_(this._state===Xp.UNINITIALIZED);var n=Wl(t.graph,e);n.bind(e),this._instantiatedPoseGraph=n,this._state=Xp.UNSETTLED},e.settle=function(t){_(this._state===Xp.UNSETTLED||this._state===Xp.SETTLED),_(this._instantiatedPoseGraph),this._instantiatedPoseGraph.settle(t),this._state=Xp.SETTLED},e.reset=function(){switch(this._state){case Xp.SETTLED:case Xp.OUTDATED:break;case Xp.UP_TO_DATE:this._state=Xp.OUTDATED;break;case Xp.UPDATED:case Xp.EVALUATED:this._evaluationCache&&(this._allocator.destroyPose(this._evaluationCache),this._evaluationCache=null),this._maxRequestedUpdateTime=0,this._state=Xp.UP_TO_DATE;break;case Xp.UNINITIALIZED:}},e.reenter=function(){switch(this._state){default:_(!1,"Unexpected stash state "+this._state+" when reenter().");break;case Xp.UP_TO_DATE:case Xp.UPDATED:break;case Xp.SETTLED:case Xp.OUTDATED:this._state=Xp.UP_TO_DATE,_(this._instantiatedPoseGraph),this._instantiatedPoseGraph.reenter()}},e.requestUpdate=function(t){var e=t.deltaTime;if(_(this._state===Xp.OUTDATED||this._state===Xp.UP_TO_DATE||this._state===Xp.UPDATING||this._state===Xp.UPDATED),_(this._instantiatedPoseGraph),this._state!==Xp.UPDATING){var n=Math.max(0,e-this._maxRequestedUpdateTime);if(this._state!==Xp.UPDATED||!D(n,0,1e-8)){this._state=Xp.UPDATING,this._maxRequestedUpdateTime=Math.max(e,this._maxRequestedUpdateTime);var i=this._updateContextGenerator.generate(n,t.indicativeWeight);this._instantiatedPoseGraph.update(i),this._state=Xp.UPDATED}}},e.evaluate=function(t){switch(this._state){default:_(!1,"Unexpected stash state "+this._state+" when evaluate().");break;case Xp.EVALUATING:this._state=Xp.EVALUATED;break;case Xp.EVALUATED:break;case Xp.UPDATED:var e;_(!this._evaluationCache),this._state=Xp.EVALUATING;var n=null===(e=this._instantiatedPoseGraph)||void 0===e?void 0:e.evaluate(t);if(this._state=Xp.EVALUATED,n){var i=this._allocator.allocatePose();i.transforms.set(n.transforms),i.auxiliaryCurves.set(n.auxiliaryCurves),this._evaluationCache=i,t.popPose()}this._state=Xp.EVALUATED}return _(this._state===Xp.EVALUATED),_(this._instantiatedPoseGraph),this._evaluationCache?t.pushDuplicatedPose(this._evaluationCache):null},t}(),vd=function(){function t(t){this._allocator=void 0,this._stashEvaluations={},this._allocator=t}var e=t.prototype;return e.bindStash=function(t){return this._stashEvaluations[t]},e.getStash=function(t){return this._stashEvaluations[t]},e.addStash=function(t){this._stashEvaluations[t]=new dd(this._allocator)},e.setStash=function(t,e,n){_(t in this._stashEvaluations),this._stashEvaluations[t].set(e,n)},e.reset=function(){for(var t in this._stashEvaluations)this._stashEvaluations[t].reset()},e.settle=function(t){for(var e in this._stashEvaluations)this._stashEvaluations[e].settle(t)},t}(),_d=function(t){function e(e,n,i,r){var o;(o=t.call(this)||this)._layerRecords=void 0;var a=e.layers.map((function(t){return new yd(t,n,i,r)}));return o._layerRecords=a,o}n(e,t);var i=e.prototype;return i.reenter=function(){},i.bind=function(){},i.settle=function(t){for(var e=this._layerRecords,n=e.length,i=0;i<n;++i)e[i].settle(t)},i.getLayerWeight=function(t){return _(t>=0&&t<this._layerRecords.length),this._layerRecords[t].weight},i.setLayerWeight=function(t,e){_(t>=0&&t<this._layerRecords.length),this._layerRecords[t].weight=e},i.getLayerTopLevelStateMachineEvaluation=function(t){return this._layerRecords[t].stateMachineEvaluation},i.overrideClips=function(t,e){for(var n=this._layerRecords,i=n.length,r=0;r<i;++r){var o=n[r];e._pushAdditiveFlag(o.additive),o.stateMachineEvaluation.overrideClips(t,e),e._popAdditiveFlag()}},i.doUpdate=function(t){for(var e=this._layerRecords,n=e.length,i=0;i<n;++i)e[i].update(t)},i.doEvaluate=function(t){for(var e=t.pushDefaultedPose(),n=this._layerRecords,i=n.length,r=0;r<i;++r){var o=n[r],a=o.stateMachineEvaluation.evaluate(t),s=o.weight*o.stateMachineEvaluation.passthroughWeight,u=o.transformFilter;o.additive?eo(e,a,s,u):Xr(e,a,s,u),t.popPose(),o.postEvaluate()}return e},r(e,[{key:"layerCount",get:function(){return this._layerRecords.length}}]),e}(xs),yd=function(){function t(t,e,n,i){var r;this.additive=!1,this.weight=0,this._topLevelStateMachineEval=void 0,this._stashManager=void 0,this._motionSyncManager=void 0,this._mask=void 0,this.transformFilter=void 0;for(var o,a=new vd(i),s=p(t.stashes());!(o=s()).done;){var u=o.value,l=u[0];u[1],a.addStash(l)}this._stashManager=a;var c=new od;this._motionSyncManager=c,e._setLayerWideContextProperties(a,c);for(var h,f=p(t.stashes());!(h=f()).done;){var d=h.value,v=d[0],_=d[1];a.setStash(v,_,e)}this.weight=t.weight;var y=this.additive=t.additive;this._mask=null!==(r=t.mask)&&void 0!==r?r:void 0,e._pushAdditiveFlag(y),this._topLevelStateMachineEval=new Jl(t.stateMachine,t.name,e,n),e._popAdditiveFlag(),e._unsetLayerWideContextProperties()}var e=t.prototype;return e.settle=function(t){this._mask&&(this.transformFilter=t.createTransformFilter(this._mask)),this._stashManager.settle(t),this._topLevelStateMachineEval.settle(t)},e.update=function(t){this.stateMachineEvaluation.update(t),this._motionSyncManager.sync()},e.postEvaluate=function(){this._stashManager.reset()},r(t,[{key:"stateMachineEvaluation",get:function(){return this._topLevelStateMachineEval}}]),t}(),gd=function(){function t(t,e,n,i){this._currentTransitionCache={duration:0,time:0},this._rootPoseNode=void 0,this._varInstances={},this._hasAutoTrigger=!1,this._auxiliaryCurveRegistry=new il,this._poseLayoutMaintainer=void 0,this._bindingContext=void 0,this._settleContext=void 0,this._rootUpdateContextGenerator=new gl;for(var r,o=p(t.variables);!(r=o()).done;){var a=r.value,s=a[0],u=a[1][Me]();this._varInstances[s]=u,u instanceof Ke&&u.resetMode===Le.NEXT_FRAME_OR_AFTER_CONSUMED&&(this._hasAutoTrigger=!0)}var l=new rl(e,this._auxiliaryCurveRegistry);this._poseLayoutMaintainer=l;var c=new el(e,l,this._varInstances,n);c._setClipOverrides(null!=i?i:void 0),this._bindingContext=c;var h=new fl(l);this._settleContext=h,l.startBind();var f=new ml;this._poseStashAllocator=f,this._rootPoseNode=new _d(t,c,i,f),this._root=e,this._initializeContexts()}var e=t.prototype;return e.destroy=function(){this._evaluationContext.destroy()},e._destroyAfterException_debugging=function(){var t=this._evaluationContext._stackSize_debugging;if(0!==t)for(var e=0;e<t;++e)this._evaluationContext.popPose();this._evaluationContext.destroy()},e.update=function(t){var e=this._evaluationContext,n=this._poseLayoutMaintainer,i=this._rootUpdateContextGenerator,r=this._rootPoseNode,o=i.generate(t,1);r.update(o);var a=r.evaluate(e,ds.LOCAL);if(this._hasAutoTrigger){var s=this._varInstances;for(var u in s){var l=s[u];l instanceof Ke&&l.resetMode===Le.NEXT_FRAME_OR_AFTER_CONSUMED&&(l.value=!1)}}n.apply(a),e.popPose()},e.getVariables=function(){return Object.entries(this._varInstances)},e.getCurrentStateStatus=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentStateStatus()},e.getCurrentClipStatuses=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentClipStatuses()},e.getCurrentTransition=function(t){var e=this._currentTransitionCache;return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentTransition(e)?e:null},e.getNextStateStatus=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getNextStateStatus()},e.getNextClipStatuses=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getNextClipStatuses()},e.getValue=function(t){var e=this._varInstances[t];return e?e.value:void 0},e.setValue=function(t,e){var n=this._varInstances[t];n&&(n.value=e)},e.getLayerWeight=function(t){return this._rootPoseNode.getLayerWeight(t)},e.setLayerWeight=function(t,e){this._rootPoseNode.setLayerWeight(t,e)},e.overrideClips=function(t){this._poseLayoutMaintainer.startBind(),this._rootPoseNode.overrideClips(t,this._bindingContext),this._updateAfterPossiblePoseLayoutChange()},e.getAuxiliaryCurveValue=function(t){return this._auxiliaryCurveRegistry.get(t)},e._initializeContexts=function(){var t=this._poseLayoutMaintainer;t.endBind(),this._createOrUpdateTransformFilters();var e=t.createEvaluationContext();this._evaluationContext=e,t.fetchDefaultTransforms(e[hl]),t.resetPoseStashAllocator(this._poseStashAllocator)},e._updateAfterPossiblePoseLayoutChange=function(){var t=this._poseLayoutMaintainer,e=t.endBind();if(0!==e){(e&tl.TRANSFORM_COUNT||e&tl.TRANSFORM_ORDER)&&this._createOrUpdateTransformFilters();var n=!1;if(e&tl.TRANSFORM_COUNT||e&tl.AUXILIARY_CURVE_COUNT){var i=t.createEvaluationContext();this._evaluationContext.destroy(),this._evaluationContext=i,n=!0,t.resetPoseStashAllocator(this._poseStashAllocator)}(n||e&tl.TRANSFORM_COUNT||e&tl.TRANSFORM_ORDER)&&t.fetchDefaultTransforms(this._evaluationContext[hl])}},e._createOrUpdateTransformFilters=function(){this._rootPoseNode.settle(this._settleContext)},r(t,[{key:"layerCount",get:function(){return this._rootPoseNode.layerCount}}]),t}(),md=L,Ed=a,Td=H,Ad=(ud=e("cc.animation.AnimationController"),ld=md(Nn),cd=Td("graph"),ud((fd=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._graph=pd&&pd(),e._graphEval=null,e}n(e,t);var i=e.prototype;return i.__preload=function(){var t=this.graph;if(t){var e,n=null;if(t instanceof ms){if(!t.original)return;e=t.original,n=t.clipOverrides}else e=t;var i=new gd(e,this.node,this,n);this._graphEval=i}},i.onDestroy=function(){var t;null===(t=this._graphEval)||void 0===t||t.destroy()},i.update=function(t){var e;null===(e=this._graphEval)||void 0===e||e.update(t)},i.getVariables=function(){return this._graphEval.getVariables()},i.setValue=function(t,e){return this.setValue_experimental(t,e)},i.setValue_experimental=function(t,e){this._graphEval.setValue(t,e)},i.getValue=function(t){var e=this.getValue_experimental(t);return"object"==typeof e?void 0:e},i.getValue_experimental=function(t){return this._graphEval.getValue(t)},i.getCurrentStateStatus=function(t){return this._graphEval.getCurrentStateStatus(t)},i.getCurrentClipStatuses=function(t){return this._graphEval.getCurrentClipStatuses(t)},i.getCurrentTransition=function(t){return this._graphEval.getCurrentTransition(t)},i.getNextStateStatus=function(t){return this._graphEval.getNextStateStatus(t)},i.getNextClipStatuses=function(t){return this._graphEval.getNextClipStatuses(t)},i.getLayerWeight=function(t){return this._graphEval.getLayerWeight(t)},i.setLayerWeight=function(t,e){return this._graphEval.setLayerWeight(t,e)},i.overrideClips_experimental=function(t){this._graphEval.overrideClips(t)},i.getAuxiliaryCurveValue_experimental=function(t){var e=this._graphEval;return e?e.getAuxiliaryCurveValue(t):0},r(e,[{key:"graph",get:function(){return this._graph},set:function(t){this._graph=t}},{key:"layerCount",get:function(){var t,e;return null!==(t=null===(e=this._graphEval)||void 0===e?void 0:e.layerCount)&&void 0!==t?t:0}}]),e}(kt),f(fd.prototype,"graph",[ld],Object.getOwnPropertyDescriptor(fd.prototype,"graph"),fd.prototype),pd=i(fd.prototype,"_graph",[Ed,cd],(function(){return null})),hd=fd))||hd);t("animation",Object.freeze({__proto__:null,UniformProxyFactory:Te,MorphWeightValueProxy:Ae,MorphWeightsValueProxy:be,MorphWeightsAllValueProxy:Ce,Track:$,TrackPath:lt,RealTrack:ct,VectorTrack:ht,QuatTrack:ft,ColorTrack:pt,SizeTrack:dt,ObjectTrack:vt,isPropertyPath:_t,isCustomPath:yt,HierarchyPath:gt,ComponentPath:mt,CubicSplineVec2Value:Et,CubicSplineVec3Value:Tt,CubicSplineVec4Value:At,CubicSplineQuatValue:bt,CubicSplineNumberValue:Ct,AnimationController:Ad,get VariableType(){return me},StateMachineComponent:Cu}));var bd,Cd=function(){function t(){this._nodeBlendStates=new Map}var e=t.prototype;return e.createWriter=function(t,e,n,i){var r=this.ref(t,e);return new Sd(t,e,r,n,i)},e.destroyWriter=function(t){var e=t;this.deRef(e.node,e.property)},e.ref=function(t,e){var n=this._nodeBlendStates.get(t);return n||(n=this.createNodeBlendState(),this._nodeBlendStates.set(t,n)),n.refProperty(t,e)},e.deRef=function(t,e){var n=this._nodeBlendStates.get(t);n&&(n.deRefProperty(e),n.empty&&this._nodeBlendStates.delete(t))},e.apply=function(){this._nodeBlendStates.forEach((function(t,e){t.apply(e)}))},t}(),Sd=function(){function t(t,e,n,i,r){this._node=t,this._property=e,this._propertyBlendState=n,this._host=i,this._constants=r}var e=t.prototype;return e.getValue=function(){return this._node[this._property]},e.setValue=function(t){var e=this._propertyBlendState,n=this._host.weight;e.blend(t,n)},r(t,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),t}();!function(t){t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.EULER_ANGLES=8]="EULER_ANGLES"}(bd||(bd={})),bd.POSITION,bd.ROTATION,bd.SCALE,bd.EULER_ANGLES;var wd,Pd,Od=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new y}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=function(t,e,n,i,r){var o=n+r;if(1!==r||n){if(o){var a=r/o;y.lerp(t,t,i,a)}}else y.copy(t,i);return o}(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,y.zero(this.result)},t}(),Nd=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new g}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=function(t,e,n,i,r){var o=n+r;if(1!==r||n){if(o){var a=r/o;g.slerp(t,e,i,a)}}else g.copy(t,i);return o}(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,g.identity(this.result)},t}(),Id=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.apply=function(e){var n=this._properties,i=n.position,r=n.scale,o=n.rotation,a=n.eulerAngles;i&&i.accumulatedWeight&&(this._transformApplyFlags|=bd.POSITION,i.accumulatedWeight<1&&i.blend(e.position,1-i.accumulatedWeight)),r&&r.accumulatedWeight&&(this._transformApplyFlags|=bd.SCALE,r.accumulatedWeight<1&&r.blend(e.scale,1-r.accumulatedWeight)),a&&a.accumulatedWeight&&(this._transformApplyFlags|=bd.EULER_ANGLES,a.accumulatedWeight<1&&a.blend(e.eulerAngles,1-a.accumulatedWeight)),o&&o.accumulatedWeight&&(this._transformApplyFlags|=bd.ROTATION,o.accumulatedWeight<1&&o.blend(e.rotation,1-o.accumulatedWeight)),t.prototype.apply.call(this,e),null==i||i.reset(),null==r||r.reset(),null==o||o.reset(),null==a||a.reset()},i._createVec3BlendState=function(){return new Od},i._createQuatBlendState=function(){return new Nd},e}(function(){function t(){this._transformApplyFlags=0,this._properties={}}var e=t.prototype;return e.refProperty=function(t,e){var n,i,r,o=this._properties;switch(e){default:case"position":case"scale":case"eulerAngles":r=null!==(n=o[e])&&void 0!==n?n:o[e]=this._createVec3BlendState(t[e]);break;case"rotation":r=null!==(i=o[e])&&void 0!==i?i:o[e]=this._createQuatBlendState(t.rotation)}return++r.refCount,r},e.deRefProperty=function(t){var e=this._properties,n=e[t];n&&(--n.refCount,n.refCount>0||delete e[t])},e.apply=function(t){var e,n,i,r=this._transformApplyFlags,o=this._properties,a=o.position,s=o.scale,u=o.rotation,l=o.eulerAngles;r&&(a&&r&bd.POSITION&&(e=a.result),s&&r&bd.SCALE&&(n=s.result),l&&r&bd.EULER_ANGLES&&(i=l.result),u&&r&bd.ROTATION&&(i=u.result),(i||e||n)&&t.setRTS(i,e,n),this._transformApplyFlags=0)},r(t,[{key:"empty",get:function(){var t=this._properties;return!(t.position||t.rotation||t.eulerAngles||t.scale)}}]),t}()),xd=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e.prototype.createNodeBlendState=function(){return new Id},e}(Cd),Rd=t("AnimationManager",e(((Pd=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._anims=new q([]),e._crossFades=new q([]),e._delayEvents=[],e._blendStateBuffer=new xd,e._sockets=[],e}n(e,t);var i=e.prototype;return i.addCrossFade=function(t){-1===this._crossFades.array.indexOf(t)&&this._crossFades.push(t)},i.removeCrossFade=function(t){var e=this._crossFades.array.indexOf(t);e>=0?this._crossFades.fastRemoveAt(e):s(3907)},i.update=function(t){var e=this._delayEvents,n=this._crossFades,i=this._sockets,r=n.array;for(n.i=0;n.i<r.length;++n.i)r[n.i].update(t);var o=this._anims,a=o.array;for(o.i=0;o.i<a.length;++o.i){var s=a[o.i];s.isMotionless||s.update(t)}this._blendStateBuffer.apply();for(var u=Lt.getTotalFrames(),l=0,c=i.length;l<c;l++){var h=i[l],f=h.target,p=h.transform;f.matrix=Vt(p,u)}for(var d=0,v=e.length;d<v;d++){var _=e[d];_.fn.apply(_.thisArg,_.args)}e.length=0},i.destruct=function(){},i.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},i.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):s(3907)},i.pushDelayEvent=function(t,e,n){this._delayEvents.push({fn:t,thisArg:e,args:n})},i.addSockets=function(t,e){for(var n=this,i=function(){var i=e[r];if(n._sockets.find((function(t){return t.target===i.target})))return"continue";var o=t.getChildByPath(i.path),a=i.target&&o&&Wt(o,t);a&&n._sockets.push({target:i.target,transform:a})},r=0;r<e.length;++r)i()},i.removeSockets=function(t,e){for(var n=0;n<e.length;++n)for(var i=e[n],r=0;r<this._sockets.length;++r){var o=this._sockets[r];if(o.target===i.target){Gt(o.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},r(e,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),e}(Q)).ID="animation",wd=Pd))||wd);Lt.on(Mt.EVENT_INIT,(function(){var t=new Rd;Lt.registerSystem(Rd.ID,t,Q.Priority.HIGH)})),Y.AnimationManager=Rd}}}));
