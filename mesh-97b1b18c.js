System.register(["./index-68ccac70.js","./node-event-40319828.js","./find-222dc7da.js","./pipeline-state-manager-8f16c5a7.js","./buffer-barrier-d1733967.js"],(function(t){"use strict";var e,r,i,n,s,a,u,o,h,f,c,d,l,v,_,m,g,p,w,x,b,T,y,A,I,M,E,B,P,R,S,U,O,N,V,D,F,C,L;return{setters:[function(t){e=t.bx,r=t.bu,i=t.l,n=t.i,s=t.w,a=t.a0,u=t.cm,o=t.bt,h=t.o,f=t.bD,c=t.bA,d=t.d,l=t.bz,v=t.Q,_=t.bE,m=t.aM,g=t.bg},function(t){p=t.A},function(t){w=t.a3,x=t.a2,b=t._},function(t){T=t.Q,y=t.T,A=t.V,I=t.W,M=t.d},function(t){E=t.aP,B=t.a9,P=t.d,R=t.f,S=t.b,U=t.j,O=t.aq,N=t.ab,V=t.F,D=t.aQ,F=t.aZ,C=t.c,L=t.bk}],execute:function(){var k,z,G,H,W,X=t("B",function(){function t(){this._arrayBufferOrPaddings=[],this._length=0}var e=t.prototype;return e.setNextAlignment=function(t){if(0!==t){var e=this._length%t;if(0!==e){var r=t-e;this._arrayBufferOrPaddings.push(r),this._length+=r}}},e.addBuffer=function(t){var e=this._length;return this._arrayBufferOrPaddings.push(t),this._length+=t.byteLength,e},e.getLength=function(){return this._length},e.getCombined=function(){var t=new Uint8Array(this._length),e=0;return this._arrayBufferOrPaddings.forEach((function(r){"number"==typeof r?e+=r:(t.set(new Uint8Array(r),e),e+=r.byteLength)})),t.buffer},t}()),j=function(){function t(t,e){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=t,this._mesh.struct.morph){var r=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(r).fill(null);for(var i=0;i<r;++i){var n=this._mesh.struct.morph.subMeshMorphs[i];n&&(n.targets.length>T.MAX_MORPH_TARGET_COUNT?this._subMeshRenderings[i]=new Q(this._mesh,i,this._mesh.struct.morph,e):this._subMeshRenderings[i]=new q(this._mesh,i,this._mesh.struct.morph,e))}}}return t.prototype.createInstance=function(){for(var t=this,e=this._mesh.struct.primitives.length,r=new Array(e),i=0;i<e;++i){var n,s;r[i]=null!==(n=null===(s=this._subMeshRenderings[i])||void 0===s?void 0:s.createInstance())&&void 0!==n?n:null}return{setWeights:function(t,e){var i;null===(i=r[t])||void 0===i||i.setWeights(e)},requiredPatches:function(e){o(t._mesh.struct.morph);var i=t._mesh.struct.morph.subMeshMorphs[e],n=r[e];if(null===n)return null;var s=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:i.targets.length}];return i.attributes.includes(E.ATTR_POSITION)&&s.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),i.attributes.includes(E.ATTR_NORMAL)&&s.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),i.attributes.includes(E.ATTR_TANGENT)&&s.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),s.push.apply(s,n.requiredPatches()),s},adaptPipelineState:function(t,e){var i;null===(i=r[t])||void 0===i||i.adaptPipelineState(e)},destroy:function(){for(var t=0,e=r;t<e.length;t++){var i=e[t];null==i||i.destroy()}}}},t}(),q=function(){function t(t,e,r,i){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=i;var n=r.subMeshMorphs[e];this._subMeshMorph=n,K(t,e,i);var s=t.struct.vertexBundles[t.struct.primitives[e].vertexBundelIndices[0]].view.count;this._verticesCount=s;var a=n.targets.length,u=Y(i,s*a);this._textureInfo={width:u.width,height:u.height},this._attributes=n.attributes.map((function(e,r){var i=u.create(),a=i.valueView;return n.targets.forEach((function(e,i){for(var n=e.displacements[r],u=new Float32Array(t.data.buffer,t.data.byteOffset+n.offset,n.count),o=s*i*4,h=0;h<s;++h)a[o+4*h+0]=u[3*h+0],a[o+4*h+1]=u[3*h+1],a[o+4*h+2]=u[3*h+2]})),i.updatePixels(),{name:e,morphTexture:i}}))}var e=t.prototype;return e.destroy=function(){for(var t,e=n(this._attributes);!(t=e()).done;)t.value.morphTexture.destroy()},e.createInstance=function(){var t=this,e=new J(this._gfxDevice,this._subMeshMorph.targets.length);return e.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),e.setVerticesCount(this._verticesCount),e.commit(),{setWeights:function(t){e.setWeights(t),e.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(r){for(var i,a=n(t._attributes);!(i=a()).done;){var u=i.value,o=void 0;switch(u.name){case E.ATTR_POSITION:o=I;break;case E.ATTR_NORMAL:o=A;break;case E.ATTR_TANGENT:o=y;break;default:s("Unexpected attribute!")}void 0!==o&&(r.bindSampler(o,u.morphTexture.sampler),r.bindTexture(o,u.morphTexture.texture))}r.bindBuffer(T.BINDING,e.buffer),r.update()},destroy:function(){}}},t}(),Q=function(){function t(t,e,r,i){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=i;var n=r.subMeshMorphs[e];K(t,e,i),this._attributes=n.attributes.map((function(e,r){return{name:e,targets:n.targets.map((function(e){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+e.displacements[r].offset,e.displacements[r].count)}}))}}))}return t.prototype.createInstance=function(){return new Z(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)},e(t,[{key:"data",get:function(){return this._attributes}}]),t}(),Z=function(){function t(t,e,r){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=t,this._morphUniforms=new J(r,0);var i=Y(r,e);this._morphUniforms.setMorphTextureInfo(i.width,i.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map((function(t){var e=i.create();return{attributeName:t.name,morphTexture:e}}))}var e=t.prototype;return e.setWeights=function(t){for(var e=0;e<this._attributes.length;++e){var i=this._attributes[e],n=i.morphTexture.valueView,s=this._owner.data[e];r(t.length===s.targets.length);for(var a=0;a<s.targets.length;++a){var u=s.targets[a].displacements,o=t[a],h=u.length/3;if(0===a)for(var f=0;f<h;++f)n[4*f+0]=u[3*f+0]*o,n[4*f+1]=u[3*f+1]*o,n[4*f+2]=u[3*f+2]*o;else if(0!==o)for(var c=0;c<h;++c)n[4*c+0]+=u[3*c+0]*o,n[4*c+1]+=u[3*c+1]*o,n[4*c+2]+=u[3*c+2]*o}i.morphTexture.updatePixels()}},e.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},e.adaptPipelineState=function(t){for(var e,r=n(this._attributes);!(e=r()).done;){var i=e.value,a=void 0;switch(i.attributeName){case E.ATTR_POSITION:a=I;break;case E.ATTR_NORMAL:a=A;break;case E.ATTR_TANGENT:a=y;break;default:s("Unexpected attribute!")}void 0!==a&&(t.bindSampler(a,i.morphTexture.sampler),t.bindTexture(a,i.morphTexture.texture))}t.bindBuffer(T.BINDING,this._morphUniforms.buffer),t.update()},e.destroy=function(){this._morphUniforms.destroy();for(var t=0;t<this._attributes.length;++t)this._attributes[t].morphTexture.destroy()},t}(),J=function(){function t(t,e){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=e,this._localBuffer=new DataView(new ArrayBuffer(T.SIZE)),this._remoteBuffer=t.createBuffer(new B(P.UNIFORM|P.TRANSFER_DST,R.HOST|R.DEVICE,T.SIZE,T.SIZE))}var n=t.prototype;return n.destroy=function(){this._remoteBuffer.destroy()},n.setWeights=function(t){r(t.length===this._targetCount);for(var e=0;e<t.length;++e)this._localBuffer.setFloat32(T.OFFSET_OF_WEIGHTS+4*e,t[e],i.sys.isLittleEndian)},n.setMorphTextureInfo=function(t,e){this._localBuffer.setFloat32(T.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,t,i.sys.isLittleEndian),this._localBuffer.setFloat32(T.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,e,i.sys.isLittleEndian)},n.setVerticesCount=function(t){this._localBuffer.setFloat32(T.OFFSET_OF_VERTICES_COUNT,t,i.sys.isLittleEndian)},n.commit=function(){this._remoteBuffer.update(this._localBuffer.buffer)},e(t,[{key:"buffer",get:function(){return this._remoteBuffer}}]),t}();function Y(t,e){var r,i,n,o;t.getFormatFeatures(S.RGBA32F)&U.SAMPLED_TEXTURE?(r=e,n=16,i=w.PixelFormat.RGBA32F,o=Float32Array):(r=4*e,n=4,i=w.PixelFormat.RGBA8888,o=Uint8Array);var h=function(t){t<5&&(t=5);var e=a(t),r=u(e),i=r>>1;return{width:1<<(1&r?i+1:i),height:1<<i}}(r),f=h.width,c=h.height;return{width:f,height:c,create:function(){var e=new ArrayBuffer(f*c*n),r=new Float32Array(e),a=o===Float32Array?r:new o(e),u=new x({width:f,height:c,_data:a,_compressed:!1,format:i}),h=new w;h.setFilters(w.Filter.NEAREST,w.Filter.NEAREST),h.setMipFilter(w.Filter.NONE),h.setWrapMode(w.WrapMode.CLAMP_TO_EDGE,w.WrapMode.CLAMP_TO_EDGE,w.WrapMode.CLAMP_TO_EDGE),h.image=u,h.getGFXTexture()||s("Unexpected: failed to create morph texture?");var d=t.getSampler(h.getSamplerInfo());return{get texture(){return h.getGFXTexture()},get sampler(){return d},get valueView(){return r},destroy:function(){h.destroy()},updatePixels:function(){h.uploadData(a)}}}}}function K(t,e,r){t.renderingSubMeshes[e].enableVertexIdChannel(r)}function $(t){switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}var tt=new h,et=new h,rt=new Uint8Array,it=t("M",f("cc.Mesh")((z=function(t){function i(){var e;return(e=t.call(this)||this).morphRendering=null,e._struct=G&&G(),e._hash=H&&H(),e._data=rt,e._initialized=!1,e._allowDataAccess=W&&W(),e._isMeshDataUploaded=!1,e._renderingSubMeshes=null,e._boneSpaceBounds=new Map,e._jointBufferIndices=null,e}c(i,t);var s=i.prototype;return s.onLoaded=function(){this.initialize()},s.initialize=function(){if(!this._initialized)if(this._initialized=!0,this._struct.dynamic){for(var t=M.gfxDevice,e=[],r=[],i=0;i<this._struct.vertexBundles.length;i++){var s=this._struct.vertexBundles[i],a=t.createBuffer(new B(P.VERTEX|P.TRANSFER_DST,R.DEVICE,s.view.length,s.view.stride));e.push(a)}for(var u=0;u<this._struct.primitives.length;u++){var o=this._struct.primitives[u],h=o.indexView,f=null;h&&(f=t.createBuffer(new B(P.INDEX|P.TRANSFER_DST,R.DEVICE,h.length,h.stride)));for(var c=[],l=0;l<o.vertexBundelIndices.length;l++){var v=o.vertexBundelIndices[l];c.push(e[v])}for(var _=[],m=0;m<o.vertexBundelIndices.length;m++)for(var g,p=o.vertexBundelIndices[m],w=this._struct.vertexBundles[p],x=n(w.attributes);!(g=x()).done;){var T=g.value,y=new O;y.copy(T),_.push(y)}var A=new b(c,_,o.primitiveMode,f);A.drawInfo=new N,A.mesh=this,A.subMeshIdx=u,r.push(A)}this._renderingSubMeshes=r}else{for(var I=this._data.buffer,E=M.gfxDevice,S=this._createVertexBuffers(E,I),U=[],D=[],F=0;F<this._struct.primitives.length;F++){var C=this._struct.primitives[F];if(0!==C.vertexBundelIndices.length){var L=null,k=null;if(C.indexView){var z=C.indexView,G=z.stride,H=z.length;if(4===G&&!E.hasFeature(V.ELEMENT_INDEX_UINT)){var W=this._struct.vertexBundles[C.vertexBundelIndices[0]].view.count;if(W>=65536){d(10001,W,65536);continue}G>>=1,H>>=1}L=E.createBuffer(new B(P.INDEX,R.DEVICE,H,G)),U.push(L),k=new($(z.stride))(I,z.offset,z.count),z.stride!==G&&(k=$(G).from(k)),L.update(k)}var X=C.vertexBundelIndices.map((function(t){return S[t]})),q=[];if(C.vertexBundelIndices.length>0)for(var Q=C.vertexBundelIndices[0],Z=this._struct.vertexBundles[Q].attributes,J=0;J<Z.length;++J){var Y=Z[J];q[J]=new O(Y.name,Y.format,Y.isNormalized,Y.stream,Y.isInstanced,Y.location)}var K=new b(X,q,C.primitiveMode,L);K.mesh=this,K.subMeshIdx=F,D.push(K)}}this._renderingSubMeshes=D,this._struct.morph&&(this.morphRendering=function(t,e){return new j(t,e)}(this,E)),this._isMeshDataUploaded=!0,this._allowDataAccess||this.releaseData()}},s.updateSubMesh=function(t,e){if(this._struct.dynamic)if(t>=this._struct.primitives.length)d(14201);else{var i=[];if(e.positions.length>0&&i.push(e.positions),e.normals&&e.normals.length>0&&i.push(e.normals),e.uvs&&e.uvs.length>0&&i.push(e.uvs),e.tangents&&e.tangents.length>0&&i.push(e.tangents),e.colors&&e.colors.length>0&&i.push(e.colors),e.customAttributes)for(var s=0;s<e.customAttributes.length;s++)i.push(e.customAttributes[s].values);for(var a=this._struct.dynamic,u=a.info,o=this._struct.primitives[t],f=this._renderingSubMeshes[t],c=f.drawInfo,v=0;v<i.length;v++){var _=i[v],m=this._struct.vertexBundles[o.vertexBundelIndices[v]],g=m.view.stride,p=_.byteLength/g,w=_.byteLength,x=new Uint8Array(this._data.buffer,m.view.offset,w),b=new Uint8Array(_.buffer,_.byteOffset,w),T=f.vertexBuffers[v];r(p<=u.maxSubMeshVertices),w>0&&(x.set(b),T.update(b,w)),m.view.count=p,c.vertexCount=p}if(o.indexView){var y=o.indexView,A=y.stride,I=2===A?e.indices16.length:e.indices32.length,M=I*A,E=new Uint8Array(this._data.buffer,y.offset,M),B=2===A?new Uint8Array(e.indices16.buffer,e.indices16.byteOffset,M):new Uint8Array(e.indices32.buffer,e.indices32.byteOffset,M),P=f.indexBuffer;r(I<=u.maxSubMeshIndices),M>0&&(E.set(B),P.update(B,M)),y.count=I,c.indexCount=I}if(e.minPos&&e.maxPos){var R=new h(e.minPos.x,e.minPos.y,e.minPos.z),S=new h(e.maxPos.x,e.maxPos.y,e.maxPos.z);a.bounds[t]||(a.bounds[t]=new l),l.fromPoints(a.bounds[t],R,S);for(var U,O=new h,N=new h,V=n(a.bounds);!(U=V()).done;){var D=U.value;D&&(D.getBoundary(O,N),h.min(R,O,R),h.max(S,N,S))}this._struct.minPosition=new h(R.x,R.y,R.z),this._struct.maxPosition=new h(S.x,S.y,S.z)}f.invalidateGeometricInfo()}else d(14200)},s.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},s.destroyRenderingMesh=function(){if(this._renderingSubMeshes){for(var t=0;t<this._renderingSubMeshes.length;t++)this._renderingSubMeshes[t].destroy();this._renderingSubMeshes=null,this._initialized=!1,this._isMeshDataUploaded=!1}},s.assign=function(t,e){this.reset({struct:t,data:e})},s.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this._data=t.data,this._hash=0},s.getBoneSpaceBounds=function(t){if(this._boneSpaceBounds.has(t.hash))return this._boneSpaceBounds.get(t.hash);var e=[];this._boneSpaceBounds.set(t.hash,e);for(var r=[],i=t.bindposes,n=0;n<i.length;n++)e.push(new l(1/0,1/0,1/0,-1/0,-1/0,-1/0)),r.push(!1);for(var s=this._struct.primitives,a=0;a<s.length;a++){var u=this.readAttribute(a,E.ATTR_JOINTS),o=this.readAttribute(a,E.ATTR_WEIGHTS),f=this.readAttribute(a,E.ATTR_POSITION);if(u&&o&&f)for(var c=Math.min(u.length/4,o.length/4,f.length/3),d=0;d<c;d++){h.set(tt,f[3*d+0],f[3*d+1],f[3*d+2]);for(var v=0;v<4;++v){var _=4*d+v,m=u[_];if(!(0===o[_]||m>=i.length)){h.transformMat4(et,tt,i[m]),r[m]=!0;var g=e[m];h.min(g.center,g.center,et),h.max(g.halfExtents,g.halfExtents,et)}}}}for(var p=0;p<i.length;p++){var w=e[p];r[p]?l.fromPoints(w,w.center,w.halfExtents):e[p]=null}return e},s.merge=function(t,e,r){if(r&&!this.validateMergingMesh(t))return!1;var i=new h,s=e&&new v,a=e&&new l;if(s&&e.getRotation(s),!this._initialized){var u=JSON.parse(JSON.stringify(t._struct)),o=t._data.slice();if(e){u.maxPosition&&u.minPosition&&(h.add(a.center,u.maxPosition,u.minPosition),h.multiplyScalar(a.center,a.center,.5),h.subtract(a.halfExtents,u.maxPosition,u.minPosition),h.multiplyScalar(a.halfExtents,a.halfExtents,.5),l.transform(a,a,e),h.add(u.maxPosition,a.center,a.halfExtents),h.subtract(u.minPosition,a.center,a.halfExtents));for(var f=0;f<u.vertexBundles.length;f++)for(var c=u.vertexBundles[f],d=0;d<c.attributes.length;d++)if(c.attributes[d].name===E.ATTR_POSITION||c.attributes[d].name===E.ATTR_NORMAL){var _=c.attributes[d].format,m=new DataView(o.buffer,c.view.offset+nt(c.attributes,d)),g=ut(m,_),p=ot(m,_);if(!g||!p)continue;for(var w=c.view.count,x=c.view.stride,b=at(_),T=0;T<w;T++){var y=T*x,A=y+b,I=A+b;switch(i.set(g(y),g(A),g(I)),c.attributes[d].name){case E.ATTR_POSITION:i.transformMat4(e);break;case E.ATTR_NORMAL:h.transformQuat(i,i,s)}p(y,i.x),p(A,i.y),p(I,i.z)}}}return this.reset({struct:u,data:o}),this.initialize(),!0}for(var M,B,P,R,S,U=new X,O=0,N=0,V=0,F=0,C=0,L=0,k=0,z=0,G=!1,H=new Array(this._struct.vertexBundles.length),W=0;W<this._struct.vertexBundles.length;++W){var j=this._struct.vertexBundles[W],q=t._struct.vertexBundles[W];V=j.view.offset,F=q.view.offset,N=j.view.stride,O=j.view.count+q.view.count,M=new ArrayBuffer(O*N),B=new Uint8Array(M),V+=(P=this._data.subarray(V,V+j.view.length)).length,F+=(R=t._data.subarray(F,F+q.view.length)).length,B.set(P),C=0;for(var Q,Z=n(j.attributes);!(Q=Z()).done;){var J=Q.value;k=0,G=!1;for(var Y,K=n(q.attributes);!(Y=K()).done;){var $=Y.value;if(J.name===$.name&&J.format===$.format){G=!0;break}k+=D[$.format].size}if(G){z=D[J.format].size,L=j.view.length+C;for(var tt=0;tt<q.view.count;++tt){if(S=R.subarray(k,k+z),B.set(S,L),(J.name===E.ATTR_POSITION||J.name===E.ATTR_NORMAL)&&e){var et=new Float32Array(B.buffer,L,3);switch(i.set(et[0],et[1],et[2]),J.name){case E.ATTR_POSITION:i.transformMat4(e);break;case E.ATTR_NORMAL:h.transformQuat(i,i,s)}et[0]=i.x,et[1]=i.y,et[2]=i.z}L+=j.view.stride,k+=q.view.stride}}C+=D[J.format].size}H[W]={attributes:j.attributes,view:{offset:U.getLength(),length:M.byteLength,count:O,stride:N}},U.addBuffer(M)}for(var rt,it,st,ht=0,ft=2,ct=new Array(this._struct.primitives.length),dt=0;dt<this._struct.primitives.length;++dt){var lt=this._struct.primitives[dt],vt=t._struct.primitives[dt];ct[dt]={primitiveMode:lt.primitiveMode,vertexBundelIndices:lt.vertexBundelIndices};for(var _t,mt=0,gt=n(lt.vertexBundelIndices);!(_t=gt()).done;){var pt=_t.value;mt=Math.max(mt,this._struct.vertexBundles[pt].view.count)}if(lt.indexView&&vt.indexView){ht=lt.indexView.count,ht+=vt.indexView.count,V=lt.indexView.offset,F=vt.indexView.offset,ft=ht<256?1:ht<65536?2:4;var wt=new ArrayBuffer(ht*ft);if(rt=2===ft?new Uint16Array(wt):1===ft?new Uint8Array(wt):new Uint32Array(wt),it=2===lt.indexView.stride?new Uint16Array(this._data.buffer,V,lt.indexView.count):1===lt.indexView.stride?new Uint8Array(this._data.buffer,V,lt.indexView.count):new Uint32Array(this._data.buffer,V,lt.indexView.count),ft===lt.indexView.stride)rt.set(it);else for(var xt=0;xt<lt.indexView.count;++xt)rt[xt]=it[xt];V+=lt.indexView.length,st=2===vt.indexView.stride?new Uint16Array(t._data.buffer,F,vt.indexView.count):1===vt.indexView.stride?new Uint8Array(t._data.buffer,F,vt.indexView.count):new Uint32Array(t._data.buffer,F,vt.indexView.count);for(var bt=0;bt<vt.indexView.count;++bt)rt[lt.indexView.count+bt]=mt+st[bt];F+=vt.indexView.length,ct[dt].indexView={offset:U.getLength(),length:wt.byteLength,count:ht,stride:ft},U.setNextAlignment(ft),U.addBuffer(wt)}}var Tt={vertexBundles:H,primitives:ct,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return Tt.minPosition&&t._struct.minPosition&&Tt.maxPosition&&t._struct.maxPosition&&(e?(h.add(a.center,t._struct.maxPosition,t._struct.minPosition),h.multiplyScalar(a.center,a.center,.5),h.subtract(a.halfExtents,t._struct.maxPosition,t._struct.minPosition),h.multiplyScalar(a.halfExtents,a.halfExtents,.5),l.transform(a,a,e),h.add(i,a.center,a.halfExtents),h.max(Tt.maxPosition,Tt.maxPosition,i),h.subtract(i,a.center,a.halfExtents),h.min(Tt.minPosition,Tt.minPosition,i)):(h.min(Tt.minPosition,Tt.minPosition,t._struct.minPosition),h.max(Tt.maxPosition,Tt.maxPosition,t._struct.maxPosition))),this.reset({struct:Tt,data:new Uint8Array(U.getCombined())}),this.initialize(),!0},s.validateMergingMesh=function(t){if(this._struct.dynamic||t._struct.dynamic)return!1;if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var e=0;e<this._struct.vertexBundles.length;++e){var r=this._struct.vertexBundles[e],i=t._struct.vertexBundles[e];if(r.attributes.length!==i.attributes.length)return!1;for(var n=0;n<r.attributes.length;++n)if(r.attributes[n].format!==i.attributes[n].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var s=0;s<this._struct.primitives.length;++s){var a=this._struct.primitives[s],u=t._struct.primitives[s];if(a.vertexBundelIndices.length!==u.vertexBundelIndices.length)return!1;for(var o=0;o<a.vertexBundelIndices.length;++o)if(a.vertexBundelIndices[o]!==u.vertexBundelIndices[o])return!1;if(a.primitiveMode!==u.primitiveMode)return!1;if(a.indexView){if(void 0===u.indexView)return!1}else if(u.indexView)return!1}return!0},s.readAttribute=function(t,e){var r=this,i=null;return this._accessAttribute(t,e,(function(t,e){var n=t.view.count,s=t.attributes[e].format,a=F(D[s]);if(0!==n){var u=new DataView(r._data.buffer,t.view.offset+nt(t.attributes,e)),o=D[s],h=ut(u,s);if(a&&h){for(var f=o.count,c=new a(n*f),d=t.view.stride,l=0;l<n;++l)for(var v=0;v<f;++v)c[f*l+v]=h(d*l+c.BYTES_PER_ELEMENT*v);i=c}}})),i},s.copyAttribute=function(t,e,r,i,n){var s=this,a=!1;return this._accessAttribute(t,e,(function(t,e){var u=t.view.count;if(0!==u){var o=t.attributes[e].format,h=new DataView(s._data.buffer,t.view.offset+nt(t.attributes,e)),f=new DataView(r,n),c=D[o],d=ut(h,o),l=ot(f,o);if(d&&l){for(var v=c.count,_=t.view.stride,m=at(o),g=i,p=m,w=0;w<u;++w)for(var x=0;x<v;++x)l(g*w+p*x,d(_*w+m*x));a=!0}}else a=!0})),a},s.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var e=this._struct.primitives[t];if(!e.indexView)return null;var r=e.indexView.stride;return new(1===r?Uint8Array:2===r?Uint16Array:Uint32Array)(this._data.buffer,e.indexView.offset,e.indexView.count)},s.copyIndices=function(t,e){if(t>=this._struct.primitives.length)return!1;var r=this._struct.primitives[t];if(!r.indexView)return!1;for(var i=r.indexView.count,n=1===r.indexView.stride?S.R8UI:2===r.indexView.stride?S.R16UI:S.R32UI,s=ut(new DataView(this._data.buffer),n),a=0;a<i;++a)e[a]=s(r.indexView.offset+D[n].size*a);return!0},s.readAttributeFormat=function(t,e){var r=null;return this._accessAttribute(t,e,(function(t,e){var i=t.attributes[e].format;r=D[i]})),r},s._accessAttribute=function(t,e,r){if(!(t>=this._struct.primitives.length))for(var i,s=this._struct.primitives[t],a=n(s.vertexBundelIndices);!(i=a()).done;){var u=i.value,o=this._struct.vertexBundles[u],h=o.attributes.findIndex((function(t){return t.name===e}));if(!(h<0)){r(o,h);break}}},s._createVertexBuffers=function(t,e){return this._struct.vertexBundles.map((function(r){var i=t.createBuffer(new B(P.VERTEX,R.DEVICE,r.view.length,r.view.stride)),n=new Uint8Array(e,r.view.offset,r.view.length);return i.update(n),i}))},s.initDefault=function(e){t.prototype.initDefault.call(this,e),this.reset({struct:{vertexBundles:[],primitives:[]},data:rt})},s.releaseData=function(){this._data=rt},e(i,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data=new Uint8Array(t)}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this._data}},{key:"hash",get:function(){return this._hash||(this._hash=L(this._data,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this._renderingSubMeshes}},{key:"allowDataAccess",get:function(){return this._allowDataAccess},set:function(t){this._allowDataAccess=t,this._isMeshDataUploaded&&!this._allowDataAccess&&this.releaseData()}}]),i}(p),G=_(z.prototype,"_struct",[g],(function(){return{vertexBundles:[],primitives:[]}})),H=_(z.prototype,"_hash",[g],(function(){return 0})),W=_(z.prototype,"_allowDataAccess",[g],(function(){return!0})),k=z))||k);function nt(t,e){for(var r=0,i=0;i<e;++i){var n=t[i];r+=D[n.format].size}return r}i.Mesh=it;var st=m.isLittleEndian;function at(t){var e=D[t];return e.size/e.count}function ut(t,e){var r=D[e],i=r.size/r.count;switch(r.type){case C.UNORM:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,st)};case 4:return function(e){return t.getUint32(e,st)}}break;case C.SNORM:case C.INT:switch(i){case 1:return function(e){return t.getInt8(e)};case 2:return function(e){return t.getInt16(e,st)};case 4:return function(e){return t.getInt32(e,st)}}break;case C.UINT:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,st)};case 4:return function(e){return t.getUint32(e,st)}}break;case C.FLOAT:return function(e){return t.getFloat32(e,st)}}return null}function ot(t,e){var r=D[e],i=r.size/r.count;switch(r.type){case C.UNORM:switch(i){case 1:return function(e,r){return t.setUint8(e,r)};case 2:return function(e,r){return t.setUint16(e,r,st)};case 4:return function(e,r){return t.setUint32(e,r,st)}}break;case C.SNORM:case C.INT:switch(i){case 1:return function(e,r){return t.setInt8(e,r)};case 2:return function(e,r){return t.setInt16(e,r,st)};case 4:return function(e,r){return t.setInt32(e,r,st)}}break;case C.UINT:switch(i){case 1:return function(e,r){return t.setUint8(e,r)};case 2:return function(e,r){return t.setUint16(e,r,st)};case 4:return function(e,r){return t.setUint32(e,r,st)}}break;case C.FLOAT:return function(e,r){return t.setFloat32(e,r,st)}}return null}}}}));
