System.register(["./index-68ccac70.js","./pipeline-state-manager-8f16c5a7.js","./buffer-barrier-d1733967.js","./node-event-40319828.js"],(function(e,t){"use strict";var i,n,r,s,o,a,u,h,l,f,c,p,_,d,g,v,m,y,b,A,R,w,I,T,D,x,S,C,E,M,P,k,L,B,O,N,F,H,G,z,U,j,V,W,X,q,K,J,Y,Q,$,Z,ee,te,ie,ne,re,se,oe,ae,ue,he,le,fe,ce,pe,_e,de,ge,ve,me,ye,be,Ae,Re,we,Ie,Te,De,xe,Se,Ce,Ee,Me,Pe,ke,Le,Be,Oe,Ne,Fe,He,Ge,ze,Ue,je,Ve,We,Xe,qe,Ke,Je,Ye,Qe,$e,Ze,et,tt,it,nt,rt,st,ot,at,ut,ht,lt,ft,ct,pt,_t,dt,gt,vt,mt,yt,bt,At,Rt,wt,It,Tt,Dt,xt,St,Ct,Et,Mt,Pt,kt,Lt,Bt,Ot,Nt,Ft,Ht,Gt,zt,Ut,jt,Vt,Wt,Xt,qt,Kt,Jt,Yt,Qt,$t,Zt,ei,ti,ii,ni,ri,si,oi,ai,ui,hi,li,fi,ci,pi,_i,di,gi,vi,mi,yi,bi,Ai,Ri;return{setters:[function(e){i=e.aa,n=e.bD,r=e.bA,s=e.i,o=e.aN,a=e.aM,u=e.d,h=e.b_,l=e.bx,f=e.b$,c=e.be,p=e.l,_=e.ab,d=e.f,g=e.bE,v=e.bg,m=e.c0,y=e.c1,b=e.e,A=e.c2,R=e.c3,w=e.aJ,I=e.aq,T=e.bP,D=e.bu,x=e.az,S=e.bV,C=e.c4,E=e.c5,M=e.c6,P=e.bj,k=e.bk,L=e.c7,B=e.c8,O=e.V,N=e.o,F=e.q,H=e.Q,G=e.B,z=e.S,U=e.y,j=e.t,V=e.bT,W=e.c9,X=e.bO,q=e.g,K=e.bF,J=e.bH,Y=e.ca,Q=e.cb,$=e.cc,Z=e.bm,ee=e.cd,te=e.bS,ie=e.ce,ne=e.cf,re=e.bt,se=e.bR,oe=e.cg,ae=e.a$,ue=e.a_,he=e.ch,le=e.aD,fe=e.M,ce=e.aG,pe=e.bB,_e=e.J,de=e.ci,ge=e.ah,ve=e.ag,me=e.as,ye=e.a,be=e.cj,Ae=e.aA,Re=e.I,we=e.ck,Ie=e.F,Te=e.au,De=e.at,xe=e.bf,Se=e.aw,Ce=e.ay,Ee=e.ac},function(e){Me=e.d,Pe=e.z,ke=e.A,Le=e.S,Be=e.J,Oe=e.t,Ne=e.j,Fe=e.k,He=e.m,Ge=e.l,ze=e.c,Ue=e.K,je=e.i,Ve=e.P,We=e.M,Xe=e.N,qe=e.b},function(e){Ke=e.b,Je=e.m,Ye=e.l,Qe=e.j,$e=e.ag,Ze=e.bk,et=e.i,tt=e.h,it=e.a3,nt=e.A,rt=e.ae,st=e.g,ot=e.af,at=e.T,ut=e.aY,ht=e.aD,lt=e.ar,ft=e.aC,ct=e.G,pt=e.ai,_t=e.ah,dt=e.aj,gt=e.ak,vt=e.al,mt=e.an,yt=e.am,bt=e.ao,At=e.aq,Rt=e.ap,wt=e.s,It=e.aF,Tt=e.aR,Dt=e.aS,xt=e.a9,St=e.d,Ct=e.f,Et=e.as,Mt=e.b7,Pt=e.ba,kt=e.b9,Lt=e.v,Bt=e.z,Ot=e.bf,Nt=e.F,Ft=e.aa,Ht=e.aE,Gt=e.a4,zt=e.Z,Ut=e.bh,jt=e.at,Vt=e.au,Wt=e.ax,Xt=e.ay,qt=e.u,Kt=e.c,Jt=e.aQ,Yt=e.aP},function(e){Qt=e.A,$t=e.C,Zt=e.l,ei=e.n,ti=e.o,ii=e.h,ni=e.q,ri=e.f,si=e.r,oi=e.k,ai=e.R,ui=e.m,hi=e.b,li=e.B,fi=e.t,ci=e.u,pi=e.v,_i=e.P,di=e.w,gi=e.x,vi=e.y,mi=e.z,yi=e.e,bi=e.D,Ai=e.F,Ri=e.N}],execute:function(){e({X:In,aA:$s,aB:Ks,aC:Vs,aD:qs,aE:Ws,aF:eo,aG:to,aH:Qs,ad:function(){return Bo},ae:function(e){for(var t=e.length-1;t>=0;--t){var i=e[t];if(i.window.swapchain)return void(Bo=i)}Bo=null},af:function(e,t,i,n,r){if(!je()&&n&&n.enabled&&r===Bo){var s=n.subModels[0],o=s.inputAssembler,a=s.passes,u=s.shaders,h=s.descriptorSet;wo.width=Io.width=r.window.width,wo.height=Io.height=r.window.height;var l=Ve.getOrCreatePipelineState(e,a[0],u[0],t,o);i.setViewport(wo),i.setScissor(Io),i.bindPipelineState(l),i.bindDescriptorSet(Le.MATERIAL,a[0].descriptorSet),i.bindDescriptorSet(Le.LOCAL,h),i.bindInputAssembler(o),i.draw(o)}},ag:To,ai:ac,aj:sc,ap:gr,ar:function(e){ur=e},as:function(e,t,i,n,r,s){void 0===t&&(t=Ke.R32F),void 0===i&&(i=0),void 0===n&&(n=e.byteLength-i),void 0===r&&(r=0),void 0===s&&(s=[]);var o=Jt[t];r||(r=o.size);for(var u="get"+la(o),h=o.size/o.count,l=Math.floor(n/r),f=a.isLittleEndian,c=0;c<l;++c)for(var p=i+r*c,_=0;_<o.count;++_){var d=p+h*_;s[o.count*c+_]=e[u](d,f)}return s},at:function(e,t,i,n,r){void 0===i&&(i=Ke.R32F),void 0===n&&(n=0),void 0===r&&(r=0);var s=Jt[i];r||(r=s.size);for(var o="set"+la(s),u=s.size/s.count,h=Math.floor(t.length/s.count),l=a.isLittleEndian,f=0;f<h;++f)for(var c=n+r*f,p=0;p<s.count;++p){var _=c+u*p;e[o](_,t[s.count*f+p],l)}},au:fa,g:so,o:Gs,q:zs,r:Us,x:_c});var wi,Ii,Ti,Di,xi,Si;e("av",wi),function(e){e[e.RGB565=Ke.R5G6B5]="RGB565",e[e.RGB5A1=Ke.RGB5A1]="RGB5A1",e[e.RGBA4444=Ke.RGBA4]="RGBA4444",e[e.RGB888=Ke.RGB8]="RGB888",e[e.RGB32F=Ke.RGB32F]="RGB32F",e[e.RGBA8888=Ke.RGBA8]="RGBA8888",e[e.RGBA32F=Ke.RGBA32F]="RGBA32F",e[e.A8=Ke.A8]="A8",e[e.I8=Ke.L8]="I8",e[e.AI8=Ke.LA8]="AI8",e[e.RGB_PVRTC_2BPPV1=Ke.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",e[e.RGBA_PVRTC_2BPPV1=Ke.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",e[e.RGB_A_PVRTC_2BPPV1=1024]="RGB_A_PVRTC_2BPPV1",e[e.RGB_PVRTC_4BPPV1=Ke.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",e[e.RGBA_PVRTC_4BPPV1=Ke.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",e[e.RGB_A_PVRTC_4BPPV1=1025]="RGB_A_PVRTC_4BPPV1",e[e.RGB_ETC1=Ke.ETC_RGB8]="RGB_ETC1",e[e.RGBA_ETC1=1026]="RGBA_ETC1",e[e.RGB_ETC2=Ke.ETC2_RGB8]="RGB_ETC2",e[e.RGBA_ETC2=Ke.ETC2_RGBA8]="RGBA_ETC2",e[e.RGBA_ASTC_4x4=Ke.ASTC_RGBA_4X4]="RGBA_ASTC_4x4",e[e.RGBA_ASTC_5x4=Ke.ASTC_RGBA_5X4]="RGBA_ASTC_5x4",e[e.RGBA_ASTC_5x5=Ke.ASTC_RGBA_5X5]="RGBA_ASTC_5x5",e[e.RGBA_ASTC_6x5=Ke.ASTC_RGBA_6X5]="RGBA_ASTC_6x5",e[e.RGBA_ASTC_6x6=Ke.ASTC_RGBA_6X6]="RGBA_ASTC_6x6",e[e.RGBA_ASTC_8x5=Ke.ASTC_RGBA_8X5]="RGBA_ASTC_8x5",e[e.RGBA_ASTC_8x6=Ke.ASTC_RGBA_8X6]="RGBA_ASTC_8x6",e[e.RGBA_ASTC_8x8=Ke.ASTC_RGBA_8X8]="RGBA_ASTC_8x8",e[e.RGBA_ASTC_10x5=Ke.ASTC_RGBA_10X5]="RGBA_ASTC_10x5",e[e.RGBA_ASTC_10x6=Ke.ASTC_RGBA_10X6]="RGBA_ASTC_10x6",e[e.RGBA_ASTC_10x8=Ke.ASTC_RGBA_10X8]="RGBA_ASTC_10x8",e[e.RGBA_ASTC_10x10=Ke.ASTC_RGBA_10X10]="RGBA_ASTC_10x10",e[e.RGBA_ASTC_12x10=Ke.ASTC_RGBA_12X10]="RGBA_ASTC_12x10",e[e.RGBA_ASTC_12x12=Ke.ASTC_RGBA_12X12]="RGBA_ASTC_12x12"}(wi||e("av",wi={})),e("ay",Ii),function(e){e[e.REPEAT=Je.WRAP]="REPEAT",e[e.CLAMP_TO_EDGE=Je.CLAMP]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=Je.MIRROR]="MIRRORED_REPEAT",e[e.CLAMP_TO_BORDER=Je.BORDER]="CLAMP_TO_BORDER"}(Ii||e("ay",Ii={})),e("aw",Ti),function(e){e[e.NONE=Ye.NONE]="NONE",e[e.LINEAR=Ye.LINEAR]="LINEAR",e[e.NEAREST=Ye.POINT]="NEAREST"}(Ti||e("aw",Ti={}));var Ci=1346981187,Ei=i({PVR:0,PKM:1,ASTC:2});function Mi(e,t){return e[t]<<8|e[t+1]}function Pi(e){return!!(a.hasFeature(a.Feature.IMAGE_BITMAP)&&e instanceof ImageBitmap)}var ki,Li,Bi,Oi,Ni,Fi,Hi,Gi,zi,Ui,ji,Vi=e("a2",n("cc.ImageAsset")(((Si=function(e){r(i,e),i.mergeCompressedTextureMips=function(e){var t=new Uint8Array(0),i=null;try{for(var n,r=8+4*e.length,o=0,a=s(e);!(n=a()).done;)o+=n.value.byteLength;o+=r,t=new Uint8Array(o);var u=new DataView(t.buffer,t.byteOffset,t.byteLength);u.setUint32(0,Ci,!0),u.setUint32(4,e.length,!0);for(var h=r,l=0;l<e.length;l++){var f=e[l];if(u.setUint32(8+4*l,f.byteLength,!0),f instanceof ArrayBuffer){var c=new Uint8Array(f);t.set(c,h)}else{var p=new Uint8Array(f.buffer,f.byteOffset,f.byteLength);t.set(p,h)}h+=f.byteLength}}catch(e){i=e,console.warn(i)}return t},i.parseCompressedTextures=function(e,t){var n={_data:new Uint8Array(0),_compressed:!0,width:0,height:0,format:0,mipmapLevelDataSize:[]},r=e instanceof ArrayBuffer?e:e.buffer,s=new DataView(r);if(s.getUint32(0,!0)===Ci){var o=s.getUint32(4,!0),a=s.getUint32(8,!0),u=8+4*o;i.parseCompressedTexture(e,0,u,a,t,n);for(var h=u+a,l=1;l<o;l++){var f=s.getUint32(8+4*l,!0);i.parseCompressedTexture(e,l,h,f,t,n),h+=f}}else i.parseCompressedTexture(e,0,0,0,t,n);return n},i.parseCompressedTexture=function(e,t,n,r,s,o){switch(s){case Ei.PVR:i.parsePVRTexture(e,t,n,r,o);break;case Ei.PKM:i.parsePKMTexture(e,t,n,r,o);break;case Ei.ASTC:i.parseASTCTexture(e,t,n,r,o)}},i.parsePVRTexture=function(e,t,i,n,r){var s=e instanceof ArrayBuffer?e:e.buffer,o=new Int32Array(s,i,13);if(55727696===o[0]){var a=i+o[12]+52,u=n-o.byteLength;if(n>0){var h=new Uint8Array(s,a,u),l=new Uint8Array(r._data.byteLength+h.byteLength);l.set(r._data),l.set(h,r._data.byteLength),r._data=l,r.mipmapLevelDataSize[t]=u}else r._data=new Uint8Array(s,a);r.width=t>0?r.width:o[7],r.height=t>0?r.height:o[6]}else{if(559044176!==o[11])throw new Error("Invalid magic number in PVR header");var f=i+o[0],c=n-o.byteLength;if(n>0){var p=new Uint8Array(s,f,c),_=new Uint8Array(r._data.byteLength+p.byteLength);_.set(r._data),_.set(p,r._data.byteLength),r._data=_,r.mipmapLevelDataSize[t]=c}else r._data=new Uint8Array(s,f);r.width=t>0?r.width:o[1],r.height=t>0?r.height:o[2]}},i.parsePKMTexture=function(e,t,i,n,r){var s=e instanceof ArrayBuffer?e:e.buffer,o=new Uint8Array(s,i,16),a=Mi(o,6);if(0!==a&&1!==a&&3!==a)throw new Error("Invalid magic number in ETC header");var u=i+16,h=n-16;if(n>0){var l=new Uint8Array(s,u,h),f=new Uint8Array(r._data.byteLength+l.byteLength);f.set(r._data),f.set(l,r._data.byteLength),r._data=f,r.mipmapLevelDataSize[t]=h}else r._data=new Uint8Array(s,u);r.width=t>0?r.width:Mi(o,12),r.height=t>0?r.height:Mi(o,14)},i.parseASTCTexture=function(e,t,i,n,r){var s=e instanceof ArrayBuffer?e:e.buffer,o=new Uint8Array(s,i,16);if(1554098963!==o[0]+(o[1]<<8)+(o[2]<<16)+(o[3]<<24))throw new Error("Invalid magic number in ASTC header");var a=o[4],u=o[5],h=o[6];if((a<3||a>6||u<3||u>6||h<3||h>6)&&(a<4||7===a||9===a||11===a||a>12||u<4||7===u||9===u||11===u||u>12||1!==h))throw new Error("Invalid block number in ASTC header");var l=function(e,t){return 4===e?wi.RGBA_ASTC_4x4:5===e?4===t?wi.RGBA_ASTC_5x4:wi.RGBA_ASTC_5x5:6===e?5===t?wi.RGBA_ASTC_6x5:wi.RGBA_ASTC_6x6:8===e?5===t?wi.RGBA_ASTC_8x5:6===t?wi.RGBA_ASTC_8x6:wi.RGBA_ASTC_8x8:10===e?5===t?wi.RGBA_ASTC_10x5:6===t?wi.RGBA_ASTC_10x6:8===t?wi.RGBA_ASTC_10x8:wi.RGBA_ASTC_10x10:10===t?wi.RGBA_ASTC_12x10:wi.RGBA_ASTC_12x12}(a,u),f=i+16,c=n-16;if(n>0){var p=new Uint8Array(s,f,c),_=new Uint8Array(r._data.byteLength+p.byteLength);_.set(r._data),_.set(p,r._data.byteLength),r._data=_,r.mipmapLevelDataSize[t]=c}else r._data=new Uint8Array(s,f);r.width=t>0?r.width:o[7]+(o[8]<<8)+(o[9]<<16),r.height=t>0?r.height:o[10]+(o[11]<<8)+(o[12]<<16),r.format=l};var t=i.prototype;function i(t){var i;return(i=e.call(this)||this)._nativeData=void 0,i._exportedExts=void 0,i._format=wi.RGBA8888,i._width=0,i._height=0,i._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1,mipmapLevelDataSize:[]},void 0!==t&&i.reset(t),i}return t.extractMipmap0=function(){if(this.mipmapLevelDataSize&&this.mipmapLevelDataSize.length>0){var e=this.mipmapLevelDataSize[0],t=this.data,n=new i({_data:new Uint8Array(t.buffer,0,e),_compressed:!0,width:this.width,height:this.height,format:this.format,mipmapLevelDataSize:[]});return n._uuid=""+this._uuid,n}return this},t.extractMipmaps=function(){var e=[];if(this.mipmapLevelDataSize&&this.mipmapLevelDataSize.length>0)for(var t,n=this.mipmapLevelDataSize,r=this.data,o=0,a=this.height,u=this.width,h=s(n);!(t=h()).done;){var l=t.value,f=new i({_data:new Uint8Array(r.buffer,o,l),_compressed:!0,width:u,height:a,format:this.format,mipmapLevelDataSize:[]});o+=l,f._uuid=""+this._uuid,u=Math.max(u>>1,1),a=Math.max(a>>1,1),e.push(f)}else e.push(this);return e},t.reset=function(e){Pi(e)||e instanceof HTMLElement?this._nativeData=e:(this._nativeData=e,this._format=e.format)},t.destroy=function(){if(this.data&&this.data instanceof HTMLImageElement)this.data.src="",this._setRawAsset("");else if(Pi(this.data)){var t;null===(t=this.data)||void 0===t||t.close()}return e.prototype.destroy.call(this)},t._serialize=function(){},t._deserialize=function(e){var t="";"string"==typeof e?t=e:(this._width=e.w,this._height=e.h,t=e.fmt);for(var n,r=Me.gfxDevice,h=t.split("_"),l=Number.MAX_VALUE,f=this._format,c="",p=o.SUPPORT_TEXTURE_FORMATS,_=s(h);!(n=_()).done;){var d=n.value.split("@"),g=parseInt(d[0],void 0),v=i.extnames[g]||d[0],m=p.indexOf(v);if(-1!==m&&m<l){var y=d[1]?parseInt(d[1]):this._format;if(!(".astc"!==v||r&&r.getFormatFeatures(Ke.ASTC_RGBA_4X4)&Qe.SAMPLED_TEXTURE))continue;if(!(".pvr"!==v||r&&r.getFormatFeatures(Ke.PVRTC_RGBA4)&Qe.SAMPLED_TEXTURE))continue;if(!(y!==wi.RGB_ETC1&&y!==wi.RGBA_ETC1||r&&r.getFormatFeatures(Ke.ETC_RGB8)&Qe.SAMPLED_TEXTURE))continue;if(!(y!==wi.RGB_ETC2&&y!==wi.RGBA_ETC2||r&&r.getFormatFeatures(Ke.ETC2_RGB8)&Qe.SAMPLED_TEXTURE))continue;if(".webp"===v&&!a.hasFeature(a.Feature.WEBP))continue;l=m,c=v,f=y}}c?(this._setRawAsset(c),this._format=f):u(3121)},t.initDefault=function(t){if(e.prototype.initDefault.call(this,t),i._sharedPlaceHolderCanvas)this.reset(i._sharedPlaceHolderCanvas);else{var n=h.document.createElement("canvas"),r=n.getContext("2d"),s=n.width=n.height=2;r.fillStyle="#ff00ff",r.fillRect(0,0,s,s),this.reset(n),i._sharedPlaceHolderCanvas=n}},t.validate=function(){return!!this.data},l(i,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(e){e instanceof HTMLElement||Pi(e)||(e.format=e.format||this._format),this.reset(e)}},{key:"data",get:function(){return(e=this._nativeData)instanceof HTMLImageElement||e instanceof HTMLCanvasElement||Pi(e)?this._nativeData:this._nativeData&&this._nativeData._data;var e}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=wi.RGB_ETC1&&this._format<=wi.RGBA_ASTC_12x12||this._format>=wi.RGB_A_PVRTC_2BPPV1&&this._format<=wi.RGBA_ETC1}},{key:"mipmapLevelDataSize",get:function(){return this._nativeData.mipmapLevelDataSize}},{key:"url",get:function(){return this.nativeUrl}}]),i}(Qt)).extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],Si._sharedPlaceHolderCanvas=null,f((xi=Si).prototype,"_nativeAsset",[c],Object.getOwnPropertyDescriptor(xi.prototype,"_nativeAsset"),xi.prototype),Di=xi))||Di);p.ImageAsset=Vi,_(Ke);var Wi,Xi,qi,Ki=new m("Tex"),Ji=e("ax",n("cc.TextureBase")(((ji=function(e){function t(){var t;return(t=e.call(this)||this)._format=Bi&&Bi(),t._minFilter=Oi&&Oi(),t._magFilter=Ni&&Ni(),t._mipFilter=Fi&&Fi(),t._wrapS=Hi&&Hi(),t._wrapT=Gi&&Gi(),t._wrapR=zi&&zi(),t._anisotropy=Ui&&Ui(),t._width=1,t._height=1,t._id=void 0,t._samplerInfo=new $e,t._gfxSampler=null,t._gfxDevice=null,t._textureHash=0,t._id=Ki.getNewId(),t._gfxDevice=t._getGFXDevice(),t._textureHash=Ze(t._id,666),t}r(t,e);var i=t.prototype;return i.getId=function(){return this._id},i.getPixelFormat=function(){return this._format},i.getAnisotropy=function(){return this._anisotropy},i.setWrapMode=function(e,t,i){void 0===i&&(i=e),this._wrapS=e,this._samplerInfo.addressU=e,this._wrapT=t,this._samplerInfo.addressV=t,this._wrapR=i,this._samplerInfo.addressW=i,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},i.setFilters=function(e,t){this._minFilter=e,this._samplerInfo.minFilter=e,this._magFilter=t,this._samplerInfo.magFilter=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},i.setMipFilter=function(e){this._mipFilter=e,this._samplerInfo.mipFilter=e,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},i.setAnisotropy=function(e){this._anisotropy=e,this._samplerInfo.maxAnisotropy=e,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},i.destroy=function(){var t,i=e.prototype.destroy.call(this);return i&&null!==(t=p.director.root)&&void 0!==t&&t.batcher2D&&p.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),i},i.getHash=function(){return this._textureHash},i.getGFXTexture=function(){return null},i.getSamplerInfo=function(){return this._samplerInfo},i.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo):d(9302)),this._gfxSampler},i._serialize=function(){return""},i._deserialize=function(e){var t=e.split(",");t.unshift(""),t.length>=5&&(this.setFilters(parseInt(t[1]),parseInt(t[2])),this.setWrapMode(parseInt(t[3]),parseInt(t[4]))),t.length>=7&&(this.setMipFilter(parseInt(t[5])),this.setAnisotropy(parseInt(t[6])))},i._getGFXDevice=function(){return Me.gfxDevice},i._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},i._setGFXFormat=function(e){this._format=void 0===e?wi.RGBA8888:e},i._getGFXPixelFormat=function(e){return e===wi.RGBA_ETC1?e=wi.RGB_ETC1:e===wi.RGB_A_PVRTC_4BPPV1?e=wi.RGB_PVRTC_4BPPV1:e===wi.RGB_A_PVRTC_2BPPV1&&(e=wi.RGB_PVRTC_2BPPV1),e},l(t,[{key:"isCompressed",get:function(){return this._format>=wi.RGB_ETC1&&this._format<=wi.RGBA_ASTC_12x12||this._format>=wi.RGB_A_PVRTC_2BPPV1&&this._format<=wi.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),t}(Qt)).PixelFormat=wi,ji.WrapMode=Ii,ji.Filter=Ti,Bi=g((Li=ji).prototype,"_format",[v],(function(){return wi.RGBA8888})),Oi=g(Li.prototype,"_minFilter",[v],(function(){return Ti.LINEAR})),Ni=g(Li.prototype,"_magFilter",[v],(function(){return Ti.LINEAR})),Fi=g(Li.prototype,"_mipFilter",[v],(function(){return Ti.NONE})),Hi=g(Li.prototype,"_wrapS",[v],(function(){return Ii.REPEAT})),Gi=g(Li.prototype,"_wrapT",[v],(function(){return Ii.REPEAT})),zi=g(Li.prototype,"_wrapR",[v],(function(){return Ii.REPEAT})),Ui=g(Li.prototype,"_anisotropy",[v],(function(){return 0})),ki=Li))||ki);p.TextureBase=Ji;var Yi=e("W",n("cc.MissingScript")((Xi=function(e){function t(){var t;return(t=e.call(this)||this)._$erialized=qi&&qi(),t}return r(t,e),t.safeFindClass=function(e){var t=y(e);if(t)return t;p.deserialize.reportMissingClass(e)},t.prototype.onLoad=function(){u(4600,this.node.name)},t}($t),qi=g(Xi.prototype,"_$erialized",[v,A],(function(){return null})),Wi=Xi))||Wi);p._MissingScript=Yi;try{var Qi=Yi.__values__;0!==Qi.length&&"_$erialized"===Qi[Qi.length-1]||(b("The '_$erialized' prop in MissingScript is missing. Please contact jare."),b("    Error props: ['"+Qi+"']"))}catch(e){b("Error when checking MissingScript 5, "+e)}var $i=function(){function e(e,t){this._document=void 0,this._chunks=void 0,this._document=e,this._chunks=t}return l(e,[{key:"document",get:function(){return this._document}},{key:"chunks",get:function(){return this._chunks}}]),e}();function Zi(e){var t=e;return{chunks:t.chunks,document:t.document}}function en(e){if(e.length<16)throw new tn(w(13102));var t=new DataView(e.buffer,e.byteOffset,e.byteLength);if(1313817411!==t.getUint32(0,!0))throw new tn(w(13100));var i=t.getUint32(4,!0);if(1!==i)throw new tn(w(13101,i));if(t.getUint32(8,!0)!==t.byteLength)throw new tn(w(13102));var n=12,r=t.getUint32(n,!0);n+=4;var s=new Uint8Array(t.buffer,n+t.byteOffset,r);n+=r;var o,a=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);if("Buffer"in globalThis)return globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString();throw new Error(w(13104))}(s);try{o=JSON.parse(a)}catch(e){throw new tn(e)}for(var u=[];n<t.byteLength;){n%8!=0&&(n+=8-n%8);var h=t.getUint32(n,!0);n+=4,u.push(new Uint8Array(t.buffer,n+t.byteOffset,h)),n+=h}if(n!==t.byteLength)throw new tn(w(13102));return new $i(o,u)}var tn=function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(R(Error));!function(){function e(){this._viewOrPaddings=[],this._length=0}var t=e.prototype;t.alignAs=function(e){if(0!==e){var t=this._length%e;if(0!==t){var i=e-t;return this._viewOrPaddings.push(i),this._length+=i,i}}return 0},t.append=function(e){var t=this._length;return this._viewOrPaddings.push(e),this._length+=e.byteLength,t},t.get=function(){var e=new Uint8Array(this._length),t=0;return this._viewOrPaddings.forEach((function(i){"number"==typeof i?t+=i:(e.set(new Uint8Array(i.buffer,i.byteOffset,i.byteLength),t),t+=i.byteLength)})),e},l(e,[{key:"byteLength",get:function(){return this._length}}])}(),p.internal.parseCCONJson=Zi,p.internal.decodeCCONBinary=en,p.internal.CCON=$i;var nn=I.Attr.DELIMETER,rn=nn+"type",sn=nn+"default",on=nn+"formerlySerializedAs",an=function(e){function t(){return e.call(this,(function(e){e.clear()}),1)||this}return r(t,e),t}(T);an.prototype.get=function(e,t,i,n,r){var s=this._get();return s?(s.reset(e,t,i,n,r),s):new un(e,t,i,n,r)};var un=function(){function e(e,t,i,n){this.deserializedList=void 0,this.deserializedData=void 0,this._ignoreEditorOnly=void 0,this.result=e,this.customEnv=n,this.deserializedList=[],this.deserializedData=null,this._classFinder=t,this._reportMissingClass=i,this._onDereferenced=null==t?void 0:t.onDereferenced}var t=e.prototype;return t.reset=function(e,t,i,n){this.result=e,this.customEnv=n,this._classFinder=t,this._reportMissingClass=i,this._onDereferenced=null==t?void 0:t.onDereferenced},t.clear=function(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this._classFinder=null,this._reportMissingClass=null,this._onDereferenced=null},t.deserialize=function(e){var t,i=!1;e instanceof $i?(i=!0,t=e.document,e.chunks.length>0&&(D(1===e.chunks.length),this._mainBinChunk=e.chunks[0])):t=e,this._serializedData=t,this._context={fromCCON:i};var n=Array.isArray(t)?t[0]:t;return this.deserializedData=this._deserializeObject(n,0),this._serializedData=void 0,this._mainBinChunk=void 0,this._context=void 0,this.deserializedData},t._deserializeObject=function(e,t,i,n){switch(e.__type__){case"TypedArray":return this._deserializeTypedArrayView(e);case"TypedArrayRef":return this._deserializeTypedArrayViewRef(e);default:return e.__type__?this._deserializeTypeTaggedObject(e,t,i,n):Array.isArray(e)?this._deserializeArray(e):this._deserializePlainObject(e)}},t._deserializeTypedArrayView=function(e){return globalThis[e.ctor].from(e.array)},t._deserializeTypedArrayViewRef=function(e){var t=e.offset,i=e.length,n=e.ctor;return new globalThis[n](this._mainBinChunk.buffer,this._mainBinChunk.byteOffset+t,i)},t._deserializeArray=function(e){for(var t,i=new Array(e.length),n=0;n<e.length;n++)"object"==typeof(t=e[n])&&t?this._deserializeAndAssignField(i,t,""+n)&&(i[n]=null):i[n]=t;return i},t._deserializePlainObject=function(e){var t={};return this._fillPlainObject(t,e),t},t._deserializeTypeTaggedObject=function(e,t,i,n){var r=this,s=e.__type__,o=this._classFinder(s,e,i,n);if(!o)return this._classFinder===y&&this._reportMissingClass(s),null;var a=function(e){var i=new e;return t>=0&&(r.deserializedList[t]=i),i}(o);return this._deserializeInto(e,a,o),a},t._deserializeInto=function(e,t,i,n){void 0===n&&(n=!1),n||!t[x]?t._deserialize?t._deserialize(e.content,this):p.Class._isCCClass(i)?this._deserializeFireClass(t,e,i):this._deserializeFastDefinedObject(t,e,i):this._runCustomizedDeserialize(e,t,i)},t._runCustomizedDeserialize=function(e,t,i){var n=this,r={readProperty:function(t){var i=e[t];return"object"==typeof i&&i?n._deserializeObjectField(i):i},readThis:function(){n._deserializeInto(e,t,i,!0)},readSuper:function(){var r=L(i);r&&n._deserializeInto(e,t,r)}};t[x](r,this._context)},t._deserializeFireClass=function(e,t,i){var n;if(i.hasOwnProperty("__deserialize__"))n=i.__deserialize__;else{n=function(e,t){var i=C.test(E(t)),n=M(t,p.Node)||M(t,p.Component),r=!1,s=[],o=s,a=[],u=a,h=[];return function(){var e=t.__values__;r="_$erialized"===e[e.length-1];for(var n=I.Attr.getClassAttrs(t),l=0;l<e.length;l++){var f=e[l],c=f;n[f+on]&&(c=n[f+on]);var _=I.getDefault(n[f+sn]),d=n[f+rn],g=!1;if(i&&(void 0!==_||d))if(void 0===_)g=d instanceof I.Attr.PrimitiveType||d===P||d===k;else{var v=typeof _;g="string"===v||"number"===v||"boolean"===v}i&&g?(c!==f&&o===s&&(o=s.slice()),s.push(f),o!==s&&o.push(c)):(c!==f&&u===a&&(u=a.slice()),a.push(f),u!==a&&u.push(c),h.push(_ instanceof p.ValueType&&_.constructor))}}(),function(e,t,l){for(var f=0;f<s.length;++f){var c=l[o[f]];void 0!==c&&(t[s[f]]=c)}for(var p=0;p<a.length;++p){var _=a[p],d=l[u[p]];if(void 0!==d)if(i||"object"==typeof d){var g=h[p];g?i||d?e._deserializeFastDefinedObject(t[_],d,g):t[_]=null:d?e._deserializeAndAssignField(t,d,_):t[_]=null}else t[_]=d}n&&l._id&&(t._id=l._id),r&&(t._$erialized=JSON.parse(JSON.stringify(l)),e._fillPlainObject(t._$erialized,l))}}(0,i);try{if(i===Yi){var r=i.__values__;0!==r.length&&"_$erialized"===r[r.length-1]||(b("The '_$erialized' prop of MissingScript is missing. Will force the raw data to be save."),b("    Error props: ['"+r+"']. Please contact jare."));var s=n;n=function(e,t,i,n){s(e,t,i,n),t._$erialized||b("Unable to stash previously serialized data. "+JSON.stringify(i))}}}catch(e){b("Error when checking MissingScript 6, "+e)}S(i,"__deserialize__",n,!0)}n(this,e,t,i)},t._deserializeAndAssignField=function(e,t,i){var n=t.__id__;if("number"==typeof n){var r=this.deserializedList[n];if(r)e[i]=r;else{var s,o=this._serializedData[n];e[i]=this._deserializeObject(o,n,void 0,i),null===(s=this._onDereferenced)||void 0===s||s.call(this,this.deserializedList,n,e,i)}}else{var a=t.__uuid__;if(a){var u=t.__expectedType__;this.result.push(e,i,a,u)}else e[i]=this._deserializeObject(t,-1)}return!1},t._deserializeObjectField=function(e){var t=e.__id__;if("number"==typeof t){var i=this.deserializedList[t];if(i)return i;var n=this._serializedData[t];return this._deserializeObject(n,t,void 0,void 0)}if(e.__uuid__)throw e.__expectedType__,new Error("Asset reference field serialization is currently not supported in custom serialization.");return this._deserializeObject(e,-1)},t._fillPlainObject=function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];"object"!=typeof n?"__type__"!==i&&(e[i]=n):n?this._deserializeAndAssignField(e,n,i)&&(e[i]=null):e[i]=null}},t._deserializeFastDefinedObject=function(e,t,i){if(i===p.Vec2)return e.x=t.x||0,void(e.y=t.y||0);if(i===p.Vec3)return e.x=t.x||0,e.y=t.y||0,void(e.z=t.z||0);if(i!==p.Color){if(i===p.Size)return e.width=t.width||0,void(e.height=t.height||0);for(var n=I.Attr.getClassAttrs(i),r=i.__values__,s=0;s<r.length;s++){var o=r[s],a=t[o];void 0!==a||t.hasOwnProperty(o)||(a=I.getDefault(n[o+sn])),"object"!=typeof a?e[o]=a:a?this._deserializeAndAssignField(e,a,o):e[o]=null}}else{e.r=t.r||0,e.g=t.g||0,e.b=t.b||0;var u=t.a;e.a=void 0===u?255:u}},l(e,[{key:"ignoreEditorOnly",get:function(){return this._ignoreEditorOnly}}]),e}();un.pool=new an;var hn=[O,N,F,H,G,z,U,j];function ln(e,t){e.x=t[1],e.y=t[2],e.z=t[3],e.w=t[4]}var fn=[function(e,t){e.x=t[1],e.y=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.z=t[3]},ln,ln,function(e,t){e._val=t[1]},function(e,t){e.width=t[1],e.height=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.width=t[3],e.height=t[4]},function(e,t){j.fromArray(e,t,1)}],cn=e("Y",function(){function e(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}var t=e.prototype;return t.init=function(e){e?(this.uuidObjList=e[8],this.uuidPropList=e[9],this.uuidList=e[10]):this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])},t.reset=function(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)},t.push=function(e,t,i,n){this.uuidObjList.push(e),this.uuidPropList.push(t),this.uuidList.push(i),this.uuidTypeList.push(n||"")},e}());function pn(e,t){for(var i=e[4][t[0]],n=i[0],r=new(0,n[0]),s=n[1],o=n[2],a=i[i.length-1],u=1;u<a;++u)r[s[i[u]]]=t[u];for(;u<t.length;++u){var h=s[i[u]],l=n[i[u]+o];(0,yn[l])(e,r,h,t[u])}return r}function _n(e,t,i){var n=new t;return n._deserialize?n._deserialize(i,e[0]):d(5303,V(t)),n}function dn(e,t,i,n){n>=0?t[i]=e[5][n]:e[7][3*~n]=t}function gn(e){return function(t,i,n,r){for(var s=0;s<r.length;++s)e(t,r,s,r[s]);i[n]=r}}function vn(e,t,i,n){t[i]=null,e[8][n]=t}function mn(e,t,i,n){t[i]=pn(e,n)}cn.pool=new T((function(e){e.reset()}),5),cn.pool.get=function(){return this._get()||new cn};var yn=new Array(13);function bn(e,t,i){return e||i(t),Object}function An(e,t,i,n,r,s,o){var a,u,h,l=e(t);if(!l){if(r)return void(i[n]=(a=i,u=n,h=t,function(){var t=e(h)||bn(s,h,o);return a[u]=t,new t}));l=bn(s,t,o)}i[n]=l}function Rn(e,t,i,n){for(var r=i||y,s=e[3],o=0;o<s.length;++o){var a=s[o];"string"!=typeof a?An(r,a[0],a,0,t,i,n):An(r,a,s,o,t,i,n)}}function wn(e){var t=e[4];if(t)for(var i=e[3],n=0;n<t.length;++n){var r=t[n];r[0]=i[r[0]]}}function In(e,t,i){"string"==typeof e&&(e=JSON.parse(e));var n,r=!t;if(t=t||cn.pool.get(),function(e){if(Array.isArray(e)){var t=e[0];return"number"==typeof t||t instanceof Tn}return!1}(e)){t.init(e),i=i||{};var s,o=e[0],u=!1;if("object"==typeof o&&(u=o.preprocessed,o=o.version),o<1)throw new Error(w(5304,o));i._version=o,i.result=t,e[0]=i,u||(Rn(e,!1,i.classFinder,null!==(s=i.reportMissingClass)&&void 0!==s?s:In.reportMissingClass),wn(e)),p.game._isCloning=!0;var h=e[5],l=function(e){var t=e[5],i=e[6],n=0===i?0:i.length,r=t[t.length-1],s=t.length-n;"number"!=typeof r?r=0:(r<0&&(r=~r),--s);for(var o=0;o<s;++o)t[o]=pn(e,t[o]);for(var a=e[3],u=0;u<n;++u,++o){var h=i[u],l=t[o];if(h>=0){var f=a[h];t[o]=_n(e,f,l)}else(0,yn[h=~h])(e,t,o,l)}return r}(e);p.game._isCloning=!1,e[7]&&function(e,t,i){for(var n=e.length-1,r=0,s=3*e[n];r<s;r+=3){var o=e[r],a=t[e[r+2]],u=e[r+1];u>=0?o[i[u]]=a:o[~u]=a}for(;r<n;r+=3){var h=t[e[r]],l=t[e[r+2]],f=e[r+1];f>=0?h[i[f]]=l:h[~f]=l}}(e[7],h,e[2]),function(e){for(var t=e[5],i=e[2],n=e[1],r=e[8],s=e[9],o=e[10],a=0;a<r.length;++a){var u=r[a];"number"==typeof u&&(r[a]=t[u]);var h=s[a];"number"==typeof h&&(h=h>=0?i[h]:~h,s[a]=h);var l=o[a];"number"==typeof l&&(o[a]=n[l])}}(e),n=h[l]}else n=function(e,t,i){var n,r=(i=i||{}).classFinder||y,s=i.createAssetRefs||a.platform===B.EDITOR_CORE,o=i.customEnv,u=i.ignoreEditorOnly,h=null!==(n=i.reportMissingClass)&&void 0!==n?n:p.deserialize.reportMissingClass;t.init();var l=un.pool.get(t,r,h,o,u);p.game._isCloning=!0;var f=l.deserialize(e);return p.game._isCloning=!1,un.pool.put(l),s&&t.assignAssetsBy((function(e,t){return EditorExtends.serialize.asAsset(e,t.type)})),f}(e,t,i);return r&&cn.pool.put(t),n}yn[0]=function(e,t,i,n){t[i]=n},yn[1]=dn,yn[2]=gn(dn),yn[3]=gn(vn),yn[4]=mn,yn[5]=function(e,t,i,n){fn[n[0]](t[i],n)},yn[6]=vn,yn[7]=function(e,t,i,n){t[i].set(n)},yn[8]=function(e,t,i,n){var r=new hn[n[0]];fn[n[0]](r,n),t[i]=r},yn[9]=gn(mn),yn[10]=function(e,t,i,n){var r=e[3][n[0]];t[i]=_n(e,r,n[1])},yn[11]=function(e,t,i,n){var r=n[0];t[i]=r;for(var s=1;s<n.length;s+=3){var o=n[s],a=n[s+1],u=n[s+2];(0,yn[a])(e,r,o,u)}},yn[12]=function(e,t,i,n){for(var r=n[0],s=0;s<r.length;++s){var o=r[s],a=n[s+1];0!==a&&(0,yn[a])(e,r,s,o)}t[i]=r},In.Details=cn,In.reportMissingClass=function(e){d(5302,e)};var Tn=function(e){this.preprocessed=!0,this.version=e};function Dn(e,t,i){return[1,0,0,[e],0,i?[t,-1]:[t],[0],0,[],[],[]]}p.deserialize=In;var xn=new WeakMap,Sn=new WeakSet,Cn=new WeakSet;function En(e,t){var i;i=Yi.safeFindClass;var n,r=cn.pool.get();try{n=In(e,r,{classFinder:i,customEnv:t})}catch(e){throw b(e),cn.pool.put(r),e}n._uuid=t.__uuid__||"";for(var s=r.uuidList,o=r.uuidObjList,a=r.uuidPropList,u=r.uuidTypeList||[],h=[],l=0;l<s.length;l++){var f=s[l];h[l]={uuid:Zt(f),owner:o[l],prop:a[l],type:y(u[l])}}return xn.set(n,h),n._native&&Sn.add(n),cn.pool.put(r),n}var Mn=function(){function e(){this._depends=new ii}var t=e.prototype;return t.init=function(){this._depends.clear()},t.getNativeDep=function(e){var t=this._depends.get(e);return t&&t.nativeDep?W({},t.nativeDep):null},t.getDeps=function(e){return this._depends.has(e)?this._depends.get(e).deps:[]},t.getDepsRecursively=function(e){var t=Object.create(null),i=[];return this._descend(e,t,i),i},t.remove=function(e){this._depends.remove(e)},t.parse=function(e,t){var i,n,r=null;if(Array.isArray(t)||t.__type__||t instanceof $i){if(this._depends.has(e))return this._depends.get(e);if(!Array.isArray(t)||"number"==typeof(n=(i=t[5])[i.length-1])&&n<0)try{var s=En(t,{__uuid__:e});(r=this._parseDepsFromAsset(s)).nativeDep&&(r.nativeDep.uuid=e),ei.add(e+"@import",s)}catch(t){ti.remove(e+"@import"),r={deps:[]}}else r={deps:this._parseDepsFromJson(t)}}else{if(this._depends.has(e)&&(r=this._depends.get(e)).parsedFromExistAsset)return r;r=this._parseDepsFromAsset(t)}return this._depends.add(e,r),r},t._parseDepsFromAsset=function(e){for(var t={deps:[],parsedFromExistAsset:!0},i=xn.get(e),n=0,r=i.length;n<r;n++)t.deps.push(i[n].uuid);return Sn.has(e)&&(t.nativeDep=e._nativeDep),t},t._parseDepsFromJson=function(e){var t=function(e){return i=(t=e)[1],t[10].map((function(e){return i[e]}));var t,i}(e);return t.forEach((function(e,i){return t[i]=Zt(e)})),t},t._descend=function(e,t,i){for(var n=this.getDeps(e),r=0;r<n.length;r++){var s=n[r];t[s]||(t[s]=!0,i.push(s),this._descend(s,t,i))}},l(e,null,[{key:"instance",get:function(){return this._instance||(this._instance=new e),this._instance}}]),e}();Mn._instance=void 0;var Pn,kn=e("al",Mn.instance),Ln=[new it];function Bn(e){return e&&0==(e&e-1)}var On,Nn,Fn,Hn,Gn,zn=n("cc.SimpleTexture")(Pn=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._gfxTexture=null,t._gfxTextureView=null,t._mipmapLevel=1,t._textureWidth=0,t._textureHeight=0,t._baseLevel=0,t._maxLevel=1e3,t}r(t,e);var i=t.prototype;return i.getGFXTexture=function(){return this._gfxTextureView},i.destroy=function(){return this._tryDestroyTextureView(),this._tryDestroyTexture(),e.prototype.destroy.call(this)},i.updateImage=function(){this.updateMipmaps(0)},i.updateMipmaps=function(){},i.uploadData=function(e,t,i){if(void 0===t&&(t=0),void 0===i&&(i=0),this._gfxTexture&&!(this._mipmapLevel<=t)){var n=this._getGFXDevice();if(n){var r=Ln[0];r.texExtent.width=this._textureWidth>>t,r.texExtent.height=this._textureHeight>>t,r.texSubres.mipLevel=t,r.texSubres.baseArrayLayer=i,ArrayBuffer.isView(e)?n.copyBuffersToTexture([e],this._gfxTexture,Ln):n.copyTexImagesToTexture([e],this._gfxTexture,Ln)}}},i._assignImage=function(e,t,i){var n=e.data;if(n&&(this.uploadData(n,t,i),this._checkTextureLoaded(),o.CLEANUP_IMAGE_CACHE)){var r=kn.getDeps(this._uuid),s=r.indexOf(e._uuid);-1!==s&&(X(r,s),e.decRef())}},i._checkTextureLoaded=function(){this._textureReady()},i._textureReady=function(){this.loaded=!0,this.emit("load")},i._setMipmapLevel=function(e){this._mipmapLevel=e<1?1:e},i._setMipRange=function(e,t){this._baseLevel=e<1?0:e,this._maxLevel=t<1?0:t},i.setMipRange=function(e,t){q(e<=t,3124),this._setMipRange(e,t);var i=this._getGFXDevice();if(i){var n=this._createTextureView(i);this._tryDestroyTextureView(),this._gfxTextureView=n}},i._getGfxTextureCreateInfo=function(){return null},i._getGfxTextureViewCreateInfo=function(){return null},i._tryReset=function(){if(this._tryDestroyTextureView(),this._tryDestroyTexture(),0!==this._mipmapLevel){var e=this._getGFXDevice();e&&(this._createTexture(e),this._gfxTextureView=this._createTextureView(e))}},i.isUsingOfflineMipmaps=function(){return!1},i._createTexture=function(e){if(0!==this._width&&0!==this._height){var t=et.NONE;this._mipFilter!==Ti.NONE&&function(e,t,i){return!(e.gfxAPI===nt.WEBGL)||Bn(t)&&Bn(i)}(e,this._width,this._height)&&(this._mipmapLevel=function(e,t){for(var i=Math.max(e,t),n=0;i;)i>>=1,n++;return n}(this._width,this._height),this.isUsingOfflineMipmaps()||this.isCompressed||(t=et.GEN_MIPMAP));var i=this._getGfxTextureCreateInfo({usage:tt.SAMPLED|tt.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:t});if(i){var n=e.createTexture(i);this._textureWidth=i.width,this._textureHeight=i.height,this._gfxTexture=n}}},i._createTextureView=function(e){if(!this._gfxTexture)return null;var t=this._maxLevel<this._mipmapLevel?this._maxLevel:this._mipmapLevel-1,i=this._getGfxTextureViewCreateInfo({texture:this._gfxTexture,format:this._getGFXFormat(),baseLevel:this._baseLevel,levelCount:t-this._baseLevel+1});return i?e.createTexture(i):null},i._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},i._tryDestroyTextureView=function(){this._gfxTextureView&&(this._gfxTextureView.destroy(),this._gfxTextureView=null)},l(t,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),t}(Ji))||Pn;p.SimpleTexture=zn;var Un,jn,Vn,Wn,Xn,qn,Kn,Jn,Yn,Qn=e("a3",(On=n("cc.Texture2D"),Nn=K([Vi]),On((Hn=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._mipmaps=Gn&&Gn(),t._generatedMipmaps=[],t}r(t,e);var i=t.prototype;return i._setMipmapParams=function(e){var t=this;if(this._generatedMipmaps=e,this._setMipmapLevel(this._generatedMipmaps.length),this._generatedMipmaps.length>0){var i=this._generatedMipmaps[0];this.reset({width:i.width,height:i.height,format:i.format,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._generatedMipmaps.forEach((function(e,i){t._assignImage(e,i)}))}else this.reset({width:0,height:0,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})},i.initialize=function(){this.mipmaps=this._mipmaps},i.onLoaded=function(){this.initialize()},i.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format);var t=void 0===e.mipmapLevel?1:e.mipmapLevel;this._setMipmapLevel(t);var i=void 0===e.baseLevel?0:e.baseLevel,n=void 0===e.maxLevel?1e3:e.maxLevel;this._setMipRange(i,n),this._tryReset()},i.create=function(e,t,i,n,r,s){void 0===i&&(i=wi.RGBA8888),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=1e3),this.reset({width:e,height:t,format:i,mipmapLevel:n,baseLevel:r,maxLevel:s})},i.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},i.updateMipmaps=function(e,t){if(void 0===e&&(e=0),!(e>=this._generatedMipmaps.length))for(var i=Math.min(void 0===t?this._generatedMipmaps.length:t,this._generatedMipmaps.length-e),n=0;n<i;++n){var r=e+n;this._assignImage(this._generatedMipmaps[r],r)}},i.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},i.destroy=function(){return this._mipmaps=[],this._generatedMipmaps=[],e.prototype.destroy.call(this)},i.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},i.releaseTexture=function(){this.destroy()},i._serialize=function(){return null},i._deserialize=function(t,i){var n=t;e.prototype._deserialize.call(this,n.base,i),this._mipmaps=new Array(n.mipmaps.length);for(var r=0;r<n.mipmaps.length;++r)if(this._mipmaps[r]=new Vi,n.mipmaps[r]){var s=n.mipmaps[r];i.result.push(this._mipmaps,""+r,s,E(Vi))}},i._getGfxTextureCreateInfo=function(e){var t=new rt(st.TEX2D);return t.width=this._width,t.height=this._height,Object.assign(t,e),t},i._getGfxTextureViewCreateInfo=function(e){var t=new ot;return t.type=st.TEX2D,Object.assign(t,e),t},i.initDefault=function(t){e.prototype.initDefault.call(this,t);var i=new Vi;i.initDefault(),this.image=i},i.validate=function(){return this.mipmaps&&0!==this.mipmaps.length},l(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){this._mipmaps=e;var t=[];if(1===e.length){var i=e[0];t.push.apply(t,i.extractMipmaps())}else if(e.length>1)for(var n=0;n<e.length;++n){var r=e[n];t.push(r.extractMipmap0())}this._setMipmapParams(t)}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(zn),Gn=g(Hn.prototype,"_mipmaps",[Nn],(function(){return[]})),Fn=Hn))||Fn));p.Texture2D=Qn,function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom",e[e.front=4]="front",e[e.back=5]="back"}(Jn||(Jn={})),function(e){e[e.NONE=0]="NONE",e[e.AUTO=1]="AUTO",e[e.BAKED_CONVOLUTION_MAP=2]="BAKED_CONVOLUTION_MAP"}(Yn||(Yn={}));var $n=e("a4",n("cc.TextureCube")(((Kn=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).isRGBE=Vn&&Vn(),t._mipmapAtlas=Wn&&Wn(),t._mipmapMode=Xn&&Xn(),t._mipmaps=qn&&qn(),t._generatedMipmaps=[],t}r(t,e);var i=t.prototype;return i._setMipmapParams=function(e){var t=this;if(this._generatedMipmaps=e,this._setMipmapLevel(this._generatedMipmaps.length),this._generatedMipmaps.length>0){var i=this._generatedMipmaps[0].front;this.reset({width:i.width,height:i.height,format:i.format,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._generatedMipmaps.forEach((function(e,i){Zn(e,(function(e,n){t._assignImage(e,i,n)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})},i.isUsingOfflineMipmaps=function(){return this._mipmapMode===Yn.BAKED_CONVOLUTION_MAP},t.fromTexture2DArray=function(e,i){for(var n=[],r=e.length/6,s=0;s<r;s++){var o=6*s;n.push({front:e[o+Jn.front].image,back:e[o+Jn.back].image,left:e[o+Jn.left].image,right:e[o+Jn.right].image,top:e[o+Jn.top].image,bottom:e[o+Jn.bottom].image})}return(i=i||new t).mipmaps=n,i},i.onLoaded=function(){this._mipmapMode===Yn.BAKED_CONVOLUTION_MAP?this.mipmapAtlas=this._mipmapAtlas:this.mipmaps=this._mipmaps},i.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format);var t=void 0===e.mipmapLevel?1:e.mipmapLevel;this._setMipmapLevel(t);var i=void 0===e.baseLevel?0:e.baseLevel,n=void 0===e.maxLevel?1e3:e.maxLevel;this._setMipRange(i,n),this._tryReset()},i.updateMipmaps=function(e,t){var i=this;if(void 0===e&&(e=0),!(e>=this._generatedMipmaps.length))for(var n=Math.min(void 0===t?this._generatedMipmaps.length:t,this._generatedMipmaps.length-e),r=function(){var t=e+s;Zn(i._generatedMipmaps[t],(function(e,n){i._assignImage(e,t,n)}))},s=0;s<n;++s)r()},i.destroy=function(){return this._mipmaps=[],this._generatedMipmaps=[],this._mipmapAtlas=null,e.prototype.destroy.call(this)},i.releaseTexture=function(){this.destroy()},i._serialize=function(){return null},i._deserialize=function(t,i){var n=t;if(e.prototype._deserialize.call(this,n.base,i),this.isRGBE=n.rgbe,this._mipmapMode=n.mipmapMode,this._mipmapMode===Yn.BAKED_CONVOLUTION_MAP){var r=n.mipmapAtlas,s=n.mipmapLayout;this._mipmapAtlas={atlas:{},layout:s},this._mipmapAtlas.atlas={front:new Vi,back:new Vi,left:new Vi,right:new Vi,top:new Vi,bottom:new Vi};var o=E(Vi);i.result.push(this._mipmapAtlas.atlas,"front",r.front,o),i.result.push(this._mipmapAtlas.atlas,"back",r.back,o),i.result.push(this._mipmapAtlas.atlas,"left",r.left,o),i.result.push(this._mipmapAtlas.atlas,"right",r.right,o),i.result.push(this._mipmapAtlas.atlas,"top",r.top,o),i.result.push(this._mipmapAtlas.atlas,"bottom",r.bottom,o)}else{this._mipmaps=new Array(n.mipmaps.length);for(var a=0;a<n.mipmaps.length;++a){this._mipmaps[a]={front:new Vi,back:new Vi,left:new Vi,right:new Vi,top:new Vi,bottom:new Vi};var u=n.mipmaps[a],h=E(Vi);i.result.push(this._mipmaps[a],"front",u.front,h),i.result.push(this._mipmaps[a],"back",u.back,h),i.result.push(this._mipmaps[a],"left",u.left,h),i.result.push(this._mipmaps[a],"right",u.right,h),i.result.push(this._mipmaps[a],"top",u.top,h),i.result.push(this._mipmaps[a],"bottom",u.bottom,h)}}},i._getGfxTextureCreateInfo=function(e){var t=new rt(st.CUBE);return t.width=this._width,t.height=this._height,t.layerCount=6,Object.assign(t,e),t},i._getGfxTextureViewCreateInfo=function(e){var t=new ot;return t.type=st.CUBE,t.baseLayer=0,t.layerCount=6,Object.assign(t,e),t},i._uploadAtlas=function(){var e=this,t=this._mipmapAtlas.layout,i=t[0];this.reset({width:i.width,height:i.height,format:this._mipmapAtlas.atlas.front.format,mipmapLevel:t.length}),Zn(this._mipmapAtlas.atlas,(function(i,n){var r=new Qn;r.image=i,r.reset({width:i.width,height:i.height,format:i.format}),r.uploadData(i.data);for(var s=0;s<t.length;s++){var o=t[s],a=r.getGFXTexture().size,u=new Uint8Array(a),h=new it;h.texOffset.x=o.left,h.texOffset.y=o.top,h.texExtent.width=o.width,h.texExtent.height=o.height,e._getGFXDevice().copyTextureToBuffers(r.getGFXTexture(),[u],[h]);var l=new Vi({_data:u,_compressed:i.isCompressed,width:o.width,height:o.height,format:i.format});e._assignImage(l,o.level,n)}}))},i.initDefault=function(t){e.prototype.initDefault.call(this,t);var i=new Vi;i.initDefault(),this.mipmaps=[{front:i,back:i,top:i,bottom:i,left:i,right:i}]},i.validate=function(){if(this._mipmapMode===Yn.BAKED_CONVOLUTION_MAP){if(null===this.mipmapAtlas||0===this.mipmapAtlas.layout.length)return!1;var e=this.mipmapAtlas.atlas;return!!(e.top&&e.bottom&&e.front&&e.back&&e.left&&e.right)}return 0!==this._mipmaps.length&&!this._mipmaps.find((function(e){return!(e.top&&e.bottom&&e.front&&e.back&&e.left&&e.right)}))},l(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){this._mipmaps=e;var t=[];if(1===e.length){var i=e[0],n=i.front.extractMipmaps(),r=i.back.extractMipmaps(),s=i.left.extractMipmaps(),o=i.right.extractMipmaps(),a=i.top.extractMipmaps(),u=i.bottom.extractMipmaps();if(n.length!==r.length||n.length!==s.length||n.length!==o.length||n.length!==a.length||n.length!==u.length)return console.error("The number of mipmaps of each face is different."),void this._setMipmapParams([]);for(var h=n.length,l=0;l<h;++l){var f={front:n[l],back:r[l],left:s[l],right:o[l],top:a[l],bottom:u[l]};t.push(f)}}else e.length>1&&e.forEach((function(e){var i={front:e.front.extractMipmap0(),back:e.back.extractMipmap0(),left:e.left.extractMipmap0(),right:e.right.extractMipmap0(),top:e.top.extractMipmap0(),bottom:e.bottom.extractMipmap0()};t.push(i)}));this._setMipmapParams(t)}},{key:"mipmapAtlas",get:function(){return this._mipmapAtlas},set:function(e){var t=this;if(this._mipmapAtlas=e,this._mipmapAtlas){var i=this._mipmapAtlas.atlas.front;if(i.data)if(a.os===J.IOS||Y||Q)this._uploadAtlas();else{var n=this._mipmapAtlas.atlas,r=this._mipmapAtlas.layout,s=r[0],o=Object.assign(h.document.createElement("canvas"),{width:i.width,height:i.height}).getContext("2d");this.reset({width:s.width,height:s.height,format:i.format,mipmapLevel:r.length});for(var u=function(){var e=r[l];Zn(n,(function(n,r){o.clearRect(0,0,i.width,i.height);var s=n.data;o.drawImage(s,0,0);var a=o.getImageData(e.left,e.top,e.width,e.height),u=new Vi({_data:a.data,_compressed:n.isCompressed,width:a.width,height:a.height,format:n.format});t._assignImage(u,e.level,r)}))},l=0;l<r.length;l++)u()}}else this.reset({width:0,height:0,mipmapLevel:0})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(zn)).FaceIndex=Jn,Vn=g((jn=Kn).prototype,"isRGBE",[v],(function(){return!1})),Wn=g(jn.prototype,"_mipmapAtlas",[v],(function(){return null})),Xn=g(jn.prototype,"_mipmapMode",[v],(function(){return Yn.NONE})),qn=g(jn.prototype,"_mipmaps",[v],(function(){return[]})),Un=jn))||Un);function Zn(e,t){t(e.front,Jn.front),t(e.back,Jn.back),t(e.left,Jn.left),t(e.right,Jn.right),t(e.top,Jn.top),t(e.bottom,Jn.bottom)}p.TextureCube=$n;var er=function(){function e(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new ii,this.scenes=new ii,this.paths=new ii}var t=e.prototype;return t.init=function(e){var t=this;!function(e){var t=e.uuids,i=e.paths,n=e.types,r=e.deps,s=e.paths=Object.create(null);if(!1===e.debug){for(var o=0,a=t.length;o<a;o++)t[o]=Zt(t[o]);for(var u in i){var h=i[u],l=h[1];h[1]=n[l]}}else{for(var f=Object.create(null),c=0,p=t.length;c<p;c++){var _=t[c];t[c]=f[_]=Zt(_)}t=f}for(var d in i){var g=i[d];s[t[d]]=g}var v=e.scenes;for(var m in v){var y=v[m];v[m]=t[y]}var b=e.packs;for(var A in b)for(var R=b[A],w=0;w<R.length;++w)R[w]=t[R[w]];var I=e.versions;if(I)for(var T in I)for(var D=I[T],x=0;x<D.length;x+=2){var S=D[x];D[x]=t[S]||S}var C=e.redirect;if(C)for(var E=0;E<C.length;E+=2)C[E]=t[C[E]],C[E+1]=r[C[E+1]];if(e.extensionMap){var M=function(i){if(!Object.prototype.hasOwnProperty.call(e.extensionMap,i))return"continue";e.extensionMap[i].forEach((function(n,r){e.extensionMap[i][r]=t[n]||n}))};for(var P in e.extensionMap)M(P)}}(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect);var i=function(i){if(!Object.prototype.hasOwnProperty.call(e.extensionMap,i))return"continue";e.extensionMap[i].forEach((function(e){var n=t.assetInfos.get(e);n&&(n.extension=i)}))};for(var n in e.extensionMap)i(n)},t.getInfoWithPath=function(e,t){if(!e)return null;e=ni(e);var i=this.paths.get(e);if(i){if(!t)return i[0];for(var n=0,r=i.length;n<r;n++){var s=i[n];if(M(s.ctor,t))return s}}return null},t.getDirWithPath=function(e,t,i){"/"===(e=ni(e))[e.length-1]&&(e=e.slice(0,-1));var n=i||[];return this.paths.forEach((function(i,r){if(r.startsWith(e)&&function(e,t){return!(e.length>t.length)||47===e.charCodeAt(t.length)}(r,e)||!e)for(var s=0,o=i.length;s<o;s++){var a=i[s];t&&!M(a.ctor,t)||n.push(a)}})),n},t.getAssetInfo=function(e){return this.assetInfos.get(e)||null},t.getSceneInfo=function(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e="/"+e),this.scenes.find((function(t,i){return i.endsWith(e)}))},t.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},t._initUuid=function(e){if(e){this.assetInfos.clear();for(var t=0,i=e.length;t<i;t++){var n=e[t];this.assetInfos.add(n,{uuid:n})}}},t._initPath=function(e){if(e){var t=this.paths;for(var i in t.clear(),e){var n=e[i],r=n[0],s=n[1],o=3===n.length,a=this.assetInfos.get(i);a.path=r,a.ctor=y(s),t.has(r)?o?t.get(r).push(a):t.get(r).unshift(a):t.add(r,[a])}}},t._initScene=function(e){if(e){var t=this.scenes;t.clear();var i=this.assetInfos;for(var n in e){var r=e[n],s=i.get(r);s.url=n,t.add(n,s)}}},t._initPackage=function(e){if(e){var t=this.assetInfos;for(var i in e){var n=e[i],r={uuid:i,packedUuids:n,ext:".json"};t.add(i,r);for(var s=0,o=n.length;s<o;s++){var a=n[s],u=t.get(a),h=u.packs;h?1===o?h.unshift(r):h.push(r):u.packs=[r]}}}},t._initVersion=function(e){if(e){var t=this.assetInfos,i=e.import;if(i)for(var n=0,r=i.length;n<r;n+=2){var s=i[n];t.get(s).ver=i[n+1]}if(i=e.native)for(var o=0,a=i.length;o<a;o+=2){var u=i[o];t.get(u).nativeVer=i[o+1]}}},t._initRedirect=function(e){if(e)for(var t=this.assetInfos,i=0,n=e.length;i<n;i+=2){var r=e[i];t.get(r).redirect=e[i+1]}},e}();function tr(e,t){e._uuid&&t.push(e._uuid)}function ir(e,t){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n];if("node"!==r&&"__eventTargets"!==r){var s=e[r];if("object"==typeof s&&s)if(Array.isArray(s))for(var o=0;o<s.length;o++){var a=s[o];a instanceof Qt&&tr(a,t)}else if(s.constructor&&s.constructor!==Object)s instanceof Qt&&tr(s,t);else for(var u=Object.getOwnPropertyNames(s),h=0;h<u.length;h++){var l=s[u[h]];l instanceof Qt&&tr(l,t)}}}}function nr(e,t){for(var i=0;i<e._components.length;i++)ir(e._components[i],t);for(var n=0;n<e._children.length;n++)nr(e._children[n],t)}function rr(e,t,i,n){i.push(e._uuid);for(var r=kn.getDeps(e._uuid),s=0,o=r.length;s<o;s++){var a=ri.get(r[s]);if(a){var u=a._uuid;u in t?t[u]+=n:t[u]=a.refCount+n,i.includes(u)||rr(a,t,i,n)}}}var sr=[],or=function(){function e(){this._persistNodeDeps=new ii,this._toDelete=new ii,this._eventListener=!1,this._dontDestroyAssets=[]}var t=e.prototype;return t.addIgnoredAsset=function(e){this._dontDestroyAssets.push(e._uuid)},t.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},t._addPersistNodeRef=function(e){var t=[];nr(e,t);for(var i=0,n=t.length;i<n;i++){var r=ri.get(t[i]);r&&r.addRef()}this._persistNodeDeps.add(e.uuid,t)},t._removePersistNodeRef=function(e){if(this._persistNodeDeps.has(e.uuid)){for(var t=this._persistNodeDeps.get(e.uuid),i=0,n=t.length;i<n;i++){var r=ri.get(t[i]);r&&r.decRef()}this._persistNodeDeps.remove(e.uuid)}},t._autoRelease=function(e,t,i){if(e){for(var n=kn.getDeps(e.uuid),r=0,o=n.length;r<o;r++){var a=ri.get(n[r]);a&&a.decRef(e.autoReleaseAssets)}var u=kn._depends.get(e.uuid);if(u&&u.persistDeps)for(var h=u.persistDeps,l=0,f=h.length;l<f;l++){var c=ri.get(h[l]);c&&c.decRef(e.autoReleaseAssets)}e.uuid!==t.uuid&&kn.remove(e.uuid)}var p=kn._depends.get(t.uuid);for(var _ in p&&(p.persistDeps=[]),i){for(var d,g,v=i[_],m=this._persistNodeDeps.get(v.uuid),y=s(m);!(g=y()).done;){var b=g.value,A=ri.get(b);A&&A.addRef()}p&&(d=p.persistDeps).push.apply(d,m)}},t.tryRelease=function(e,t){void 0===t&&(t=!1),e instanceof Qt&&(t?this._free(e,t):(this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,$(this._freeAssets.bind(this)))))},t._freeAssets=function(){var e=this;this._eventListener=!1,this._toDelete.forEach((function(t){e._free(t)})),this._toDelete.clear()},t._free=function(e,t){void 0===t&&(t=!1);var i=e._uuid;if(this._toDelete.remove(i),Z(e,!0)&&-1===this._dontDestroyAssets.indexOf(i)&&!(!t&&e.refCount>0&&function(e){var t=Object.create(null);if(t[e._uuid]=e.refCount,rr(e,t,sr,-1),sr.length=0,0!==t[e._uuid])return t[e._uuid];for(var i in t)0!==t[i]&&rr(ri.get(i),t,sr,1);return sr.length=0,t[e._uuid]}(e)>0)){ri.remove(i);for(var n=kn.getDeps(i),r=0,s=n.length;r<s;r++){var o=ri.get(n[r]);o&&(o.decRef(!1),this._free(o,!1))}e.destroy(),kn.remove(i)}},e}(),ar=e("ao",new or),ur=null;function hr(e,t){for(var i=0,n=e.input.length;i<n;i++){var r=e.input[i];t&&!r.isNative&&r.content instanceof Qt&&r.content.decRef(!1),r.recycle()}e.input=null}function lr(e,t){return t?/\?/.test(e)?e+"&_t="+Date.now():e+"?_t="+Date.now():e}function fr(e,t,i,n,r){void 0===r&&(r=0),e(r,(function(s,o){r++,!s||r>t?n&&n(s,o):setTimeout((function(){fr(e,t,i,n,r)}),i)}))}function cr(e,t,i,n,r){try{for(var s=kn.parse(e,t),o=0,a=s.deps.length;o<a;o++){var u=s.deps[o];u in i||(i[u]=!0,n.push({uuid:u,bundle:r&&r.name}))}s.nativeDep&&(r&&(s.nativeDep.bundle=r.name),n.push(W({},s.nativeDep)))}catch(e){b(e.message,e.stack)}}function pr(e,t,i){t&&(i=void 0!==i?i:p.assetManager.cacheAsset,si(t)||!i||t.isDefault||ri.add(e,t))}function _r(e,t,i){var n=0,r=[],s=e.length;0===s&&i&&i(r);for(var o=function(e){e&&r.push(e),++n===s&&i&&i(r)},a=0;a<s;a++)t(e[a],o)}function dr(e,t,i){var n=e,r=t,s=i;if(void 0===i){var o="function"==typeof e;t?(s=t,o||(r=null)):void 0===t&&o&&(s=e,n=null,r=null),void 0!==t&&o&&(r=e,n=null)}return{options:n||Object.create(null),onProgress:r,onComplete:s}}function gr(e,t,i){var n=e,r=t,s=i;if(void 0===i){var o=M(e,Qt);t?(s=t,o&&(r=null)):void 0!==t||o||(s=e,r=null,n=null),void 0===t||o||(r=e,n=null)}return{type:n,onProgress:r||ur,onComplete:s}}function vr(e,t,i,n){if(void 0===n&&(n={}),!i[t]||n[t])return!1;n[t]=!0;var r=!1,s=kn.getDeps(t);if(s)for(var o=0,a=s.length;o<a;o++){var u=s[o];if(u===e||vr(e,u,i,n)){r=!0;break}}return r}function mr(e){return function(t,i){if(e){var n=[];Array.isArray(i)?i.forEach((function(e){return e instanceof Qt&&n.push(e.addRef())})):i instanceof Qt&&n.push(i.addRef()),$((function(){n.forEach((function(e){return e.decRef(!1)})),e(t,i)}))}}}var yr=function(){function e(){this._config=new er}var t=e.prototype;return t.getInfoWithPath=function(e,t){return this._config.getInfoWithPath(e,t)},t.getDirWithPath=function(e,t,i){return this._config.getDirWithPath(e,t,i)},t.getAssetInfo=function(e){return this._config.getAssetInfo(e)},t.getSceneInfo=function(e){return this._config.getSceneInfo(e)},t.init=function(e){this._config.init(e),oi.add(e.name,this)},t.load=function(e,t,i,n){var r=gr(t,i,n),s=r.type,o=r.onProgress,a=r.onComplete,u={__requestType__:ai.PATH,type:s,bundle:this.name,__outputAsArray__:Array.isArray(e)};p.assetManager.loadAny(e,u,o,a)},t.preload=function(e,t,i,n){var r=gr(t,i,n),s=r.type,o=r.onProgress,a=r.onComplete;p.assetManager.preloadAny(e,{__requestType__:ai.PATH,type:s,bundle:this.name},o,a)},t.loadDir=function(e,t,i,n){var r=gr(t,i,n),s=r.type,o=r.onProgress,a=r.onComplete;p.assetManager.loadAny(e,{__requestType__:ai.DIR,type:s,bundle:this.name,__outputAsArray__:!0},o,a)},t.preloadDir=function(e,t,i,n){var r=gr(t,i,n),s=r.type,o=r.onProgress,a=r.onComplete;p.assetManager.preloadAny(e,{__requestType__:ai.DIR,type:s,bundle:this.name},o,a)},t.loadScene=function(e,t,i,n){var r=dr(t,i,n),s=r.options,o=r.onProgress,a=r.onComplete;s.preset=s.preset||"scene",s.bundle=this.name,p.assetManager.loadAny({scene:e},s,o,(function(e,t){if(e)b(e.message,e.stack);else if(t.scene){var i=t.scene;i._id=t._uuid,i.name=t.name}else e=new Error("The asset "+t._uuid+" is not a scene");a&&a(e,t)}))},t.preloadScene=function(e,t,i,n){var r=dr(t,i,n),s=r.options,o=r.onProgress,a=r.onComplete;s.bundle=this.name,p.assetManager.preloadAny({scene:e},s,o,(function(t){t&&d(1210,e,t.message),a&&a(t)}))},t.get=function(e,t){var i=this.getInfoWithPath(e,t);return i&&ri.get(i.uuid)||null},t.release=function(e,t){var i=this.get(e,t);i&&ar.tryRelease(i,!0)},t.releaseUnusedAssets=function(){var e=this;ri.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&ar.tryRelease(t)}))},t.releaseAll=function(){var e=this;ri.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&ar.tryRelease(t,!0)}))},t._destroy=function(){this._config.destroy()},l(e,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),e}(),br=e("aa",new yr);function Ar(e,t,i){var n=new h.Image;function r(){n.removeEventListener("load",r),n.removeEventListener("error",s),i&&i(null,n)}function s(){n.removeEventListener("load",r),n.removeEventListener("error",s),i&&i(new Error(w(4930,e)))}return("file:"!==h.location.protocol||ee)&&(n.crossOrigin="anonymous"),n.addEventListener("load",r),n.addEventListener("error",s),n.src=e,n}function Rr(e,t,i,n){var r=new XMLHttpRequest,s="download failed: "+e+", status: ";if(r.open("GET",e,!0),void 0!==t.xhrResponseType&&(r.responseType=t.xhrResponseType),void 0!==t.xhrWithCredentials&&(r.withCredentials=t.xhrWithCredentials),void 0!==t.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(t.xhrMimeType),void 0!==t.xhrTimeout&&(r.timeout=t.xhrTimeout),t.xhrHeader)for(var o in t.xhrHeader)r.setRequestHeader(o,t.xhrHeader[o]);return r.onload=function(){200===r.status||0===r.status?n&&n(null,r.response):n&&n(new Error(""+s+r.status+"(no response)"))},i&&(r.onprogress=function(e){e.lengthComputable&&i(e.loaded,e.total)}),r.onerror=function(){n&&n(new Error(""+s+r.status+"(error)"))},r.ontimeout=function(){n&&n(new Error(""+s+r.status+"(time out)"))},r.onabort=function(){n&&n(new Error(""+s+r.status+"(abort)"))},r.send(null),r}p.resources=br;var wr=h.document,Ir={};function Tr(e,t,i){if(Ir[e])return i&&i(null),null;var n=wr.createElement("script");function r(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",s,!1),Ir[e]=!0,i&&i(null)}function s(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",s,!1),i&&i(new Error(w(4928,e)))}return"file:"!==h.location.protocol&&(n.crossOrigin="anonymous"),n.async=t.scriptAsyncLoading||!1,n.src=e,n.addEventListener("load",r,!1),n.addEventListener("error",s,!1),wr.body.appendChild(n),n}var Dr=/^(?:\w+:\/\/|\.+\/).+/,xr=function(e,t,i){(a.hasFeature(a.Feature.IMAGE_BITMAP)&&p.assetManager.allowImageBitmap?Sr:Ar)(e,t,i)},Sr=function(e,t,i){t.xhrResponseType="blob",Rr(e,t,t.onFileProgress,i)},Cr=function(e,t,i){t.xhrResponseType="json",Rr(e,t,t.onFileProgress,i)},Er=function(e,t,i){t.xhrResponseType="arraybuffer",Rr(e,t,t.onFileProgress,i)},Mr=function(e,t,i){Cr(e,t,(function(t,n){if(t)i(t);else{var r=Zi(n);Promise.all(r.chunks.map((function(i){return new Promise((function(n,r){Er(""+ui(e)+i,{},(function(e,i){t?r(t):n(new Uint8Array(i))}))}))}))).then((function(e){var t=new $i(r.document,e);i(null,t)})).catch((function(e){i(e)}))}}))},Pr=function(e,t,i){Er(e,t,(function(e,t){if(e)i(e);else try{var n=en(new Uint8Array(t));i(null,n)}catch(e){i(e)}}))},kr=function(e,t,i){t.xhrResponseType="text",Rr(e,t,t.onFileProgress,i)},Lr=function(e,t,i){var n=hi(e),r=e;Dr.test(r)||(r=-1!==Ur.remoteBundles.indexOf(n)?Ur.remoteServerAddress+"remote/"+n:"assets/"+n);var s=t.version||Ur.bundleVers[n],o=0,a=null,u=null;Cr(r+"/config."+(s?s+".":"")+"json",t,(function(e,t){u=e||u,(a=t)&&(a.base=r+"/"),2==++o&&i(u,a)})),Tr(r+"/index."+(s?s+".":"")+"js",t,(function(e){u=e||u,2==++o&&i(u,a)}))},Br=function(){var e=t.prototype;function t(){this.maxConcurrency=15,this.maxRequestsPerFrame=15,this.maxRetryCount=3,this.appendTimeStamp=!!ie,this.limited=!ne,this.retryInterval=2e3,this.bundleVers={},this.remoteBundles=[],this.downloadDomImage=Ar,this.downloadDomAudio=null,this.downloadFile=Rr,this.downloadScript=Tr,this._downloaders={".png":xr,".jpg":xr,".bmp":xr,".jpeg":xr,".gif":xr,".ico":xr,".tiff":xr,".webp":xr,".image":xr,".pvr":Er,".pkm":Er,".astc":Er,".txt":kr,".xml":kr,".vsh":kr,".fsh":kr,".atlas":kr,".tmx":kr,".tsx":kr,".json":Cr,".ExportJson":Cr,".plist":kr,".ccon":Mr,".cconb":Pr,".fnt":kr,".binary":Er,".bin":Er,".dbbin":Er,".skel":Er,".js":Tr,bundle:Lr,default:kr},this._downloading=new ii,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}return e.init=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t={}),void 0===i&&(i=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=i},e.register=function(e,t){"object"==typeof e?te(this._downloaders,e):this._downloaders[e]=t},e.download=function(e,t,i,n,r){var s=this,o=ti.get(e);if(o)r(null,o);else{var a=this._downloading.get(e);if(a){a.push(r);var u=this._queue.find((function(t){return t.id===e}));if(!u)return;var h=n.priority||0;u.priority<h&&(u.priority=h,this._queueDirty=!0)}else{var l=void 0!==n.maxRetryCount?n.maxRetryCount:this.maxRetryCount,f=void 0!==n.maxConcurrency?n.maxConcurrency:this.maxConcurrency,c=void 0!==n.maxRequestsPerFrame?n.maxRequestsPerFrame:this.maxRequestsPerFrame,p=this._downloaders[i]||this._downloaders.default;fr((function(i,o){if(0===i&&s._downloading.add(e,[r]),s.limited){s._updateTime();var a=function(e,t){s._totalNum--,s._handleQueueInNextFrame(f,c),o(e,t)};s._totalNum<f&&s._totalNumThisPeriod<c?(p(lr(t,s.appendTimeStamp),n,a),s._totalNum++,s._totalNumThisPeriod++):(s._queue.push({id:e,priority:n.priority||0,url:t,options:n,done:a,handler:p}),s._queueDirty=!0,s._totalNum<f&&s._handleQueueInNextFrame(f,c))}else p(lr(t,s.appendTimeStamp),n,o)}),l,this.retryInterval,(function(t,i){t||ti.add(e,i);for(var n=s._downloading.remove(e),r=0,o=n.length;r<o;r++)n[r](t,i)}))}}},e.loadSubpackage=function(e,t){p.assetManager.loadBundle(e,null,t)},e._updateTime=function(){var e=performance.now(),t=p.game.deltaTime,i=t>this._maxInterval?this._maxInterval:t;e-this._lastDate>1e3*i&&(this._totalNumThisPeriod=0,this._lastDate=e)},e._handleQueue=function(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort((function(e,t){return e.priority-t.priority})),this._queueDirty=!1);var i=this._queue.pop();if(!i)break;this._totalNum++,this._totalNumThisPeriod++,i.handler(lr(i.url,this.appendTimeStamp),i.options,i.done)}this._handleQueueInNextFrame(e,t)},e._handleQueueInNextFrame=function(e,t){!this._checkNextPeriod&&this._queue.length>0&&($(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)},l(t,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}],[{key:"instance",get:function(){return t._instance||(t._instance=new t),t._instance}}]),t}();Br._instance=void 0;var Or,Nr,Fr,Hr,Gr,zr,Ur=Br.instance,jr=e("am",Br.instance),Vr=e("a1",n("cc.JsonAsset")((Nr=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).json=Fr&&Fr(),t}return r(t,e),t}(Qt),Fr=g(Nr.prototype,"json",[v],(function(){return null})),Or=Nr))||Or);p.JsonAsset=Vr;var Wr,Xr,qr=e("a0",n("cc.TextAsset")((Gr=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).text=zr&&zr(),t}return r(t,e),t.prototype.toString=function(){return this.text},t}(Qt),zr=g(Gr.prototype,"text",[v],(function(){return""})),Hr=Gr))||Hr);p.TextAsset=qr;var Kr=e("Z",n("cc.BufferAsset")((Xr=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._buffer=null,t}r(t,e);var i=t.prototype;return i.buffer=function(){return re(this._buffer),this._buffer},i.validate=function(){return!!this._buffer},l(t,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(e){e instanceof ArrayBuffer?this._buffer=e:this._buffer=e.buffer}}]),t}(Qt),f(Xr.prototype,"_nativeAsset",[c],Object.getOwnPropertyDescriptor(Xr.prototype,"_nativeAsset"),Xr.prototype),Wr=Xr))||Wr);function Jr(e,t,i,n){var r=null,s=null;try{(r=new Vi)._nativeUrl=e,r._nativeAsset=t}catch(e){s=e}n(s,r)}function Yr(e,t,i,n){var r=new Vr;r.json=t,n(null,r)}function Qr(e,t,i,n){var r=new qr;r.text=t,n(null,r)}function $r(e,t,i,n){var r=new Kr;r._nativeUrl=e,r._nativeAsset=t,n(null,r)}function Zr(e,t,i,n){var r=new Qt;r._nativeUrl=e,r._nativeAsset=t,n(null,r)}function es(e,i,n,r){var s=oi.get(i.name);s||(s=i.name===li.RESOURCES?br:new yr,i.base=i.base||e+"/",s.init(i)),t.import("virtual:///prerequisite-imports/"+s.name).then((function(){r(null,s)})).catch(r)}p.BufferAsset=Kr;var ts=function(){function e(){this._creating=new ii,this._producers={".png":Jr,".jpg":Jr,".bmp":Jr,".jpeg":Jr,".gif":Jr,".ico":Jr,".tiff":Jr,".webp":Jr,".image":Jr,".pvr":Jr,".pkm":Jr,".txt":Qr,".xml":Qr,".vsh":Qr,".fsh":Qr,".atlas":Qr,".tmx":Qr,".tsx":Qr,".fnt":Qr,".json":Yr,".ExportJson":Yr,".binary":$r,".bin":$r,".dbbin":$r,".skel":$r,bundle:es,default:Zr}}var t=e.prototype;return t.register=function(e,t){"object"==typeof e?te(this._producers,e):this._producers[e]=t},t.create=function(e,t,i,n,r){var s=this,o=this._producers[i]||this._producers.default,a=ri.get(e);if(n.reloadAsset||!a){var u=this._creating.get(e);u?u.push(r):(this._creating.add(e,[r]),o(e,t,n,(function(t,i){!t&&i instanceof Qt&&(i._uuid=e,pr(e,i,n.cacheAsset));for(var r=s._creating.remove(e),o=0,a=r.length;o<a;o++)r[o](t,i)})))}else r(null,a)},e}(),is=e("aq",new ts),ns=new(function(){function e(){this._loading=new ii,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,i,n){var r=se(!0),s=null;if(Array.isArray(t)){(t=function(e){if(e[0]<1)throw new Error(w(5304,e[0]));Rn(e,!0,void 0,In.reportMissingClass),wn(e);for(var t=new Tn(e[0]),i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=0;a<o.length;++a)o[a].unshift(t,i,n,r,s);return o}(t)).length!==e.length&&d(4915);for(var o=0;o<e.length;o++)r[e[o]+"@import"]=t[o]}else{var a=E(Qn),u=E(Vi);if(t.type===a&&t.data){var h=t.data;h.length!==e.length&&d(4915);for(var l=0;l<e.length;l++)r[e[l]+"@import"]=Dn(a,{base:h[l][0],mipmaps:h[l][1]})}else if(t.type===u&&t.data){var f=t.data;f.length!==e.length&&d(4915);for(var c=0;c<e.length;c++)r[e[c]+"@import"]=f[c]}else s=new Error("unmatched type pack!"),r=null}n(s,r)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?te(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,i,n,r){t?(0,this._unpackers[i])(e,t,n,r):r(new Error("package data is wrong!"))},t.load=function(e,t,i){var n=this;if(!e.isNative&&e.info&&e.info.packs)if(ti.has(e.id))i(null,ti.get(e.id));else{var r=e.info.packs,s=r.find((function(e){return n._loading.has(e.uuid)}));if(s)this._loading.get(s.uuid).push({onComplete:i,id:e.id});else{s=r[0],this._loading.add(s.uuid,[{onComplete:i,id:e.id}]);var o=fi(s.uuid,{ext:s.ext,bundle:e.config.name});jr.download(s.uuid,o,s.ext,e.options,(function(t,i){ti.remove(s.uuid),t&&b(t.message,t.stack),n.unpack(s.packedUuids,i,s.ext,e.options,(function(e,i){if(!e)for(var r in i)ti.add(r,i[r]);for(var o=n._loading.remove(s.uuid),a=0,u=o.length;a<u;a++){var h=o[a];if(t||e)h.onComplete(t||e);else{var l=i[h.id];l?h.onComplete(null,l):h.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else jr.download(e.id,e.url,e.ext,e.options,i)},e}());function rs(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress,s=[],o=r.total,a=n.__exclude__=n.__exclude__||Object.create(null);e.output=[],_r(e.input,(function(n,u){if(!n.isNative&&ri.has(n.uuid)){var h=ri.get(n.uuid);return n.content=h.addRef(),e.output.push(n),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n),void u()}ns.load(n,e.options,(function(h,l){h?e.isFinished||(!p.assetManager.force||i?(b(h.message,h.stack),r.canInvoke=!1,t(h)):(e.output.push(n),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n))):e.isFinished||(n.file=l,e.output.push(n),n.isNative||(a[n.uuid]=!0,cr(n.uuid,l,a,s,n.config),r.total=o+s.length),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n)),u()}))}),(function(){if(e.isFinished)return hr(e,!0),void e.dispatch("error");if(s.length>0){var o=ci.create({input:s,progress:r,options:n,onProgress:e.onProgress,onError:ci.prototype.recycle,onComplete:function(n){var r;n||((r=e.output).push.apply(r,o.output),o.recycle()),i&&ss(e),t(n)}});pi.async(o)}else i&&ss(e),t()}))}function ss(e){for(var t=e.output,i=0,n=t.length;i<n;i++)t[i].content&&t[i].content.decRef(!1)}var os=new(function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var i=t.prototype;return i.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return u(5100),{};for(var i=null,n=0,r=t.childNodes.length;n<r&&1!==(i=t.childNodes[n]).nodeType;n++);return this._parseNode(i)},i._parseNode=function(e){var t=null,i=e.tagName;if("dict"===i)t=this._parseDict(e);else if("array"===i)t=this._parseArray(e);else if("string"===i)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var n=0;n<e.childNodes.length;n++)t+=e.childNodes[n].nodeValue}else"false"===i?t=!1:"true"===i?t=!0:"real"===i?t=parseFloat(e.firstChild.nodeValue):"integer"===i&&(t=parseInt(e.firstChild.nodeValue,10));return t},i._parseArray=function(e){for(var t=[],i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&t.push(this._parseNode(r))}return t},i._parseDict=function(e){for(var t={},i="",n=0,r=e.childNodes.length;n<r;n++){var s=e.childNodes[n];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:t[i]=this._parseNode(s))}return t},t}(e("az",function(){function e(){this._parser=null,globalThis.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")},e}()))),as=function(){function e(){this._parsing=new ii,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.parseImport,".ccon":this.parseImport,".cconb":this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,i){e instanceof HTMLImageElement?i(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){i(null,e)}),(function(e){i(e,null)}))},t.parsePVRTex=function(e,t,i){var n=null,r=null;try{r=Vi.parseCompressedTextures(e,0)}catch(e){n=e,console.warn(n)}i(n,r)},t.parsePKMTex=function(e,t,i){var n=null,r=null;try{r=Vi.parseCompressedTextures(e,1)}catch(e){n=e,console.warn(n)}i(n,r)},t.parseASTCTex=function(e,t,i){var n=null,r=null;try{r=Vi.parseCompressedTextures(e,2)}catch(e){n=e,console.warn(n)}i(n,r)},t.parsePlist=function(e,t,i){var n=null,r=os.parse(e);r||(n=new Error("parse failed")),i(n,r)},t.parseImport=function(e,t,i){if(e){var n=null,r=null;try{n=En(e,t)}catch(e){r=e}i(r,n)}else i(new Error("The json file of asset "+t.__uuid__+" is empty or missing"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?te(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,i,n,r){var s=this,o=ei.get(e);if(o)r(null,o);else{var a=this._parsing.get(e);if(a)a.push(r);else{var u=this._parsers[i];u?(this._parsing.add(e,[r]),u(t,n,(function(t,i){t?ti.remove(e):si(i)||ei.add(e,i);for(var n=s._parsing.remove(e),r=0,o=n.length;r<o;r++)n[r](t,i)}))):r(null,t)}}},l(e,null,[{key:"instance",get:function(){return this._instance||(this._instance=new e),this._instance}}]),e}();as._instance=void 0;var us=e("an",as.instance);function hs(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress;n.__exclude__=n.__exclude__||Object.create(null),e.output=[],_r(e.input,(function(s,o){var a=ci.create({input:s,onProgress:e.onProgress,options:n,progress:r,onComplete:function(n,u){n&&!e.isFinished&&(!p.assetManager.force||i?(b(n.message,n.stack),r.canInvoke=!1,t(n)):r.canInvoke&&e.dispatch("progress",++r.finish,r.total,s)),e.output.push(u),a.recycle(),o(null)}});ls.async(a)}),(function(){if(n.__exclude__=null,e.isFinished)return hr(e,!0),void e.dispatch("error");!function(e){var t=e.source;if(e.options.__outputAsArray__||1!==t.length)for(var i=e.output=[],n=0,r=t.length;n<r;n++)i.push(t[n].content);else e.output=t[0].content}(e),hr(e,!0),t()}))}var ls=new _i("loadOneAsset",[function(e,t){var i=e.output=e.input,n=i.options,r=i.isNative,s=i.uuid,o=i.file,a=n.reloadAsset;o||!a&&!r&&ri.has(s)?t():ns.load(i,e.options,(function(e,n){i.file=n,t(e)}))},function(e,t){var i=e.output=e.input,n=e.progress,r=e.options.__exclude__,o=i.id,a=i.file,u=i.options;if(i.isNative)us.parse(o,a,i.ext,u,(function(r,s){r?t(r):(i.content=s,n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),ti.remove(o),ei.remove(o),t())}));else{var h=i.uuid;if(h in r){var l=r[h],f=l.finish,c=l.content,_=l.err,d=l.callbacks;n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),f||vr(h,h,r)?(c&&c.addRef(),i.content=c,t(_)):d.push({done:t,item:i})}else if(!u.reloadAsset&&ri.has(h)){var g=ri.get(h);i.content=g.addRef(),n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),t()}else u.__uuid__=h,us.parse(o,a,"import",u,(function(i,n){i?t(i):function(e,t,i){var n=e.input,r=e.progress,o=n,a=o.uuid,u=o.id,h=o.options,l=o.config,f=h.cacheAsset,c=[];t.addRef&&t.addRef(),cr(a,t,Object.create(null),c,l),r.canInvoke&&e.dispatch("progress",++r.finish,r.total+=c.length,n);var _=e.options.__exclude__[a]={content:t,finish:!1,callbacks:[{done:i,item:n}]},d=ci.create({input:c,options:e.options,onProgress:e.onProgress,onError:ci.prototype.recycle,progress:r,onComplete:function(e){if(t.decRef&&t.decRef(!1),_.finish=!0,_.err=e,!e){for(var i,n=Array.isArray(d.output)?d.output:[d.output],r=Object.create(null),o=s(n);!(i=o()).done;){var h=i.value;h&&(r[h instanceof Qt?h._uuid+"@import":a+"@native"]=h)}!function(e,t,i){var n=xn.get(t);if(n){for(var r=0,s=n.length;r<s;r++){var o=n[r],a=i[o.uuid+"@import"];if(a)o.owner[o.prop]=a.addRef();else{if(b("The asset "+o.uuid+" is missing!"),p.assetManager.dispatchAssetMissing(t,o.owner,o.prop,o.uuid),o.type&&o.type!==Qt){var u=new o.type;u.initDefault(o.uuid),o.owner[o.prop]=u}!0}}xn.delete(t)}Sn.has(t)&&(i[e+"@native"]?t._nativeAsset=i[e+"@native"]:(!0,console.error("the native asset of "+e+" is missing!")),Sn.delete(t))}(a,t,r);try{"function"!=typeof t.onLoaded||Cn.has(t)||Sn.has(t)||(t.onLoaded(),Cn.add(t))}catch(e){b("The asset "+a+" is invalid for some reason, detail message: "+e.message+", stack: "+e.stack)}ti.remove(u),ei.remove(u),pr(a,t,f),d.recycle()}for(var l=_.callbacks,c=0,g=l.length;c<g;c++){var v=l[c];t.addRef&&t.addRef(),v.item.content=t,v.done(e)}l.length=0}});di.async(d)}(e,n,t)}))}}]);function fs(e,t){var i=e.options,n=Object.create(null),r=Object.create(null);for(var s in i)switch(s){case ai.PATH:case ai.UUID:case ai.DIR:case ai.SCENE:case ai.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":n[s]=i[s];break;case"__exclude__":case"__outputAsArray__":r[s]=i[s];break;default:n[s]=i[s],r[s]=i[s]}e.options=r;var o=ci.create({input:e.input,options:n}),a=null;try{e.output=e.source=gi.sync(o)}catch(e){a=e;for(var u=0,h=o.output.length;u<h;u++)o.output[u].recycle()}o.recycle(),t(a)}var cs=function(){function e(){this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},l(e,[{key:"id",get:function(){return this._id||(this._id=(this.overrideUuid||this.uuid)+"@"+(this.isNative?"native":"import")),this._id}}]),e}();cs.MAX_DEAD_NUM=500,cs._deadPool=[];var ps=[];function _s(e){var t=e.options,i=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(var n=function(){var n=i[r],o=cs.create(),a=null,u=null;if("string"==typeof n&&((n=Object.create(null))[t.__requestType__||ai.UUID]=i[r]),"object"==typeof n){oe(n,t),n.preset&&oe(n,vi[n.preset]);var h=function(){var e;switch(l){case ai.UUID:var t,r=o.uuid=Zt(n.uuid);if(!n.bundle){var h=oi.find((function(e){return!!e.getAssetInfo(r)}));n.bundle=h&&h.name}if(oi.has(n.bundle)){if(a=oi.get(n.bundle).config,(u=a.getAssetInfo(r))&&u.redirect){if(!oi.has(u.redirect))throw new Error("Please load bundle "+u.redirect+" first");a=oi.get(u.redirect).config,u=a.getAssetInfo(r)}o.config=a,o.info=u}o.ext=n.ext||(null===(t=u)||void 0===t?void 0:t.extension)||".json";break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case ai.DIR:if(oi.has(n.bundle)){oi.get(n.bundle).config.getDirWithPath(n.dir,n.type,ps);for(var f,c=s(ps);!(f=c()).done;){var p=f.value;i.push({uuid:p.uuid,__isNative__:!1,ext:p.extension||".json",bundle:n.bundle})}ps.length=0}o.recycle(),o=null;break;case ai.PATH:if(oi.has(n.bundle)){if(a=oi.get(n.bundle).config,(u=a.getInfoWithPath(n.path,n.type))&&u.redirect){if(!oi.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");a=oi.get(u.redirect).config,u=a.getAssetInfo(u.uuid)}if(!u)throw o.recycle(),new Error("Bundle "+n.bundle+" doesn't contain "+n.path);o.config=a,o.uuid=u.uuid,o.info=u}o.ext=n.ext||(null===(e=u)||void 0===e?void 0:e.extension)||".json";break;case ai.SCENE:if(!n.bundle){var _=oi.find((function(e){return!!e.getSceneInfo(n.scene)}));n.bundle=_&&_.name}if(oi.has(n.bundle)){if(a=oi.get(n.bundle).config,(u=a.getSceneInfo(n.scene))&&u.redirect){if(!oi.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");a=oi.get(u.redirect).config,u=a.getAssetInfo(u.uuid)}if(!u)throw o.recycle(),new Error("Bundle "+a.name+" doesn't contain scene "+n.scene);o.config=a,o.uuid=u.uuid,o.info=u}break;case"__isNative__":o.isNative=n.__isNative__;break;case ai.URL:o.url=n.url,o.uuid=n.uuid||n.url,o.ext=n.ext||yi(n.url),o.isNative=void 0===n.__isNative__||n.__isNative__;break;default:o.options[l]=n[l]}if(!o)return"break"};for(var l in n)if("break"===h())break}if(!o)return"continue";if(e.output.push(o),!o.uuid&&!o.url)throw new Error("Can not parse this input:"+JSON.stringify(n))},r=0;r<i.length;r++)n();return null}function ds(e){for(var t=e.output=e.input,i=function(){var e=t[n];if(mi.has(e.uuid)){var i=mi.get(e.uuid),r=oi.find((function(e){return!!e.getAssetInfo(i)}));if(r){var s;e.overrideUuid=i;var o=r.config,a=o.getAssetInfo(i);if(a&&a.redirect){if(!oi.has(a.redirect))throw new Error("Please load bundle "+a.redirect+" first");a=(o=oi.get(a.redirect).config).getAssetInfo(i)}e.config=o,e.info=a,e.ext=e.isNative?e.ext:(null===(s=a)||void 0===s?void 0:s.extension)||".json"}else u(16201,i,e.uuid)}},n=0;n<t.length;n++)i()}function gs(e){for(var t=e.output=e.input,i=0;i<t.length;i++){var n=t[i];if(!n.url){var r,s,o=n.config;s=n.isNative?o&&o.nativeBase?o.base+o.nativeBase:p.assetManager.generalNativeBase:o&&o.importBase?o.base+o.importBase:p.assetManager.generalImportBase;var a=n.overrideUuid||n.uuid,u="";n.info&&(u=n.isNative?n.info.nativeVer?"."+n.info.nativeVer:"":n.info.ver?"."+n.info.ver:""),r=".ttf"===n.ext?s+"/"+a.slice(0,2)+"/"+a+u+"/"+n.options.__nativeName__:s+"/"+a.slice(0,2)+"/"+a+u+n.ext,n.url=r}}return null}var vs="asset-missing",ms=e("a9",function(){function e(){this.pipeline=di.append(fs).append(hs),this.fetchPipeline=pi.append(fs).append(rs),this.transformPipeline=gi.append(_s).append(ds).append(gs),this.bundles=oi,this.assets=ri,this.assetsOverrideMap=mi,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=kn,this.force=he,this.allowImageBitmap=!a.isMobile,this.utils=bi,this.downloader=jr,this.parser=us,this.packManager=ns,this.cacheAsset=!0,this.cacheManager=null,this.presets=vi,this.factory=is,this.preprocessPipe=fs,this.fetchPipe=rs,this.loadPipe=hs,this.references=Ai,this._releaseManager=ar,this._files=ti,this._parsed=ei,this._parsePipeline=null,this._projectBundles=[],this._eventTarget=new le}var t=e.prototype;return t.onAssetMissing=function(e,t){this._eventTarget.on(vs,e,t)},t.offAssetMissing=function(e,t){this._eventTarget.off(vs,e,t)},t.dispatchAssetMissing=function(e,t,i,n){this._eventTarget.emit(vs,e,t,i,n)},t.init=function(e){void 0===e&&(e={});var t=e.server||ae.querySettings(ue.Category.ASSETS,"server")||"",i=e.bundleVers||ae.querySettings(ue.Category.ASSETS,"bundleVers")||{},n=e.remoteBundles||ae.querySettings(ue.Category.ASSETS,"remoteBundles")||[];this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(t,i,n),this.parser.init(),this.dependUtil.init();var r=e.importBase||ae.querySettings(ue.Category.ASSETS,"importBase")||"";r&&r.endsWith("/")&&(r=r.substr(0,r.length-1));var s=e.nativeBase||ae.querySettings(ue.Category.ASSETS,"nativeBase")||"";s&&s.endsWith("/")&&(s=s.substr(0,s.length-1)),this.generalImportBase=r,this.generalNativeBase=s,this._projectBundles=ae.querySettings(ue.Category.ASSETS,"projectBundles")||[];var o=ae.querySettings(ue.Category.ASSETS,"assetsOverrides")||{};for(var a in o)this.assetsOverrideMap.set(a,o[a])},t.getBundle=function(e){return oi.get(e)||null},t.removeBundle=function(e){e._destroy(),oi.remove(e.name)},t.loadAny=function(e,t,i,n){var r=dr(t,i,n),s=r.options,o=r.onProgress,a=r.onComplete;s.preset=s.preset||"default",e=Array.isArray(e)?e.slice():e;var u=ci.create({input:e,onProgress:o,onComplete:mr(a),options:s});di.async(u)},t.preloadAny=function(e,t,i,n){var r=dr(t,i,n),s=r.options,o=r.onProgress,a=r.onComplete;s.preset=s.preset||"preload",e=Array.isArray(e)?e.slice():e;var u=ci.create({input:e,onProgress:o,onComplete:mr(a),options:s});pi.async(u)},t.loadRemote=function(e,t,i){var n=dr(t,void 0,i),r=n.options,s=n.onComplete;r.reloadAsset||!this.assets.has(e)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:e},r,null,(function(t,i){t?(b(t.message,t.stack),s&&s(t,i)):is.create(e,i,r.ext||yi(e),r,(function(e,t){s&&s(e,t)}))}))):mr(s)(null,this.assets.get(e))},t.loadBundle=function(e,t,i){var n=dr(t,void 0,i),r=n.options,s=n.onComplete,o=hi(e);this.bundles.has(o)?mr(s)(null,this.getBundle(o)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:e},r,null,(function(t,i){t?(b(t.message,t.stack),s&&s(t,i)):is.create(e,i,"bundle",r,(function(e,t){s&&s(e,t)}))})))},t.releaseAsset=function(e){ar.tryRelease(e,!0)},t.releaseUnusedAssets=function(){ri.forEach((function(e){ar.tryRelease(e)}))},t.releaseAll=function(){ri.forEach((function(e){ar.tryRelease(e,!0)}))},t.loadWithJson=function(){throw new Error("Only valid in Editor")},l(e,[{key:"main",get:function(){return oi.get(li.MAIN)||null}},{key:"resources",get:function(){return oi.get(li.RESOURCES)||null}}],[{key:"instance",get:function(){return this._instance||(this._instance=new e),this._instance}}]),e}());ms._instance=void 0,ms.Pipeline=_i,ms.Task=ci,ms.Cache=ii,ms.RequestItem=cs,ms.Bundle=yr,ms.BuiltinBundleName=li,ms.CacheManager=function(){this.cacheDir=void 0,this.cacheEnabled=void 0,this.autoClear=void 0,this.cacheInterval=void 0,this.deleteInterval=void 0,this.cachedFiles=void 0},ms.Downloader=Br,ms.Parser=as,ms.DependUtil=Mn;var ys=e("a8",p.assetManager=ms.instance);p.AssetManager=ms;var bs,As,Rs,ws,Is,Ts=e("ab",function(){function e(){this._resources={},this._materialsToBeCompiled=[]}var t=e.prototype;return t.init=function(){for(var e=this._resources,t=new Uint8Array(16),i=new Uint8Array(16),n=new Uint8Array(16),r=new Uint8Array(16),s=new Uint8Array(16),o=0,a=0;a<4;a++)t[o]=0,t[o+1]=0,t[o+2]=0,t[o+3]=255,i[o]=0,i[o+1]=0,i[o+2]=0,i[o+3]=0,n[o]=119,n[o+1]=119,n[o+2]=119,n[o+3]=255,r[o]=255,r[o+1]=255,r[o+2]=255,r[o+3]=255,s[o]=127,s[o+1]=127,s[o+2]=255,s[o+3]=255,o+=4;var u=new Uint8Array(1024);o=0;for(var h=0;h<256;h++)u[o]=221,u[o+1]=221,u[o+2]=221,u[o+3]=255,o+=4;o=0;for(var l=0;l<8;l++){for(var f=0;f<8;f++)u[o]=85,u[o+1]=85,u[o+2]=85,u[o+3]=255,o+=4;o+=32}o+=32;for(var c=0;c<8;c++){for(var _=0;_<8;_++)u[o]=85,u[o+1]=85,u[o+2]=85,u[o+3]=255,o+=4;o+=32}var d={width:2,height:2,_data:t,_compressed:!1,format:Qn.PixelFormat.RGBA8888},g={width:2,height:2,_data:i,_compressed:!1,format:Qn.PixelFormat.RGBA8888},v={width:2,height:2,_data:n,_compressed:!1,format:Qn.PixelFormat.RGBA8888},m={width:2,height:2,_data:r,_compressed:!1,format:Qn.PixelFormat.RGBA8888},y={width:2,height:2,_data:s,_compressed:!1,format:Qn.PixelFormat.RGBA8888},b={width:16,height:16,_data:u,_compressed:!1,format:Qn.PixelFormat.RGBA8888},A=new Vi(d),R=new Qn;R._uuid="black-texture",R.image=A,e[R._uuid]=R;var w=new Vi(g),I=new Qn;I._uuid="empty-texture",I.image=w,e[I._uuid]=I;var T=new $n;T._uuid="black-cube-texture",T.setMipFilter($n.Filter.NEAREST),T.image={front:new Vi(d),back:new Vi(d),left:new Vi(d),right:new Vi(d),top:new Vi(d),bottom:new Vi(d)},e[T._uuid]=T;var D=new Vi(v),x=new Qn;x._uuid="grey-texture",x.image=D,e[x._uuid]=x;var S=new $n;S._uuid="grey-cube-texture",S.setMipFilter($n.Filter.NEAREST),S.image={front:new Vi(v),back:new Vi(v),left:new Vi(v),right:new Vi(v),top:new Vi(v),bottom:new Vi(v)},e[S._uuid]=S;var C=new Vi(m),E=new Qn;E._uuid="white-texture",E.image=C,e[E._uuid]=E;var M=new $n;M._uuid="white-cube-texture",M.setMipFilter($n.Filter.NEAREST),M.image={front:new Vi(m),back:new Vi(m),left:new Vi(m),right:new Vi(m),top:new Vi(m),bottom:new Vi(m)},e[M._uuid]=M;var P=new Vi(y),k=new Qn;k._uuid="normal-texture",k.image=P,e[k._uuid]=k;var L=new Vi(b),B=new Qn;B._uuid="default-texture",B.image=L,e[B._uuid]=B;var O=new $n;if(O.setMipFilter($n.Filter.NEAREST),O._uuid="default-cube-texture",O.image={front:new Vi(b),back:new Vi(b),left:new Vi(b),right:new Vi(b),top:new Vi(b),bottom:new Vi(b)},e[O._uuid]=O,p.SpriteFrame){var N=new p.SpriteFrame,F=A,H=new Qn;H.image=F,N.texture=H,N._uuid="default-spriteframe",e[N._uuid]=N}},t.addAsset=function(e,t){this._resources[e]=t},t.get=function(e){return this._resources[e]},t.loadBuiltinAssets=function(){var e=this,t=ae.querySettings(ue.Category.ENGINE,"builtinAssets");if(!t)return Promise.resolve();var i=this._resources;return new Promise((function(n,r){ys.loadBundle(li.INTERNAL,(function(s){s?r(s):ys.loadAny(t,(function(t,s){t?r(t):(s.forEach((function(t){i[t.name]=t,ar.addIgnoredAsset(t),t instanceof p.Material&&e._materialsToBeCompiled.push(t)})),n())}))}))}))},t.compileBuiltinMaterial=function(){for(var e=0;e<this._materialsToBeCompiled.length;++e)for(var t=this._materialsToBeCompiled[e],i=0;i<t.passes.length;++i)t.passes[i].tryCompile();this._materialsToBeCompiled.length=0},e}()),Ds=e("ac",p.builtinResMgr=new Ts),xs=e("v",(bs=new Map,As=0,function(e){return"number"==typeof e?e:(bs.has(e)||(bs.set(e,1<<As),As++),bs.get(e))})),Ss=4227858432,Cs=66060288,Es=1044480,Ms=e("f",(function(e,t,i,n){return void 0===n&&(n=0),t<<26&Ss|e<<20&Cs|i<<12&Es|4095&n})),Ps=e("h",(function(e){return(e&Ss)>>>26})),ks=e("i",(function(e){return(e&Cs)>>>20})),Ls=e("j",(function(e){return(e&Es)>>>12})),Bs=e("k",(function(e){return 4095&e})),Os=e("l",(function(e,t){return 67108863&e|t<<26&Ss})),Ns=e("t",((Rs={})[at.UNKNOWN]=function(e,t,i){return void 0===i&&(i=0),u(12010,i)},Rs[at.INT]=function(e,t,i){return void 0===i&&(i=0),e[i]},Rs[at.INT2]=function(e,t,i){return void 0===i&&(i=0),O.fromArray(t,e,i)},Rs[at.INT3]=function(e,t,i){return void 0===i&&(i=0),N.fromArray(t,e,i)},Rs[at.INT4]=function(e,t,i){return void 0===i&&(i=0),F.fromArray(t,e,i)},Rs[at.FLOAT]=function(e,t,i){return void 0===i&&(i=0),e[i]},Rs[at.FLOAT2]=function(e,t,i){return void 0===i&&(i=0),O.fromArray(t,e,i)},Rs[at.FLOAT3]=function(e,t,i){return void 0===i&&(i=0),N.fromArray(t,e,i)},Rs[at.FLOAT4]=function(e,t,i){return void 0===i&&(i=0),F.fromArray(t,e,i)},Rs[at.MAT3]=function(e,t,i){return void 0===i&&(i=0),fe.fromArray(t,e,i)},Rs[at.MAT4]=function(e,t,i){return void 0===i&&(i=0),j.fromArray(t,e,i)},Rs)),Fs=e("m",((ws={})[at.UNKNOWN]=function(e,t,i){return void 0===i&&(i=0),u(12010,i)},ws[at.INT]=function(e,t,i){return void 0===i&&(i=0),e[i]=t},ws[at.INT2]=function(e,t,i){return void 0===i&&(i=0),O.toArray(e,t,i)},ws[at.INT3]=function(e,t,i){return void 0===i&&(i=0),N.toArray(e,t,i)},ws[at.INT4]=function(e,t,i){return void 0===i&&(i=0),F.toArray(e,t,i)},ws[at.FLOAT]=function(e,t,i){return void 0===i&&(i=0),e[i]=t},ws[at.FLOAT2]=function(e,t,i){return void 0===i&&(i=0),O.toArray(e,t,i)},ws[at.FLOAT3]=function(e,t,i){return void 0===i&&(i=0),N.toArray(e,t,i)},ws[at.FLOAT4]=function(e,t,i){return void 0===i&&(i=0),F.toArray(e,t,i)},ws[at.MAT3]=function(e,t,i){return void 0===i&&(i=0),fe.toArray(e,t,i)},ws[at.MAT4]=function(e,t,i){return void 0===i&&(i=0),j.toArray(e,t,i)},ws)),Hs=(e("n",((Is={})[at.INT]=function(e){return"number"==typeof e},Is[at.FLOAT]=function(e){return"number"==typeof e},Is[at.INT2]=function(e){return!!(e instanceof O)},Is[at.FLOAT2]=function(e){return!!(e instanceof O)},Is[at.INT3]=function(e){return!!(e instanceof N)},Is[at.FLOAT3]=function(e){return!!(e instanceof N)},Is[at.INT4]=function(e){return!!(e instanceof F)},Is[at.FLOAT4]=function(e){return!!(e instanceof F||e instanceof G||e instanceof H)},Is[at.MAT3]=function(e){return!!(e instanceof fe)},Is[at.MAT4]=function(e){return!!(e instanceof j)},Is)),[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])]);function Gs(e){switch(e){case at.BOOL:case at.INT:case at.UINT:case at.FLOAT:return Hs[0];case at.BOOL2:case at.INT2:case at.UINT2:case at.FLOAT2:return Hs[1];case at.BOOL4:case at.INT4:case at.UINT4:case at.FLOAT4:return Hs[2];case at.MAT4:return Hs[3];case at.SAMPLER2D:return"default-texture";case at.SAMPLER_CUBE:return"default-cube-texture";case at.SAMPLER2D_ARRAY:return"default-array-texture";case at.SAMPLER3D:return"default-3d-texture"}return Hs[0]}function zs(e){switch(e){case at.SAMPLER2D:return"-texture";case at.SAMPLER_CUBE:return"-cube-texture";case at.SAMPLER2D_ARRAY:return"-array-texture";case at.SAMPLER3D:return"-3d-texture";default:return"-unknown"}}function Us(e,t){for(var i=Object.entries(t),n=!1,r=0;r<i.length;r++)e[i[r][0]]!==i[r][1]&&(e[i[r][0]]=i[r][1],n=!0);return n}function js(e,t){switch(e.type){case"boolean":return"number"==typeof t?t.toString():t?"1":"0";case"string":return void 0!==t?t:e.options[0];case"number":return void 0!==t?t.toString():e.range[0].toString();default:return console.warn("unknown define type '"+e.type+"'"),"-1"}}function Vs(e,t){for(var i=[],n=0;n<t.length;n++){var r=t[n],s=r.name,o=e[s],a=js(r,o),u=!o||"0"===o;i.push({name:s,value:a,isDefault:u})}return i}function Ws(e,t){return e+t.reduce((function(e,t){return t.isDefault?e:e+"|"+t.name+t.value}),"")}function Xs(e,t){for(var i=0;i<e.length;i++){var n=e[i];if("!"===n[0]){if(t[n.slice(1)])return!1}else if(!t[n])return!1}return!0}function qs(e,t,i){for(var n=[],r=e.attributes,s=0;s<r.length;s++)Xs(r[s].defines,i)&&n.push(t[s]);return n}function Ks(e,t){var i=e.defines;if(e.uber){for(var n="",r=0;r<i.length;r++){var s=i[r],o=t[s.name];if(o&&s._map){var a=s._map(o);n+=""+s._offset+a+"|"}}return""+n+e.hash}for(var u=0,h=0;h<i.length;h++){var l=i[h],f=t[l.name];f&&l._map&&(u|=l._map(f)<<l._offset)}return u.toString(16)+"|"+e.hash}var Js=new Map;function Ys(e,t){if(t.count)return e+ut(t.type)*t.count;var i=Js.get(t.name);return void 0!==i?e+ut(t.type)*i:(console.error("uniform '"+t.name+"' must have a count"),e)}function Qs(e){return e.reduce(Ys,0)}function $s(e){for(var t={},i=0;i<e.blocks.length;i++)for(var n=e.blocks[i],r=n.members,s=0,o=0;o<r.length;o++){var a=r[o];t[a.name]=Ms(n.binding,a.type,a.count,s),s+=(ut(a.type)>>2)*a.count}for(var u=0;u<e.samplerTextures.length;u++){var h=e.samplerTextures[u];t[h.name]=Ms(h.binding,h.type,h.count)}return t}function Zs(e){return Math.ceil(Math.log2(Math.max(e,2)))}function eo(e){for(var t=0,i=function(){var i=e.defines[n],r=1;if("number"===i.type){var s=i.range;r=Zs(s[1]-s[0]+1),i._map=function(e){return e-s[0]}}else"string"===i.type?(r=Zs(i.options.length),i._map=function(e){return Math.max(0,i.options.findIndex((function(t){return t===e})))}):"boolean"===i.type&&(i._map=function(e){return e?1:0});i._offset=t,t+=r},n=0;n<e.defines.length;n++)i();for(var r in t>31&&(e.uber=!0),e.constantMacros="",e.builtins.statistics)e.constantMacros+="#define "+r+" "+e.builtins.statistics[r]+"\n"}function to(e){return Object.keys(e).reduce((function(t,i){return t.reduce((function(t,n){for(var r=e[i],s=0;s<r.length;++s){var o=W({},n);o[i]=r[s],t.push(o)}return t}),[])}),[{}])}Js.set("cc_joints",Pe.LAYOUT.members[0].count),Js.set("cc_lightPos",ke.LIGHTS_PER_PASS),Js.set("cc_lightColor",ke.LIGHTS_PER_PASS),Js.set("cc_lightSizeRangeAngle",ke.LIGHTS_PER_PASS),Js.set("cc_lightDir",ke.LIGHTS_PER_PASS),Js.set("cc_lightBoundingSizeVS",ke.LIGHTS_PER_PASS);var io=new ht;function no(e,t,i,n,r){for(var s=e.builtins[n],o=[],a=function(){var e=s.blocks[u],t=i.layouts[e.name],n=t&&i.bindings.find((function(e){return e.binding===t.binding}));if(!(t&&n&&n.descriptorType&Tt))return console.warn("builtin UBO '"+e.name+"' not available!"),"continue";o.push(t),r&&!r.includes(n)&&r.push(n)},u=0;u<s.blocks.length;u++)a();Array.prototype.unshift.apply(t.shaderInfo.blocks,o);for(var h=[],l=function(){var e=s.samplerTextures[f],t=i.layouts[e.name],n=t&&i.bindings.find((function(e){return e.binding===t.binding}));if(!(t&&n&&n.descriptorType&Dt))return console.warn("builtin samplerTexture '"+e.name+"' not available!"),"continue";h.push(t),r&&!r.includes(n)&&r.push(n)},f=0;f<s.samplerTextures.length;f++)l();Array.prototype.unshift.apply(t.shaderInfo.samplerTextures,h),r&&r.sort((function(e,t){return e.binding-t.binding}))}var ro=function(){function e(){this._templates={},this._cache={},this._templateInfos={}}var t=e.prototype;return t.register=function(e){for(var t=0;t<e.shaders.length;t++)this.define(e.shaders[t]).effectName=e.name;for(var i=0;i<e.techniques.length;i++)for(var n=e.techniques[i],r=0;r<n.passes.length;r++){var s=n.passes[r];void 0!==s.propertyIndex&&void 0===s.properties&&(s.properties=n.passes[s.propertyIndex].properties)}},t.define=function(e){var t=this._templates[e.name];if(t&&t.hash===e.hash)return t;var i=W({},e);if(eo(i),this._templates[e.name]=i,!this._templateInfos[i.hash]){var n={};n.samplerStartBinding=i.blocks.length,n.shaderInfo=new lt,n.blockSizes=[],n.bindings=[];for(var r=0;r<i.blocks.length;r++){var s=i.blocks[r];n.blockSizes.push(Qs(s.members)),n.bindings.push(new ft(s.binding,ct.UNIFORM_BUFFER,1,s.stageFlags)),n.shaderInfo.blocks.push(new pt(Le.MATERIAL,s.binding,s.name,s.members.map((function(e){return new _t(e.name,e.type,e.count)})),1))}for(var o=0;o<i.samplerTextures.length;o++){var a=i.samplerTextures[o];n.bindings.push(new ft(a.binding,ct.SAMPLER_TEXTURE,a.count,a.stageFlags)),n.shaderInfo.samplerTextures.push(new dt(Le.MATERIAL,a.binding,a.name,a.type,a.count))}for(var u=0;u<i.samplers.length;u++){var h=i.samplers[u];n.bindings.push(new ft(h.binding,ct.SAMPLER,h.count,h.stageFlags)),n.shaderInfo.samplers.push(new gt(Le.MATERIAL,h.binding,h.name,h.count))}for(var l=0;l<i.textures.length;l++){var f=i.textures[l];n.bindings.push(new ft(f.binding,ct.TEXTURE,f.count,f.stageFlags)),n.shaderInfo.textures.push(new vt(Le.MATERIAL,f.binding,f.name,f.type,f.count))}for(var c=0;c<i.buffers.length;c++){var p=i.buffers[c];n.bindings.push(new ft(p.binding,ct.STORAGE_BUFFER,1,p.stageFlags)),n.shaderInfo.buffers.push(new mt(Le.MATERIAL,p.binding,p.name,1,p.memoryAccess))}for(var _=0;_<i.images.length;_++){var d=i.images[_];n.bindings.push(new ft(d.binding,ct.STORAGE_IMAGE,d.count,d.stageFlags)),n.shaderInfo.images.push(new yt(Le.MATERIAL,d.binding,d.name,d.type,d.count,d.memoryAccess))}for(var g=0;g<i.subpassInputs.length;g++){var v=i.subpassInputs[g];n.bindings.push(new ft(v.binding,ct.INPUT_ATTACHMENT,v.count,v.stageFlags)),n.shaderInfo.subpassInputs.push(new bt(Le.MATERIAL,v.binding,v.name,v.count))}n.gfxAttributes=[];for(var m=0;m<i.attributes.length;m++){var y=i.attributes[m];n.gfxAttributes.push(new At(y.name,y.format,y.isNormalized,0,y.isInstanced,y.location))}no(i,n,Be,"locals"),n.shaderInfo.stages.push(new Rt(wt.VERTEX,"")),n.shaderInfo.stages.push(new Rt(wt.FRAGMENT,"")),n.handleMap=$s(i),n.setLayouts=[],this._templateInfos[i.hash]=n}return i},t.getTemplate=function(e){return this._templates[e]},t.getTemplateInfo=function(e){var t=this._templates[e].hash;return this._templateInfos[t]},t.getDescriptorSetLayout=function(e,t,i){void 0===i&&(i=!1);var n=this._templates[t],r=this._templateInfos[n.hash];return r.setLayouts.length||(io.bindings=r.bindings,r.setLayouts[Le.MATERIAL]=e.createDescriptorSetLayout(io),io.bindings=Be.bindings,r.setLayouts[Le.LOCAL]=e.createDescriptorSetLayout(io)),r.setLayouts[i?Le.LOCAL:Le.MATERIAL]},t.hasProgram=function(e){return void 0!==this._templates[e]},t.getKey=function(e,t){return Ks(this._templates[e],t)},t.destroyShaderByDefines=function(e){var t=this,i=Object.keys(e);if(i.length)for(var n=i.map((function(t){var i=e[t];return"boolean"==typeof i&&(i=i?"1":"0"),new RegExp(""+t+i)})),r=Object.keys(this._cache).filter((function(e){return n.every((function(i){return i.test(t._cache[e].name)}))})),s=0;s<r.length;s++){var o=r[s],a=this._cache[o];ce("destroyed shader "+a.name),a.destroy(),delete this._cache[o]}},t.getGFXShader=function(e,t,i,n,r){Object.assign(i,n.macros),r||(r=this.getKey(t,i));var s=this._cache[r];if(s)return s;var o=this._templates[t],a=this._templateInfos[o.hash];a.pipelineLayout||(this.getDescriptorSetLayout(e,t),no(o,a,Oe,"globals"),a.setLayouts[Le.GLOBAL]=n.descriptorSetLayout,a.pipelineLayout=e.createPipelineLayout(new It(a.setLayouts)));var u=Vs(i,o.defines),h=n.constantMacros+o.constantMacros+u.reduce((function(e,t){return e+"#define "+t.name+" "+t.value+"\n"}),""),l=o.glsl3,f=so(e);f?l=o[f]:console.error("Invalid GFX API!"),a.shaderInfo.stages[0].source=h+l.vert,a.shaderInfo.stages[1].source=h+l.frag,a.shaderInfo.attributes=qs(o,a.gfxAttributes,i),a.shaderInfo.name=Ws(t,u);var c=a.shaderInfo;return this._cache[r]=e.createShader(c)},e}();function so(e){switch(e.gfxAPI){case nt.GLES2:case nt.WEBGL:return"glsl1";case nt.GLES3:case nt.WEBGL2:return"glsl3";default:return"glsl4"}}var oo=e("p",new ro);p.programLib=oo;var ao,uo=e("I",function(){function e(e){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=e.device,this.pass=e}var t=e.prototype;return t.destroy=function(){for(var e=0;e<this.instances.length;++e){var t=this.instances[e];t.vb.destroy(),t.ia.destroy()}this.instances.length=0},t.merge=function(e,t,i){void 0===i&&(i=null);var n=e.instancedAttributeBlock,r=n.buffer.length;if(r){var s=e.inputAssembler,o=e.descriptorSet.getTexture(Ne),a=e.descriptorSet.getTexture(Fe),u=e.descriptorSet.getTexture(He),h=e.descriptorSet.getTexture(Ge),l=e.useReflectionProbeType,f=i;f||(f=e.shaders[t]);for(var c=e.descriptorSet,p=0;p<this.instances.length;++p){var _,d,g=this.instances[p];if(!((null===(_=g.ia.indexBuffer)||void 0===_?void 0:_.objectID)!==(null===(d=s.indexBuffer)||void 0===d?void 0:d.objectID)||g.count>=1024)&&g.lightingMap.objectID===o.objectID&&g.useReflectionProbeType===l&&g.reflectionProbeCubemap.objectID===a.objectID&&g.reflectionProbePlanarMap.objectID===u.objectID&&g.reflectionProbeBlendCubemap.objectID===h.objectID&&g.stride===r){if(g.count>=g.capacity){g.capacity<<=1;var v=g.stride*g.capacity,m=g.data;g.data=new Uint8Array(v),g.data.set(m),g.vb.resize(v)}return g.shader=f,g.descriptorSet=c,g.data.set(n.buffer,g.stride*g.count++),void(this.hasPendingModels=!0)}}for(var y=this._device.createBuffer(new xt(St.VERTEX|St.TRANSFER_DST,Ct.HOST|Ct.DEVICE,32*r,r)),b=new Uint8Array(32*r),A=s.vertexBuffers.slice(),R=s.attributes.slice(),w=s.indexBuffer,I=0;I<n.attributes.length;I++){var T=n.attributes[I],D=new At(T.name,T.format,T.isNormalized,A.length,!0);R.push(D)}b.set(n.buffer),A.push(y);var x=new Et(R,A,w),S=this._device.createInputAssembler(x);this.instances.push({count:1,capacity:32,vb:y,data:b,ia:S,stride:r,shader:f,descriptorSet:c,lightingMap:o,reflectionProbeCubemap:a,reflectionProbePlanarMap:u,useReflectionProbeType:l,reflectionProbeBlendCubemap:h}),this.hasPendingModels=!0}},t.uploadBuffers=function(e){for(var t=0;t<this.instances.length;++t){var i=this.instances[t];i.count&&(i.ia.instanceCount=i.count,e.updateBuffer(i.vb,i.data))}},t.clear=function(){for(var e=0;e<this.instances.length;++e)this.instances[e].count=0;this.hasPendingModels=!1},e}()),ho=new xt(St.UNIFORM|St.TRANSFER_DST,Ct.DEVICE),lo=new Ft(null),fo=new Ht(null);e("B",ao),function(e){e[e.NONE=0]="NONE",e[e.INSTANCING=1]="INSTANCING"}(ao||e("B",ao={}));var co,po,_o,go,vo,mo,yo,bo=e("s",function(){function e(e){this._rootBuffer=null,this._buffers=[],this._descriptorSet=null,this._pipelineLayout=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocksInt=[],this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._shader=null,this._bs=new Mt,this._dss=new Pt,this._rs=new kt,this._priority=ze.DEFAULT,this._stage=Ue.DEFAULT,this._phase=xs("default"),this._passID=4294967295,this._phaseID=4294967295,this._primitive=Lt.TRIANGLE_LIST,this._batchingScheme=ao.NONE,this._dynamicStates=Bt.NONE,this._instancedBuffers={},this._hash=0,this._root=void 0,this._device=void 0,this._rootBufferDirty=!1,this._root=e,this._device=Me.gfxDevice}e.fillPipelineInfo=function(e,t){void 0!==t.priority&&(e._priority=t.priority),void 0!==t.primitive&&(e._primitive=t.primitive),void 0!==t.stage&&(e._stage=t.stage),void 0!==t.dynamicStates&&(e._dynamicStates=t.dynamicStates),void 0!==t.phase&&(e._phase=xs(t.phase));var i=e._bs;if(t.blendState){var n=t.blendState,r=n.targets;r&&r.forEach((function(e,t){i.setTarget(t,e)})),void 0!==n.isA2C&&(i.isA2C=n.isA2C),void 0!==n.isIndepend&&(i.isIndepend=n.isIndepend),void 0!==n.blendColor&&(i.blendColor=n.blendColor)}e._rs.assign(t.rasterizerState),e._dss.assign(t.depthStencilState)},e.getPassHash=function(e){var t="";if(p.rendering&&p.rendering.enableEffectImport){var i=p.rendering.programLib.getKey(e._phaseID,e.program,e.defines);t=e._phaseID.toString()+","+i}else t=oo.getKey(e.program,e.defines);var n,r=t+","+e._primitive+","+e._dynamicStates;return r+=function(e){for(var t,i=",bs,"+e.isA2C,n=s(e.targets);!(t=n()).done;){var r=t.value;i+=",bt,"+r.blend+","+r.blendEq+","+r.blendAlphaEq+","+r.blendColorMask,i+=","+r.blendSrc+","+r.blendDst+","+r.blendSrcAlpha+","+r.blendDstAlpha}return i}(e._bs),r+=function(e){var t=",dss,"+e.depthTest+","+e.depthWrite+","+e.depthFunc;return t+=","+e.stencilTestFront+","+e.stencilFuncFront+","+e.stencilRefFront+","+e.stencilReadMaskFront,t+=","+e.stencilFailOpFront+","+e.stencilZFailOpFront+","+e.stencilPassOpFront+","+e.stencilWriteMaskFront,(t+=","+e.stencilTestBack+","+e.stencilFuncBack+","+e.stencilRefBack+","+e.stencilReadMaskBack)+","+e.stencilFailOpBack+","+e.stencilZFailOpBack+","+e.stencilPassOpBack+","+e.stencilWriteMaskBack}(e._dss),r+=",rs,"+(n=e._rs).cullMode+","+n.depthBias+","+n.isFrontFaceCCW,Ze(r,666)};var t=e.prototype;return t.initialize=function(e){this._doInit(e),this.resetUBOs(),this.resetTextures(),this.tryCompile()},t.getHandle=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=at.UNKNOWN);var n=this._propertyHandleMap[e];return n?(i?n=Os(n,i):t&&(n=Os(n,Ps(n)-t)),n+t):0},t.getBinding=function(t){var i=this.getHandle(t);return i?e.getBindingFromHandle(i):-1},t.setUniform=function(t,i){var n=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),s=e.getOffsetFromHandle(t),o=this._getBlockView(r,n);Fs[r](o,i,s),this._rootBufferDirty=!0},t.getUniform=function(t,i){var n=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),s=e.getOffsetFromHandle(t),o=this._getBlockView(r,n);return Ns[r](o,i,s)},t.setUniformArray=function(t,i){for(var n=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),s=ut(r)>>2,o=this._getBlockView(r,n),a=e.getOffsetFromHandle(t),u=0;u<i.length;u++,a+=s)null!==i[u]&&Fs[r](o,i[u],a);this._rootBufferDirty=!0},t.bindTexture=function(e,t,i){this._descriptorSet.bindTexture(e,t,i||0)},t.bindSampler=function(e,t,i){this._descriptorSet.bindSampler(e,t,i||0)},t.setDynamicState=function(e,t){var i=this._dynamics[e];i&&i.value===t||(i.value=t,i.dirty=!0)},t.overridePipelineStates=function(){u(12102)},t.update=function(){this._descriptorSet?(this._rootBuffer&&this._rootBufferDirty&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()):d(12006)},t.getInstancedBuffer=function(e){return void 0===e&&(e=0),this._instancedBuffers[e]||(this._instancedBuffers[e]=new uo(this))},t.destroy=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++){var t=this._shaderInfo.blocks[e];this._buffers[t.binding].destroy()}for(var i in this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBuffer=null),this._instancedBuffers)this._instancedBuffers[i].destroy();this._descriptorSet.destroy(),this._rs.destroy(),this._dss.destroy(),this._bs.destroy()},t.resetUniform=function(t){var i=this.getHandle(t);if(i){for(var n=e.getTypeFromHandle(i),r=e.getBindingFromHandle(i),s=e.getOffsetFromHandle(i),o=e.getCountFromHandle(i),a=this._getBlockView(n,r),u=this._properties[t],h=u&&u.value||Gs(n),l=(ut(n)>>2)*o,f=0;f+h.length<=l;f+=h.length)a.set(h,s+f);this._rootBufferDirty=!0}},t.resetTexture=function(t,i){var n=this.getHandle(t);if(n){var r=e.getTypeFromHandle(n),s=e.getBindingFromHandle(n),o=this._properties[t],a=o&&o.value,u=a?""+a+zs(r):Gs(r),h=Ds.get(u),l=h&&h.getGFXTexture(),f=o&&void 0!==o.samplerHash?Ot.unpackFromHash(o.samplerHash):h&&h.getSamplerInfo(),c=this._device.getSampler(f);this._descriptorSet.bindSampler(s,c,i||0),this._descriptorSet.bindTexture(s,l,i||0)}},t.resetUBOs=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++)for(var t=this._shaderInfo.blocks[e],i=0,n=0;n<t.members.length;n++){for(var r=t.members[n],s=this._getBlockView(r.type,t.binding),o=this._properties[r.name],a=o&&o.value||Gs(r.type),u=(ut(r.type)>>2)*r.count,h=0;h+a.length<=u;h+=a.length)s.set(a,i+h);i+=u}this._rootBufferDirty=!0},t.resetTextures=function(){for(var e=0;e<this._shaderInfo.samplerTextures.length;e++)for(var t=this._shaderInfo.samplerTextures[e],i=0;i<t.count;i++)this.resetTexture(t.name,i)},t.tryCompile=function(){var t=this._root.pipeline;if(!t)return!1;if(this._syncBatchingScheme(),p.rendering&&p.rendering.enableEffectImport){var i=p.rendering.programLib,n=i.getProgramVariant(this._device,this._phaseID,this._programName,this._defines);if(!n)return u(12103,this._programName),!1;this._shader=n.shader,this._pipelineLayout=i.getPipelineLayout(this.device,this._phaseID,this._programName)}else{var r=oo.getGFXShader(this._device,this._programName,this._defines,t);if(!r)return u(12104,this._programName),!1;this._shader=r,this._pipelineLayout=oo.getTemplateInfo(this._programName).pipelineLayout}return this._hash=e.getPassHash(this),!0},t.getShaderVariant=function(e){if(void 0===e&&(e=null),!this._shader&&!this.tryCompile())return u(12105),null;if(!e)return this._shader;for(var t=this._root.pipeline,i=0;i<e.length;i++){var n=e[i];this._defines[n.name]=n.value}var r=null;if(p.rendering&&p.rendering.enableEffectImport){var s=p.rendering.programLib.getProgramVariant(this._device,this._phaseID,this._programName,this._defines);s&&(r=s.shader)}else r=oo.getGFXShader(this._device,this._programName,this._defines,t);for(var o=0;o<e.length;o++){var a=e[o];delete this._defines[a.name]}return r},t.beginChangeStatesSilently=function(){},t.endChangeStatesSilently=function(){},t._doInit=function(t,i){if(void 0===i&&(i=!1),this._priority=ze.DEFAULT,this._stage=Ue.DEFAULT,p.rendering&&p.rendering.enableEffectImport){var n=p.rendering;if("number"==typeof t.phase?(this._passID=t._passID,this._phaseID=t._phaseID):(this._passID=n.getPassID(t.pass),this._passID!==n.INVALID_ID&&(this._phaseID=n.getPhaseID(this._passID,t.phase))),this._passID===n.INVALID_ID)return void d(12107,t.program);if(this._phaseID===n.INVALID_ID)return void d(12108,t.program)}this._phase=xs("default"),this._primitive=Lt.TRIANGLE_LIST,this._passIndex=t.passIndex,this._propertyIndex=void 0!==t.propertyIndex?t.propertyIndex:t.passIndex,this._programName=t.program,this._defines=i?W({},t.defines):t.defines,p.rendering&&p.rendering.enableEffectImport?this._shaderInfo=p.rendering.programLib.getProgramInfo(this._phaseID,this._programName):this._shaderInfo=oo.getTemplate(t.program),this._properties=t.properties||this._properties;var r=this._device;e.fillPipelineInfo(this,t),t.stateOverrides&&e.fillPipelineInfo(this,t.stateOverrides),p.rendering&&p.rendering.enableEffectImport?fo.layout=p.rendering.programLib.getMaterialDescriptorSetLayout(this._device,this._phaseID,t.program):fo.layout=oo.getDescriptorSetLayout(this._device,t.program),this._descriptorSet=this._device.createDescriptorSet(fo);var s,o,a=this._shaderInfo.blocks;if(p.rendering&&p.rendering.enableEffectImport){var u=p.rendering.programLib;s=u.getBlockSizes(this._phaseID,this._programName),o=u.getHandleMap(this._phaseID,this._programName)}else{var h=oo.getTemplateInfo(t.program);s=h.blockSizes,o=h.handleMap}if(p.rendering&&p.rendering.enableEffectImport){var l=p.rendering.programLib.getShaderInfo(this._phaseID,this.program);this._buildMaterialUniformBlocks(r,l.blocks,s)}else this._buildUniformBlocks(r,a,s);var f=this._propertyHandleMap=o,c={};for(var _ in this._properties){var g=this._properties[_];g.handleInfo&&(c[_]=this.getHandle.apply(this,g.handleInfo))}Object.assign(f,c)},t._buildUniformBlocks=function(e,t,i){for(var n=e.capabilities.uboOffsetAlignment,r=[],s=0,o=0,a=0;a<t.length;a++){var u=i[a];r.push(o),o+=Math.ceil(u/n)*n,s=u}var h=r[r.length-1]+s;h&&(ho.size=16*Math.ceil(h/16),this._rootBuffer=e.createBuffer(ho),this._rootBlock=new ArrayBuffer(h));for(var l=0,f=0;l<t.length;l++){var c=t[l].binding,p=i[l];lo.buffer=this._rootBuffer,lo.offset=r[f++],lo.range=16*Math.ceil(p/16);var _=this._buffers[c]=e.createBuffer(lo);this._blocks[c]=new Float32Array(this._rootBlock,lo.offset,p/Float32Array.BYTES_PER_ELEMENT),this._blocksInt[c]=new Int32Array(this._blocks[c].buffer,this._blocks[c].byteOffset,this._blocks[c].length),this._descriptorSet.bindBuffer(c,_)}},t._buildMaterialUniformBlocks=function(e,t,i){for(var n=e.capabilities.uboOffsetAlignment,r=[],s=0,o=0,a=0;a<t.length;a++)if(1===t[a].set){var u=i[a];r.push(o),o+=Math.ceil(u/n)*n,s=u}if(0!==s){var h=r[r.length-1]+s;h&&(ho.size=16*Math.ceil(h/16),this._rootBuffer=e.createBuffer(ho),this._rootBlock=new ArrayBuffer(h))}for(var l=0,f=0;l<t.length;l++)if(1===t[l].set){var c=t[l].binding,p=i[l];lo.buffer=this._rootBuffer,lo.offset=r[f++],lo.range=16*Math.ceil(p/16);var _=this._buffers[c]=e.createBuffer(lo);this._blocks[c]=new Float32Array(this._rootBlock,lo.offset,p/Float32Array.BYTES_PER_ELEMENT),this._blocksInt[c]=new Int32Array(this._blocks[c].buffer,this._blocks[c].byteOffset,this._blocks[c].length),this._descriptorSet.bindBuffer(c,_)}},t._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(Nt.INSTANCED_ARRAYS)?this._batchingScheme=ao.INSTANCING:(this._defines.USE_INSTANCING=!1,this._batchingScheme=ao.NONE):this._batchingScheme=ao.NONE},t._getBlockView=function(e,t){return e<at.FLOAT?this._blocksInt[t]:this._blocks[t]},t._initPassFromTarget=function(e,t,i){this._priority=e.priority,this._stage=e.stage,this._phase=e.phase,this._phaseID=e._phaseID,this._passID=e._passID,this._batchingScheme=e.batchingScheme,this._primitive=e.primitive,this._dynamicStates=e.dynamicStates,this._bs=e.blendState,this._dss=t,this._descriptorSet=e.descriptorSet,this._rs=e.rasterizerState,this._passIndex=e.passIndex,this._propertyIndex=e.propertyIndex,this._programName=e.program,this._defines=e.defines,this._shaderInfo=e._shaderInfo,this._properties=e._properties,this._blocks=e._blocks,this._blocksInt=e._blocksInt,this._dynamics=e._dynamics,this._shader=e._shader,p.rendering&&p.rendering.enableEffectImport?this._pipelineLayout=p.rendering.programLib.getPipelineLayout(this.device,this._phaseID,this._programName):this._pipelineLayout=oo.getTemplateInfo(this._programName).pipelineLayout,this._hash=e._hash^i},t._updatePassHash=function(){this._hash=e.getPassHash(this)},t.setRootBufferDirty=function(e){this._rootBufferDirty=e},t.setPriority=function(e){this._priority=e},l(e,[{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return p.rendering&&p.rendering.enableEffectImport?p.rendering.programLib.getLocalDescriptorSetLayout(this._device,this._phaseID,this._programName):oo.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"blocksInt",get:function(){return this._blocksInt}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}},{key:"priority",get:function(){return this._priority}},{key:"primitive",get:function(){return this._primitive}},{key:"stage",get:function(){return this._stage}},{key:"phase",get:function(){return this._phase}},{key:"passID",get:function(){return this._passID}},{key:"phaseID",get:function(){return this._phaseID}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"batchingScheme",get:function(){return this._batchingScheme}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return this._hash}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}}]),e}());bo.getTypeFromHandle=Ps,bo.getBindingFromHandle=ks,bo.getCountFromHandle=Ls,bo.getOffsetFromHandle=Bs;var Ao=["planar-shadow","skybox","deferred-lighting","bloom","hbao","copy-pass","post-process","profiler","splash-screen","unlit","sprite","particle","particle-gpu","particle-trail","billboard","terrain","graphics","clear-stencil","spine","occlusion-query","geometry-renderer","debug-renderer","ssss-blur","tone-mapping"],Ro=e("a5",n("cc.EffectAsset")(((yo=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).techniques=_o&&_o(),t.shaders=go&&go(),t.combinations=vo&&vo(),t.hideInEditor=mo&&mo(),t}r(t,e),t.register=function(e){t._effects[e.name]=e,t._layoutValid=!1},t.remove=function(e){if("string"!=typeof e)t._effects[e.name]&&t._effects[e.name]===e&&delete t._effects[e.name];else{if(t._effects[e])return void delete t._effects[e];for(var i in t._effects)if(t._effects[i]._uuid===e)return void delete t._effects[i]}},t.get=function(e){if(t._effects[e])return t._effects[e];for(var i in t._effects)if(t._effects[i]._uuid===e)return t._effects[i];return Ao.includes(e)&&u(16101,e),null},t.getAll=function(){return t._effects},t.isLayoutValid=function(){return t._layoutValid},t.setLayoutValid=function(){t._layoutValid=!0};var i=t.prototype;return i.onLoaded=function(){p.rendering&&p.rendering.enableEffectImport?(function(e){for(var t=0;t<e.techniques.length;t++)for(var i=e.techniques[t],n=0;n<i.passes.length;n++){var r=i.passes[n];void 0!==r.propertyIndex&&void 0===r.properties&&(r.properties=i.passes[r.propertyIndex].properties)}}(this),p.rendering.programLib.addEffect(this)):oo.register(this),t.register(this),p.game.once(p.Game.EVENT_RENDERER_INITED,this._precompile,this)},i._precompile=function(){var e=this;if(p.rendering&&p.rendering.enableEffectImport)p.rendering.programLib.precompileEffect(Me.gfxDevice,this);else for(var t=p.director.root,i=function(){var i=e.shaders[n],r=e.combinations[n];if(!r)return"continue";to(r).forEach((function(e){return oo.getGFXShader(Me.gfxDevice,i.name,e,t.pipeline)}))},n=0;n<this.shaders.length;n++)i()},i.destroy=function(){return t.remove(this),e.prototype.destroy.call(this)},i.initDefault=function(i){e.prototype.initDefault.call(this,i);var n=t.get("builtin-unlit");this.name="builtin-unlit",this.shaders=n.shaders,this.combinations=n.combinations,this.techniques=n.techniques},i.validate=function(){return this.techniques.length>0&&this.shaders.length>0},t}(Qt))._effects={},yo._layoutValid=!0,_o=g((po=yo).prototype,"techniques",[v],(function(){return[]})),go=g(po.prototype,"shaders",[v],(function(){return[]})),vo=g(po.prototype,"combinations",[v],(function(){return[]})),mo=g(po.prototype,"hideInEditor",[v,A],(function(){return!1})),co=po))||co);p.EffectAsset=Ro;var wo=new Gt,Io=new zt;function To(e,t){e.x=t.x*t.x,e.y=t.y*t.y,e.z=t.z*t.z}var Do,xo,So,Co,Eo,Mo,Po,ko,Lo,Bo=null,Oo=new F,No=e("a6",(Do=n("cc.Material"),xo=K(Ro),Do((Co=function(e){function t(){var t;return(t=e.call(this)||this)._effectAsset=Eo&&Eo(),t._techIdx=Mo&&Mo(),t._defines=Po&&Po(),t._states=ko&&ko(),t._props=Lo&&Lo(),t._passes=[],t._hash=0,t}r(t,e),t.getHash=function(e){for(var t,i=0,n=s(e.passes);!(t=n()).done;)i^=t.value.hash;return i};var i=t.prototype;return i.initialize=function(e){this._passes.length?u(12005):(this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),this._fillInfo(e),this._update())},i.reset=function(e){this.initialize(e)},i.destroy=function(){return this._doDestroy(),e.prototype.destroy.call(this)},i.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},i.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},i.onLoaded=function(){this._update()},i.resetUniforms=function(e){void 0===e&&(e=!0),this._props.length=this._passes.length;for(var t=0;t<this._props.length;t++)this._props[t]={};if(e)for(var i,n=s(this._passes);!(i=n()).done;){var r=i.value;r.resetUBOs(),r.resetTextures()}},i.setProperty=function(e,t,i){var n=!1;if(void 0===i)for(var r=this._passes,s=r.length,o=0;o<s;o++){var a=r[o];this._uploadProperty(a,e,t)&&(this._props[a.propertyIndex][e]=t,n=!0)}else{if(i>=this._passes.length)return void console.warn("illegal pass index: "+i+".");var u=this._passes[i];this._uploadProperty(u,e,t)&&(this._props[u.propertyIndex][e]=t,n=!0)}n||console.warn("illegal property name: "+e+".")},i.getProperty=function(e,t){if(void 0===t)for(var i=this._props,n=i.length,r=0;r<n;r++){var s=i[r];if(e in s)return s[e]}else{if(t>=this._passes.length)return console.warn("illegal pass index: "+t+"."),null;var o=this._props[this._passes[t].propertyIndex];if(e in o)return o[e]}return null},i.copy=function(e,t){this._techIdx=e._techIdx,this._props.length=e._props.length;for(var i=0;i<e._props.length;i++)this._props[i]=W({},e._props[i]);this._defines.length=e._defines.length;for(var n=0;n<e._defines.length;n++)this._defines[n]=W({},e._defines[n]);this._states.length=e._states.length;for(var r=0;r<e._states.length;r++)this._states[r]=W({},e._states[r]);this._effectAsset=e._effectAsset,t&&this._fillInfo(t),this._update()},i._fillInfo=function(e){void 0!==e.technique&&(this._techIdx=e.technique),e.effectAsset?this._effectAsset=e.effectAsset:e.effectName&&(this._effectAsset=Ro.get(e.effectName)),e.defines&&this._prepareInfo(e.defines,this._defines),e.states&&this._prepareInfo(e.states,this._states)},i._prepareInfo=function(e,t){var i=e;if(!Array.isArray(i)){var n=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;i=Array(n).fill(i)}for(var r=0;r<i.length;++r)Object.assign(t[r]||(t[r]={}),i[r])},i._createPasses=function(){var e=this._effectAsset.techniques[this._techIdx||0];if(!e)return[];for(var t=e.passes.length,i=[],n=0;n<t;++n){var r=e.passes[n],s=r.passIndex=n,o=r.defines=this._defines[s]||(this._defines[s]={});if(r.stateOverrides=this._states[s]||(this._states[s]={}),void 0!==r.propertyIndex&&Object.assign(o,this._defines[r.propertyIndex]),void 0!==r.embeddedMacros&&Object.assign(o,r.embeddedMacros),!r.switch||o[r.switch]){var a=new bo(p.director.root);a.initialize(r),i.push(a)}}return i},i._update=function(e){var i=this;if(void 0===e&&(e=!0),this._effectAsset){this._passes=this._createPasses();var n=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=n,e)this._passes.forEach((function(e,t){var n=i._props[t];for(var r in n||(n=i._props[t]={}),void 0!==e.propertyIndex&&Object.assign(n,i._props[e.propertyIndex]),n)i._uploadProperty(e,r,n[r])}));else for(var r=0;r<this._props.length;r++)this._props[r]={}}this._hash=t.getHash(this)},i._uploadProperty=function(e,t,i){var n=e.getHandle(t);if(!n)return!1;if(bo.getTypeFromHandle(n)<at.SAMPLER1D)if(Array.isArray(i))e.setUniformArray(n,i);else if(null!==i){var r;if(null!==(r=e.properties[t])&&void 0!==r&&r.linear){var s=i;To(Oo,s),Oo.w=s.w,i=Oo}e.setUniform(n,i)}else e.resetUniform(t);else if(Array.isArray(i))for(var o=0;o<i.length;o++)this._bindTexture(e,n,i[o],o);else i?this._bindTexture(e,n,i):e.resetTexture(t);return!0},i._bindTexture=function(e,t,i,n){var r=bo.getBindingFromHandle(t);if(i instanceof Ut)e.bindTexture(r,i,n);else if(i instanceof Ji){var s=i.getGFXTexture();if(!s||!s.width||!s.height)return;e.bindTexture(r,s,n),e.bindSampler(r,i.getGFXSampler(),n)}},i._doDestroy=function(){if(this._passes&&this._passes.length)for(var e,t=s(this._passes);!(e=t()).done;)e.value.destroy();this._passes.length=0},i.initDefault=function(t){e.prototype.initDefault.call(this,t),this.initialize({effectName:"builtin-unlit",defines:{USE_COLOR:!0},technique:0}),this.setProperty("mainColor",new G("#ff00ff"))},i.validate=function(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0},l(t,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),t}(Qt),Eo=g(Co.prototype,"_effectAsset",[xo],(function(){return null})),Mo=g(Co.prototype,"_techIdx",[v],(function(){return 0})),Po=g(Co.prototype,"_defines",[v],(function(){return[]})),ko=g(Co.prototype,"_states",[v],(function(){return[]})),Lo=g(Co.prototype,"_props",[v],(function(){return[]})),So=Co))||So));p.Material=No;var Fo,Ho=e("a",i({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048})),Go=e("b",i({Planar:0,ShadowMap:1})),zo=(e("P",i({HARD:0,SOFT:1,SOFT_2X:2,SOFT_4X:3})),e("C",i({LEVEL_1:1,LEVEL_2:2,LEVEL_3:3,LEVEL_4:4})),e("c",i({NONE:1,RemoveDuplicates:2,DisableRotationFix:3})),Go.ShadowMap+1),Uo=e("d",function(){function e(){this.fixedSphere=new pe(0,0,0,.01),this.maxReceived=4,this._matLight=new j,this._material=null,this._instancingMaterial=null,this._enabled=!1,this._type=zo,this._distance=0,this._normal=new N(0,1,0),this._shadowColor=new G(0,0,0,76),this._size=new O(1024,1024),this._shadowMapDirty=!1}var t=e.prototype;return t.getPlanarShader=function(e){this._material||(this._material=new No,this._material.initialize({effectName:"pipeline/planar-shadow"}));var t=this._material.passes;return t.length>0?t[0].getShaderVariant(e):null},t.initialize=function(e){this._enabled=e.enabled,this._type=this.enabled?e.type:zo,this.normal=e.planeDirection,this.distance=e.planeHeight,this.shadowColor=e.shadowColor,this.maxReceived=e.maxReceived,e.shadowMapSize!==this._size.x&&(this.size.set(e.shadowMapSize,e.shadowMapSize),this._shadowMapDirty=!0)},t.activate=function(){if(this._enabled)if(this.type===Go.Planar)this._updatePlanarInfo();else{var e=p.director.root;e.pipeline.macros.CC_SHADOW_TYPE=2,e.onGlobalPipelineStateChanged()}else{var t=p.director.root;t.pipeline.macros.CC_SHADOW_TYPE=0,t.onGlobalPipelineStateChanged()}},t._updatePlanarInfo=function(){this._material||(this._material=new No,this._material.initialize({effectName:"pipeline/planar-shadow"}));var e=p.director.root;e.pipeline.macros.CC_SHADOW_TYPE=1,e.onGlobalPipelineStateChanged()},t.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this.fixedSphere.destroy()},l(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this.activate()}},{key:"type",get:function(){return this._type},set:function(e){this._type=this.enabled?e:zo,this.activate()}},{key:"normal",get:function(){return this._normal},set:function(e){N.copy(this._normal,e)}},{key:"distance",get:function(){return this._distance},set:function(e){this._distance=e}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(e){this._shadowColor=e}},{key:"size",get:function(){return this._size},set:function(e){this._size.set(e)}},{key:"shadowMapDirty",get:function(){return this._shadowMapDirty},set:function(e){this._shadowMapDirty=e}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}}]),e}());Uo.MAX_FAR=2e3,Uo.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),p.Shadows=Uo;var jo=new jt;jo.format=Ke.RGBA8;var Vo=new Vt;Vo.format=Ke.DEPTH_STENCIL;var Wo=new Wt([jo],Vo),Xo={width:1,height:1,renderPassInfo:Wo},qo=e("a7",n("cc.RenderTexture")(Fo=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._window=null,t}r(t,e);var i=t.prototype;return i.initialize=function(e){this._name=e.name||"",this._width=e.width,this._height=e.height,this._initWindow(e)},i.reset=function(e){this.initialize(e)},i.destroy=function(){if(this._window){var t=p.director.root;null==t||t.destroyWindow(this._window),this._window=null}return e.prototype.destroy.call(this)},i.resize=function(e,t){this._width=Math.floor(_e(e,1,2048)),this._height=Math.floor(_e(t,1,2048)),this._window&&this._window.resize(this._width,this._height),this.emit("resize",this._window)},i._serialize=function(){return{}},i._deserialize=function(t,i){var n=t;this._width=n.w,this._height=n.h,this._name=n.n,e.prototype._deserialize.call(this,n.base,i)},i.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},i.onLoaded=function(){this._initWindow()},i._initWindow=function(e){var t=p.director.root;Xo.title=this._name,Xo.width=this._width,Xo.height=this._height,Xo.renderPassInfo=e&&e.passInfo?e.passInfo:Wo,Xo.externalResLow=e&&e.externalResLow?e.externalResLow:0,Xo.externalResHigh=e&&e.externalResHigh?e.externalResHigh:0,Xo.externalFlag=e&&e.externalFlag?e.externalFlag:et.NONE,jo.barrier=Me.gfxDevice.getGeneralBarrier(new Xt(qt.FRAGMENT_SHADER_READ_TEXTURE,qt.FRAGMENT_SHADER_READ_TEXTURE)),this._window?(this._window.destroy(),this._window.initialize(Me.gfxDevice,Xo)):this._window=t.createWindow(Xo)},i.initDefault=function(t){e.prototype.initDefault.call(this,t),this._width=this._height=1,this._initWindow()},i.validate=function(){return this.width>=1&&this.width<=2048&&this.height>=1&&this.height<=2048},i.readPixels=function(e,t,i,n,r){void 0===e&&(e=0),void 0===t&&(t=0),i=i||this.width,n=n||this.height;var s=this.getGFXTexture();if(!s)return d(7606),null;var o=4*i*n;if(void 0===r)r=new Uint8Array(o);else if(r.length<o)return d(7607,o),null;var a=this._getGFXDevice(),u=[],h=[],l=new it;return l.texOffset.x=e,l.texOffset.y=t,l.texExtent.width=i,l.texExtent.height=n,h.push(l),u.push(r),null==a||a.copyTextureToBuffers(s,u,h),r},l(t,[{key:"window",get:function(){return this._window}}]),t}(Ji))||Fo);p.RenderTexture=qo;var Ko=e("A",function(){function e(){this._groundAlbedoHDR=new F(.2,.2,.2,1),this._skyColorHDR=new F(.2,.5,.8,1),this._skyIllumHDR=0,this._groundAlbedoLDR=new F(.2,.2,.2,1),this._skyColorLDR=new F(.2,.5,.8,1),this._skyIllumLDR=0,this._mipmapCount=1,this._enabled=!1}return e.prototype.initialize=function(e){this._skyColorHDR=e.skyColorHDR,this._groundAlbedoHDR.set(e.groundAlbedoHDR),this._skyIllumHDR=e.skyIllumHDR,this._skyColorLDR=e.skyColorLDR,this._groundAlbedoLDR.set(e.groundAlbedoLDR),this._skyIllumLDR=e.skyIllumLDR},l(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"skyColor",get:function(){return p.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR:this._skyColorLDR},set:function(e){p.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(e):this._skyColorLDR.set(e)}},{key:"skyIllum",get:function(){return p.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(e){p.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=e:this._skyIllumLDR=e}},{key:"groundAlbedo",get:function(){return p.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR:this._groundAlbedoLDR},set:function(e){p.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(e):this._groundAlbedoLDR.set(e)}}]),e}());Ko.SUN_ILLUM=65e3,Ko.SKY_ILLUM=2e4,p.Ambient=Ko;var Jo=e("u",function(e){function t(t,i){var n;(n=e.call(this,t.root)||this)._parent=void 0,n._owner=void 0,n._dontNotify=!1,n._parent=t,n._owner=i,n._doInit(n._parent,!0);for(var r=0;r<n._shaderInfo.blocks.length;r++){var s=n._shaderInfo.blocks[r],o=n._blocks[s.binding],a=n._parent.blocks[s.binding];o.set(a)}n._rootBufferDirty=!0;for(var u=n._parent,h=0;h<n._shaderInfo.samplerTextures.length;h++)for(var l=n._shaderInfo.samplerTextures[h],f=0;f<l.count;f++){var c=u._descriptorSet.getSampler(l.binding,f),p=u._descriptorSet.getTexture(l.binding,f);n._descriptorSet.bindSampler(l.binding,c,f),n._descriptorSet.bindTexture(l.binding,p,f)}return e.prototype.tryCompile.call(de(n)),n}r(t,e);var i=t.prototype;return i.overridePipelineStates=function(e,t){this._bs.reset(),this._rs.reset(),this._dss.reset(),bo.fillPipelineInfo(this,e),bo.fillPipelineInfo(this,t),this._onStateChange()},i.tryCompile=function(t){if(t&&!Us(this._defines,t))return!1;var i=e.prototype.tryCompile.call(this);return this._onStateChange(),i},i.beginChangeStatesSilently=function(){this._dontNotify=!0},i.endChangeStatesSilently=function(){this._dontNotify=!1},i._syncBatchingScheme=function(){this._defines.USE_INSTANCING=!1,this._batchingScheme=ao.NONE},i._onStateChange=function(){this._hash=bo.getPassHash(this),this._owner.onPassStateChange(this._dontNotify)},l(t,[{key:"parent",get:function(){return this._parent}}]),t}(bo)),Yo=e("M",function(e){function t(t){var i;return(i=e.call(this)||this)._passes=[],i._parent=void 0,i._owner=void 0,i._subModelIdx=0,i._parent=t.parent,i._owner=t.owner||null,i._subModelIdx=t.subModelIdx||0,i.copy(i._parent),i}r(t,e);var i=t.prototype;return i.recompileShaders=function(e,t){if(this._passes&&this.effectAsset)if(void 0===t)for(var i,n=s(this._passes);!(i=n()).done;)i.value.tryCompile(e);else this._passes[t].tryCompile(e)},i.overridePipelineStates=function(e,t){if(this._passes&&this.effectAsset){var i=this.effectAsset.techniques[this.technique].passes;if(void 0===t)for(var n=0;n<this._passes.length;n++){var r=this._passes[n],s=this._states[n]||(this._states[n]={});for(var o in e)s[o]=e[o];r.overridePipelineStates(i[r.passIndex],s)}else{var a=this._states[t]||(this._states[t]={});for(var u in e)a[u]=e[u];this._passes[t].overridePipelineStates(i[t],a)}}},i.destroy=function(){return this._doDestroy(),!0},i.onPassStateChange=function(e){this._hash=No.getHash(this),!e&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},i._createPasses=function(){var e=[],t=this._parent.passes;if(!t)return e;for(var i=0;i<t.length;++i)e.push(new Jo(t[i],this));return e},l(t,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]),t}(No)),Qo=null,$o=null,Zo=e("E",i({HEMISPHERE_DIFFUSE:0,AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION:1,DIFFUSEMAP_WITH_REFLECTION:2})),ea=e("S",function(){function e(){this._envmapLDR=null,this._envmapHDR=null,this._diffuseMapLDR=null,this._diffuseMapHDR=null,this._globalDSManager=null,this._model=null,this._default=null,this._enabled=!1,this._useIBL=!1,this._useHDR=!0,this._useDiffuseMap=!1,this._editableMaterial=null,this._activated=!1,this._reflectionHDR=null,this._reflectionLDR=null,this._rotationAngle=0}var t=e.prototype;return t.initialize=function(e){this._activated=!1,this._enabled=e.enabled,this._useIBL=e.useIBL,this._useDiffuseMap=e.applyDiffuseMap,this._useHDR=e.useHDR},t.setEnvMaps=function(e,t){this._envmapHDR=e,this._envmapLDR=t,this._updateGlobalBinding(),this._updatePipeline()},t.setDiffuseMaps=function(e,t){this._diffuseMapHDR=e,this._diffuseMapLDR=t,this._updateGlobalBinding(),this._updatePipeline()},t.setSkyboxMaterial=function(e){e?(this._editableMaterial=new Yo({parent:e}),this._editableMaterial.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})):this._editableMaterial=null,this._updatePipeline()},t.setReflectionMaps=function(e,t){this._reflectionHDR=e,this._reflectionLDR=t,this._updateGlobalBinding(),this._updatePipeline()},t.setRotationAngle=function(e){this._rotationAngle=e},t.getRotationAngle=function(){return this._rotationAngle},t.updateMaterialRenderInfo=function(){this._updateGlobalBinding(),this._updatePipeline()},t.activate=function(){var e=p.director.root.pipeline;this._globalDSManager=e.globalDSManager,this._default=Ds.get("default-cube-texture"),this._model||(this._model=p.director.root.createModel(p.renderer.scene.Model));var t=this._default.isRGBE;if(this._default.isUsingOfflineMipmaps(),this.envmap&&(t=this.envmap.isRGBE,this.envmap.isUsingOfflineMipmaps()),!$o){var i=new No;i.initialize({effectName:"pipeline/skybox",defines:{USE_RGBE_CUBEMAP:t}}),$o=new Yo({parent:i})}this.enabled&&(Qo||(Qo=p.utils.createMesh(p.primitives.box({width:2,height:2,length:2}))),this._editableMaterial?this._model.initSubModel(0,Qo.renderingSubMeshes[0],this._editableMaterial):this._model.initSubModel(0,Qo.renderingSubMeshes[0],$o)),this.envmap||(this.envmap=this._default),this.diffuseMap||(this.diffuseMap=this._default),this._updateGlobalBinding(),this._updatePipeline(),this._activated=!0},t._updatePipeline=function(){var e=p.director.root,t=e.pipeline,i=this.useIBL?this.isRGBE?2:1:0,n=this.useIBL&&this.useDiffuseMap&&this.diffuseMap?this.isRGBE?2:1:0,r=this.useHDR,s=this.useConvolutionMap;if(t.macros.CC_USE_IBL===i&&t.macros.CC_USE_DIFFUSEMAP===n&&t.macros.CC_USE_HDR===r&&t.macros.CC_IBL_CONVOLUTED===s||(t.macros.CC_USE_IBL=i,t.macros.CC_USE_DIFFUSEMAP=n,t.macros.CC_USE_HDR=r,t.macros.CC_IBL_CONVOLUTED=s,this._activated&&e.onGlobalPipelineStateChanged()),this.enabled){var o=this.envmap?this.envmap:this._default,a=this._editableMaterial?this._editableMaterial:$o;a&&(a.setProperty("environmentMap",o),a.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})),this._model&&(this._model.setSubModelMaterial(0,a),this._updateSubModes())}},t._updateGlobalBinding=function(){if(this._globalDSManager){var e=Me.gfxDevice;if(this.reflectionMap){var t=this.reflectionMap.getGFXTexture(),i=e.getSampler(this.reflectionMap.getSamplerInfo());this._globalDSManager.bindSampler(We,i),this._globalDSManager.bindTexture(We,t)}else{var n=this.envmap?this.envmap:this._default;if(n){var r=n.getGFXTexture(),s=e.getSampler(n.getSamplerInfo());this._globalDSManager.bindSampler(We,s),this._globalDSManager.bindTexture(We,r)}}var o=this.diffuseMap?this.diffuseMap:this._default;if(o){var a=o.getGFXTexture(),u=e.getSampler(o.getSamplerInfo());this._globalDSManager.bindSampler(Xe,u),this._globalDSManager.bindTexture(Xe,a)}this._globalDSManager.update()}},t._updateSubModes=function(){if(this._model)for(var e=this._model.subModels,t=0;t<e.length;t++)e[t].update()},l(e,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,e?this.activate():this._updatePipeline()}},{key:"useHDR",get:function(){return this._useHDR},set:function(e){this._useHDR=e,this.setEnvMaps(this._envmapHDR,this._envmapLDR)}},{key:"useIBL",get:function(){return this._useIBL},set:function(e){this._useIBL=e,this._updatePipeline()}},{key:"useDiffuseMap",get:function(){return this._useDiffuseMap},set:function(e){this._useDiffuseMap=e,this._updatePipeline()}},{key:"isRGBE",get:function(){return!!this.envmap&&this.envmap.isRGBE}},{key:"useConvolutionMap",get:function(){return this.reflectionMap?this.reflectionMap.isUsingOfflineMipmaps():!!this.envmap&&this.envmap.isUsingOfflineMipmaps()}},{key:"envmap",get:function(){return p.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(e){p.director.root.pipeline.pipelineSceneData.isHDR?this.setEnvMaps(e,this._envmapLDR):this.setEnvMaps(this._envmapHDR,e)}},{key:"diffuseMap",get:function(){return p.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(e){p.director.root.pipeline.pipelineSceneData.isHDR?this.setDiffuseMaps(e,this._diffuseMapLDR):this.setDiffuseMaps(this._diffuseMapHDR,e)}},{key:"reflectionMap",get:function(){return p.director.root.pipeline.pipelineSceneData.isHDR?this._reflectionHDR:this._reflectionLDR}},{key:"editableMaterial",get:function(){return this._editableMaterial}}]),e}());p.Skybox=ea;var ta,ia,na=new F,ra=e("F",i({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3})),sa=ra.LAYERED+1,oa=e("e",function(){function e(){this._fogColor=new G("#C8C8C8"),this._colorArray=new F(.2,.2,.2,1),this._enabled=!1,this._accurate=!1,this._type=0,this._fogDensity=.3,this._fogStart=.5,this._fogEnd=300,this._fogAtten=5,this._fogTop=1.5,this._fogRange=1.2,this._activated=!1}var t=e.prototype;return t.initialize=function(e){this._activated=!1,this.fogColor=e.fogColor,this._enabled=e.enabled,this._type=this.enabled?e.type:sa,this._accurate=e.accurate,this.fogDensity=e.fogDensity,this.fogStart=e.fogStart,this.fogEnd=e.fogEnd,this.fogAtten=e.fogAtten,this.fogTop=e.fogTop,this.fogRange=e.fogRange},t.activate=function(){this._updatePipeline(),this._activated=!0},t._updatePipeline=function(){var e=p.director.root,t=this.enabled?this.type:sa,i=this.accurate?1:0,n=e.pipeline;n.macros.CC_USE_FOG===t&&n.macros.CC_USE_ACCURATE_FOG===i||(n.macros.CC_USE_FOG=t,n.macros.CC_USE_ACCURATE_FOG=i,this._activated&&e.onGlobalPipelineStateChanged())},l(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,e?this.activate():(this._type=sa,this._updatePipeline())}},{key:"accurate",get:function(){return this._accurate},set:function(e){this._accurate=e,this._updatePipeline()}},{key:"fogColor",get:function(){return this._fogColor},set:function(e){this._fogColor.set(e),na.set(e.x,e.y,e.z,e.w),To(this._colorArray,na)}},{key:"type",get:function(){return this._type},set:function(e){this._type=this.enabled?e:sa,this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(e){this._fogDensity=e}},{key:"fogStart",get:function(){return this._fogStart},set:function(e){this._fogStart=e}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(e){this._fogEnd=e}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(e){this._fogAtten=e}},{key:"fogTop",get:function(){return this._fogTop},set:function(e){this._fogTop=e}},{key:"fogRange",get:function(){return this._fogRange},set:function(e){this._fogRange=e}},{key:"colorArray",get:function(){return this._colorArray}}]),e}());p.Fog=oa,e("y",ta),function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD"}(ta||e("y",ta={})),e("T",ia),function(e){e[e.NONE=0]="NONE",e[e.POSITION=1]="POSITION",e[e.ROTATION=2]="ROTATION",e[e.SCALE=4]="SCALE",e[e.RS=e.ROTATION|e.SCALE]="RS",e[e.TRS=e.POSITION|e.ROTATION|e.SCALE]="TRS",e[e.TRS_MASK=~e.TRS]="TRS_MASK"}(ia||e("T",ia={})),p.internal.TransformBit=ia;var aa,ua=e("z",i({Static:0,Stationary:1,Movable:2}));ge(Ji.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),ve(qo.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this.window}}]);var ha=((aa={})[Kt.UNORM]="Uint",aa[Kt.SNORM]="Int",aa[Kt.UINT]="Uint",aa[Kt.INT]="Int",aa[Kt.UFLOAT]="Float",aa[Kt.FLOAT]="Float",aa.default="Uint",aa);function la(e){return""+(ha[e.type]||ha.default)+e.size/e.count*8}function fa(e,t,i,n,r,s,o){void 0===i&&(i=Ke.R32F),void 0===n&&(n=0),void 0===r&&(r=e.byteLength-n),void 0===s&&(s=0),o||(o=new DataView(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)));var u=Jt[i];s||(s=u.size);for(var h="set"+la(u),l="get"+la(u),f=u.size/u.count,c=Math.floor(r/s),p=a.isLittleEndian,_=0;_<c;++_)for(var d=n+s*_,g=0;g<u.count;++g){var v=d+f*g,m=e[l](v,p);o[h](v,t(m,g,e),p)}return o}e("_",function(){function e(e,t,i,n,r,s){void 0===n&&(n=null),void 0===r&&(r=null),void 0===s&&(s=!0),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._isOwnerOfIndexBuffer=!0,this._drawInfo=null,this._attributes=t,this._vertexBuffers=e,this._indexBuffer=n,this._indirectBuffer=r,this._primitiveMode=i,this._iaInfo=new Et(t,e,n,r),this._isOwnerOfIndexBuffer=s}var t=e.prototype;return t.invalidateGeometricInfo=function(){this._geometricInfo=void 0},t.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var e=this.mesh,t=0,i=e.struct.primitives[this.subMeshIdx];i.indexView&&(t=i.indexView.count);for(var n=0;n<i.vertexBundelIndices.length;n++){var r=i.vertexBundelIndices[n],s=e.struct.vertexBundles[r],o=i.indexView?i.indexView.count:s.view.count,a=s.view.stride,u=a*o,h=new Uint8Array(e.data.buffer,s.view.offset,s.view.length),l=new Uint8Array(i.indexView?u:s.view.length);if(i.indexView){for(var f=e.readIndices(this.subMeshIdx),c=0;c<t;++c)for(var p=c*a,_=f[c]*a,d=0;d<a;++d)l[p+d]=h[_+d];this._flatBuffers.push({stride:a,count:o,buffer:l})}else l.set(e.data.subarray(s.view.offset,s.view.offset+s.view.length)),this._flatBuffers.push({stride:a,count:o,buffer:l})}}},t.destroy=function(){for(var e=0;e<this.vertexBuffers.length;e++)this.vertexBuffers[e].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._isOwnerOfIndexBuffer&&this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var t=0;t<this._jointMappedBufferIndices.length;t++)this._jointMappedBuffers[this._jointMappedBufferIndices[t]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null)},t.enableVertexIdChannel=function(e){if(!this._vertexIdChannel){var t=this.vertexBuffers.length,i=this.attributes.length,n=this._allocVertexIdBuffer(e);this._vertexBuffers.push(n),this._attributes.push(new At("a_vertexId",Ke.R32F,!1,t)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:t,index:i}}},t._allocVertexIdBuffer=function(e){for(var t=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,i=new Float32Array(t),n=0;n<t;++n)i[n]=n+.5;var r=e.createBuffer(new xt(St.VERTEX|St.TRANSFER_DST,Ct.DEVICE,i.byteLength,i.BYTES_PER_ELEMENT));return r.update(i),r},l(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:N.ZERO,max:N.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:N.ZERO,max:N.ZERO}};var e=this.mesh,t=this.subMeshIdx,i=e.readAttribute(t,Yt.ATTR_POSITION),n=e.readIndices(t),r=new N,s=new N,o=this.attributes.find((function(e){return e.name===Yt.ATTR_POSITION}));if(o){var a=Jt[o.format].count;2===a?(r.set(i[0],i[1],0),s.set(i[0],i[1],0)):(r.set(i[0],i[1],i[2]),s.set(i[0],i[1],i[2]));for(var u=0;u<i.length;u+=a)2===a?(r.x=i[u]>r.x?i[u]:r.x,r.y=i[u+1]>r.y?i[u+1]:r.y,s.x=i[u]<s.x?i[u]:s.x,s.y=i[u+1]<s.y?i[u+1]:s.y):(r.x=i[u]>r.x?i[u]:r.x,r.y=i[u+1]>r.y?i[u+1]:r.y,r.z=i[u+2]>r.z?i[u+2]:r.z,s.x=i[u]<s.x?i[u]:s.x,s.y=i[u+1]<s.y?i[u+1]:s.y,s.z=i[u+2]<s.z?i[u+2]:s.z)}return this._geometricInfo={positions:i,indices:n,boundingBox:{max:r,min:s}},this._geometricInfo}},{key:"drawInfo",get:function(){return this._drawInfo},set:function(e){this._drawInfo=e}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var e=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var t=this._jointMappedBuffers=[],i=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var n,r,s=this.mesh.struct,o=s.primitives[this.subMeshIdx];if(!s.jointMaps||void 0===o.jointMapIndex||!s.jointMaps[o.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var a=p.director.root.device,u=function(){var u=s.vertexBundles[o.vertexBundelIndices[h]];r=0,n=Ke.UNKNOWN;for(var l=0;l<u.attributes.length;l++){var f=u.attributes[l];if(f.name===Yt.ATTR_JOINTS){n=f.format;break}r+=Jt[f.format].size}if(n){var c=new Uint8Array(e.mesh.data.buffer,u.view.offset,u.view.length),p=new DataView(c.slice().buffer),_=s.jointMaps[o.jointMapIndex];fa(p,(function(e){return _.indexOf(e)}),n,r,u.view.length,u.view.stride,p);var d=a.createBuffer(new xt(St.VERTEX|St.TRANSFER_DST,Ct.DEVICE,u.view.length,u.view.stride));d.update(p.buffer),t.push(d),i.push(h)}else t.push(e.vertexBuffers[o.vertexBundelIndices[h]])},h=0;h<o.vertexBundelIndices.length;h++)u();return this._vertexIdChannel&&t.push(this._allocVertexIdBuffer(a)),t}},{key:"iaInfo",get:function(){return this._iaInfo}}]),e}());var ca,pa,_a,da,ga,va,ma,ya,ba,Aa,Ra,wa,Ia,Ta,Da,xa,Sa,Ca=e("ah",function(){var e=t.prototype;function t(e){this._uiComp=null,this._opacity=1,this._localOpacity=1,this.colorDirty=!0,this._uiTransformComp=null,this._node=void 0,this._node=e}return e.setOpacity=function(e){this._opacity=e},e.applyOpacity=function(e){this._opacity=this._localOpacity*e},t.markOpacityTree=function(){},l(t,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(e){this._uiTransformComp=e}},{key:"uiComp",get:function(){return this._uiComp},set:function(e){this._uiComp&&e?u(12002):this._uiComp=e}},{key:"opacity",get:function(){return this._opacity}},{key:"localOpacity",get:function(){return this._localOpacity},set:function(e){this._localOpacity=e,this.colorDirty=!0}}]),t}());me.Flags.Destroying,p.GAME_VIEW;var Ea=me.Flags.Destroying,Ma=me.Flags.DontDestroy,Pa=me.Flags.Deactivating,ka=new m("Node");function La(e){return e?"string"==typeof e?be(e):e:(d(3804),null)}var Ba=new N,Oa=new N,Na=new H,Fa=new H,Ha=new H,Ga=new fe;new fe;var za,Ua,ja,Va,Wa,Xa,qa,Ka,Ja,Ya,Qa,$a,Za,eu,tu,iu,nu,ru,su,ou,au,uu,hu,lu,fu,cu,pu,_u,du,gu,vu,mu,yu,bu,Au,Ru,wu,Iu,Tu,Du,xu,Su,Cu,Eu,Mu,Pu,ku,Lu,Bu,Ou,Nu,Fu,Hu,Gu,zu,Uu,ju,Vu,Wu,Xu,qu,Ku,Ju,Yu,Qu,$u,Zu,eh,th,ih,nh,rh,sh,oh,ah,uh,hh,lh,fh,ch,ph,_h,dh,gh,vh,mh,yh,bh,Ah,Rh,wh,Ih,Th,Dh,xh,Sh,Ch,Eh,Mh,Ph,kh,Lh,Bh,Oh,Nh,Fh,Hh,Gh,zh,Uh,jh,Vh,Wh,Xh,qh,Kh,Jh,Yh,Qh,$h,Zh,el,tl=new j,il=new j,nl=[],rl=Symbol("ReserveContentsForAllSyncablePrefab"),sl=0,ol=e("N",(ca=n("cc.Node"),pa=K(N),_a=K(ua),ca(((Sa=function(e){r(i,e),i._setScene=function(e){e._updateScene()},i._findComponent=function(e,t){var i=t,n=e._components;if(i._sealed)for(var r=0;r<n.length;++r){var s=n[r];if(s.constructor===t)return s}else for(var o=0;o<n.length;++o){var a=n[o];if(a instanceof t)return a}return null},i._findComponents=function(e,t,i){var n=t,r=e._components;if(n._sealed)for(var s=0;s<r.length;++s){var o=r[s];o.constructor===t&&i.push(o)}else for(var a=0;a<r.length;++a){var u=r[a];u instanceof t&&i.push(u)}},i._findChildComponent=function(e,t){for(var n=0;n<e.length;++n){var r=e[n],s=i._findComponent(r,t);if(s)return s;if(r._children.length>0&&(s=i._findChildComponent(r._children,t)))return s}return null},i._findChildComponents=function(e,t,n){for(var r=0;r<e.length;++r){var s=e[r];i._findComponents(s,t,n),s._children.length>0&&i._findChildComponents(s._children,t,n)}};var t=i.prototype;function i(t){var i;return(i=e.call(this,t)||this)._parent=va&&va(),i._children=ma&&ma(),i._active=ya&&ya(),i._components=ba&&ba(),i._prefab=Aa&&Aa(),i._scene=null,i._activeInHierarchy=!1,i._id=ka.getNewId(),i._name=void 0,i._eventProcessor=new p.NodeEventProcessor(de(i)),i._eventMask=0,i._siblingIndex=0,i._originalSceneId="",i._uiProps=new Ca(de(i)),i._static=!1,i._lpos=Ra&&Ra(),i._lrot=wa&&wa(),i._lscale=Ia&&Ia(),i._mobility=Ta&&Ta(),i._layer=Da&&Da(),i._euler=xa&&xa(),i._transformFlags=ia.NONE,i._eulerDirty=!1,i._flagChangeVersion=0,i._hasChangedFlags=0,i._name=void 0!==t?t:"New Node",i._pos=new N,i._rot=new H,i._scale=new N(1,1,1),i._mat=new j,i}return t.getWritableComponents=function(){return this._components},t._updateScene=function(){null==this._parent?b("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},t.attr=function(e){te(this,e)},t.getParent=function(){return this._parent},t.modifyParent=function(e){this._parent=e},t.setParent=function(e,t){if(void 0===t&&(t=!1),t&&this.updateWorldTransform(),this._parent!==e){var i=this._parent,n=e;if(this._parent=n,this._siblingIndex=0,this._onSetParent(i,t),this.emit&&this.emit(Ri.PARENT_CHANGED,i),i&&!(i._objFlags&Ea)){var r=i._children.indexOf(this);i._children.splice(r,1),i._updateSiblingIndex(),i.emit&&i.emit(Ri.CHILD_REMOVED,this)}n&&(n._children.push(this),this._siblingIndex=n._children.length-1,n.emit&&n.emit(Ri.CHILD_ADDED,this)),this._onHierarchyChanged(i)}},t.getChildByUuid=function(e){if(!e)return ye("Invalid uuid"),null;for(var t=this._children,i=0,n=t.length;i<n;i++)if(t[i]._id===e)return t[i];return null},t.getChildByName=function(e){if(!e)return ye("Invalid name"),null;for(var t=this._children,i=0,n=t.length;i<n;i++)if(t[i]._name===e)return t[i];return null},t.getChildByPath=function(e){for(var t=e.split("/"),i=this,n=function(){var e=t[r];if(0===e.length)return"continue";var n=i.children.find((function(t){return t.name===e}));if(!n)return{v:null};i=n},r=0;r<t.length;++r){var s=n();if("continue"!==s&&"object"==typeof s)return s.v}return i},t.addChild=function(e){e.setParent(this)},t.insertChild=function(e,t){e.setParent(this),e.setSiblingIndex(t)},t.getSiblingIndex=function(){return this._siblingIndex},t.setSiblingIndex=function(e){if(this._parent)if(this._parent._objFlags&Pa)d(3821);else{var t=this._parent._children;e=-1!==e?e:t.length-1;var i=t.indexOf(this);e!==i&&(t.splice(i,1),e<t.length?t.splice(e,0,this):t.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(e),this._eventProcessor.onUpdatingSiblingIndex())}},t.walk=function(e,t){var n=1,r=null,s=null,o=0,a=i._stacks[i._stackId];a||(a=[],i._stacks.push(a)),i._stackId++,a.length=0,a[0]=this;for(var u=null,h=!1;n;)if(s=a[--n])if(!h&&e?e(s):h&&t&&t(s),a[n]=null,h){if(u===this._parent)break;if(h=!1,r)if(r[++o])a[n]=r[o],n++;else if(u&&(a[n]=u,n++,h=!0,u._parent?(o=(r=u._parent._children).indexOf(u),u=u._parent):(u=null,r=null),o<0))break}else s._children.length>0?(u=s,r=s._children,o=0,a[n]=r[o],n++):(a[n]=s,n++,h=!0);a.length=0,i._stackId--},t.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},t.removeChild=function(e){this._children.indexOf(e)>-1&&(e.parent=null)},t.removeAllChildren=function(){for(var e=this._children,t=e.length-1;t>=0;t--){var i=e[t];i&&(i.parent=null)}this._children.length=0},t.isChildOf=function(e){var t=this;do{if(t===e)return!0;t=t._parent}while(t);return!1},t.getComponent=function(e){var t=La(e);return t?i._findComponent(this,t):null},t.getComponents=function(e){var t=La(e),n=[];return t&&i._findComponents(this,t,n),n},t.getComponentInChildren=function(e){var t=La(e);return t?i._findChildComponent(this._children,t):null},t.getComponentsInChildren=function(e){var t=La(e),n=[];return t&&(i._findComponents(this,t,n),i._findChildComponents(this._children,t,n)),n},t.addComponent=function(e){var t;if("string"==typeof e){if(!(t=be(e)))throw p._RF.peek()&&d(3808,e),TypeError(w(3807,e))}else{if(!e)throw TypeError(w(3804));t=e}if("function"!=typeof t)throw TypeError(w(3809));if(!M(t,p.Component))throw TypeError(w(3810));var i=t._requireComponent;if(i)if(Array.isArray(i))for(var n=0;n<i.length;n++){var r=i[n];this.getComponent(r)||this.addComponent(r)}else{var s=i;this.getComponent(s)||this.addComponent(s)}var o=new t;return o.node=this,this._components.push(o),this.emit(Ri.COMPONENT_ADDED,o),this._activeInHierarchy&&p.director._nodeActivator.activateComp(o),o},t.removeComponent=function(e){if(e){var t=null;(t=e instanceof $t?e:this.getComponent(e))&&t.destroy()}else d(3813)},t.on=function(e,t,i,n){switch(void 0===n&&(n=!1),e){case Ri.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(e,t,i,n)},t.off=function(e,t,i,n){if(void 0===n&&(n=!1),this._eventProcessor.off(e,t,i,n),!this._eventProcessor.hasEventListener(e))switch(e){case Ri.TRANSFORM_CHANGED:this._eventMask&=-2}},t.once=function(e,t,i,n){this._eventProcessor.once(e,t,i,n)},t.emit=function(e,t,i,n,r,s){this._eventProcessor.emit(e,t,i,n,r,s)},t.dispatchEvent=function(e){this._eventProcessor.dispatchEvent(e)},t.hasEventListener=function(e,t,i){return this._eventProcessor.hasEventListener(e,t,i)},t.targetOff=function(e){this._eventProcessor.targetOff(e),1&this._eventMask&&!this._eventProcessor.hasEventListener(Ri.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},t.destroy=function(){return!!e.prototype.destroy.call(this)&&(this.active=!1,!0)},t.destroyAllChildren=function(){for(var e=this._children,t=0;t<e.length;++t)e[t].destroy()},t._removeComponent=function(e){if(e){if(!(this._objFlags&Ea)){var t=this._components.indexOf(e);-1!==t?(this._components.splice(t,1),this.emit(Ri.COMPONENT_REMOVED,e)):e.node!==this&&d(3815)}}else d(3814)},t._updateSiblingIndex=function(){for(var e=0;e<this._children.length;++e)this._children[e]._siblingIndex=e;this.emit(Ri.SIBLING_ORDER_CHANGED)},t._instantiate=function(e,t){return e||(e=p.instantiate._clone(this,this)),e._prefab,e._parent=null,e._onBatchCreated(t),e},t._onHierarchyChangedBase=function(){var e=this._parent;!this._persistNode||e instanceof p.Scene||p.game.removePersistRootNode(this);var t=this._active&&!(!e||!e._activeInHierarchy);this._activeInHierarchy!==t&&p.director._nodeActivator.activateNode(this,t)},t._onPreDestroyBase=function(){this._objFlags|=Ea;var e=this._parent,t=!!e&&0!=(e._objFlags&Ea);if(!t&&ne&&this._registerIfAttached(!1),this._persistNode&&p.game.removePersistRootNode(this),!t&&e){this.emit(Ri.PARENT_CHANGED,this);var i=e._children.indexOf(this);e._children.splice(i,1),this._siblingIndex=0,e._updateSiblingIndex(),e.emit&&e.emit(Ri.CHILD_REMOVED,this)}this.emit(Ri.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var n=this._children,r=0;r<n.length;++r)n[r]._destroyImmediate();for(var s=this._components,o=0;o<s.length;++o)s[o]._destroyImmediate();return t},i.isNode=function(e){return e instanceof i&&(e.constructor===i||!(e instanceof p.Scene))},t._onPreDestroy=function(){return this._onPreDestroyBase()},t[Ae]=function(e){e.writeThis()},t._onSetParent=function(e,t){if(void 0===t&&(t=!1),this._parent&&(null!=e&&e._scene===this._parent._scene||null==this._parent._scene||this.walk(i._setScene)),t){var n=this._parent;n?(n.updateWorldTransform(),Re(j.determinant(n._mat),0,Ie)?(u(14300),this._transformFlags|=ia.TRS,this.updateWorldTransform()):(j.multiply(tl,j.invert(tl,n._mat),this._mat),j.toRTS(tl,this._lrot,this._lpos,this._lscale))):(N.copy(this._lpos,this._pos),H.copy(this._lrot,this._rot),N.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(ia.TRS)},t._onHierarchyChanged=function(e){this.eventProcessor.reattach(),this._onHierarchyChangedBase(e)},t._onBatchCreated=function(e){this.hasChangedFlags=ia.TRS,this._transformFlags|=ia.TRS;for(var t=this._children.length,i=0;i<t;++i)this._children[i]._siblingIndex=i,this._children[i]._onBatchCreated(e)},t._onBeforeSerialize=function(){this.eulerAngles},t._onPostActivated=function(e){e?(this._eventProcessor.setEnabled(!0),this.invalidateChildren(ia.TRS),this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.setTextureDirty(),this._uiProps.uiComp.markForUpdateRenderData())):this._eventProcessor.setEnabled(!1)},t.translate=function(e,t){var i=t||ta.LOCAL;if(i===ta.LOCAL)N.transformQuat(Ba,e,this._lrot),this._lpos.x+=Ba.x,this._lpos.y+=Ba.y,this._lpos.z+=Ba.z;else if(i===ta.WORLD)if(this._parent){H.invert(Na,this._parent.worldRotation),N.transformQuat(Ba,e,Na);var n=this.worldScale;this._lpos.x+=Ba.x/n.x,this._lpos.y+=Ba.y/n.y,this._lpos.z+=Ba.z/n.z}else this._lpos.x+=e.x,this._lpos.y+=e.y,this._lpos.z+=e.z;this.invalidateChildren(ia.POSITION),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.POSITION)},t.rotate=function(e,t){var i=t||ta.LOCAL;if(H.normalize(Na,e),i===ta.LOCAL)H.multiply(this._lrot,this._lrot,Na);else if(i===ta.WORLD){var n=this.worldRotation;H.multiply(Fa,Na,n),H.invert(Na,n),H.multiply(Fa,Na,Fa),H.multiply(this._lrot,this._lrot,Fa)}this._eulerDirty=!0,this.invalidateChildren(ia.ROTATION),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.ROTATION)},t.lookAt=function(e,t){this.getWorldPosition(Ba),N.subtract(Ba,Ba,e),N.normalize(Ba,Ba),H.fromViewUp(Na,Ba,t),this.setWorldRotation(Na)},t.invalidateChildren=function(e){var t,i,n=0,r=0,s=0,o=0,a=e|ia.POSITION;for(nl[0]=this;n>=0;){if(o=(t=nl[n--]).hasChangedFlags,t.isValid&&(t._transformFlags&o&e)!==e)for(t._transformFlags|=e,t.hasChangedFlags=o|e,s=(i=t._children).length,r=0;r<s;r++)nl[++n]=i[r];e=a}},t.updateWorldTransform=function(){if(this._transformFlags){for(var e,t=this,i=0;t&&t._transformFlags;)nl[i++]=t,t=t._parent;for(var n=0;i;){if(n|=(e=nl[--i])._transformFlags,t){if(n&ia.POSITION&&(N.transformMat4(e._pos,e._lpos,t._mat),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z),n&ia.RS){j.fromRTS(e._mat,e._lrot,e._lpos,e._lscale),j.multiply(e._mat,t._mat,e._mat);var r=n&ia.ROTATION?e._rot:null;j.toRTS(e._mat,r,null,e._scale)}}else n&ia.POSITION&&(N.copy(e._pos,e._lpos),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z),n&ia.RS&&(n&ia.ROTATION&&H.copy(e._rot,e._lrot),n&ia.SCALE&&N.copy(e._scale,e._lscale),j.fromRTS(e._mat,e._rot,e._pos,e._scale));e._transformFlags=ia.NONE,t=e}}},t.setPosition=function(e,t,i){void 0===t&&void 0===i?N.copy(this._lpos,e):void 0===i?N.set(this._lpos,e,t,this._lpos.z):N.set(this._lpos,e,t,i),this.invalidateChildren(ia.POSITION),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.POSITION)},t.getPosition=function(e){return e?N.set(e,this._lpos.x,this._lpos.y,this._lpos.z):N.copy(new N,this._lpos)},t.setRotation=function(e,t,i,n){void 0===t||void 0===i||void 0===n?H.copy(this._lrot,e):H.set(this._lrot,e,t,i,n),this._eulerDirty=!0,this.invalidateChildren(ia.ROTATION),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.ROTATION)},t.setRotationFromEuler=function(e,t,i){var n=void 0===i?this._euler.z:i;void 0===t?(N.copy(this._euler,e),H.fromEuler(this._lrot,e.x,e.y,e.z)):(N.set(this._euler,e,t,n),H.fromEuler(this._lrot,e,t,n)),this._eulerDirty=!1,this.invalidateChildren(ia.ROTATION),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.ROTATION)},t.getRotation=function(e){return e?H.set(e,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):H.copy(new H,this._lrot)},t.setScale=function(e,t,i){void 0===t&&void 0===i?N.copy(this._lscale,e):void 0===i?N.set(this._lscale,e,t,this._lscale.z):N.set(this._lscale,e,t,i),this.invalidateChildren(ia.SCALE),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.SCALE)},t.getScale=function(e){return e?N.set(e,this._lscale.x,this._lscale.y,this._lscale.z):N.copy(new N,this._lscale)},t.inverseTransformPoint=function(e,t){N.copy(e,t);for(var i=this,n=0;i._parent;)nl[n++]=i,i=i._parent;for(;n>=0;)N.transformInverseRTS(e,e,i._lrot,i._lpos,i._lscale),i=nl[--n];return e},t.setWorldPosition=function(e,t,i){void 0===t||void 0===i?N.copy(this._pos,e):N.set(this._pos,e,t,i);var n=this._parent,r=this._lpos;n?(n.updateWorldTransform(),N.transformMat4(r,this._pos,j.invert(tl,n._mat))):N.copy(r,this._pos),this.invalidateChildren(ia.POSITION),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.POSITION)},t.getWorldPosition=function(e){return this.updateWorldTransform(),e?N.copy(e,this._pos):N.copy(new N,this._pos)},t.setWorldRotation=function(e,t,i,n){void 0===t||void 0===i||void 0===n?H.copy(this._rot,e):H.set(this._rot,e,t,i,n),this._parent?(this._parent.updateWorldTransform(),H.multiply(this._lrot,H.conjugate(this._lrot,this._parent._rot),this._rot)):H.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(ia.ROTATION),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.ROTATION)},t.setWorldRotationFromEuler=function(e,t,i){H.fromEuler(this._rot,e,t,i),this._parent?(this._parent.updateWorldTransform(),H.multiply(this._lrot,H.conjugate(this._lrot,this._parent._rot),this._rot)):H.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(ia.ROTATION),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.ROTATION)},t.getWorldRotation=function(e){return this.updateWorldTransform(),e?H.copy(e,this._rot):H.copy(new H,this._rot)},t.setWorldScale=function(e,t,i){var n=this._parent;n&&this.updateWorldTransform(),void 0===t||void 0===i?N.copy(this._scale,e):N.set(this._scale,e,t,i),n?(Ba.x=this._scale.x/N.set(Oa,this._mat.m00,this._mat.m01,this._mat.m02).length(),Ba.y=this._scale.y/N.set(Oa,this._mat.m04,this._mat.m05,this._mat.m06).length(),Ba.z=this._scale.z/N.set(Oa,this._mat.m08,this._mat.m09,this._mat.m10).length(),j.scale(tl,this._mat,Ba),j.multiply(il,j.invert(il,n._mat),tl),fe.fromQuat(Ga,H.conjugate(Ha,this._lrot)),fe.multiplyMat4(Ga,Ga,il),this._lscale.x=N.set(Ba,Ga.m00,Ga.m01,Ga.m02).length(),this._lscale.y=N.set(Ba,Ga.m03,Ga.m04,Ga.m05).length(),this._lscale.z=N.set(Ba,Ga.m06,Ga.m07,Ga.m08).length()):N.copy(this._lscale,this._scale),this.invalidateChildren(ia.SCALE),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.SCALE)},t.getWorldScale=function(e){return this.updateWorldTransform(),e?N.copy(e,this._scale):N.copy(new N,this._scale)},t.getWorldMatrix=function(e){this.updateWorldTransform();var t=e||new j;return j.copy(t,this._mat)},t.getWorldRS=function(e){this.updateWorldTransform();var t=e||new j;return j.copy(t,this._mat),t.m12=0,t.m13=0,t.m14=0,t},t.getWorldRT=function(e){this.updateWorldTransform();var t=e||new j;return j.fromRT(t,this._rot,this._pos)},t.setRTS=function(e,t,i){var n=0;e&&(n|=ia.ROTATION,void 0!==e.w?(H.copy(this._lrot,e),this._eulerDirty=!0):(N.copy(this._euler,e),H.fromEuler(this._lrot,e.x,e.y,e.z),this._eulerDirty=!1)),t&&(N.copy(this._lpos,t),n|=ia.POSITION),i&&(N.copy(this._lscale,i),n|=ia.SCALE),n&&(this.invalidateChildren(n),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,n))},t.isTransformDirty=function(){return this._transformFlags!==ia.NONE},t.pauseSystemEvents=function(e){this._eventProcessor.setEnabled(!1,e)},t.resumeSystemEvents=function(e){this._eventProcessor.setEnabled(!0,e)},i.resetHasChangedFlags=function(){sl+=1},i.clearNodeArray=function(){i.ClearFrame<i.ClearRound&&!ne?i.ClearFrame++:(i.ClearFrame=0,nl.length=0)},t.getPathInHierarchy=function(){for(var e=this.name,t=this.parent;t&&!(t instanceof p.Scene);)e=t.name+"/"+e,t=t.parent;return e},l(i,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&Ma)>0},set:function(e){e?this._objFlags|=Ma:this._objFlags&=~Ma}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(e){if(e=!!e,this._active!==e){this._active=e;var t=this._parent;t&&t._activeInHierarchy&&p.director._nodeActivator.activateNode(this,e)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){this.setParent(e)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}},{key:"id",set:function(e){this._id=e}},{key:"siblingIndex",get:function(){return this._siblingIndex},set:function(e){this._siblingIndex=e}},{key:"position",get:function(){return this._lpos},set:function(e){this.setPosition(e)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(e){this.setWorldPosition(e)}},{key:"rotation",get:function(){return this._lrot},set:function(e){this.setRotation(e)}},{key:"eulerAngles",get:function(){return this._eulerDirty&&(H.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler},set:function(e){this.setRotationFromEuler(e.x,e.y,e.z)}},{key:"angle",get:function(){return this._euler.z},set:function(e){N.set(this._euler,0,0,e),H.fromAngleZ(this._lrot,e),this._eulerDirty=!1,this.invalidateChildren(ia.ROTATION),1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(e){this.setWorldRotation(e)}},{key:"scale",get:function(){return this._lscale},set:function(e){this.setScale(e)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(e){this.setWorldScale(e)}},{key:"matrix",set:function(e){j.toRTS(e,this._lrot,this._lpos,this._lscale),this.invalidateChildren(ia.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(Ri.TRANSFORM_CHANGED,ia.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return N.transformQuat(new N,N.FORWARD,this.worldRotation)},set:function(e){var t=e.length();N.multiplyScalar(Ba,e,-1/t),H.fromViewUp(Na,Ba),this.setWorldRotation(Na)}},{key:"up",get:function(){return N.transformQuat(new N,N.UP,this.worldRotation)}},{key:"right",get:function(){return N.transformQuat(new N,N.RIGHT,this.worldRotation)}},{key:"mobility",get:function(){return this._mobility},set:function(e){this._mobility=e,this.emit(Ri.MOBILITY_CHANGED)}},{key:"layer",get:function(){return this._layer},set:function(e){this._layer=e,this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.markForUpdateRenderData()),this.emit(Ri.LAYER_CHANGED,this._layer)}},{key:"flagChangedVersion",get:function(){return this._flagChangeVersion}},{key:"hasChangedFlags",get:function(){return this._flagChangeVersion===sl?this._hasChangedFlags:0},set:function(e){this._flagChangeVersion=sl,this._hasChangedFlags=e}}]),i}(me)).idGenerator=ka,Sa._stacks=[[]],Sa._stackId=0,Sa.EventType=Ri,Sa.NodeSpace=ta,Sa.TransformDirtyBit=ia,Sa.TransformBit=ia,Sa.reserveContentsForAllSyncablePrefabTag=rl,Sa.ClearFrame=0,Sa.ClearRound=1e3,f((ga=Sa).prototype,"_persistNode",[we],Object.getOwnPropertyDescriptor(ga.prototype,"_persistNode"),ga.prototype),va=g(ga.prototype,"_parent",[v],(function(){return null})),ma=g(ga.prototype,"_children",[v],(function(){return[]})),ya=g(ga.prototype,"_active",[v],(function(){return!0})),ba=g(ga.prototype,"_components",[v],(function(){return[]})),Aa=g(ga.prototype,"_prefab",[v],(function(){return null})),Ra=g(ga.prototype,"_lpos",[v],(function(){return new N})),wa=g(ga.prototype,"_lrot",[v],(function(){return new H})),Ia=g(ga.prototype,"_lscale",[v],(function(){return new N(1,1,1)})),Ta=g(ga.prototype,"_mobility",[v],(function(){return ua.Static})),Da=g(ga.prototype,"_layer",[v],(function(){return qe.Enum.DEFAULT})),xa=g(ga.prototype,"_euler",[v],(function(){return new N})),f(ga.prototype,"eulerAngles",[pa],Object.getOwnPropertyDescriptor(ga.prototype,"eulerAngles"),ga.prototype),f(ga.prototype,"mobility",[_a],Object.getOwnPropertyDescriptor(ga.prototype,"mobility"),ga.prototype),da=ga))||da));p.Node=ol;var al=new N(0,1,0),ul=new N,hl=new F,ll=new G,fl=new H,cl=function(e){var t=1/Math.max(Math.max(Math.max(e.x,e.y),e.z),1e-4);t<1&&(e.x*=t,e.y*=t,e.z*=t)},pl=e("D",(za=n("cc.AmbientInfo"),Ua=K(Te),ja=xe("_skyColor"),Va=xe("_skyIllum"),Wa=xe("_groundAlbedo"),za((qa=function(){function e(){this._skyColorHDR=Ka&&Ka(),this._skyIllumHDR=Ja&&Ja(),this._groundAlbedoHDR=Ya&&Ya(),this._skyColorLDR=Qa&&Qa(),this._skyIllumLDR=$a&&$a(),this._groundAlbedoLDR=Za&&Za(),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this)},l(e,[{key:"skyColorHDR",get:function(){return this._skyColorHDR}},{key:"groundAlbedoHDR",get:function(){return this._groundAlbedoHDR}},{key:"skyIllumHDR",get:function(){return this._skyIllumHDR}},{key:"skyColorLDR",get:function(){return this._skyColorLDR}},{key:"groundAlbedoLDR",get:function(){return this._groundAlbedoLDR}},{key:"skyIllumLDR",get:function(){return this._skyIllumLDR}},{key:"skyLightingColor",get:function(){var e=p.director.root.pipeline.pipelineSceneData.isHDR;return hl.set(e?this._skyColorHDR:this._skyColorLDR),cl(hl),ll.set(255*hl.x,255*hl.y,255*hl.z,255)},set:function(e){hl.set(e.x,e.y,e.z,e.w),p.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(hl):this._skyColorLDR.set(hl),this._resource&&this._resource.skyColor.set(hl)}},{key:"skyColor",set:function(e){p.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(e):this._skyColorLDR.set(e),this._resource&&this._resource.skyColor.set(e)}},{key:"skyIllum",get:function(){return p.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(e){p.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=e:this._skyIllumLDR=e,this._resource&&(this._resource.skyIllum=e)}},{key:"groundLightingColor",get:function(){var e=p.director.root.pipeline.pipelineSceneData.isHDR;return hl.set(e?this._groundAlbedoHDR:this._groundAlbedoLDR),cl(hl),ll.set(255*hl.x,255*hl.y,255*hl.z,255)},set:function(e){hl.set(e.x,e.y,e.z,e.w),p.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(hl):this._groundAlbedoLDR.set(hl),this._resource&&this._resource.groundAlbedo.set(hl)}},{key:"groundAlbedo",set:function(e){p.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(e):this._groundAlbedoLDR.set(e),this._resource&&this._resource.groundAlbedo.set(e)}}]),e}(),f(qa.prototype,"skyIllum",[Ua],Object.getOwnPropertyDescriptor(qa.prototype,"skyIllum"),qa.prototype),Ka=g(qa.prototype,"_skyColorHDR",[v,ja],(function(){return new F(.2,.5,.8,1)})),Ja=g(qa.prototype,"_skyIllumHDR",[v,Va],(function(){return Ko.SKY_ILLUM})),Ya=g(qa.prototype,"_groundAlbedoHDR",[v,Wa],(function(){return new F(.2,.2,.2,1)})),Qa=g(qa.prototype,"_skyColorLDR",[v],(function(){return new F(.2,.5,.8,1)})),$a=g(qa.prototype,"_skyIllumLDR",[v],(function(){return Ko.SKY_ILLUM})),Za=g(qa.prototype,"_groundAlbedoLDR",[v],(function(){return new F(.2,.2,.2,1)})),Xa=qa))||Xa));p.AmbientInfo=pl;var _l=e("G",(eu=n("cc.SkyboxInfo"),tu=K(Zo),iu=K($n),nu=K(Te),ru=K($n),su=K($n),ou=K(No),au=K($n),uu=xe("_envmap"),hu=K($n),lu=K($n),fu=K($n),cu=K(No),pu=K($n),_u=K($n),eu((gu=function(){function e(){this._envLightingType=vu&&vu(),this._envmapHDR=mu&&mu(),this._envmapLDR=yu&&yu(),this._diffuseMapHDR=bu&&bu(),this._diffuseMapLDR=Au&&Au(),this._enabled=Ru&&Ru(),this._useHDR=wu&&wu(),this._editableMaterial=Iu&&Iu(),this._reflectionHDR=Tu&&Tu(),this._reflectionLDR=Du&&Du(),this._rotationAngle=xu&&xu(),this._resource=null}var t=e.prototype;return t.activate=function(e){this.envLightingType=this._envLightingType,this._resource=e,this._resource.initialize(this),this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.setSkyboxMaterial(this._editableMaterial),this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),this._resource.setRotationAngle(this._rotationAngle),this._resource.activate()},t.updateEnvMap=function(e){e||(this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=Zo.HEMISPHERE_DIFFUSE,u(15001)),this._resource&&(this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),this._resource.useDiffuseMap=this.applyDiffuseMap,this._resource.envmap=e)},t.setMaterialProperty=function(e,t,i){this._resource&&this._resource.enabled&&this._resource.editableMaterial&&(this._resource.editableMaterial.setProperty(e,t,i),this._resource.editableMaterial.passes.forEach((function(e){e.update()})))},l(e,[{key:"applyDiffuseMap",get:function(){return Zo.DIFFUSEMAP_WITH_REFLECTION===this._envLightingType},set:function(e){this._resource&&(this._resource.useDiffuseMap=e)}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=this._enabled))}},{key:"envLightingType",get:function(){return this._envLightingType},set:function(e){this.envmap||Zo.HEMISPHERE_DIFFUSE===e?(Zo.HEMISPHERE_DIFFUSE===e?(this.useIBL=!1,this.applyDiffuseMap=!1):Zo.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION===e?(this.useIBL=!0,this.applyDiffuseMap=!1):Zo.DIFFUSEMAP_WITH_REFLECTION===e&&(this.useIBL=!0,this.applyDiffuseMap=!0),this._envLightingType=e):(this.useIBL=!1,this.applyDiffuseMap=!1,this._envLightingType=Zo.HEMISPHERE_DIFFUSE,u(15001))}},{key:"useIBL",get:function(){return Zo.HEMISPHERE_DIFFUSE!==this._envLightingType},set:function(e){this._resource&&(this._resource.useIBL=e)}},{key:"useHDR",get:function(){return p.director.root.pipeline.pipelineSceneData.isHDR=this._useHDR,this._useHDR},set:function(e){p.director.root.pipeline.pipelineSceneData.isHDR=e,this._useHDR=e,this._resource&&this.envLightingType===Zo.DIFFUSEMAP_WITH_REFLECTION&&(null===this.diffuseMap?(this.envLightingType=Zo.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION,u(15e3)):this.diffuseMap.isDefault&&u(15002)),this._resource&&(this._resource.useHDR=this._useHDR,this._resource.updateMaterialRenderInfo())}},{key:"envmap",get:function(){return p.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(e){var t=p.director.root.pipeline.pipelineSceneData.isHDR;t?(this._envmapHDR=e,this._reflectionHDR=null):(this._envmapLDR=e,this._reflectionLDR=null),e||(t?this._diffuseMapHDR=null:this._diffuseMapLDR=null,this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=Zo.HEMISPHERE_DIFFUSE,u(15001)),this._resource&&(this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),this._resource.useDiffuseMap=this.applyDiffuseMap,this._resource.envmap=e)}},{key:"rotationAngle",get:function(){return this._rotationAngle},set:function(e){this._rotationAngle=e,this._resource&&this._resource.setRotationAngle(this._rotationAngle)}},{key:"diffuseMap",get:function(){return p.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(e){p.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR=e:this._diffuseMapLDR=e,this._resource&&this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR)}},{key:"reflectionMap",get:function(){return p.director.root.pipeline.pipelineSceneData.isHDR?this._reflectionHDR:this._reflectionLDR},set:function(e){p.director.root.pipeline.pipelineSceneData.isHDR?this._reflectionHDR=e:this._reflectionLDR=e,this._resource&&this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR)}},{key:"skyboxMaterial",get:function(){return this._editableMaterial},set:function(e){this._editableMaterial=e,this._resource&&this._resource.setSkyboxMaterial(this._editableMaterial)}}]),e}(),f(gu.prototype,"envLightingType",[tu],Object.getOwnPropertyDescriptor(gu.prototype,"envLightingType"),gu.prototype),f(gu.prototype,"envmap",[iu],Object.getOwnPropertyDescriptor(gu.prototype,"envmap"),gu.prototype),f(gu.prototype,"rotationAngle",[nu],Object.getOwnPropertyDescriptor(gu.prototype,"rotationAngle"),gu.prototype),f(gu.prototype,"diffuseMap",[ru],Object.getOwnPropertyDescriptor(gu.prototype,"diffuseMap"),gu.prototype),f(gu.prototype,"reflectionMap",[su],Object.getOwnPropertyDescriptor(gu.prototype,"reflectionMap"),gu.prototype),f(gu.prototype,"skyboxMaterial",[ou],Object.getOwnPropertyDescriptor(gu.prototype,"skyboxMaterial"),gu.prototype),vu=g(gu.prototype,"_envLightingType",[v],(function(){return Zo.HEMISPHERE_DIFFUSE})),mu=g(gu.prototype,"_envmapHDR",[v,au,uu],(function(){return null})),yu=g(gu.prototype,"_envmapLDR",[v,hu],(function(){return null})),bu=g(gu.prototype,"_diffuseMapHDR",[v,lu],(function(){return null})),Au=g(gu.prototype,"_diffuseMapLDR",[v,fu],(function(){return null})),Ru=g(gu.prototype,"_enabled",[v],(function(){return!1})),wu=g(gu.prototype,"_useHDR",[v],(function(){return!0})),Iu=g(gu.prototype,"_editableMaterial",[v,cu],(function(){return null})),Tu=g(gu.prototype,"_reflectionHDR",[v,pu],(function(){return null})),Du=g(gu.prototype,"_reflectionLDR",[v,_u],(function(){return null})),xu=g(gu.prototype,"_rotationAngle",[v],(function(){return 0})),du=gu))||du));p.SkyboxInfo=_l;var dl=e("H",(Su=n("cc.FogInfo"),Cu=K(ra),Eu=K(Te),Mu=K(Te),Pu=K(Te),ku=K(Te),Lu=K(Te),Bu=K(Te),Su(((Ku=function(){function e(){this._type=Fu&&Fu(),this._fogColor=Hu&&Hu(),this._enabled=Gu&&Gu(),this._fogDensity=zu&&zu(),this._fogStart=Uu&&Uu(),this._fogEnd=ju&&ju(),this._fogAtten=Vu&&Vu(),this._fogTop=Wu&&Wu(),this._fogRange=Xu&&Xu(),this._accurate=qu&&qu(),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},l(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))}},{key:"accurate",get:function(){return this._accurate},set:function(e){this._accurate!==e&&(this._accurate=e,this._resource&&(this._resource.accurate=e,e&&(this._resource.type=this._type)))}},{key:"fogColor",get:function(){return this._fogColor},set:function(e){this._fogColor.set(e),this._resource&&(this._resource.fogColor=this._fogColor)}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._resource&&(this._resource.type=e)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(e){this._fogDensity=e,this._resource&&(this._resource.fogDensity=e)}},{key:"fogStart",get:function(){return this._fogStart},set:function(e){this._fogStart=e,this._resource&&(this._resource.fogStart=e)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(e){this._fogEnd=e,this._resource&&(this._resource.fogEnd=e)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(e){this._fogAtten=e,this._resource&&(this._resource.fogAtten=e)}},{key:"fogTop",get:function(){return this._fogTop},set:function(e){this._fogTop=e,this._resource&&(this._resource.fogTop=e)}},{key:"fogRange",get:function(){return this._fogRange},set:function(e){this._fogRange=e,this._resource&&(this._resource.fogRange=e)}}]),e}()).FogType=ra,f((Nu=Ku).prototype,"type",[Cu],Object.getOwnPropertyDescriptor(Nu.prototype,"type"),Nu.prototype),f(Nu.prototype,"fogDensity",[Eu],Object.getOwnPropertyDescriptor(Nu.prototype,"fogDensity"),Nu.prototype),f(Nu.prototype,"fogStart",[Mu],Object.getOwnPropertyDescriptor(Nu.prototype,"fogStart"),Nu.prototype),f(Nu.prototype,"fogEnd",[Pu],Object.getOwnPropertyDescriptor(Nu.prototype,"fogEnd"),Nu.prototype),f(Nu.prototype,"fogAtten",[ku],Object.getOwnPropertyDescriptor(Nu.prototype,"fogAtten"),Nu.prototype),f(Nu.prototype,"fogTop",[Lu],Object.getOwnPropertyDescriptor(Nu.prototype,"fogTop"),Nu.prototype),f(Nu.prototype,"fogRange",[Bu],Object.getOwnPropertyDescriptor(Nu.prototype,"fogRange"),Nu.prototype),Fu=g(Nu.prototype,"_type",[v],(function(){return ra.LINEAR})),Hu=g(Nu.prototype,"_fogColor",[v],(function(){return new G("#C8C8C8")})),Gu=g(Nu.prototype,"_enabled",[v],(function(){return!1})),zu=g(Nu.prototype,"_fogDensity",[v],(function(){return.3})),Uu=g(Nu.prototype,"_fogStart",[v],(function(){return.5})),ju=g(Nu.prototype,"_fogEnd",[v],(function(){return 300})),Vu=g(Nu.prototype,"_fogAtten",[v],(function(){return 5})),Wu=g(Nu.prototype,"_fogTop",[v],(function(){return 1.5})),Xu=g(Nu.prototype,"_fogRange",[v],(function(){return 1.2})),qu=g(Nu.prototype,"_accurate",[v],(function(){return!1})),Ou=Nu))||Ou)),gl=e("J",(Ju=n("cc.ShadowsInfo"),Yu=K(Go),Qu=K(Te),$u=K(De),Zu=K(Ho),Ju((th=function(){function e(){this._enabled=ih&&ih(),this._type=nh&&nh(),this._normal=rh&&rh(),this._distance=sh&&sh(),this._shadowColor=oh&&oh(),this._maxReceived=ah&&ah(),this._size=uh&&uh(),this._resource=null}var t=e.prototype;return t.setPlaneFromNode=function(e){e.getWorldRotation(fl),this.planeDirection=N.transformQuat(ul,al,fl),e.getWorldPosition(ul),this.planeHeight=N.dot(this._normal,ul)},t.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},l(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._resource&&(this._resource.type=e)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(e){this._shadowColor.set(e),this._resource&&(this._resource.shadowColor=e)}},{key:"planeDirection",get:function(){return this._normal},set:function(e){N.copy(this._normal,e),this._resource&&(this._resource.normal=e)}},{key:"planeHeight",get:function(){return this._distance},set:function(e){this._distance=e,this._resource&&(this._resource.distance=e)}},{key:"maxReceived",get:function(){return this._maxReceived},set:function(e){this._maxReceived=e,this._resource&&(this._resource.maxReceived=e)}},{key:"shadowMapSize",get:function(){return this._size.x},set:function(e){this._size.set(e,e),this._resource&&(this._resource.size.set(e,e),this._resource.shadowMapDirty=!0)}}]),e}(),f(th.prototype,"type",[Yu],Object.getOwnPropertyDescriptor(th.prototype,"type"),th.prototype),f(th.prototype,"planeHeight",[Qu],Object.getOwnPropertyDescriptor(th.prototype,"planeHeight"),th.prototype),f(th.prototype,"maxReceived",[$u],Object.getOwnPropertyDescriptor(th.prototype,"maxReceived"),th.prototype),f(th.prototype,"shadowMapSize",[Zu],Object.getOwnPropertyDescriptor(th.prototype,"shadowMapSize"),th.prototype),ih=g(th.prototype,"_enabled",[v],(function(){return!1})),nh=g(th.prototype,"_type",[v],(function(){return Go.Planar})),rh=g(th.prototype,"_normal",[v],(function(){return new N(0,1,0)})),sh=g(th.prototype,"_distance",[v],(function(){return 0})),oh=g(th.prototype,"_shadowColor",[v],(function(){return new G(0,0,0,76)})),ah=g(th.prototype,"_maxReceived",[v],(function(){return 4})),uh=g(th.prototype,"_size",[v],(function(){return new O(1024,1024)})),eh=th))||eh));p.ShadowsInfo=gl;var vl=e("K",new N(-1024,-1024,-1024)),ml=e("L",new N(1024,1024,1024)),yl=e("O",8),bl=e("Q",(hh=n("cc.OctreeInfo"),lh=K(De),hh((ch=function(){function e(){this._enabled=ph&&ph(),this._minPos=_h&&_h(),this._maxPos=dh&&dh(),this._depth=gh&&gh(),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this)},l(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e))}},{key:"minPos",get:function(){return this._minPos},set:function(e){this._minPos=e,this._resource&&(this._resource.minPos=e)}},{key:"maxPos",get:function(){return this._maxPos},set:function(e){this._maxPos=e,this._resource&&(this._resource.maxPos=e)}},{key:"depth",get:function(){return this._depth},set:function(e){this._depth=e,this._resource&&(this._resource.depth=e)}}]),e}(),f(ch.prototype,"depth",[lh],Object.getOwnPropertyDescriptor(ch.prototype,"depth"),ch.prototype),ph=g(ch.prototype,"_enabled",[v],(function(){return!1})),_h=g(ch.prototype,"_minPos",[v],(function(){return new N(vl)})),dh=g(ch.prototype,"_maxPos",[v],(function(){return new N(ml)})),gh=g(ch.prototype,"_depth",[v],(function(){return yl})),fh=ch))||fh));p.OctreeInfo=bl;var Al=e("R",(vh=n("cc.SkinInfo"),mh=K(Te),yh=K(Te),vh((Ah=function(){function e(){this._enabled=Rh&&Rh(),this._blurRadius=wh&&wh(),this._sssIntensity=Ih&&Ih(),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this)},l(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e))}},{key:"blurRadius",get:function(){return this._blurRadius},set:function(e){this._blurRadius=e,this._resource&&(this._resource.blurRadius=e)}},{key:"sssIntensity",get:function(){return this._sssIntensity},set:function(e){this._sssIntensity=e,this._resource&&(this._resource.sssIntensity=e)}}]),e}(),f(Ah.prototype,"blurRadius",[mh],Object.getOwnPropertyDescriptor(Ah.prototype,"blurRadius"),Ah.prototype),f(Ah.prototype,"sssIntensity",[yh],Object.getOwnPropertyDescriptor(Ah.prototype,"sssIntensity"),Ah.prototype),Rh=g(Ah.prototype,"_enabled",[v],(function(){return!0})),wh=g(Ah.prototype,"_blurRadius",[v],(function(){return.01})),Ih=g(Ah.prototype,"_sssIntensity",[v],(function(){return 3})),bh=Ah))||bh));p.SkinInfo=Al;var Rl,wl,Il,Tl,Dl,xl,Sl,Cl,El,Ml,Pl,kl,Ll,Bl,Ol,Nl,Fl,Hl,Gl,zl,Ul,jl,Vl,Wl,Xl,ql,Kl,Jl,Yl,Ql,$l,Zl,ef,tf,nf,rf,sf,of,af,uf,hf,lf,ff,cf,pf,_f,df,gf,vf,mf,yf,bf,Af,Rf,wf,If,Tf,Df,xf,Sf,Cf,Ef,Mf,Pf,kf,Lf,Bf,Of,Nf,Ff=e("U",(Th=n("cc.LightProbeInfo"),Dh=K(Te),xh=K(De),Sh=K(De),Ch=K(Te),Eh=K(Te),Th((Ph=function(){function e(){this._giScale=kh&&kh(),this._giSamples=Lh&&Lh(),this._bounces=Bh&&Bh(),this._reduceRinging=Oh&&Oh(),this._showProbe=Nh&&Nh(),this._showWireframe=Fh&&Fh(),this._showConvex=Hh&&Hh(),this._data=Gh&&Gh(),this._lightProbeSphereVolume=zh&&zh(),this._nodes=[],this._scene=null,this._resource=null}var t=e.prototype;return t.activate=function(e,t){this._scene=e,this._resource=t,this._resource.initialize(this)},t.onProbeBakeFinished=function(){this.onProbeBakingChanged(this._scene)},t.onProbeBakeCleared=function(){this.clearSHCoefficients(),this.onProbeBakingChanged(this._scene)},t.onProbeBakingChanged=function(e){if(e){e.emit(Ri.LIGHT_PROBE_BAKING_CHANGED);for(var t=0;t<e.children.length;t++){var i=e.children[t];this.onProbeBakingChanged(i)}}},t.clearSHCoefficients=function(){if(this._data){for(var e=this._data.probes,t=0;t<e.length;t++)e[t].coefficients.length=0;this.clearAllSHUBOs()}},t.isUniqueNode=function(){return 1===this._nodes.length},t.addNode=function(e){if(!e)return!1;for(var t=0;t<this._nodes.length;t++)if(this._nodes[t].node===e)return!1;return this._nodes.push({node:e,probes:null}),!0},t.removeNode=function(e){if(!e)return!1;var t=this._nodes.findIndex((function(t){return t.node===e}));return-1!==t&&(this._nodes.splice(t,1),!0)},t.syncData=function(e,t){for(var i=0;i<this._nodes.length;i++)if(this._nodes[i].node===e)return void(this._nodes[i].probes=t)},t.update=function(e){if(void 0===e&&(e=!0),p.internal.LightProbesData){this._data||(this._data=new p.internal.LightProbesData,this._resource&&(this._resource.data=this._data));for(var t=[],i=0;i<this._nodes.length;i++){var n=this._nodes[i].node,r=this._nodes[i].probes,s=n.worldPosition;if(r)for(var o=0;o<r.length;o++){var a=new N(0,0,0);N.add(a,r[o],s),t.push(a)}}if(t.length<4)return this.resetAllTetraIndices(),void this._data.reset();this._data.updateProbes(t),e&&(this.resetAllTetraIndices(),this._data.updateTetrahedrons())}},t.clearAllSHUBOs=function(){if(this._scene){var e=this._scene.renderScene;if(e)for(var t=e.models,i=0;i<t.length;i++)t[i].clearSHUBOs()}},t.resetAllTetraIndices=function(){if(this._scene){var e=this._scene.renderScene;if(e)for(var t=e.models,i=0;i<t.length;i++)t[i].tetrahedronIndex=-1}},l(e,[{key:"giScale",get:function(){return this._giScale},set:function(e){this._giScale!==e&&(this._giScale=e,this._resource&&(this._resource.giScale=e))}},{key:"giSamples",get:function(){return this._giSamples},set:function(e){this._giSamples!==e&&(this._giSamples=e,this._resource&&(this._resource.giSamples=e))}},{key:"bounces",get:function(){return this._bounces},set:function(e){this._bounces!==e&&(this._bounces=e,this._resource&&(this._resource.bounces=e))}},{key:"reduceRinging",get:function(){return this._reduceRinging},set:function(e){this._reduceRinging!==e&&(this._reduceRinging=e,this._resource&&(this._resource.reduceRinging=e))}},{key:"showProbe",get:function(){return this._showProbe},set:function(e){this._showProbe!==e&&(this._showProbe=e,this._resource&&(this._resource.showProbe=e))}},{key:"showWireframe",get:function(){return this._showWireframe},set:function(e){this._showWireframe!==e&&(this._showWireframe=e,this._resource&&(this._resource.showWireframe=e))}},{key:"showConvex",get:function(){return this._showConvex},set:function(e){this._showConvex!==e&&(this._showConvex=e,this._resource&&(this._resource.showConvex=e))}},{key:"data",get:function(){return this._data},set:function(e){this._data!==e&&(this._data=e,this._resource&&(this._resource.data=e))}},{key:"lightProbeSphereVolume",get:function(){return this._lightProbeSphereVolume},set:function(e){this._lightProbeSphereVolume!==e&&(this._lightProbeSphereVolume=e,this._resource&&(this._resource.lightProbeSphereVolume=e))}}]),e}(),f(Ph.prototype,"giScale",[Dh],Object.getOwnPropertyDescriptor(Ph.prototype,"giScale"),Ph.prototype),f(Ph.prototype,"giSamples",[xh],Object.getOwnPropertyDescriptor(Ph.prototype,"giSamples"),Ph.prototype),f(Ph.prototype,"bounces",[Sh],Object.getOwnPropertyDescriptor(Ph.prototype,"bounces"),Ph.prototype),f(Ph.prototype,"reduceRinging",[Ch],Object.getOwnPropertyDescriptor(Ph.prototype,"reduceRinging"),Ph.prototype),f(Ph.prototype,"lightProbeSphereVolume",[Eh],Object.getOwnPropertyDescriptor(Ph.prototype,"lightProbeSphereVolume"),Ph.prototype),kh=g(Ph.prototype,"_giScale",[v],(function(){return 1})),Lh=g(Ph.prototype,"_giSamples",[v],(function(){return 1024})),Bh=g(Ph.prototype,"_bounces",[v],(function(){return 2})),Oh=g(Ph.prototype,"_reduceRinging",[v],(function(){return 0})),Nh=g(Ph.prototype,"_showProbe",[v],(function(){return!0})),Fh=g(Ph.prototype,"_showWireframe",[v],(function(){return!0})),Hh=g(Ph.prototype,"_showConvex",[v],(function(){return!1})),Gh=g(Ph.prototype,"_data",[v],(function(){return null})),zh=g(Ph.prototype,"_lightProbeSphereVolume",[v],(function(){return 1})),Mh=Ph))||Mh)),Hf=e("V",(Uh=n("cc.SceneGlobals"),jh=K(_l),Uh((Wh=function(){function e(){this.ambient=Xh&&Xh(),this.shadows=qh&&qh(),this._skybox=Kh&&Kh(),this.fog=Jh&&Jh(),this.octree=Yh&&Yh(),this.skin=Qh&&Qh(),this.lightProbeInfo=$h&&$h(),this.bakedWithStationaryMainLight=Zh&&Zh(),this.bakedWithHighpLightmap=el&&el(),this.disableLightmap=!1}return e.prototype.activate=function(e){var t=p.director.root.pipeline.pipelineSceneData;this.skybox.activate(t.skybox),this.ambient.activate(t.ambient),this.shadows.activate(t.shadows),this.fog.activate(t.fog),this.octree.activate(t.octree),this.skin.activate(t.skin),this.lightProbeInfo&&t.lightProbes&&this.lightProbeInfo.activate(e,t.lightProbes),p.director.root.onGlobalPipelineStateChanged()},l(e,[{key:"skybox",get:function(){return this._skybox},set:function(e){this._skybox=e}}]),e}(),Xh=g(Wh.prototype,"ambient",[v],(function(){return new pl})),qh=g(Wh.prototype,"shadows",[v],(function(){return new gl})),Kh=g(Wh.prototype,"_skybox",[v],(function(){return new _l})),Jh=g(Wh.prototype,"fog",[v],(function(){return new dl})),f(Wh.prototype,"skybox",[jh],Object.getOwnPropertyDescriptor(Wh.prototype,"skybox"),Wh.prototype),Yh=g(Wh.prototype,"octree",[v],(function(){return new bl})),Qh=g(Wh.prototype,"skin",[v],(function(){return new Al})),$h=g(Wh.prototype,"lightProbeInfo",[v],(function(){return new Ff})),Zh=g(Wh.prototype,"bakedWithStationaryMainLight",[v],(function(){return!1})),el=g(Wh.prototype,"bakedWithHighpLightmap",[v],(function(){return!1})),Vh=Wh))||Vh));p.SceneGlobals=Hf;var Gf,zf,Uf,jf,Vf=(Rl=n("cc.TargetInfo"),wl=K([Se]),Rl((Tl=function(){this.localID=Dl&&Dl()},Dl=g(Tl.prototype,"localID",[v,wl],(function(){return[]})),Il=Tl))||Il),Wf=(xl=n("cc.TargetOverrideInfo"),Sl=K(me),Cl=K(Vf),El=K([Se]),Ml=K(ol),Pl=K(Vf),xl((Ll=function(){this.source=Bl&&Bl(),this.sourceInfo=Ol&&Ol(),this.propertyPath=Nl&&Nl(),this.target=Fl&&Fl(),this.targetInfo=Hl&&Hl()},Bl=g(Ll.prototype,"source",[v,Sl],(function(){return null})),Ol=g(Ll.prototype,"sourceInfo",[v,Cl],(function(){return null})),Nl=g(Ll.prototype,"propertyPath",[v,El],(function(){return[]})),Fl=g(Ll.prototype,"target",[v,Ml],(function(){return null})),Hl=g(Ll.prototype,"targetInfo",[v,Pl],(function(){return null})),kl=Ll))||kl),Xf=n("cc.CompPrefabInfo")((zl=function(){this.fileId=Ul&&Ul()},Ul=g(zl.prototype,"fileId",[v],(function(){return""})),Gl=zl))||Gl,qf=(jl=n("CCPropertyOverrideInfo"),Vl=K(Vf),Wl=K([Se]),jl((ql=function(){function e(){this.targetInfo=Kl&&Kl(),this.propertyPath=Jl&&Jl(),this.value=Yl&&Yl()}return e.prototype.isTarget=function(){},e}(),Kl=g(ql.prototype,"targetInfo",[v,Vl],(function(){return null})),Jl=g(ql.prototype,"propertyPath",[v,Wl],(function(){return[]})),Yl=g(ql.prototype,"value",[v],null),Xl=ql))||Xl),Kf=(Ql=n("cc.MountedChildrenInfo"),$l=K(Vf),Zl=K([ol]),Ql((tf=function(){function e(){this.targetInfo=nf&&nf(),this.nodes=rf&&rf()}return e.prototype.isTarget=function(){},e}(),nf=g(tf.prototype,"targetInfo",[v,$l],(function(){return null})),rf=g(tf.prototype,"nodes",[v,Zl],(function(){return[]})),ef=tf))||ef),Jf=(sf=n("cc.MountedComponentsInfo"),of=K(Vf),af=K([$t]),sf((hf=function(){function e(){this.targetInfo=lf&&lf(),this.components=ff&&ff()}return e.prototype.isTarget=function(){},e}(),lf=g(hf.prototype,"targetInfo",[v,of],(function(){return null})),ff=g(hf.prototype,"components",[v,af],(function(){return[]})),uf=hf))||uf),Yf=(cf=n("cc.PrefabInstance"),pf=K(ol),_f=K([Kf]),df=K([Jf]),gf=K([qf]),vf=K([Vf]),cf((yf=function(){function e(){this.fileId=bf&&bf(),this.prefabRootNode=Af&&Af(),this.mountedChildren=Rf&&Rf(),this.mountedComponents=wf&&wf(),this.propertyOverrides=If&&If(),this.removedComponents=Tf&&Tf(),this.targetMap={},this.expanded=!1}var t=e.prototype;return t.findPropertyOverride=function(){},t.removePropertyOverride=function(){},e}(),bf=g(yf.prototype,"fileId",[v],(function(){return""})),Af=g(yf.prototype,"prefabRootNode",[v,pf],null),Rf=g(yf.prototype,"mountedChildren",[v,_f],(function(){return[]})),wf=g(yf.prototype,"mountedComponents",[v,df],(function(){return[]})),If=g(yf.prototype,"propertyOverrides",[v,gf],(function(){return[]})),Tf=g(yf.prototype,"removedComponents",[v,vf],(function(){return[]})),mf=yf))||mf),Qf=(Df=n("cc.PrefabInfo"),xf=K(ol),Sf=K(Yf),Cf=K([Wf]),Df((Mf=function(){this.root=Pf&&Pf(),this.asset=kf&&kf(),this.fileId=Lf&&Lf(),this.instance=Bf&&Bf(),this.targetOverrides=Of&&Of(),this.nestedPrefabInstanceRoots=Nf&&Nf()},Pf=g(Mf.prototype,"root",[v,xf],null),kf=g(Mf.prototype,"asset",[v],null),Lf=g(Mf.prototype,"fileId",[v],(function(){return""})),Bf=g(Mf.prototype,"instance",[v,Sf],null),Of=g(Mf.prototype,"targetOverrides",[v,Cf],null),Nf=g(Mf.prototype,"nestedPrefabInstanceRoots",[v],null),Ef=Mf))||Ef);function $f(e){var t=e._prefab;if(t&&t.instance){if(!t.asset)return d(3701,e.name),void(t.instance=void 0);var i=e._objFlags,n=e.getParent(),r=e.uuid,s=e._prefab;e[Ce],p.game._isCloning=!0;var o=t.asset.data;o._iN$t=e,p.instantiate._clone(o,o),p.game._isCloning=!1,e._objFlags=i,e.modifyParent(n),e.id=r,e._prefab&&(e._prefab.instance=null==s?void 0:s.instance)}}function Zf(e,t,i){var n;if(t&&e){var r=t,s=null===(n=e._prefab)||void 0===n?void 0:n.instance;!i&&s&&(t[s.fileId]={},r=t[s.fileId]);var o=e._prefab;o&&(r[o.fileId]=e);for(var a=e.components,u=0;u<a.length;u++){var h=a[u];h.__prefab&&(r[h.__prefab.fileId]=h)}for(var l=0;l<e.children.length;l++)Zf(e.children[l],r,!1)}}function ec(e,t){if(!e)return null;for(var i=t,n=0;n<e.length;n++){if(!i)return null;i=i[e[n]]}return i}function tc(e,t,i){if(t)for(var n=0;n<t.length;n++){var r=t[n];if(r&&r.targetInfo){var s=ec(r.targetInfo.localID,i);if(!s)continue;var o=i,a=r.targetInfo.localID;if(a.length>0)for(var u=0;u<a.length-1;u++)o=o[a[u]];if(r.nodes)for(var h=0;h<r.nodes.length;h++){var l=r.nodes[h];l&&!s.children.includes(l)&&(s.children.push(l),l.modifyParent(s),Zf(l,o,!1),l.siblingIndex=s.children.length-1,oc(l,!0))}}}}function ic(e,t,i){if(t)for(var n=0;n<t.length;n++){var r=t[n];if(r&&r.targetInfo){var s=ec(r.targetInfo.localID,i);if(!s)continue;if(r.components)for(var o=0;o<r.components.length;o++){var a=r.components[o];a&&(a.node=s,s.getWritableComponents().push(a))}}}}function nc(e,t,i){if(t)for(var n=0;n<t.length;n++){var r=t[n];if(r){var s=ec(r.localID,i);if(!s||!s.node)continue;var o=s.node.components.indexOf(s);o>=0&&s.node.getWritableComponents().splice(o,1)}}}function rc(e,t,i){if(!(t.length<=0))for(var n=null,r=0;r<t.length;r++){var s=t[r];if(s&&s.targetInfo){if(!(n=ec(s.targetInfo.localID,i)))continue;var o=n,a=s.propertyPath.slice();if(a.length>0){var u=a.pop();if(!u)continue;for(var h=0;h<a.length&&(o=o[a[h]]);h++);if(!o)continue;if(Array.isArray(o))if("length"===u)o[u]=s.value;else{var l=Number.parseInt(u);Number.isInteger(l)&&l<o.length&&(o[u]=s.value)}else o[u]instanceof Ee?o[u].set(s.value):o[u]=s.value}}}}function sc(e){var t,i=null===(t=e._prefab)||void 0===t?void 0:t.targetOverrides;if(i)for(var n=0;n<i.length;n++){var r,s,o=i[n],a=o.source,u=o.sourceInfo;if(u){var h,l,f=null===(h=o.source)||void 0===h||null===(l=h._prefab)||void 0===l?void 0:l.instance;f&&f.targetMap&&(a=ec(u.localID,f.targetMap))}if(a){var c,p=o.targetInfo;if(p){var _=null===(r=o.target)||void 0===r||null===(s=r._prefab)||void 0===s?void 0:s.instance;if(_&&_.targetMap&&(c=ec(p.localID,_.targetMap))){var d=o.propertyPath.slice(),g=a;if(d.length>0){var v=d.pop();if(!v)return;for(var m=0;m<d.length&&(g=g[d[m]]);m++);if(!g)continue;g[v]=c}}}}}}function oc(e,t){void 0===t&&(t=!1);var i=e._prefab,n=null==i?void 0:i.instance;if(n&&!n.expanded){$f(e),t&&e&&e.children&&e.children.forEach((function(e){oc(e,!0)}));var r={};n.targetMap=r,Zf(e,r,!0),tc(0,n.mountedChildren,r),nc(0,n.removedComponents,r),ic(0,n.mountedComponents,r),rc(0,n.propertyOverrides,r),n.expanded=!0}else t&&e&&e.children&&e.children.forEach((function(e){oc(e,!0)}))}function ac(e){var t=e._prefab;t&&t.nestedPrefabInstanceRoots&&t.nestedPrefabInstanceRoots.forEach((function(e){var t,i,n;oc(e),uc(e,null!==(t=null===(i=e._prefab)||void 0===i||null===(n=i.instance)||void 0===n?void 0:n.fileId)&&void 0!==t?t:"")}))}function uc(e,t){for(var i=e.components,n=e.children,r=0;r<i.length;r++){var s,o,a=i[r],u=null!==(s=null===(o=a.__prefab)||void 0===o?void 0:o.fileId)&&void 0!==s?s:"";a._id=""+t+u}for(var h=0;h<n.length;h++){var l=n[h],f=l._prefab,c=null!=f&&f.instance?f.instance.fileId:null==f?void 0:f.fileId;c&&(l.id=""+t+c,null!=f&&f.instance||uc(l,t))}}p._PrefabInfo=Qf,e("ak",Object.freeze({__proto__:null,createNodeWithPrefab:$f,generateTargetMap:Zf,getTarget:ec,applyMountedChildren:tc,applyMountedComponents:ic,applyRemovedComponents:nc,applyPropertyOverrides:rc,applyTargetOverrides:sc,expandPrefabInstanceNode:oc,expandNestedPrefabInstanceNode:ac,applyNodeAndComponentId:uc,TargetInfo:Vf,TargetOverrideInfo:Wf,CompPrefabInfo:Xf,PropertyOverrideInfo:qf,MountedChildrenInfo:Kf,MountedComponentsInfo:Jf,PrefabInstance:Yf,PrefabInfo:Qf}));var hc,lc,fc,cc=e("w",n("cc.Scene")((zf=function(e){r(i,e);var t=i.prototype;function i(t){var i;return(i=e.call(this,t)||this).autoReleaseAssets=Uf&&Uf(),i._globals=jf&&jf(),i.dependAssets=null,i._renderScene=null,i._inited=void 0,i._prefabSyncedInLiveReload=!1,i._activeInHierarchy=!1,p.director&&p.director.root&&(i._renderScene=p.director.root.createScene({})),i._inited=!p.game||!p.game._isCloning,i}return t._updateScene=function(){this._scene=this},t.destroy=function(){var e=me.prototype.destroy.call(this);if(e)for(var t=this._children,i=0;i<t.length;++i)t[i].active=!1;return this._renderScene&&p.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,e},t.addComponent=function(){throw new Error(w(3822))},t._onHierarchyChanged=function(){},t._onPostActivated=function(){},t._onBatchCreated=function(e){for(var t=this._children.length,i=0;i<t;++i)this._children[i]._siblingIndex=i,this._children[i]._onBatchCreated(e)},t.updateWorldTransform=function(){},t._instantiate=function(){},t._load=function(){this._inited||(ac(this),sc(this),this._onBatchCreated(ne),this._inited=!0),this.walk(ol._setScene)},t._activate=function(e){void 0===e&&(e=!0),p.director._nodeActivator.activateNode(this,e),this._globals.activate(this)},l(i,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]),i}(ol),Uf=g(zf.prototype,"autoReleaseAssets",[v],(function(){return!1})),jf=g(zf.prototype,"_globals",[v],(function(){return new Hf})),Gf=zf))||Gf);p.Scene=cc;var pc=e("$",n("cc.SceneAsset")((lc=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).scene=fc&&fc(),t}r(t,e);var i=t.prototype;return i.initDefault=function(t){e.prototype.initDefault.call(this,t),this.scene=new cc("New Scene")},i.validate=function(){return!!this.scene},t}(Qt),fc=g(lc.prototype,"scene",[v],(function(){return null})),hc=lc))||hc);function _c(e,t){if(!t){var i=p.director.getScene();if(!i)return null;t=i}return t.getChildByPath(e)}p.SceneAsset=pc,p.find=_c}}}));
