System.register(["./index-68ccac70.js","./director-56fe9b8d.js","./find-222dc7da.js","./pipeline-state-manager-8f16c5a7.js","./buffer-barrier-d1733967.js","./node-event-40319828.js"],(function(e,t){"use strict";var i,n,s,r,a,o,h,u,l,c,d,g,m,f,p,_,E,T,S,v,P,y,b,I,R,N,w,x,M,A,C,D,B,k,L,V,F,H,q,O,j,G,U,z,W,X,Y,J,Z,K,$,Q,ee,te,ie,ne;return{setters:[function(e){i=e.bx,n=e.bJ,s=e.V,r=e.a$,a=e.a_,o=e.l,h=e.b_,u=e.t,l=e.aM,c=e.K,d=e.E,g=e.cs,m=e.bA,f=e.bG,p=e.aK,_=e.bp,E=e.aN,T=e.aL,S=e.bh,v=e.k,P=e.ce,y=e.b,b=e.w,I=e.aF,R=e.aD,N=e.ai,w=e.ah,x=e.ag},function(e){M=e.at,A=e.a3,C=e.a9,D=e.a2,B=e.y},function(e){k=e.a6,L=e.a8,V=e.ac},function(e){F=e.P,H=e.S,q=e.d,O=e.O,j=e.b,G=e.L},function(e){U=e.a5,z=e.Z,W=e.a9,X=e.d,Y=e.f,J=e.aq,Z=e.b,K=e.as,$=e.ag,Q=e.m,ee=e.ae,te=e.g,ie=e.h,ne=e.a3},function(){}],execute:function(){var se=function(){function e(){var e=this;this._rafHandle=0,this._onTick=null,this._updateCallback=void 0,this._targetFrameRate=60,this._isPlaying=!1,this._updateCallback=function(){e._isPlaying&&(e._rafHandle=requestAnimationFrame(e._updateCallback)),e._onTick&&e._onTick()}}var t=e.prototype;return t.start=function(){this._isPlaying||(this._rafHandle=requestAnimationFrame(this._updateCallback),this._isPlaying=!0)},t.stop=function(){this._isPlaying&&(cancelAnimationFrame(this._rafHandle),this._rafHandle=0,this._isPlaying=!1)},i(e,[{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){this._targetFrameRate!==e&&(this._targetFrameRate=e,n.setPreferredFramesPerSecond(this._targetFrameRate),this._isPlaying&&(this.stop(),this.start()))}},{key:"onTick",get:function(){return this._onTick},set:function(e){this._onTick=e}}]),e}(),re=new s,ae=function(){var e=t.prototype;function t(){this.settings=void 0,this._curTime=0,this.device=void 0,this.swapchain=void 0,this.shader=void 0,this.sampler=void 0,this.cmdBuff=void 0,this.quadAssmebler=void 0,this.vertexBuffers=void 0,this.indicesBuffers=void 0,this.renderArea=void 0,this.clearColors=void 0,this.projection=void 0,this.isMobile=!1,this.bgMat=void 0,this.bgImage=void 0,this.bgTexture=void 0,this.logoMat=void 0,this.logoImage=void 0,this.logoTexture=void 0,this.watermarkMat=void 0,this.watermarkTexture=void 0,this.bgWidth=1920,this.bgHeight=1080,this.bgRatio=16/9,this.logoWidthTemp=140,this.logoHeightTemp=200,this.logoWidth=0,this.logoHeight=0,this.logoXTrans=.5,this.logoYTrans=1/6+2.5/6,this.textSize=24,this.textHeight=24,this.textXTrans=.5,this.textYExtraTrans=32,this.textExpandSize=4,this.scaleSize=1}return e.init=function(){var e,t,i,n,s,u,l,c,d=this;if(this.settings={displayRatio:null!==(e=r.querySettings(a.Category.SPLASH_SCREEN,"displayRatio"))&&void 0!==e?e:.4,totalTime:null!==(t=r.querySettings(a.Category.SPLASH_SCREEN,"totalTime"))&&void 0!==t?t:3e3,watermarkLocation:null!==(i=r.querySettings(a.Category.SPLASH_SCREEN,"watermarkLocation"))&&void 0!==i?i:"default",autoFit:null===(n=r.querySettings(a.Category.SPLASH_SCREEN,"autoFit"))||void 0===n||n,url:null!==(s=r.querySettings(a.Category.SPLASH_SCREEN,"url"))&&void 0!==s?s:"",type:null!==(u=r.querySettings(a.Category.SPLASH_SCREEN,"type"))&&void 0!==u?u:"default",bgBase64:null!==(l=r.querySettings(a.Category.SPLASH_SCREEN,"bgBase64"))&&void 0!==l?l:"",base64src:null!==(c=r.querySettings(a.Category.SPLASH_SCREEN,"base64src"))&&void 0!==c?c:""},this._curTime=0,!(""===this.settings.base64src||this.settings.totalTime<=0)){this.device=o.director.root.device,this.swapchain=o.director.root.mainWindow.swapchain,this.preInit(),this.initLayout(),this.initWaterMark();var g=new Promise((function(e,t){d.bgImage=new h.Image,d.bgImage.onload=function(){d.initBG(),e()},d.bgImage.onerror=function(){t()},d.bgImage.src=d.settings.bgBase64})),m=new Promise((function(e,t){d.logoImage=new h.Image,d.logoImage.onload=function(){d.initLogo(),e()},d.logoImage.onerror=function(){t()},d.logoImage.src=d.settings.base64src}));return Promise.all([g,m])}return this.settings.totalTime=0,Promise.resolve([])},e.preInit=function(){this.clearColors=[new U(0,0,0,255)];var e=this.device,t=this.swapchain;this.renderArea=new z(0,0,t.width,t.height),this.cmdBuff=e.commandBuffer;var i=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),n=4*Float32Array.BYTES_PER_ELEMENT,s=4*n;this.vertexBuffers=e.createBuffer(new W(X.VERTEX|X.TRANSFER_DST,Y.DEVICE,s,n)),this.vertexBuffers.update(i);var r=new Uint16Array([0,1,2,1,3,2]),a=Uint16Array.BYTES_PER_ELEMENT,o=6*a;this.indicesBuffers=e.createBuffer(new W(X.INDEX|X.TRANSFER_DST,Y.DEVICE,o,a)),this.indicesBuffers.update(r);var h=[new J("a_position",Z.RG32F),new J("a_texCoord",Z.RG32F)],c=new K(h,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=e.createInputAssembler(c),this.projection=new u,u.ortho(this.projection,-1,1,-1,1,-1,1,e.capabilities.clipSpaceMinZ,e.capabilities.clipSpaceSignY,t.surfaceTransform),this.isMobile=l.isMobile},e.initLayout=function(){this.isMobile?(this.bgWidth=812,this.bgHeight=375,this.logoWidthTemp=70,this.logoHeightTemp=100,this.textSize=12,this.textHeight=this.textSize+this.textExpandSize,this.textXTrans=.5,this.textYExtraTrans=16):(this.bgWidth=1920,this.bgHeight=1080,this.logoWidthTemp=140,this.logoHeightTemp=200,this.textSize=24,this.textHeight=this.textSize+this.textExpandSize,this.textXTrans=.5,this.textYExtraTrans=32),this.logoXTrans=.5,this.logoYTrans=1/6+2.5/6,this.initScale()},e.initScale=function(){var e=this.swapchain.width,t=this.swapchain.height,i=this.isMobile?375:1080,n=this.isMobile?812:1920;if(e>t){var s=n;n=i,i=s}this.scaleSize=e/t>16/9?t/n:e/i},e.update=function(e){var t=this.settings,i=this.device,n=this.swapchain;u.ortho(this.projection,-1,1,-1,1,-1,1,i.capabilities.clipSpaceMinZ,i.capabilities.clipSpaceSignY,n.surfaceTransform);var s=n.width,r=n.height;this.initScale(),this._curTime+=1e3*e;var a=c(this._curTime/t.totalTime),o=g(a),h=1,l=1;s<r?(h=r*this.bgRatio,l=r):(h=s,l=s*this.bgRatio),this.bgMat.setProperty("resolution",re.set(s,r),0),this.bgMat.setProperty("scale",re.set(h,l),0),this.bgMat.setProperty("translate",re.set(.5*s,.5*r),0),this.bgMat.setProperty("percent",1),this.bgMat.setProperty("u_projection",this.projection),this.bgMat.passes[0].update(),h=1,l=1,h=this.logoWidth*this.scaleSize*t.displayRatio,l=this.logoHeight*this.scaleSize*t.displayRatio;var d=r*this.logoYTrans;if(this.logoMat.setProperty("resolution",re.set(s,r),0),this.logoMat.setProperty("scale",re.set(h,l),0),this.logoMat.setProperty("translate",re.set(s*this.logoXTrans,d),0),this.logoMat.setProperty("percent",o),this.logoMat.setProperty("u_projection",this.projection),this.logoMat.passes[0].update(),this.watermarkMat){var m=this.watermarkTexture.width,f=this.watermarkTexture.height;h=m,l=f;var p=d-(.5*this.logoHeight*t.displayRatio+this.textYExtraTrans)*this.scaleSize-.5*f;this.watermarkMat.setProperty("resolution",re.set(s,r),0),this.watermarkMat.setProperty("scale",re.set(h,l),0),this.watermarkMat.setProperty("translate",re.set(s*this.textXTrans,p),0),this.watermarkMat.setProperty("percent",o),this.watermarkMat.setProperty("u_projection",this.projection),this.watermarkMat.passes[0].update()}this.frame()},e.initBG=function(){var e=this.device;this.bgMat=new k,this.bgMat.initialize({effectName:"util/splash-screen"});var t=new $;t.addressU=Q.CLAMP,t.addressV=Q.CLAMP,t.addressW=Q.CLAMP,this.sampler=e.getSampler(t),this.bgTexture=e.createTexture(new ee(te.TEX2D,ie.SAMPLED|ie.TRANSFER_DST,Z.RGBA8,this.bgImage.width,this.bgImage.height));var i=this.bgMat.passes[0],n=i.getBinding("mainTexture");i.bindTexture(n,this.bgTexture),this.shader=i.getShaderVariant();var s=i.descriptorSet;s.bindSampler(n,this.sampler),s.update();var r=new ne;r.texExtent.width=this.bgImage.width,r.texExtent.height=this.bgImage.height,r.texExtent.depth=1,e.copyTexImagesToTexture([this.bgImage],this.bgTexture,[r])},e.initLogo=function(){var e=this.device;this.logoMat=new k,this.logoMat.initialize({effectName:"util/splash-screen"});var t=new $;t.addressU=Q.CLAMP,t.addressV=Q.CLAMP,t.addressW=Q.CLAMP,this.sampler=e.getSampler(t),this.logoTexture=e.createTexture(new ee(te.TEX2D,ie.SAMPLED|ie.TRANSFER_DST,Z.RGBA8,this.logoImage.width,this.logoImage.height));var i=this.logoMat.passes[0],n=i.getBinding("mainTexture");i.bindTexture(n,this.logoTexture),this.shader=i.getShaderVariant();var s=i.descriptorSet;s.bindSampler(n,this.sampler),s.update();var r=new ne;r.texExtent.width=this.logoImage.width,r.texExtent.height=this.logoImage.height,r.texExtent.depth=1,e.copyTexImagesToTexture([this.logoImage],this.logoTexture,[r]);var a=this.logoImage.width/this.logoImage.height;a<1?(this.logoWidth=this.logoWidthTemp,this.logoHeight=this.logoWidthTemp/a):(this.logoWidth=this.logoHeightTemp*a,this.logoHeight=this.logoHeightTemp)},e.initWaterMark=function(){var e=h.document.createElement("canvas");e.height=this.textHeight*this.scaleSize,e.style.width=""+e.width,e.style.height=""+e.height;var t="Created with Cocos",i=e.getContext("2d");i.font=this.textSize*this.scaleSize+"px Arial",i.textBaseline="top",i.textAlign="center",i.fillStyle="#707070";var n=i.measureText(t).width+10;e.width=n,i.font=this.textSize*this.scaleSize+"px Arial",i.textBaseline="top",i.textAlign="center",i.fillStyle="#707070",i.fillText(t,e.width/2,0);var s=new ne;s.texExtent.width=e.width,s.texExtent.height=e.height,s.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new ee(te.TEX2D,ie.SAMPLED|ie.TRANSFER_DST,Z.RGBA8,e.width,e.height)),this.device.copyTexImagesToTexture([e],this.watermarkTexture,[s]),this.watermarkMat=new k,this.watermarkMat.initialize({effectName:"util/splash-screen"});var r=this.watermarkMat.passes[0],a=r.getBinding("mainTexture");r.bindTexture(a,this.watermarkTexture),r.descriptorSet.update()},e.frame=function(){var e=this.device,t=this.swapchain;if(!l.isXR||xr.entry.isRenderAllowable())for(var i=l.isXR?2:1,n=0;n<i;n++){if(l.isXR){xr.entry.renderLoopStart(n);var s=xr.entry.getEyeFov(n),r=1,a=1;n===M.LEFT?r=Math.abs(Math.tan(s[0]))/Math.abs(Math.tan(s[1])):n===M.RIGHT&&(a=Math.abs(Math.tan(s[1]))/Math.abs(Math.tan(s[0]))),u.ortho(this.projection,-r,a,-1,1,-1,1,e.capabilities.clipSpaceMinZ,e.capabilities.clipSpaceSignY,t.surfaceTransform),this.projection.m00=d[t.surfaceTransform][0],this.projection.m05=d[t.surfaceTransform][3]*e.capabilities.clipSpaceSignY,this.bgMat.setProperty("u_projection",this.projection),this.bgMat.passes[0].update(),this.logoMat.setProperty("u_projection",this.projection),this.logoMat.passes[0].update(),this.watermarkMat&&(this.watermarkMat.setProperty("u_projection",this.projection),this.watermarkMat.passes[0].update())}e.enableAutoBarrier(!0),e.acquire([t]);var h=this.cmdBuff,c=o.director.root.mainWindow.framebuffer,g=this.renderArea;g.width=t.width,g.height=t.height,h.begin(),h.beginRenderPass(c.renderPass,c,g,this.clearColors,1,0);var m=this.bgMat.passes[0],f=F.getOrCreatePipelineState(e,m,this.shader,c.renderPass,this.quadAssmebler);h.bindPipelineState(f),h.bindDescriptorSet(H.MATERIAL,m.descriptorSet),h.bindInputAssembler(this.quadAssmebler),h.draw(this.quadAssmebler);var p=this.logoMat.passes[0],_=F.getOrCreatePipelineState(e,p,this.shader,c.renderPass,this.quadAssmebler);if(h.bindPipelineState(_),h.bindDescriptorSet(H.MATERIAL,p.descriptorSet),h.bindInputAssembler(this.quadAssmebler),h.draw(this.quadAssmebler),this.watermarkMat){var E=this.watermarkMat.passes[0],T=F.getOrCreatePipelineState(e,E,this.shader,c.renderPass,this.quadAssmebler);h.bindPipelineState(T),h.bindDescriptorSet(H.MATERIAL,E.descriptorSet),h.bindInputAssembler(this.quadAssmebler),h.draw(this.quadAssmebler)}h.endRenderPass(),h.end(),e.flushCommands([h]),e.queue.submit([h]),e.present(),e.enableAutoBarrier(!o.rendering),l.isXR&&xr.entry.renderLoopEnd(n)}},e.destroy=function(){this.device=null,this.swapchain=null,this.clearColors=null,this.bgImage.destroy&&this.bgImage.destroy(),this.bgImage=null,this.bgMat.destroy(),this.bgMat=null,this.bgTexture.destroy(),this.bgTexture=null,this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.renderArea=null,this.cmdBuff=null,this.shader=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler=null,this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null},i(t,[{key:"isFinished",get:function(){return this._curTime>=this.settings.totalTime}},{key:"curTime",get:function(){return this._curTime},set:function(e){this._curTime=e}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();ae._ins=void 0,o.internal.SplashScreen=ae;var oe=new(function(){function e(){this._data=null}return e.prototype.init=function(e){var t=this;return void 0===e&&(e=""),o.rendering&&o.rendering.enableEffectImport&&e?new Promise((function(i,n){if(e.startsWith("http")){var s=new XMLHttpRequest;s.open("GET",e),s.responseType="arraybuffer",s.onload=function(){t._data=s.response,i()},s.onerror=function(){n(new Error("request effect settings failed!"))},s.send(null)}else fsUtils.readArrayBuffer(e,(function(e,s){e?n(e):(t._data=s,i())}))})):Promise.resolve()},i(e,[{key:"data",get:function(){return this._data}}]),e}());o.effectSettings=oe;var he=e("G",function(e){function n(){for(var t,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(t=e.call.apply(e,[this].concat(n))||this).frame=null,t.container=null,t.canvas=null,t.renderType=-1,t.eventTargetOn=e.prototype.on,t.eventTargetOnce=e.prototype.once,t.config={},t.onStart=null,t.frameTime=1e3/60,t._isCloning=!1,t._inited=!1,t._engineInited=!1,t._rendererInitialized=!1,t._paused=!0,t._pausedByEngine=!1,t._frameRate=60,t._pacer=null,t._initTime=0,t._startTime=0,t._deltaTime=0,t._useFixedDeltaTime=!1,t._shouldLoadLaunchScene=!0,t.onPreBaseInitDelegate=new I,t.onPostBaseInitDelegate=new I,t.onPreInfrastructureInitDelegate=new I,t.onPostInfrastructureInitDelegate=new I,t.onPreSubsystemInitDelegate=new I,t.onPostSubsystemInitDelegate=new I,t.onPreProjectInitDelegate=new I,t.onPostProjectInitDelegate=new I,t}m(n,e);var s=n.prototype;return s.setFrameRate=function(e){this.frameRate=e},s.getFrameRate=function(){return this.frameRate},s.step=function(){A.tick(this._calculateDT(!0))},s.pauseByEngine=function(){this._paused||(this._pausedByEngine=!0,this.pause())},s.resumeByEngine=function(){this._pausedByEngine&&(this.resume(),this._pausedByEngine=!1)},s.pause=function(){var e;this._paused||(this._paused=!0,null===(e=this._pacer)||void 0===e||e.stop(),this.emit(n.EVENT_PAUSE))},s.resume=function(){var e;this._paused&&(C._clearEvents(),this._paused=!1,null===(e=this._pacer)||void 0===e||e.start(),this.emit(n.EVENT_RESUME))},s.isPaused=function(){return this._paused},s.restart=function(){var e=this;return new Promise((function(e){A.once(D.EVENT_END_FRAME,(function(){return e()}))})).then((function(){A.reset(),o.Object._deferredDestroy(),e.pause(),e.resume(),e._shouldLoadLaunchScene=!0,ae.instance.curTime=0,e._safeEmit(n.EVENT_RESTART)}))},s.end=function(){f.close()},s.on=function(e,t,i,s){return(this._engineInited&&e===n.EVENT_ENGINE_INITED||this._inited&&e===n.EVENT_GAME_INITED||this._rendererInitialized&&e===n.EVENT_RENDERER_INITED)&&t.call(i),this.eventTargetOn(e,t,i,s)},s.once=function(e,t,i){return this._engineInited&&e===n.EVENT_ENGINE_INITED?t.call(i):this.eventTargetOnce(e,t,i)},s.init=function(e){var i=this;return this._compatibleWithOldParams(e),Promise.resolve().then((function(){return i.emit(n.EVENT_PRE_BASE_INIT),i.onPreBaseInitDelegate.dispatch()})).then((function(){var t=e.debugMode||p.NONE;_(t)})).then((function(){return l.init()})).then((function(){i._initEvents()})).then((function(){return r.init(e.settingsPath,e.overrideSettings)})).then((function(){return i.emit(n.EVENT_POST_BASE_INIT),i.onPostBaseInitDelegate.dispatch()})).then((function(){return i.emit(n.EVENT_PRE_INFRASTRUCTURE_INIT),i.onPreInfrastructureInitDelegate.dispatch()})).then((function(){E.init(),i._initXR();var e,t={frame:e=document.createElement("div"),canvas:window.canvas,container:e};t&&(i.canvas=t.canvas,i.frame=t.frame,i.container=t.container),T.init(),S.init(),q.init(i.canvas,O),""===E.CUSTOM_PIPELINE_NAME&&(o.rendering=void 0),L.init(),V.init(),j.init(),i.initPacer()})).then((function(){return i.emit(n.EVENT_POST_INFRASTRUCTURE_INIT),i.onPostInfrastructureInitDelegate.dispatch()})).then((function(){return i.emit(n.EVENT_PRE_SUBSYSTEM_INIT),i.onPreSubsystemInitDelegate.dispatch()})).then((function(){return oe.init(r.querySettings(a.Category.RENDERING,"effectSettingsPath"))})).then((function(){if(o.rendering&&o.rendering.enableEffectImport)if(r.querySettings(a.Category.RENDERING,"renderMode")!==G.HEADLESS){var e=oe.data;null!==e?o.rendering.init(q.gfxDevice,e):console.error("Effect settings not found, effects will not be imported.")}else o.rendering.init(q.gfxDevice,null)})).then((function(){return A.init(),V.loadBuiltinAssets()})).then((function(){return i.emit(n.EVENT_POST_SUBSYSTEM_INIT),i.onPostSubsystemInitDelegate.dispatch()})).then((function(){console.log("Cocos Creator v"+v),i.emit(n.EVENT_ENGINE_INITED),i._engineInited=!0})).then((function(){return i.emit(n.EVENT_PRE_PROJECT_INIT),i.onPreProjectInitDelegate.dispatch()})).then((function(){var e=r.querySettings(a.Category.PLUGINS,"jsList"),t=Promise.resolve();return e&&e.forEach((function(e){t=t.then((function(){return __wxRequire("src/"+e)}))})),t})).then((function(){var e=r.querySettings(a.Category.SCRIPTING,"scriptPackages");return e?Promise.all(e.map((function(e){return t.import(e)}))):Promise.resolve([])})).then((function(){return i._loadProjectBundles()})).then((function(){return i._loadCCEScripts()})).then((function(){return i._setupRenderPipeline()})).then((function(){return i._loadPreloadAssets()})).then((function(){return V.compileBuiltinMaterial(),ae.instance.init()})).then((function(){return i.emit(n.EVENT_POST_PROJECT_INIT),i.onPostProjectInitDelegate.dispatch()})).then((function(){i._inited=!0,i._safeEmit(n.EVENT_GAME_INITED)}))},s._initXR=function(){var e;if(void 0===globalThis.__globalXR&&(globalThis.__globalXR={}),globalThis.__globalXR.webxrCompatible=null!==(e=r.querySettings(a.Category.XR,"webxrCompatible"))&&void 0!==e&&e,l.isXR){var t,i;xr.entry=xr.XrEntry.getInstance();var n=null!==(t=r.querySettings(a.Category.RENDERING,"msaa"))&&void 0!==t?t:1,s=null!==(i=r.querySettings(a.Category.RENDERING,"renderingScale"))&&void 0!==i?i:1;xr.entry.setMultisamplesRTT(n),xr.entry.setRenderingScale(s)}},s._compatibleWithOldParams=function(e){var t=e.overrideSettings=e.overrideSettings||{};"showFPS"in e&&(t.profiling=t.profiling||{},t.profiling.showFPS=e.showFPS),"frameRate"in e&&(t.screen=t.screen||{},t.screen.frameRate=e.frameRate),"renderMode"in e&&(t.rendering=t.rendering||{},t.rendering.renderMode=e.renderMode),"renderPipeline"in e&&(t.rendering=t.rendering||{},t.rendering.renderPipeline=e.renderPipeline),"assetOptions"in e&&(t.assets=t.assets||{},Object.assign(t.assets,e.assetOptions)),"customJointTextureLayouts"in e&&(t.animation=t.animation||{},t.animation.customJointTextureLayouts=e.customJointTextureLayouts),"physics"in e&&(t.physics=t.physics||{},Object.assign(t.physics,e.physics)),"orientation"in e&&(t.screen=t.screen||{},t.screen.orientation=e.orientation),"exactFitScreen"in e&&(t.screen=t.screen||{},t.screen.exactFitScreen=e.exactFitScreen)},s._loadPreloadAssets=function(){var e=r.querySettings(a.Category.ASSETS,"preloadAssets");return e?Promise.all(e.map((function(e){return new Promise((function(t,i){L.loadAny(e,(function(e){e?i(e):t()}))}))}))):Promise.resolve([])},s._loadCCEScripts=function(){return new Promise((function(e){e()}))},s._loadProjectBundles=function(){var e=r.querySettings(a.Category.ASSETS,"preloadBundles");return e?Promise.all(e.map((function(e){var t=e.bundle,i=e.version;return new Promise((function(e,n){var s={};i&&(s.version=i),L.loadBundle(t,s,(function(t){t?n(t):e()}))}))}))):Promise.resolve([])},s.run=function(e){e&&(this.onStart=e),this._inited&&!P&&this.resume()},s._calculateDT=function(e){if(this._useFixedDeltaTime=e,e)return this._startTime=performance.now(),this.frameTime/1e3;var t=performance.now();return this._deltaTime=t>this._startTime?(t-this._startTime)/1e3:0,this._deltaTime>n.DEBUG_DT_THRESHOLD&&(this._deltaTime=this.frameTime/1e3),this._startTime=t,this._deltaTime},s._updateCallback=function(){var e=this;if(this._inited)if(ae.instance.isFinished)if(this._shouldLoadLaunchScene){this._shouldLoadLaunchScene=!1;var t,i=r.querySettings(a.Category.LAUNCH,"launchScene");i?A.loadScene(i,(function(){var t;console.log("Success to load scene: "+i),e._initTime=performance.now(),A.startAnimation(),null===(t=e.onStart)||void 0===t||t.call(e)})):(this._initTime=performance.now(),A.startAnimation(),null===(t=this.onStart)||void 0===t||t.call(this))}else A.tick(this._calculateDT(!1));else ae.instance.update(this._calculateDT(!1))},s.initPacer=function(){var e,t=null!==(e=r.querySettings(a.Category.SCREEN,"frameRate"))&&void 0!==e?e:60;y("number"==typeof t),this._pacer=new se,this._pacer.onTick=this._updateCallback.bind(this),this.frameRate=t},s._initEvents=function(){f.on("show",this._onShow,this),f.on("hide",this._onHide,this),f.on("close",this._onClose,this)},s._onHide=function(){this.emit(n.EVENT_HIDE),this.pauseByEngine()},s._onShow=function(){this.emit(n.EVENT_SHOW),this.resumeByEngine()},s._onClose=function(){this.emit(n.EVENT_CLOSE),f.exit()},s.addPersistRootNode=function(e){A.addPersistRootNode(e)},s.removePersistRootNode=function(e){A.removePersistRootNode(e)},s.isPersistRootNode=function(e){return A.isPersistRootNode(e)},s._setupRenderPipeline=function(){var e=this,t=r.querySettings(a.Category.RENDERING,"renderPipeline");return t?new Promise((function(e,i){L.loadAny(t,(function(t,n){return!t&&n instanceof B?e(n):i(t)}))})).then((function(t){e._setRenderPipeline(t)})).catch((function(i){b(i),b("Failed load render pipeline: "+t+", engine failed to initialize, will fallback to default pipeline"),e._setRenderPipeline()})):this._setRenderPipeline()},s._setRenderPipeline=function(e){A.root.setRenderPipeline(e)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(n.EVENT_RENDERER_INITED)},s._safeEmit=function(e){this.emit(e)},i(n,[{key:"inited",get:function(){return this._inited}},{key:"frameRate",get:function(){return this._frameRate},set:function(e){"number"!=typeof e&&(e=parseInt(e,10),Number.isNaN(e)&&(e=60)),this._frameRate=e,this.frameTime=1e3/e,this._pacer&&(this._pacer.targetFrameRate=this._frameRate)}},{key:"deltaTime",get:function(){return this._useFixedDeltaTime?this.frameTime/1e3:this._deltaTime}},{key:"totalTime",get:function(){return performance.now()-this._initTime}},{key:"frameStartTime",get:function(){return this._startTime}}]),n}(R));he.EVENT_HIDE="game_on_hide",he.EVENT_SHOW="game_on_show",he.EVENT_LOW_MEMORY="game_on_low_memory",he.EVENT_GAME_INITED="game_inited",he.EVENT_ENGINE_INITED="engine_inited",he.EVENT_RENDERER_INITED="renderer_inited",he.EVENT_PRE_BASE_INIT="pre_base_init",he.EVENT_POST_BASE_INIT="post_base_init",he.EVENT_PRE_INFRASTRUCTURE_INIT="pre_infrastructure_init",he.EVENT_POST_INFRASTRUCTURE_INIT="post_infrastructure_init",he.EVENT_PRE_SUBSYSTEM_INIT="pre_subsystem_init",he.EVENT_POST_SUBSYSTEM_INIT="post_subsystem_init",he.EVENT_PRE_PROJECT_INIT="pre_project_init",he.EVENT_POST_PROJECT_INIT="post_project_init",he.EVENT_RESTART="game_on_restart",he.EVENT_PAUSE="game_on_pause",he.EVENT_RESUME="game_on_resume",he.EVENT_CLOSE="game_on_close",he.RENDER_TYPE_CANVAS=0,he.RENDER_TYPE_WEBGL=1,he.RENDER_TYPE_OPENGL=2,he.RENDER_TYPE_HEADLESS=3,he.DEBUG_DT_THRESHOLD=1,o.Game=he;var ue=e("g",o.game=new he);N(D.prototype,"director",[{name:"calculateDeltaTime"},{name:"getDeltaTime",suggest:"Use game.deltaTime instead"},{name:"getTotalTime",suggest:"Use game.totalTime instead"},{name:"getCurrentTime",suggest:"Use game.frameStartTime instead"}]),w(D.prototype,"director",[{name:"setAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getRunningScene",suggest:"please use getScene instead"},{name:"setDepthTest",suggest:"please use camera API instead"},{name:"setClearColor",suggest:"please use camera API instead"},{name:"getWinSize",suggest:"please use view.getVisibleSize instead"},{name:"getWinSizeInPixels"},{name:"purgeCachedData",suggest:"please use assetManager.releaseAll instead"},{name:"convertToGL"},{name:"convertToUI"}]),x(A,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return L.main?null===(t=L.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),N(ue,"game",[{name:"collisionMatrix"},{name:"groupList"}]),x(ue,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return L.main&&L.main.config.scenes.forEach((function(t){e.push(t)})),e}}])}}}));
