System.register(["./pipeline-state-manager-8f16c5a7.js","./buffer-barrier-d1733967.js","./index-68ccac70.js","./director-56fe9b8d.js","./find-222dc7da.js"],(function(t){"use strict";var e,i,n,s,a,r,h,o,_,u,O,T,A,f,I,l,E,N,L;return{setters:[function(t){e=t.b},function(t){i=t.aQ,n=t.aZ,s=t.ae,a=t.g,r=t.h,h=t.b,o=t.a3},function(t){_=t.aG,u=t.ah,O=t.ag,T=t.l},function(t){A=t.u,f=t.h,I=t.g,l=t.o,E=t.i},function(t){N=t.s,L=t.d}],execute:function(){var R,c;function m(t){return--t,t|=t>>16,t|=t>>8,t|=t>>4,t|=t>>2,t|=t>>1,++t}function d(t,e){return Math.ceil(t/e)*e}t("n",m),t("R",R),function(t){t[t.OPAQUE=0]="OPAQUE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OVERLAY=2]="OVERLAY"}(R||t("R",R={})),t("P",c),function(t){t[t.DEFAULT=1]="DEFAULT",t[t.FORWARD=2]="FORWARD",t[t.SHADOWCAST=4]="SHADOWCAST"}(c||t("P",c={})),t("T",function(){function t(t){this._device=void 0,this._format=h.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new o,this._region1=new o,this._region2=new o,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=t}var e=t.prototype;return e.initialize=function(t){var e=i[t.format];this._format=t.format,this._formatSize=e.size,this._channels=e.count,this._bufferViewCtor=n(e),this._roundUpFn=t.roundUpFn||null,this._alignment=t.alignment||1,t.inOrderFree&&(this.alloc=this._McDonaldAlloc)},e.destroy=function(){for(var t=0;t<this._chunkCount;++t)this._chunks[t].texture.destroy();this._chunks.length=0,this._handles.length=0},e.alloc=function(t,e){t=d(t,this._alignment);var i=-1,n=-1;if(void 0!==e&&(i=e,n=this._findAvailableSpace(t,i)),n<0)for(var s=0;s<this._chunkCount&&(i=s,!((n=this._findAvailableSpace(t,i))>=0));++s);if(n>=0){var a=this._chunks[i];a.start+=t;var r={chunkIdx:i,start:n,end:n+t,texture:a.texture};return this._handles.push(r),r}var h=Math.sqrt(t/this._formatSize),o=this._roundUpFn&&this._roundUpFn(h,this._formatSize)||Math.max(1024,m(h)),_=this._chunks[this.createChunk(o)];_.start+=t;var u={chunkIdx:this._chunkCount-1,start:0,end:t,texture:_.texture};return this._handles.push(u),u},e.free=function(t){for(var e=0;e<this._handles.length;++e)if(this._handles[e]===t)return this._chunks[t.chunkIdx].end=t.end,void this._handles.splice(e,1)},e.createChunk=function(t){var e=t*t*this._formatSize;_("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+e+", format: "+this._format);var i={texture:this._device.createTexture(new s(a.TEX2D,r.SAMPLED|r.TRANSFER_DST,this._format,t,t)),size:e,start:0,end:e};return this._chunks[this._chunkCount]=i,this._chunkCount++},e.update=function(t,e){var i=[],n=[],s=t.start/this._formatSize,a=e.byteLength/this._formatSize,r=s%t.texture.width,h=Math.floor(s/t.texture.width),o=Math.min(t.texture.width-r,a),_=0;r>0&&(this._region0.texOffset.x=r,this._region0.texOffset.y=h,this._region0.texExtent.width=o,this._region0.texExtent.height=1,i.push(new this._bufferViewCtor(e,_*this._formatSize,o*this._channels)),n.push(this._region0),r=0,h+=1,a-=o,_+=o),a>0&&(this._region1.texOffset.x=r,this._region1.texOffset.y=h,a>t.texture.width?(this._region1.texExtent.width=t.texture.width,this._region1.texExtent.height=Math.floor(a/t.texture.width),o=this._region1.texExtent.width*this._region1.texExtent.height):(o=a,this._region1.texExtent.width=o,this._region1.texExtent.height=1),i.push(new this._bufferViewCtor(e,_*this._formatSize,o*this._channels)),n.push(this._region1),r=0,h+=this._region1.texExtent.height,a-=o,_+=o),a>0&&(this._region2.texOffset.x=r,this._region2.texOffset.y=h,this._region2.texExtent.width=a,this._region2.texExtent.height=1,i.push(new this._bufferViewCtor(e,_*this._formatSize,a*this._channels)),n.push(this._region2)),this._device.copyBuffersToTexture(i,t.texture,n)},e._findAvailableSpace=function(t,e){var i=this._chunks[e],n=!1,s=i.start;if(s+t<=i.size)n=!0;else{s=0;for(var a=this._handles.filter((function(t){return t.chunkIdx===e})).sort((function(t,e){return t.start-e.start})),r=0;r<a.length;r++){var h=a[r];if(s+t<=h.start){n=!0;break}s=h.end}!n&&s+t<=i.size&&(n=!0)}return n?s:-1},e._McDonaldAlloc=function(t){t=d(t,this._alignment);for(var e=0;e<this._chunkCount;++e){var i=this._chunks[e],n=!1,s=i.start;if(s+t<=i.end?n=!0:s>i.end?s+t<=i.size?n=!0:t<=i.end&&(i.start=s=0,n=!0):s===i.end&&(i.start=s=0,i.end=i.size,t<=i.end&&(n=!0)),n){i.start+=t;var a={chunkIdx:e,start:s,end:s+t,texture:i.texture};return this._handles.push(a),a}}var r=Math.sqrt(t/this._formatSize),h=this._roundUpFn&&this._roundUpFn(r,this._formatSize)||Math.max(1024,m(r)),o=this._chunks[this.createChunk(h)];o.start+=t;var _={chunkIdx:this._chunkCount,start:0,end:t,texture:o.texture};return this._handles.push(_),_},t}());var S,g,C,p,M,y,U,v,D,w=function(){function t(t,e,i){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=i*(1<<e)}return t.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},t}();!function(t){t[t.UINT32=0]="UINT32",t[t.FLOAT32=1]="FLOAT32",t[t.NEVER=2]="NEVER"}(D||(D={}));var F,P,k=function(){function t(t,e,i,n,s){void 0===s&&(s=8),this._dataType=void 0,this._dataMembers=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freeLists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=n.COUNT,this._entryBits=s,this._dataType=e,this._dataMembers=i,this._stride=4*this._elementCount,this._entriesPerChunk=1<<s,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new w(t,s,this._stride);var a=D.NEVER,r=!1,h=!1;for(var o in e){if(r=this._hasFloat32,(h=this._hasUint32)&&r)break;a=e[o],r||a!==D.FLOAT32?h||a!==D.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var e=t.prototype;return e.alloc=function(){for(var t=0;t<this._freeLists.length;t++){var e=this._freeLists[t];if(e.length){var i=e[e.length-1];return e.length--,(t<<this._entryBits)+i+this._poolFlag}}for(var n=this._nativePool.allocateNewChunk(),s=[],a=[],r=[],h=this._hasFloat32,o=this._hasUint32,_=0;_<this._entriesPerChunk;_++)h&&s.push(new Float32Array(n,this._stride*_,this._elementCount)),o&&a.push(new Uint32Array(n,this._stride*_,this._elementCount)),_&&r.push(_);return o&&this._uint32BufferViews.push(a),h&&this._float32BufferViews.push(s),this._freeLists.push(r),this._arrayBuffers.push(n),(t<<this._entryBits)+this._poolFlag},e.getBuffer=function(t){var e=(this._chunkMask&t)>>this._entryBits,i=this._entryMask&t;return(this._hasFloat32?this._float32BufferViews:this._uint32BufferViews)[e][i]},e.getTypedArray=function(t,e){var i=(this._chunkMask&t)>>this._entryBits,n=this._entryMask&t,s=e,a=(this._dataType[e]===D.UINT32?this._uint32BufferViews:this._float32BufferViews)[i][n],r=this._dataMembers[e];return a.subarray(s,s+r)},e.free=function(t){var e=(this._chunkMask&t)>>this._entryBits,i=this._entryMask&t;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[e][i].fill(0),this._freeLists[e].push(i)},t}();t("a",F),function(t){t[t.NODE=0]="NODE",t[t.PASS=1]="PASS",t[t.AABB=2]="AABB",t[t.RENDER2D=3]="RENDER2D"}(F||t("a",F={})),t("N",0),t("b",P),function(t){t[t.POSITION=0]="POSITION",t[t.UV=3]="UV",t[t.COLOR=5]="COLOR",t[t.COUNT=9]="COUNT"}(P||t("b",P={}));var x,V=((S={})[P.POSITION]=D.FLOAT32,S[P.UV]=D.FLOAT32,S[P.COLOR]=D.UINT32,S[P.COUNT]=D.NEVER,S),B=((g={})[P.POSITION]=P.UV-P.POSITION,g[P.UV]=P.COLOR-P.UV,g[P.COLOR]=P.COUNT-P.COLOR,g[P.COUNT]=1,g);t("c",new k(F.RENDER2D,V,B,P)),t("d",x),function(t){t[t.DIRTY_FLAG=0]="DIRTY_FLAG",t[t.LAYER=1]="LAYER",t[t.WORLD_SCALE=2]="WORLD_SCALE",t[t.WORLD_POSITION=5]="WORLD_POSITION",t[t.WORLD_ROTATION=8]="WORLD_ROTATION",t[t.WORLD_MATRIX=12]="WORLD_MATRIX",t[t.LOCAL_SCALE=28]="LOCAL_SCALE",t[t.LOCAL_POSITION=31]="LOCAL_POSITION",t[t.LOCAL_ROTATION=34]="LOCAL_ROTATION",t[t.COUNT=38]="COUNT"}(x||t("d",x={}));var H,b=((C={})[x.DIRTY_FLAG]=D.UINT32,C[x.LAYER]=D.UINT32,C[x.WORLD_SCALE]=D.FLOAT32,C[x.WORLD_POSITION]=D.FLOAT32,C[x.WORLD_ROTATION]=D.FLOAT32,C[x.WORLD_MATRIX]=D.FLOAT32,C[x.LOCAL_SCALE]=D.FLOAT32,C[x.LOCAL_POSITION]=D.FLOAT32,C[x.LOCAL_ROTATION]=D.FLOAT32,C[x.COUNT]=D.NEVER,C),W=((p={})[x.DIRTY_FLAG]=x.LAYER-x.DIRTY_FLAG,p[x.LAYER]=x.WORLD_SCALE-x.LAYER,p[x.WORLD_SCALE]=x.WORLD_POSITION-x.WORLD_SCALE,p[x.WORLD_POSITION]=x.WORLD_ROTATION-x.WORLD_POSITION,p[x.WORLD_ROTATION]=x.WORLD_MATRIX-x.WORLD_ROTATION,p[x.WORLD_MATRIX]=x.LOCAL_SCALE-x.WORLD_MATRIX,p[x.LOCAL_SCALE]=x.LOCAL_POSITION-x.LOCAL_SCALE,p[x.LOCAL_POSITION]=x.LOCAL_ROTATION-x.LOCAL_POSITION,p[x.LOCAL_ROTATION]=x.COUNT-x.LOCAL_ROTATION,p[x.COUNT]=1,p);t("e",new k(F.NODE,b,W,x)),t("f",H),function(t){t[t.PRIORITY=0]="PRIORITY",t[t.STAGE=1]="STAGE",t[t.PHASE=2]="PHASE",t[t.PRIMITIVE=3]="PRIMITIVE",t[t.BATCHING_SCHEME=4]="BATCHING_SCHEME",t[t.DYNAMIC_STATE=5]="DYNAMIC_STATE",t[t.HASH=6]="HASH",t[t.COUNT=7]="COUNT"}(H||t("f",H={}));var G,z=((M={})[H.PRIORITY]=D.UINT32,M[H.STAGE]=D.UINT32,M[H.PHASE]=D.UINT32,M[H.PRIMITIVE]=D.UINT32,M[H.BATCHING_SCHEME]=D.UINT32,M[H.DYNAMIC_STATE]=D.UINT32,M[H.HASH]=D.UINT32,M[H.COUNT]=D.NEVER,M),Y=((y={})[H.PRIORITY]=H.STAGE-H.PRIORITY,y[H.STAGE]=H.PHASE-H.STAGE,y[H.PHASE]=H.PRIMITIVE-H.PHASE,y[H.PRIMITIVE]=H.BATCHING_SCHEME-H.PRIMITIVE,y[H.BATCHING_SCHEME]=H.DYNAMIC_STATE-H.BATCHING_SCHEME,y[H.DYNAMIC_STATE]=H.HASH-H.DYNAMIC_STATE,y[H.HASH]=H.COUNT-H.HASH,y[H.COUNT]=1,y);t("g",new k(F.PASS,z,Y,H)),t("A",G),function(t){t[t.CENTER=0]="CENTER",t[t.HALFEXTENTS=3]="HALFEXTENTS",t[t.COUNT=6]="COUNT"}(G||t("A",G={}));var X=((U={})[G.CENTER]=D.FLOAT32,U[G.HALFEXTENTS]=D.FLOAT32,U[G.COUNT]=D.NEVER,U),j=((v={})[G.CENTER]=G.HALFEXTENTS-G.CENTER,v[G.HALFEXTENTS]=G.COUNT-G.HALFEXTENTS,v[G.COUNT]=1,v);t("h",new k(F.AABB,X,j,G)),u(A.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),u(A.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]),u(f.prototype,"Model.prototype",[{name:"isInstancingEnabled"},{name:"instancedAttributes"}]);var Z=t("C",{});u(Z,"CameraVisFlags",[{name:"GENERAL"}]),O(Z,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:e.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:e.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:e.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:e.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:e.BitMask,targetName:"UI_2D"}]),T.CameraVisFlags=Z;var Q=t("V",{});u(Q,"VisibilityFlags",[{name:"GENERAL"}]),O(Q,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:e.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:e.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:e.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:e.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:e.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:e.Enum,targetName:"UI_2D"}]),T.VisibilityFlags=Q,O(N.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),u(I.prototype,"Camera.prototype",[{name:"getSplitFrustum"},{name:"setMatView"},{name:"setMatViewInv"},{name:"setMatProjInv"},{name:"setMatViewProjInv"},{name:"setMatProj"},{name:"setMatViewProj"},{name:"getMatViewInv"}]),u(L.prototype,"Shadows.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"},{name:"fixedArea"},{name:"pcf"},{name:"bias"},{name:"normalBias"},{name:"near"},{name:"far"},{name:"shadowDistance"},{name:"invisibleOcclusionRange"},{name:"orthoSize"},{name:"saturation"}]),u(l.prototype,"SpotLight.prototype",[{name:"aspect"}]),O(E.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),u(E.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}])}}}));
