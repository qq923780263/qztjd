System.register(["./index-68ccac70.js","./node-event-40319828.js","./sprite-e4e3e9a1.js","./find-222dc7da.js","./director-56fe9b8d.js","./sprite-renderer-e5daf04e.js","./pipeline-state-manager-8f16c5a7.js","./buffer-barrier-d1733967.js","./deprecated-0752a51c.js","./deprecated-37e42d8f.js"],(function(t){"use strict";var e,i,n,s,r,o,a,h,l,c,u,p,_,f,d,m,g,y,v,b,C,T,E,S,R,x,A,L,D,I,O,P,k,M,w,N,H,F,z,W,U,G,B,j,V,X,Y,q,J,Q,Z,$,K,tt,et,it,nt,st,rt,ot,at,ht,lt,ct,ut,pt,_t,ft;return{setters:[function(t){e=t.ab,i=t.bA,n=t.V,s=t.B,r=t.bD,o=t.bF,a=t.d,h=t.bx,l=t.b$,c=t.be,u=t.bE,p=t.l,_=t.ct,f=t.ci,d=t.bg,m=t.t,g=t.o,y=t.J,v=t.i,b=t.cD,C=t.bP,T=t.as,E=t.cr,S=t.cE,R=t.cq,x=t.ag},function(t){A=t.N,L=t.C},function(t){D=t.a,I=t.b,t.T,O=t.j,P=t.k,k=t.l,M=t.c,w=t.i,N=t.e,H=t.H,F=t.F,z=t.V,W=t.C,U=t.S},function(t){G=t.ac,B=t._,j=t.N,V=t.s},function(t){X=t.a3,Y=t.h,q=t.aw,J=t.ay},function(t){Q=t.f,Z=t.n,$=t.o,K=t.j,tt=t.p,et=t.q,it=t.b,nt=t.I,st=t.l,rt=t.c},function(t){ot=t.d,at=t.c,ht=t.b},function(t){lt=t.aq,ct=t.b,ut=t.a9,pt=t.d,_t=t.f,ft=t.v},function(){},function(){}],execute:function(){var dt,mt,gt;t("e",dt),function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(dt||t("e",dt={})),e(dt),t("d",mt),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(mt||t("d",mt={})),e(mt),t("f",gt),function(t){t[t.PT_CORNER=1]="PT_CORNER",t[t.PT_LEFT=2]="PT_LEFT",t[t.PT_BEVEL=4]="PT_BEVEL",t[t.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(gt||t("f",gt={})),e(gt);var yt=Math.PI,vt=Math.min,bt=Math.max,Ct=Math.cos,Tt=Math.sin,Et=Math.abs,St=Math.sign,Rt=.5522847493;function xt(t,e,i,n,s){t.moveTo(e-n,i),t.bezierCurveTo(e-n,i+s*Rt,e-n*Rt,i+s,e,i+s),t.bezierCurveTo(e+n*Rt,i+s,e+n,i+s*Rt,e+n,i),t.bezierCurveTo(e+n,i-s*Rt,e+n*Rt,i-s,e,i-s),t.bezierCurveTo(e-n*Rt,i-s,e-n,i-s*Rt,e-n,i),t.close()}function At(t,e,i,n,s,r,o,a,h,l,c){var u,p,_,f,d,m,g,y,v,b,C,T,E,S,R,x;l>10||(d=.5*(r+a),m=.5*(o+h),g=.5*((u=.5*(e+n))+(_=.5*(n+r))),y=.5*((p=.5*(i+s))+(f=.5*(s+o))),((R=Et((n-a)*(S=h-i)-(s-h)*(E=a-e)))+(x=Et((r-a)*S-(o-h)*E)))*(R+x)<t.tessTol*(E*E+S*S)?t.addPoint(a,h,0===c?c|gt.PT_BEVEL:c):(At(t,e,i,u,p,g,y,C=.5*(g+(v=.5*(_+d))),T=.5*(y+(b=.5*(f+m))),l+1,0),At(t,C,T,v,b,d,m,a,h,l+1,c)))}var Lt,Dt,It,Ot,Pt,kt,Mt,wt,Nt,Ht,Ft,zt,Wt,Ut,Gt,Bt,jt,Vt,Xt,Yt,qt,Jt,Qt,Zt=t("P",function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).dx=0,e.dy=0,e.dmx=0,e.dmy=0,e.flags=0,e.len=0,e}return i(e,t),e.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},e}(n)),$t=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[]}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points.length=0},t}(),Kt=function(){function t(t){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=s.WHITE.clone(),this.lineCap=dt.BUTT,this.strokeColor=s.BLACK.clone(),this.lineJoin=mt.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null,this._comp=void 0,this._comp=t}var e=t.prototype;return e.moveTo=function(t,e){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,e,gt.PT_CORNER),this._commandX=t,this._commandY=e},e.lineTo=function(t,e){this.addPoint(t,e,gt.PT_CORNER),this._commandX=t,this._commandY=e},e.bezierCurveTo=function(t,e,i,n,s,r){var o=this._curPath,a=o.points[o.points.length-1];a&&(a.x!==t||a.y!==e||i!==s||n!==r?(At(this,a.x,a.y,t,e,i,n,s,r,0,gt.PT_CORNER),this._commandX=s,this._commandY=r):this.lineTo(s,r))},e.quadraticCurveTo=function(t,e,i,n){var s=this._commandX,r=this._commandY;this.bezierCurveTo(s+2/3*(t-s),r+2/3*(e-r),i+2/3*(t-i),n+2/3*(e-n),i,n)},e.arc=function(t,e,i,n,s,r){!function(t,e,i,n,s,r,o){var a,h,l=0,c=0,u=0,p=0,_=0,f=0,d=0,m=0,g=0,y=0,v=0,b=0,C=0,T=0;if(c=r-s,o=o||!1)if(Et(c)>=2*yt)c=2*yt;else for(;c<0;)c+=2*yt;else if(Et(c)>=2*yt)c=2*-yt;else for(;c>0;)c-=2*yt;for(h=0|bt(1,vt(Et(c)/(.5*yt)+.5,5)),u=Et(4/3*(1-Ct(a=c/h/2))/Tt(a)),o||(u=-u),T=0;T<=h;T++)f=e+(p=Ct(l=s+c*(T/h)))*n,d=i+(_=Tt(l))*n,m=-_*n*u,g=p*n*u,0===T?t.moveTo(f,d):t.bezierCurveTo(y+b,v+C,f-m,d-g,f,d),y=f,v=d,b=m,C=g}(this,t,e,i,n,s,r)},e.ellipse=function(t,e,i,n){xt(this,t,e,i,n),this._curPath.complex=!1},e.circle=function(t,e,i){xt(this,t,e,i,i),this._curPath.complex=!1},e.rect=function(t,e,i,n){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+n),this.lineTo(t,e+n),this.close(),this._curPath.complex=!1},e.roundRect=function(t,e,i,n,s){!function(t,e,i,n,s,r){if(r<.1)t.rect(e,i,n,s);else{var o=vt(r,.5*Et(n))*St(n),a=vt(r,.5*Et(s))*St(s);t.moveTo(e,i+a),t.lineTo(e,i+s-a),t.bezierCurveTo(e,i+s-a*(1-Rt),e+o*(1-Rt),i+s,e+o,i+s),t.lineTo(e+n-o,i+s),t.bezierCurveTo(e+n-o*(1-Rt),i+s,e+n,i+s-a*(1-Rt),e+n,i+s-a),t.lineTo(e+n,i+a),t.bezierCurveTo(e+n,i+a*(1-Rt),e+n-o*(1-Rt),i,e+n-o,i),t.lineTo(e+o,i),t.bezierCurveTo(e+o*(1-Rt),i,e,i+a*(1-Rt),e,i+a),t.close()}}(this,t,e,i,n,s),this._curPath.complex=!1},e.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var t=this._renderDataList,e=0,i=t.length;e<i;e++){var n=t[e];n&&(Q.remove(n),n.removeRenderDrawInfo(this._comp))}this._renderDataList.length=0},e.close=function(){this._curPath.closed=!0},e.requestRenderData=function(){var t=Q.add();return this._renderDataList.push(t),t},e.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},e.addPoint=function(t,e,i){var n=this._curPath;if(n){var s=this._points,r=n.points,o=s[this.pointsOffset++];o?(o.x=t,o.y=e):(o=new Zt(t,e),s.push(o)),o.flags=i,r.push(o)}},e._addPath=function(){var t=this.pathLength,e=this.paths[t];return e?e.reset():(e=new $t,this.paths.push(e)),this.pathLength++,this._curPath=e,e},t}(),te=Z.concat([new lt("a_dist",ct.R32F)]),ee=$(te),ie=K(te),ne=t("G",(Lt=r("cc.Graphics"),Dt=_(110),It=o(mt),Ot=o(dt),Lt(Pt=Dt(((Wt=function(t){function e(){var e;return(e=t.call(this)||this).impl=null,e.model=null,e._lineWidth=Mt&&Mt(),e._strokeColor=wt&&wt(),e._lineJoin=Nt&&Nt(),e._lineCap=Ht&&Ht(),e._fillColor=Ft&&Ft(),e._miterLimit=zt&&zt(),e._isDrawing=!1,e._isNeedUploadData=!0,e._graphicsUseSubMeshes=[],e._instanceMaterialType=nt.ADD_COLOR,e.impl=new Kt(f(e)),e}i(e,t);var n=e.prototype;return n.onRestore=function(){this.impl||this._flushAssembler()},n.onLoad=function(){t.prototype.onLoad.call(this),this.model=X.root.createModel(Y),this.model.node=this.model.transform=this.node,this._flushAssembler()},n.onEnable=function(){t.prototype.onEnable.call(this),this._updateMtlForGraphics()},n.onDestroy=function(){this._sceneGetter=null,this.model&&(X.root.destroyModel(this.model),this.model=null);var e=this._graphicsUseSubMeshes.length;if(e>0){for(var i=0;i<e;++i)this._graphicsUseSubMeshes[i].destroy();this._graphicsUseSubMeshes.length=0}this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null),t.prototype.onDestroy.call(this)},n.moveTo=function(t,e){this.impl&&this.impl.moveTo(t,e)},n.lineTo=function(t,e){this.impl&&this.impl.lineTo(t,e)},n.bezierCurveTo=function(t,e,i,n,s,r){this.impl&&this.impl.bezierCurveTo(t,e,i,n,s,r)},n.quadraticCurveTo=function(t,e,i,n){this.impl&&this.impl.quadraticCurveTo(t,e,i,n)},n.arc=function(t,e,i,n,s,r){this.impl&&this.impl.arc(t,e,i,n,s,r)},n.ellipse=function(t,e,i,n){this.impl&&this.impl.ellipse(t,e,i,n)},n.circle=function(t,e,i){this.impl&&this.impl.circle(t,e,i)},n.rect=function(t,e,i,n){this.impl&&this.impl.rect(t,e,i,n)},n.roundRect=function(t,e,i,n,s){this.impl&&this.impl.roundRect(t,e,i,n,s)},n.fillRect=function(t,e,i,n){this.rect(t,e,i,n),this.fill()},n.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++)this.model.subModels[t].inputAssembler.indexCount=0;this.markForUpdateRenderData()}},n.close=function(){this.impl&&this.impl.close()},n.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},n.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},n._updateMtlForGraphics=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=G.get("ui-graphics-material"),this.setMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},n.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var e=ot.gfxDevice,i=e.createBuffer(new ut(pt.VERTEX|pt.TRANSFER_DST,_t.DEVICE,65535*ie,ie)),n=e.createBuffer(new ut(pt.INDEX|pt.TRANSFER_DST,_t.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),s=new B([i],te,ft.TRIANGLE_LIST,n);s.subMeshIdx=0,this.model.initSubModel(t,s,this.getMaterialInstance(0)),this._graphicsUseSubMeshes.push(s)}}else a(4500,this.node.name)},n._uploadData=function(){var t=this.impl;if(t){var e=t&&t.getRenderDataList();if(!(e.length<=0)&&this.model){for(var i=this.model.subModels,n=0;n<e.length;n++){var s=e[n],r=i[n].inputAssembler;if(s.lastFilledVertex!==s.vertexStart){var o=new Float32Array(s.vData.buffer,0,s.vertexStart*ee);r.vertexBuffers[0].update(o),r.vertexCount=s.vertexStart;var a=new Uint16Array(s.iData.buffer,0,s.indexStart);r.indexBuffer.update(a),r.indexCount=s.indexStart,s.lastFilledVertex=s.vertexStart,s.lastFilledIndex=s.indexStart}}this._isNeedUploadData=!1}}},n._render=function(t){if(this._isNeedUploadData){if(this.impl){var e=this.impl.getRenderDataList(),i=this.model.subModels.length;if(e.length>i)for(var n=i;n<e.length;n++)this.activeSubModel(n)}this._uploadData()}t.commitModel(this,this.model,this.getMaterialInstance(0))},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},n._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},n.updateRenderer=function(){t.prototype.updateRenderer.call(this)},n.createRenderEntity=function(){return new tt(et.DYNAMIC)},h(e,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"graphicsNativeProxy",get:function(){return this._graphicsNativeProxy}}]),e}(it)).LineJoin=mt,Wt.LineCap=dt,l((kt=Wt).prototype,"lineJoin",[It],Object.getOwnPropertyDescriptor(kt.prototype,"lineJoin"),kt.prototype),l(kt.prototype,"lineCap",[Ot],Object.getOwnPropertyDescriptor(kt.prototype,"lineCap"),kt.prototype),l(kt.prototype,"color",[c],Object.getOwnPropertyDescriptor(kt.prototype,"color"),kt.prototype),Mt=u(kt.prototype,"_lineWidth",[d],(function(){return 1})),wt=u(kt.prototype,"_strokeColor",[d],(function(){return s.BLACK.clone()})),Nt=u(kt.prototype,"_lineJoin",[d],(function(){return mt.MITER})),Ht=u(kt.prototype,"_lineCap",[d],(function(){return dt.BUTT})),Ft=u(kt.prototype,"_fillColor",[d],(function(){return s.WHITE.clone()})),zt=u(kt.prototype,"_miterLimit",[d],(function(){return 10})),Pt=kt))||Pt)||Pt));p.Graphics=ne;var se,re=new m,oe=new n,ae=new m,he=[];!function(t){t[t.GRAPHICS_RECT=0]="GRAPHICS_RECT",t[t.GRAPHICS_ELLIPSE=1]="GRAPHICS_ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.SPRITE_STENCIL=3]="SPRITE_STENCIL"}(se||(se={})),e(se);var le=t("M",(Ut=r("cc.Mask"),Gt=_(110),Bt=o(se),Ut(jt=Gt(((Qt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._type=Xt&&Xt(),e._inverted=Yt&&Yt(),e._segments=qt&&qt(),e._alphaThreshold=Jt&&Jt(),e._sprite=null,e._graphics=null,e._stencilStage=st.DISABLED,e}i(e,t);var r=e.prototype;return r.onLoad=function(){this._changeRenderType()},r.onEnable=function(){this._changeRenderType(),this._updateGraphics(),this._enableRender(),this.node.on(A.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(A.SIZE_CHANGED,this._nodeStateChange,this)},r.onRestore=function(){this._changeRenderType(),this._updateGraphics()},r.onDisable=function(){this._disableRender(),this.node.off(A.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(A.SIZE_CHANGED,this._nodeStateChange,this)},r.onDestroy=function(){this._removeMaskNode()},r.isHit=function(t){var e=this.node._uiProps.uiTransformComp,i=e.contentSize,s=i.width,r=i.height,o=oe;this.node.getWorldMatrix(re),m.invert(ae,re),n.transformMat4(o,t,ae);var a=e.anchorPoint;o.x+=a.x*s,o.y+=a.y*r;var h=!1;if(this.type===se.GRAPHICS_RECT||this.type===se.GRAPHICS_STENCIL||this.type===se.SPRITE_STENCIL)h=o.x>=0&&o.y>=0&&o.x<=s&&o.y<=r;else if(this.type===se.GRAPHICS_ELLIPSE){var l=s/2,c=r/2,u=o.x-.5*s,p=o.y-.5*r;h=u*u/(l*l)+p*p/(c*c)<1}return this._inverted&&(h=!h),h},r._nodeStateChange=function(){this._updateGraphics()},r._changeRenderType=function(){this._type!==se.SPRITE_STENCIL?this._createGraphics():this._createSprite()},r._createSprite=function(){if(!this._sprite){var t=this._sprite=this.node.getComponent(D);if(!t){var e=this.node;t=this._sprite=e.addComponent(D)}t.color=s.WHITE.clone(),t.sizeMode=0}this._sprite.stencilStage=this.inverted?st.ENTER_LEVEL_INVERTED:st.ENTER_LEVEL,this._sprite.updateMaterial()},r._createGraphics=function(){if(!this._graphics){var t=this._graphics=this.node.getComponent(ne);if(!t){var e=this.node;t=this._graphics=e.addComponent(ne)}t.lineWidth=1;var i=s.WHITE.clone();i.a=0,t.fillColor=i}this._graphics.stencilStage=this.inverted?st.ENTER_LEVEL_INVERTED:st.ENTER_LEVEL},r._updateGraphics=function(){if(this._graphics&&(this._type===se.GRAPHICS_RECT||this._type===se.GRAPHICS_ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var i=t.contentSize,n=i.width,s=i.height,r=t.anchorPoint,o=-n*r.x,a=-s*r.y;if(this._type===se.GRAPHICS_RECT)e.rect(o,a,n,s);else if(this._type===se.GRAPHICS_ELLIPSE){for(var h=function(t,e,i){he.length=0;for(var n=2*Math.PI/i,s=0;s<i;++s)he.push(new g(e.x*Math.cos(n*s)+t.x,e.y*Math.sin(n*s)+t.y,0));return he}(new g(o+n/2,a+s/2,0),new g(n/2,s/2,0),this._segments),l=0;l<h.length;++l){var c=h[l];0===l?e.moveTo(c.x,c.y):e.lineTo(c.x,c.y)}e.close()}e.fill()}},r._enableRender=function(){this.subComp&&(this.subComp.enabled=!0)},r._disableRender=function(){this.subComp&&(this.subComp.stencilStage=st.DISABLED,this.subComp.updateMaterial(),this.node.activeInHierarchy&&(this.subComp.enabled=!1))},r._removeMaskNode=function(){this._sprite&&(this._sprite.destroy(),this._sprite=null),this._graphics&&(this._graphics.destroy(),this._graphics=null)},r.markForUpdateRenderData=function(t){void 0===t&&(t=!0),a(9007),this.subComp&&this.subComp.markForUpdateRenderData(t)},r.requestRenderData=function(){a(9007)},r.destroyRenderData=function(){a(9007)},r.updateRenderer=function(){a(9007),this.subComp&&this.subComp.updateRenderer()},r.fillBuffers=function(){a(9007)},r.postUpdateAssembler=function(){a(9007)},r.setNodeDirty=function(){a(9007),this.subComp&&this.subComp.setNodeDirty()},r.setTextureDirty=function(){a(9007),this.subComp&&this.subComp.setTextureDirty()},r.getMaterial=function(t){return a(9007),this.subComp?this.subComp.getSharedMaterial(t):null},r.setMaterial=function(t,e){a(9007),this.subComp&&this.subComp.setMaterial(t,e)},r.getMaterialInstance=function(t){return a(9007),this.subComp?this.subComp.getMaterialInstance(t):null},r.setMaterialInstance=function(t,e){a(9007),this.subComp&&this.subComp.setMaterialInstance(t,e)},r.getRenderMaterial=function(t){return a(9007),this.subComp?this.subComp.getRenderMaterial(t):null},h(e,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._type!==se.SPRITE_STENCIL?(this._sprite&&(this.node.removeComponent(D),this._sprite._destroyImmediate(),this._sprite=null),this._changeRenderType(),this._updateGraphics()):(this._graphics&&(this._graphics.clear(),this.node.removeComponent(ne),this._graphics._destroyImmediate(),this._graphics=null),this._changeRenderType()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){this._inverted=t,this.subComp.stencilStage=this.inverted?st.ENTER_LEVEL_INVERTED:st.ENTER_LEVEL}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=y(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._sprite?this._sprite.spriteFrame:null},set:function(t){this._sprite?this._sprite.spriteFrame=t:console.error("please change type to sprite_stencil first")}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===se.SPRITE_STENCIL&&this._sprite&&this._sprite.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"subComp",get:function(){return this._graphics||this._sprite}},{key:"customMaterial",get:function(){return a(9007),this.subComp?this.subComp.customMaterial:null},set:function(t){a(9007),this.subComp&&(this.subComp.customMaterial=t)}},{key:"color",get:function(){return a(9007),this.subComp?this.subComp.color:null},set:function(t){a(9007),this.subComp&&t&&(this.subComp.color=t)}},{key:"sharedMaterial",get:function(){return a(9007),this.subComp?this.subComp.sharedMaterial:null}},{key:"sharedMaterials",get:function(){return a(9007),this.subComp?this.subComp.sharedMaterials:null},set:function(t){a(9007),this.subComp&&t&&(this.subComp.sharedMaterials=t)}},{key:"material",get:function(){return a(9007),this.subComp?this.subComp.material:null},set:function(t){a(9007),this.subComp&&(this.subComp.material=t)}},{key:"materials",get:function(){return a(9007),this.subComp?this.subComp.materials:[null]},set:function(t){a(9007),this.subComp&&(this.subComp.materials=t)}}]),e}(L)).Type=se,l((Vt=Qt).prototype,"type",[Bt],Object.getOwnPropertyDescriptor(Vt.prototype,"type"),Vt.prototype),Xt=u(Vt.prototype,"_type",[d],(function(){return se.GRAPHICS_RECT})),Yt=u(Vt.prototype,"_inverted",[d],(function(){return!1})),qt=u(Vt.prototype,"_segments",[d],(function(){return 64})),Jt=u(Vt.prototype,"_alphaThreshold",[d],(function(){return.1})),jt=Vt))||jt)||jt));q._maskComp=le,p.Mask=le;var ce,ue,pe,_e,fe,de,me,ge,ye,ve,be,Ce,Te,Ee,Se,Re,xe,Ae,Le,De,Ie,Oe,Pe,ke,Me,we,Ne,He=/^(click)(\s)*=|(param)(\s)*=/,Fe=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,ze=t("H",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,i=t.length;e<i;){var n=t.indexOf(">",e),s=-1;if(n>=0&&(s=t.lastIndexOf("<",n))<e-1&&(s=t.indexOf("<",n+1),n=t.indexOf(">",s+1)),s<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{var r=t.substring(e,s),o=t.substring(s+1,n);""===o&&(r=t.substring(e,n+1)),this._processResult(r),-1===n?n=s:"/"===t.charAt(s+1)?this._stack.pop():this._addToStack(o),e=n+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},i=/^(color|size)(\s)*=/.exec(t),n="",s=0,r="";if(i){if(n=i[0],""===(t=t.substring(n.length).trim()))return e;switch(s=t.indexOf(" "),n[0]){case"c":e.color=s>-1?t.substring(0,s).trim():t;break;case"s":e.size=parseInt(t)}return s>-1&&(r=t.substring(s+1).trim(),e.event=this._processEventHandler(r)),e}if((i=/^(br(\s)*\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("br")&&"/"===n[n.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var o="",a=-1;if((i=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("img")&&"/"===n[n.length-1]){var h;i=Fe.exec(t);for(var l=!1;i;){var c=(n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length)).length;if(n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),o=t.substring(c).trim(),a="src"===n?this.getRightQuotationIndex(o):-1,h=(s=o.indexOf(" ",a+1>=o.length?-1:a+1))>-1?o.substr(0,s):o,t=o.substring(s).trim(),h.endsWith("/")&&(h=h.slice(0,-1)),"src"===n){switch(h.charCodeAt(0)){case 34:case 39:l=!0,h=h.slice(1,-1)}e.isImage=!0,e.src=h}else if("height"===n)e.imageHeight=parseInt(h);else if("width"===n)e.imageWidth=parseInt(h);else if("align"===n){switch(h.charCodeAt(0)){case 34:case 39:h=h.slice(1,-1)}e.imageAlign=h.toLowerCase()}else"offset"===n?e.imageOffset=h:"click"===n&&(e.event=this._processEventHandler(n+"="+h));e.event&&"param"===n&&(e.event[n]=h.replace(/^"|"$/g,"")),i=Fe.exec(t)}return l&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(i=/^(outline(\s)*[^>]*)/.exec(t)){var u={color:"#ffffff",width:1};if(t=i[0].substring("outline".length).trim()){var p,_=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(i=_.exec(t);i;)n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),p=(s=(o=t.substring(n.length).trim()).indexOf(" "))>-1?o.substr(0,s):o,n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(s).trim(),"click"===n?e.event=this._processEventHandler(n+"="+p):"color"===n?u.color=p:"width"===n&&(u.width=parseInt(p)),e.event&&"param"===n&&(e.event[n]=p.replace(/^"|"$/g,"")),i=_.exec(t)}e.outline=u}if((i=/^(on|u|b|i)(\s)*/.exec(t))&&i[0].length>0){switch(n=i[0],t=t.substring(n.length).trim(),n[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e.getRightQuotationIndex=function(t){var e=-1,i=-1,n=t.indexOf("'"),s=t.indexOf('"'),r=s>-1&&(s<n||-1===n);return n>-1&&(n<s||-1===s)?(e=n,i=t.indexOf("'",e+1>=t.length?-1:e+1)):r&&(e=s,i=t.indexOf('"',e+1>=t.length?-1:e+1)),i},e._processEventHandler=function(t){for(var e={},i=0,n=!1,s=He.exec(t);s;){var r=s[0],o="";if(n=!1,'"'===(t=t.substring(r.length).trim()).charAt(0))(i=t.indexOf('"',1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else if("'"===t.charAt(0))(i=t.indexOf("'",1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else{var a=/(\S)+/.exec(t);i=(o=a?a[0]:"").length}n&&(e[r=r.substring(0,r.length-1).trim()]=o),t=t.substring(i).trim(),s=He.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var n in i)e[n]||(e[n]=i[n]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,i=v(this._specialSymbolArray);!(e=i()).done;){var n=e.value,s=n[0],r=n[1];t=t.replace(s,r)}return t},t}()),We=t("L",r("cc.LabelOutline")(ce=_(110)(ce=b(I)((ue=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._color=pe&&pe(),e._width=_e&&_e(),e}i(e,t);var n=e.prototype;return n.onEnable=function(){this._updateRenderData()},n.onDisable=function(){this._updateRenderData()},n._updateRenderData=function(){var t=this.node.getComponent(I);t&&t.updateRenderData(!0)},h(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())}}]),e}(L),pe=u(ue.prototype,"_color",[d],(function(){return new s(0,0,0,255)})),_e=u(ue.prototype,"_width",[d],(function(){return 2})),ce=ue))||ce)||ce)||ce);p.LabelOutline=We;var Ue=new ze,Ge="RICHTEXT_CHILD",Be="RICHTEXT_Image_CHILD",je=new n,Ve=new n,Xe=new C((function(t){if(!p.isValid(t.node))return!1;var e=t.node.getComponent(We);return e&&(e.width=0),!0}),20),Ye=new C((function(t){return p.isValid(t.node)}),10);function qe(t){return{node:new j(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function Je(t,e){var i;t===Ge?i=Xe._get():t===Be&&(i=Ye._get());var n=(i=i||qe(t)).node;return n||(n=new j(t)),n.hideFlags|=T.Flags.DontSave|T.Flags.HideInHierarchy,n.active=!0,t===Be?(i.comp=n.getComponent(D)||n.addComponent(D),i.comp.spriteFrame=e,i.comp.type=D.Type.SLICED,i.comp.sizeMode=D.SizeMode.CUSTOM):(i.comp=n.getComponent(I)||n.addComponent(I),i.comp.string=e,i.comp.horizontalAlign=H.LEFT,i.comp.verticalAlign=z.TOP,i.comp.underlineHeight=2),n.setPosition(0,0,0),n._uiProps.uiTransformComp.setAnchorPoint(.5,.5),i.node=n,i.lineCount=0,i.styleIndex=0,i.imageOffset="",i.clickParam="",i.clickHandler="",i}var Qe,Ze=t("R",(fe=r("cc.RichText"),de=_(110),me=o(H),ge=o(z),ye=o(F),ve=o(W),be=o(U),fe(Ce=de(((Ne=function(t){function e(){var e;return(e=t.call(this)||this)._lineHeight=Ee&&Ee(),e._string=Se&&Se(),e._horizontalAlign=Re&&Re(),e._verticalAlign=xe&&xe(),e._fontSize=Ae&&Ae(),e._maxWidth=Le&&Le(),e._fontFamily=De&&De(),e._font=Ie&&Ie(),e._isSystemFontUsed=Oe&&Oe(),e._userDefinedFont=Pe&&Pe(),e._cacheMode=ke&&ke(),e._imageAtlas=Me&&Me(),e._handleTouchEvent=we&&we(),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._labelChildrenNum=0,e._updateRichTextStatus=e._updateRichText,e}i(e,t);var r=e.prototype;return r.onLoad=function(){this.node.on(A.LAYER_CHANGED,this._applyLayer,this),this.node.on(A.ANCHOR_CHANGED,this._updateRichTextPosition,this)},r.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},r.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},r.onRestore=function(){},r.onDestroy=function(){for(var t,e=v(this._segments);!(t=e()).done;){var i=t.value;i.node.removeFromParent(),i.type===Ge?Xe.put(i):i.type===Be&&Ye.put(i)}this.node.off(A.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(A.LAYER_CHANGED,this._applyLayer,this)},r._addEventListeners=function(){this.node.on(A.TOUCH_END,this._onTouchEnded,this)},r._removeEventListeners=function(){this.node.off(A.TOUCH_END,this._onTouchEnded,this)},r._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},r._createFontLabel=function(t){return Je(Ge,t)},r._createImage=function(t){return Je(Be,t)},r._onTTFLoaded=function(){this._font,this._layoutDirty=!0,this._updateRichText()},r.splitLongStringApproximatelyIn2048=function(t,e){var i=[];if(t.length*this.fontSize<=1638.4)return i.push(t),i;if(this._calculateSize(je,e,t),je.x<2048)i.push(t);else for(var n=t.split("\n"),s=0;s<n.length;s++)if(this._calculateSize(je,e,n[s]),je.x<2048)i.push(n[s]);else{var r=this.splitLongStringOver2048(n[s],e);i.push.apply(i,r)}return i},r.splitLongStringOver2048=function(t,e){var i=[],n=t,s=0,r=n.length/2,o=n.substring(s,r),a=n.substring(r),h=this._calculateSize(je,e,o),l=this._calculateSize(Ve,e,a),c=this._maxWidth;0===this._maxWidth&&(c=2047.9);for(var u=1*c;h.x>u;){if((r/=2)<1){r*=2;break}o=o.substring(s,r),a=n.substring(r),this._calculateSize(h,e,o)}for(var p=1e3,_=1;p&&s<t.length;){for(;p&&h.x<u;){var f=O(a);f&&f.length>0&&(_=f[0].length),r+=_,o=n.substring(s,r),a=n.substring(r),this._calculateSize(h,e,o),p--}for(;p&&o.length>=2&&h.x>u;)r-=_,o=n.substring(s,r),this._calculateSize(h,e,o),_=1,p--;if(o.length>=2){var d=P(o);d&&d.length>0&&o!==d[0]&&(r-=d[0].length,o=n.substring(s,r))}if(i.push(o),s=r,r+=o.length,o=n.substring(s,r),a=n.substring(r),this._calculateSize(l,e,a),this._calculateSize(h,e,o),p--,l.x<2048&&h.x<u){i.push(o),s=t.length,r=t.length,o=a,""!==a&&i.push(o);break}}return i},r._measureText=function(t,e){var i=this,n=function(e){return i._calculateSize(je,t,e).x};return e?n(e):n},r._calculateSize=function(t,e,i){var s;0===this._labelSegmentsCache.length?(s=this._createFontLabel(i),this._labelSegmentsCache.push(s)):(s=this._labelSegmentsCache[0]).node.getComponent(I).string=i,s.styleIndex=e,this._applyTextAttribute(s);var r=s.node._uiProps.uiTransformComp.contentSize;return n.set(t,r.x,r.y),t},r._onTouchEnded=function(t){for(var e,i=this,n=this.node.getComponents(L),s=function(){var s=e.value,r=s.clickHandler,o=s.clickParam;r&&i._containsTouchLocation(s,t.touch.getUILocation())&&(n.forEach((function(e){var i=e[r];e.enabledInHierarchy&&i&&i.call(e,t,o)})),t.propagationStopped=!0)},r=v(this._segments);!(e=r()).done;)s()},r._containsTouchLocation=function(t,e){var i=t.node.getComponent(rt);return!!i&&i.getBoundingBoxToWorld().contains(e)},r._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var i=t[e];if(i.name===Ge||i.name===Be){i.parent=null;var n=qe(i.name);n.node=i,i.name===Ge?(n.comp=i.getComponent(I),Xe.put(n)):(n.comp=i.getComponent(D),Ye.put(n)),this._labelChildrenNum--}}this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},r._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var i=this.node.children[e];i.name!==Ge&&i.name!==Be||(i.active=t)}},r._addLabelSegment=function(t,e){var i;if(0===this._labelSegmentsCache.length)i=this._createFontLabel(t);else{var n=(i=this._labelSegmentsCache.pop()).node.getComponent(I);n&&(n.string=t)}var s=i.comp;return s.verticalAlign!==this._verticalAlign&&(s.verticalAlign=this._verticalAlign),i.styleIndex=e,i.lineCount=this._lineCount,i.node._uiProps.uiTransformComp.setAnchorPoint(0,0),i.node.layer=this.node.layer,this.node.insertChild(i.node,this._labelChildrenNum++),this._applyTextAttribute(i),this._segments.push(i),i},r._updateRichTextWithMaxWidth=function(t,e,i){var n=e;if(this._lineOffsetX>0&&n+this._lineOffsetX>this._maxWidth)for(var s=0;this._lineOffsetX<=this._maxWidth;){var r=this._getFirstWordLen(t,s,t.length),o=t.substr(s,r),a=this._measureText(i,o);if(!(this._lineOffsetX+a<=this._maxWidth)){if(s>0){var h=t.substr(0,s);this._addLabelSegment(h,i),t=t.substr(s,t.length),n=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=a,s+=r}if(n>this._maxWidth)for(var l=k(t,n,this._maxWidth,this._measureText(i)),c=0;c<l.length;++c){var u=l[c],p=this._addLabelSegment(u,i).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=p.width,l.length>1&&c<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=n,this._addLabelSegment(t,i)},r._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},r._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},r._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var i=this._textArray[e],n=t[e];if(i.text!==n.text)return!0;var s=i.style,r=n.style;if(s){if(r){if(!!r.outline!=!!s.outline)return!0;if(s.size!==r.size||s.italic!==r.italic||s.isImage!==r.isImage)return!0;if(s.src!==r.src||s.imageAlign!==r.imageAlign||s.imageHeight!==r.imageHeight||s.imageWidth!==r.imageWidth||s.imageOffset!==r.imageOffset)return!0}else if(s.size||s.italic||s.isImage||s.outline)return!0}else if(r&&(r.size||r.italic||r.isImage||r.outline))return!0}return!1},r._addRichTextImageElement=function(t){if(t.style){var e=t.style,i=e.src,n=this._imageAtlas&&i&&this._imageAtlas.getSpriteFrame(i);if(n){var s=this._createImage(n);switch(s.comp,e.imageAlign){case"top":s.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":s.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:s.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}e.imageOffset&&(s.imageOffset=e.imageOffset),s.node.layer=this.node.layer,this.node.insertChild(s.node,this._labelChildrenNum++),this._segments.push(s);var r=n.rect.clone(),o=1,h=r.width,l=r.height,c=e.imageWidth||0,u=e.imageHeight||0;u>0?(h*=o=u/l,l*=o):(h*=o=this._lineHeight/l,l*=o),c>0&&(h=c),this._maxWidth>0?(this._lineOffsetX+h>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=h):(this._lineOffsetX+=h,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),s.node._uiProps.uiTransformComp.setContentSize(h,l),s.lineCount=this._lineCount,s.clickHandler="",s.clickParam="";var p=e.event;p&&(s.clickHandler=p.click,s.clickParam=p.param)}else a(4400)}},r._updateRichText=function(){if(this.enabledInHierarchy){var t=Ue.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,i=!1,n=0;n<this._textArray.length;++n){var s=this._textArray[n],r=s.text;if(void 0!==r){if(""===r){if(s.style&&s.style.isNewLine){this._updateLineInfo();continue}if(s.style&&s.style.isImage&&this._imageAtlas){this._addRichTextImageElement(s);continue}}for(var o=(r=this.splitLongStringApproximatelyIn2048(r,n).join("\n")).split("\n"),a=0;a<o.length;++a){var h=o[a];if(""!==h)if(i=!1,this._maxWidth>0){var l=this._measureText(n,h);this._updateRichTextWithMaxWidth(h,l,n),o.length>1&&a<o.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(h,n),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),o.length>1&&a<o.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(r)&&a===o.length-1)continue;this._updateLineInfo(),i=!0}}}}i||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+M)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},r._getFirstWordLen=function(t,e,i){var n=t.charAt(e);if(w(n)||N(n))return 1;for(var s=1,r=e+1;r<i&&(n=t.charAt(r),!N(n)&&!w(n));++r)s++;return s},r._updateRichTextPosition=function(){for(var t=0,e=1,i=this._lineCount,n=this.node._uiProps.uiTransformComp,s=n.anchorX,r=n.anchorY,o=0;o<this._segments.length;++o){var a=this._segments[o],h=a.lineCount;h>e&&(t=0,e=h);var l=this._labelWidth*(.5*this._horizontalAlign-s);switch(this._horizontalAlign){case H.LEFT:break;case H.CENTER:l-=this._linesWidth[h-1]/2;break;case H.RIGHT:l-=this._linesWidth[h-1]}var c=a.node.position;if(a.node.setPosition(t+l,this._lineHeight*(i-h)-this._labelHeight*r,c.z),h===e&&(t+=a.node._uiProps.uiTransformComp.width),a.node.getComponent(D)){var u=a.node.position.clone(),p=this._lineHeight,_=this._lineHeight*(1+M);switch(a.node._uiProps.uiTransformComp.anchorY){case 1:u.y+=p+(_-p)/2;break;case.5:u.y+=_/2;break;default:u.y+=(_-p)/2}if(a.imageOffset){var f=a.imageOffset.split(",");if(1===f.length&&f[0]){var d=parseFloat(f[0]);Number.isInteger(d)&&(u.y+=d)}else if(2===f.length){var m=parseFloat(f[0]),g=parseFloat(f[1]);Number.isInteger(m)&&(u.x+=m),Number.isInteger(g)&&(u.y+=g)}}a.node.position=u}var y=a.node.getComponent(We);if(y){var v=a.node.position.clone();v.y-=y.width,a.node.position=v}}},r._convertLiteralColorValue=function(t){var e=t.toUpperCase();return s[e]?s[e]:(new s).fromHEX(t)},r._applyTextAttribute=function(t){var e=t.node.getComponent(I);if(e){this._resetLabelState(e);var i,n=t.styleIndex;if(this._textArray[n]&&(i=this._textArray[n].style),i){if(e.color=this._convertLiteralColorValue(i.color||"white"),e.isBold=!!i.bold,e.isItalic=!!i.italic,e.isUnderline=!!i.underline,i.outline){var s=t.node.getComponent(We);s||(s=t.node.addComponent(We)),s.color=this._convertLiteralColorValue(i.outline.color),s.width=i.outline.width}e.fontSize=i.size||this._fontSize,t.clickHandler="",t.clickParam="";var r=i.event;r&&(t.clickHandler=r.click||"",t.clickParam=r.param||"")}e.cacheMode=this._cacheMode,this._font instanceof F&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0)}},r._applyLayer=function(){for(var t,e=v(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},r._resetLabelState=function(t){t.fontSize=this._fontSize,t.color=s.WHITE,t.isBold=!1,t.isItalic=!1,t.isUnderline=!1},h(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),e}(L)).HorizontalAlign=H,Ne.VerticalAlign=z,l((Te=Ne).prototype,"horizontalAlign",[me],Object.getOwnPropertyDescriptor(Te.prototype,"horizontalAlign"),Te.prototype),l(Te.prototype,"verticalAlign",[ge],Object.getOwnPropertyDescriptor(Te.prototype,"verticalAlign"),Te.prototype),l(Te.prototype,"font",[ye],Object.getOwnPropertyDescriptor(Te.prototype,"font"),Te.prototype),l(Te.prototype,"cacheMode",[ve],Object.getOwnPropertyDescriptor(Te.prototype,"cacheMode"),Te.prototype),l(Te.prototype,"imageAtlas",[be],Object.getOwnPropertyDescriptor(Te.prototype,"imageAtlas"),Te.prototype),Ee=u(Te.prototype,"_lineHeight",[d],(function(){return 40})),Se=u(Te.prototype,"_string",[d],(function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"})),Re=u(Te.prototype,"_horizontalAlign",[d],(function(){return H.LEFT})),xe=u(Te.prototype,"_verticalAlign",[d],(function(){return z.TOP})),Ae=u(Te.prototype,"_fontSize",[d],(function(){return 40})),Le=u(Te.prototype,"_maxWidth",[d],(function(){return 0})),De=u(Te.prototype,"_fontFamily",[d],(function(){return"Arial"})),Ie=u(Te.prototype,"_font",[d],(function(){return null})),Oe=u(Te.prototype,"_isSystemFontUsed",[d],(function(){return!0})),Pe=u(Te.prototype,"_userDefinedFont",[d],(function(){return null})),ke=u(Te.prototype,"_cacheMode",[d],(function(){return W.NONE})),Me=u(Te.prototype,"_imageAtlas",[d],(function(){return null})),we=u(Te.prototype,"_handleTouchEvent",[d],(function(){return!0})),Ce=Te))||Ce)||Ce));p.RichText=Ze;var $e=t("U",r("cc.UIMeshRenderer")(Qe=_(110)(Qe=function(t){function e(){var e;return(e=t.call(this)||this)._modelComponent=null,e._dirtyVersion=-1,e._internalId=-1,e.stencilStage=st.DISABLED,e._renderData=null,e._renderEntity=new tt(et.DYNAMIC),e}i(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){J.addRenderer(this),this.markForUpdateRenderData()},n.onDisable=function(){J.removeRenderer(this),this.renderEntity.enabled=this._canRender()},n.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.ModelRenderer"),this._modelComponent?this.renderEntity.setNode(this.node):console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},n.onDestroy=function(){this.renderEntity.setNode(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this._modelComponent=this.getComponent("cc.ModelRenderer"),this._modelComponent&&(this._modelComponent._sceneGetter=null)},n._render=function(t){if(this._modelComponent){var e=this._modelComponent._collectModels();this._modelComponent._detachFromScene();for(var i=0;i<e.length;i++)e[i].enabled&&t.commitModel(this,e[i],this._modelComponent.material);return!0}return!1},n.fillBuffers=function(t){this.enabled&&this._render(t)},n.updateRenderer=function(){},n._uploadRenderData=function(){},n.postUpdateAssembler=function(){},n.update=function(){this._fitUIRenderQueue()},n._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var i=this._modelComponent.getMaterialInstance(e);if(null!=i)for(var n=i.passes,s=n.length,r=0;r<s;r++)n[r].setPriority(at.MAX-11),i.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},r)}},n.markForUpdateRenderData=function(){J.markDirtyRenderer(this)},n.setNodeDirty=function(){},n.setTextureDirty=function(){},n._canRender=function(){return this.enabled&&null!==this._modelComponent},h(e,[{key:"modelComponent",get:function(){return this._modelComponent}},{key:"renderEntity",get:function(){return this._renderEntity}},{key:"renderData",get:function(){return this._renderData}}]),e}(L))||Qe)||Qe);p.UIMeshRenderer=$e;var Ke,ti,ei,ii,ni,si,ri,oi,ai,hi,li=ht.Enum.NONE|ht.Enum.UI_3D,ci=t("D",function(){function t(){this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._passes=[],this._shaders=[],this._visFlags=li,this._inputAssembler=null,this._descriptorSet=null}var e=t.prototype;return e.destroy=function(){this._passes=[]},e.clear=function(){this._inputAssembler=null,this._descriptorSet=null,this.texture=null,this.sampler=null,this.textureHash=0,this.samplerHash=0,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=li},e.fillPasses=function(t,e,i,n){if(t){var s=t.passes;if(!s)return;this._shaders.length=s.length;for(var r=0;r<s.length;r++){this._passes[r]||(this._passes[r]=new V(p.director.root));var o=s[r],a=this._passes[r];o.update(),e||(e=o.depthStencilState,i=0),a._initPassFromTarget(o,e,i),this._shaders[r]=a.getShaderVariant(n)}}},h(t,[{key:"inputAssembler",get:function(){return this._inputAssembler},set:function(t){this._inputAssembler=t}},{key:"descriptorSet",get:function(){return this._descriptorSet},set:function(t){this._descriptorSet=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"passes",get:function(){return this._passes}},{key:"shaders",get:function(){return this._shaders}}]),t}()),ui=t("a",r("cc.UIStaticBatch")(Ke=_(110)((ti=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._init=!1,e._bufferAccessor=null,e._dirty=!0,e._uiDrawBatchList=[],e}i(e,t);var n=e.prototype;return n.postUpdateAssembler=function(){},n.markAsDirty=function(){},n._requireDrawBatch=function(){var t=new ci;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},n._clearData=function(){if(this._bufferAccessor){this._bufferAccessor.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},n._getBatcher=function(){return X.root&&X.root.batcher2D?X.root.batcher2D:(a(9301),null)},h(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(it),l(ti.prototype,"color",[c],Object.getOwnPropertyDescriptor(ti.prototype,"color"),ti.prototype),Ke=ti))||Ke)||Ke),pi=(t("b",r("cc.LabelShadow")(ei=_(110)(ei=b(I)((ii=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._color=ni&&ni(),e._offset=si&&si(),e._blur=ri&&ri(),e}i(e,t);var n=e.prototype;return n.onEnable=function(){this._updateRenderData()},n.onDisable=function(){this._updateRenderData()},n._updateRenderData=function(){var t=this.node.getComponent(I);t&&t.updateRenderData(!0)},h(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()}}]),e}(L),ni=u(ii.prototype,"_color",[d],(function(){return new s(0,0,0,255)})),si=u(ii.prototype,"_offset",[d],(function(){return new n(2,2)})),ri=u(ii.prototype,"_blur",[d],(function(){return 2})),ei=ii))||ei)||ei)||ei),t("c",r("cc.UIOpacity")(oi=_(110)(oi=E((ai=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._opacity=hi&&hi(),e}i(e,t);var n=e.prototype;return n.setEntityLocalOpacityDirtyRecursively=function(){},e.setEntityLocalOpacityDirtyRecursively=function(t,i,n){if(t.isValid){var s=t._uiProps.uiComp,r=t.getComponent(e),o=n;s&&s.color?(s.renderEntity.colorDirty=i,s.renderEntity.localOpacity=r?o*r.opacity/255:o,o=1):r&&(o=o*r.opacity/255);for(var a=0;a<t.children.length;a++)e.setEntityLocalOpacityDirtyRecursively(t.children[a],i||o<1,o)}},n.onEnable=function(){this.node._uiProps.localOpacity=this._opacity/255,this.setEntityLocalOpacityDirtyRecursively(!0)},n.onDisable=function(){this.node._uiProps.localOpacity=1,this.setEntityLocalOpacityDirtyRecursively(!0)},h(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=S(t,0,255),this._opacity=t,this.node._uiProps.localOpacity=t/255,this.setEntityLocalOpacityDirtyRecursively(!0))}}]),e}(L),hi=u(ai.prototype,"_opacity",[d],(function(){return 255})),oi=ai))||oi)||oi)||oi));p.MaskComponent=le,R(le,"cc.MaskComponent"),p.LabelComponent=I,R(I,"cc.LabelComponent"),p.LabelOutlineComponent=We,R(We,"cc.LabelOutlineComponent"),p.RichTextComponent=Ze,R(Ze,"cc.RichTextComponent"),p.SpriteComponent=D,R(D,"cc.SpriteComponent"),p.UIModelComponent=$e,R($e,"cc.UIModelComponent"),p.GraphicsComponent=ne,R(ne,"cc.GraphicsComponent"),R(ui,"cc.UIStaticBatchComponent"),R(pi,"cc.UIOpacityComponent"),x(le.prototype,"Mask",[{name:"graphics",newName:"subComp",target:le.prototype,targetName:"Mask"}]),x(se,"MaskType",[{name:"RECT",newName:"GRAPHICS_RECT",target:se,targetName:"MaskType"},{name:"ELLIPSE",newName:"GRAPHICS_ELLIPSE",target:se,targetName:"MaskType"},{name:"IMAGE_STENCIL",newName:"SPRITE_STENCIL",target:se,targetName:"MaskType"}])}}}));
