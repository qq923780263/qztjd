System.register(["./index-68ccac70.js","./find-222dc7da.js","./director-56fe9b8d.js","./pipeline-state-manager-8f16c5a7.js","./node-event-40319828.js","./buffer-barrier-d1733967.js"],(function(t){"use strict";var e,r,i,o,n,s,a,c,h,_,p,u,f,y,m,l,g,d,T,v,P,S,w,b,x,O,k,C,E,j;return{setters:[function(t){e=t.bD,r=t.cr,i=t.bA,o=t.bx,n=t.bE,s=t.b$,a=t.ck,c=t.o,h=t.aa,_=t.bF,p=t.bw,u=t.l,f=t.N,y=t.bg,m=t.B,l=t.y},function(t){g=t.T,d=t.a7},function(t){T=t.a,v=t.C,P=t.b,S=t.d,w=t.c,b=t.S,x=t.e,O=t.T},function(t){k=t.b,C=t.C},function(t){E=t.C},function(t){j=t.J}],execute:function(){var A,D,F,I,R,L,N,H,W,z,M,V,G,U,X,B,Y,K,J,$,q,Q,Z,tt,et,rt,it,ot,nt,st,at,ct,ht,_t,pt,ut,ft,yt,mt,lt,gt,dt=t("P",e("cc.PostProcess")(A=r(((L=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).global=F&&F(),e._shadingScale=I&&I(),e.enableShadingScaleInEditor=R&&R(),e.settings=new Map,e}i(e,t);var r=e.prototype;return r.addSetting=function(t){this.settings.set(t.constructor,t)},r.removeSetting=function(t){this.settings.delete(t.constructor)},r.getSetting=function(t){return this.settings.get(t)},r.onEnable=function(){e.all.push(this)},r.onDisable=function(){var t=e.all.indexOf(this);-1!==t&&e.all.splice(t,1)},o(e,[{key:"shadingScale",get:function(){return this._shadingScale},set:function(t){this._shadingScale=t}}]),e}(E)).all=[],F=n((D=L).prototype,"global",[a],(function(){return!0})),I=n(D.prototype,"_shadingScale",[a],(function(){return 1})),s(D.prototype,"shadingScale",[a],Object.getOwnPropertyDescriptor(D.prototype,"shadingScale"),D.prototype),R=n(D.prototype,"enableShadingScaleInEditor",[a],(function(){return!1})),A=D))||A)||A),Tt=new c,vt=h(T),Pt=h(v),St=h(P),wt=h(S),bt=h(w),xt=h({SKYBOX:b|j.DEPTH_STENCIL,SOLID_COLOR:j.ALL,DEPTH_ONLY:j.DEPTH_STENCIL,DONT_CLEAR:j.NONE}),Ot=t("C",(N=e("cc.Camera"),H=_(k.BitMask),W=_(xt),z=_(vt),M=_(Pt),V=_(St),G=_(wt),U=_(bt),X=_(d),B=_(dt),N(((gt=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this)._projection=J&&J(),e._priority=$&&$(),e._fov=q&&q(),e._fovAxis=Q&&Q(),e._orthoHeight=Z&&Z(),e._near=tt&&tt(),e._far=et&&et(),e._color=rt&&rt(),e._depth=it&&it(),e._stencil=ot&&ot(),e._clearFlags=nt&&nt(),e._rect=st&&st(),e._aperture=at&&at(),e._shutter=ct&&ct(),e._iso=ht&&ht(),e._screenScale=_t&&_t(),e._visibility=pt&&pt(),e._targetTexture=ut&&ut(),e._postProcess=ft&&ft(),e._usePostProcess=yt&&yt(),e._camera=null,e._inEditorMode=!1,e._flows=void 0,e._cameraType=mt&&mt(),e._trackingType=lt&&lt(),e}i(e,t);var r=e.prototype;return r.onLoad=function(){this._createCamera()},r.onEnable=function(){this.node.hasChangedFlags|=g.POSITION,this._camera&&this._attachToScene()},r.onDisable=function(){this._camera&&this._detachFromScene()},r.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},r.screenPointToRay=function(t,e,r){return r||(r=p.create()),this._camera&&this._camera.screenPointToRay(r,t,e),r},r.worldToScreen=function(t,e){return e||(e=new c),this._camera&&this._camera.worldToScreen(e,t),e},r.screenToWorld=function(t,e){return e||(e=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(e,t),e},r.convertToUINode=function(t,e,r){if(r||(r=new c),!this._camera)return r;this.worldToScreen(t,Tt);var i=e.getComponent("cc.UITransform"),o=u.view.getVisibleSize(),n=Tt.x-.5*this._camera.width,s=Tt.y-.5*this._camera.height;return Tt.x=n/u.view.getScaleX()+.5*o.width,Tt.y=s/u.view.getScaleY()+.5*o.height,i&&i.convertToNodeSpaceAR(Tt,r),r},r._createCamera=function(){this._camera||(this._camera=u.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?u.director.root&&u.director.root.mainWindow:u.director.root&&u.director.root.tempWindow,priority:this._priority,cameraType:this.cameraType,trackingType:this.trackingType}),this._camera.setViewportInOrientedSpace(this._rect),this._camera.fovAxis=this._fovAxis,this._camera.fov=f(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso,this._camera.postProcess=this._postProcess,this._camera.usePostProcess=this._usePostProcess),this._updateTargetTexture()},r._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},r._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},r._checkTargetTextureEvent=function(t){var e=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){e._camera&&e._camera.setFixedSize(t.width,t.height)}),this)},r._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}},o(e,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}},{key:"clearColor",get:function(){return this._color},set:function(t){this._color.set(t),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}},{key:"clearStencil",get:function(){return this._stencil},set:function(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}},{key:"projection",get:function(){return this._projection},set:function(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,t===v.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._camera&&(this._camera.fov=f(t))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._camera&&(this._camera.nearClip=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this._camera&&(this._camera.farClip=t)}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._camera&&(this._camera.iso=t)}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect=t,this._camera&&this._camera.setViewportInOrientedSpace(t)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var r=this._targetTexture;this._targetTexture=t,this._checkTargetTextureEvent(r),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0),this.node.emit(e.TARGET_TEXTURE_CHANGE,this)}}},{key:"usePostProcess",get:function(){return this._usePostProcess},set:function(t){this._usePostProcess=t,this._camera&&(this._camera.usePostProcess=t)}},{key:"postProcess",get:function(){return this._postProcess},set:function(t){this._postProcess=t,this._camera&&(this._camera.postProcess=t)}},{key:"screenScale",get:function(){return this._screenScale},set:function(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(t){this._inEditorMode=t,this._camera&&this._camera.changeTargetWindow(t?u.director.root&&u.director.root.mainWindow:u.director.root&&u.director.root.tempWindow)}},{key:"cameraType",get:function(){return this._cameraType},set:function(t){this._cameraType!==t&&(this._cameraType=t,this.camera&&(this.camera.cameraType=t))}},{key:"trackingType",get:function(){return this._trackingType},set:function(t){this._trackingType!==t&&(this._trackingType=t,this.camera&&(this.camera.trackingType=t))}}]),e}(E)).ProjectionType=vt,gt.FOVAxis=Pt,gt.ClearFlag=xt,gt.Aperture=St,gt.Shutter=wt,gt.ISO=bt,gt.TARGET_TEXTURE_CHANGE="tex-change",J=n((K=gt).prototype,"_projection",[y],(function(){return vt.PERSPECTIVE})),$=n(K.prototype,"_priority",[y],(function(){return 0})),q=n(K.prototype,"_fov",[y],(function(){return 45})),Q=n(K.prototype,"_fovAxis",[y],(function(){return Pt.VERTICAL})),Z=n(K.prototype,"_orthoHeight",[y],(function(){return 10})),tt=n(K.prototype,"_near",[y],(function(){return 1})),et=n(K.prototype,"_far",[y],(function(){return 1e3})),rt=n(K.prototype,"_color",[y],(function(){return new m("#333333")})),it=n(K.prototype,"_depth",[y],(function(){return 1})),ot=n(K.prototype,"_stencil",[y],(function(){return 0})),nt=n(K.prototype,"_clearFlags",[y],(function(){return xt.SOLID_COLOR})),st=n(K.prototype,"_rect",[y],(function(){return new l(0,0,1,1)})),at=n(K.prototype,"_aperture",[y],(function(){return St.F16_0})),ct=n(K.prototype,"_shutter",[y],(function(){return wt.D125})),ht=n(K.prototype,"_iso",[y],(function(){return bt.ISO100})),_t=n(K.prototype,"_screenScale",[y],(function(){return 1})),pt=n(K.prototype,"_visibility",[y],(function(){return C})),ut=n(K.prototype,"_targetTexture",[y],(function(){return null})),ft=n(K.prototype,"_postProcess",[y],(function(){return null})),yt=n(K.prototype,"_usePostProcess",[y],(function(){return!1})),mt=n(K.prototype,"_cameraType",[y],(function(){return x.DEFAULT})),lt=n(K.prototype,"_trackingType",[y],(function(){return O.NO_TRACKING})),s(K.prototype,"visibility",[H],Object.getOwnPropertyDescriptor(K.prototype,"visibility"),K.prototype),s(K.prototype,"clearFlags",[W],Object.getOwnPropertyDescriptor(K.prototype,"clearFlags"),K.prototype),s(K.prototype,"projection",[z],Object.getOwnPropertyDescriptor(K.prototype,"projection"),K.prototype),s(K.prototype,"fovAxis",[M],Object.getOwnPropertyDescriptor(K.prototype,"fovAxis"),K.prototype),s(K.prototype,"aperture",[V],Object.getOwnPropertyDescriptor(K.prototype,"aperture"),K.prototype),s(K.prototype,"shutter",[G],Object.getOwnPropertyDescriptor(K.prototype,"shutter"),K.prototype),s(K.prototype,"iso",[U],Object.getOwnPropertyDescriptor(K.prototype,"iso"),K.prototype),s(K.prototype,"targetTexture",[X],Object.getOwnPropertyDescriptor(K.prototype,"targetTexture"),K.prototype),s(K.prototype,"usePostProcess",[a],Object.getOwnPropertyDescriptor(K.prototype,"usePostProcess"),K.prototype),s(K.prototype,"postProcess",[B],Object.getOwnPropertyDescriptor(K.prototype,"postProcess"),K.prototype),Y=K))||Y));u.Camera=Ot}}}));
